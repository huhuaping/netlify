<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <title>10-dummy-model-slide.utf8.md</title>
    <meta charset="utf-8" />
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/default-fonts.css" rel="stylesheet" />
    <link href="libs/remark-css/duke-blue.css" rel="stylesheet" />
    <link href="libs/remark-css/hygge-duke.css" rel="stylesheet" />
    <script src="libs/htmlwidgets/htmlwidgets.js"></script>
    <script src="libs/jquery/jquery.min.js"></script>
    <link href="libs/datatables-css/datatables-crosstalk.css" rel="stylesheet" />
    <script src="libs/datatables-binding/datatables.js"></script>
    <link href="libs/dt-core/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="libs/dt-core/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="libs/dt-core/js/jquery.dataTables.min.js"></script>
    <link href="libs/crosstalk/css/crosstalk.css" rel="stylesheet" />
    <script src="libs/crosstalk/js/crosstalk.min.js"></script>
    <link rel="stylesheet" href="libs\cc-fonts.css" type="text/css" />
    <link rel="stylesheet" href="libs\figure-captions.css" type="text/css" />
    <link rel="stylesheet" href="libs\animate.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">

background-image: url("pic/slide-front-page.jpg")
class: center,middle

# 计量经济学(Econometrics)

### 胡华平

### 西北农林科技大学

### 经济管理学院数量经济教研室

### huhuaping01@hotmail.com

### 2019-04-15





&lt;style type="text/css"&gt;
.remark-slide-content {
    font-size: 22px;
    padding: 1em 4em 1em 4em;
}

.page-font-16 {
  font-size: 16px;
}

&lt;/style&gt;

---
class: center, middle,inverse
# 第10章：虚拟变量回归模型


方差分析(ANOVA) 模型

虚拟变量的设置规则

含有两个定性变量的ANOVA模型

同时含有定性和定量变量的ANOVA 模型

虚拟变量的引入方式

一个总结性案例



---
class: center, middle,inverse
# 知识回顾

---
## 变量类型


**定量变量**（Quantitative variable）一般也称为连续变量，是由测量或计数、统计所得到的量，可以通过数值表达，并具有直接的数值含义。

**定性变量**（qualitative variables）：又被称为指标变量（indicator variables）、分类变量（categorical variables），主要用于区分事物性质差异，往往用语义类别表达，没有直接的数值含义。

- 性别（男；女）

- 肤色（黄色；白色；黑色；其他）

- 种族、宗教、国籍、地区、政治动乱和党派等。

&gt; **提问**：定性变量怎样表达出来？如何数量化？

---
## 变量尺度

**变量尺度**（Variable scale）：刻画的是变量的数值含义或数值关系。它将意味着在数值含义和关系上，变量是有层次级别的差异性。根据变量层级不同，具体可以分为由低到高的4个层级：

- **名义尺度（nominal scale）变量**：这类变量只用于属性分类，不具备任何数值含义或数值关系，也即不能加、减、乘、除，也不能比较大小。

- **序数尺度（order scale）变量**：这类变量具备很少的数值含义或数值关系，它可以比较大小，但不能进行加、减、乘、除。

- **区间尺度（interval scale）变量**：这类变量具备一定的数值含义或数值关系，它可以比较大小，也可以进行加、减，但不能进行乘、除。

- **比率尺度（ratio scale）变量**：这类变量具备最多的数值含义或数值关系，它可以比较大小，也可以进行加、减、乘、除。

---
### 区域经理年薪案例（数据）



<div id="htmlwidget-9b8929729e503dec5eb1" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-9b8929729e503dec5eb1">{"x":{"filter":"none","caption":"<caption>变量类型和变量尺度<\/caption>","data":[["Zhang","Tom","Lee","Jeff","Kevin"],[25,35,27,42,38],[140,195,184,256,207],[2,3,1,5,4],["yellow","white","yellow","white","black"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>staff<\/th>\n      <th>salary<\/th>\n      <th>sale<\/th>\n      <th>score<\/th>\n      <th>race<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","columnDefs":[{"className":"dt-center","targets":"_all"}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>

**区域经理年薪案例**中，公司有五名区域经理，分别负责不同的国际市场。

定量变量
`\(salary\)`表示区域经理的年薪（万元）；变量
`\(sale\)`表示负责市场的销售额；变量
`\(score\)`表示客户对区域经理的评价（1表示很不满意，2表示不满意，3表示一般，4表示很满意，5表示非常满意）；变量
`\(race\)`表示区域市场主要消费群体的肤色（yellow表示黄色消费群体、white表示白色消费群体，black表示黑色消费群体）。

---
### 区域经理年薪案例（变量）

<div id="htmlwidget-3f94bc686c9ca0570e47" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-3f94bc686c9ca0570e47">{"x":{"filter":"none","caption":"<caption>变量类型和变量尺度<\/caption>","data":[["Zhang","Tom","Lee","Jeff","Kevin"],[25,35,27,42,38],[140,195,184,256,207],[2,3,1,5,4],["yellow","white","yellow","white","black"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>staff<\/th>\n      <th>salary<\/th>\n      <th>sale<\/th>\n      <th>score<\/th>\n      <th>race<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","columnDefs":[{"className":"dt-center","targets":"_all"}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>

根据以上定义，**区域经理年薪案例**中，可以认为年薪
`\(salary\)`、销售额
`\(sale\)`，以及客户评价
`\(score\)`为**定量变量**，消费群体主要肤色
`\(race\)`为**定性变量**。

从变量的度量尺度来看：

- 年薪
`\(salary\)`和销售额
`\(sale\)`两个变量为**比率尺度**变量
- 客户评价
`\(score\)`变量为**序数尺度**变量
- 消费群体主要肤色
`\(race\)`为**名义尺度**变量

---
class: center, middle,inverse
# 虚拟变量的设置规则

---
## 定性变量对回归模型的影响

计量经济学建模分析中，我们常常需要把一些**定性变量**（Qualitative variables）（如性别、地区、党派等）作为自变量放入回归模型中。从**变量层次**（Variable Scale）来看，这些变量没有具体的取值，只有特定属性类别。例如，性别变量的具体取值往往为男或女。显然，诸如此类的变量如果直接放到线性回归模型中，将会产生一系列的参数估计、模型解释等问题。

`$$\begin{align}
salary_i = \beta_1 +\beta_2sale_i +\beta_3score_i + \beta_4 race_i + u_i
\end{align}$$`

- 一个**定性变量**的不同数据取值，称为该定性变量的**属性**。

- 定性变量的任一属性，都可以设置为一个**虚拟变量**。

- 我们可以用一套**虚拟变量体系**来完全表达一个定性变量。

- 按照一定的规则构建虚拟变量回归模型，从而避免参数估计、模型解释等问题的出现。

---
## 虚拟变量的定义

**虚拟变量**（dummy variable）：将取值为0和1的**人造变量**称为虚拟变量。

- 对定性变量的量化可采用虚拟变量的方式实现。

- 一般而言，1表示出现（或具备）某种属性，0表示没有（或不具备）某种属性。

对于某定性变量的任一特定属性，可以构造出一个虚拟变量（记为D），使得该虚拟变量能够表达这一属性。同时，给该虚拟变量D赋值为1，记为具备这一属性；给该虚拟变量赋值为0，记为不具备该属性。

正式地，假设定性变量
`\(X\)`具有
`\(m\)`个属性
`\(a_1,a_2,\cdots,a_m\)`，对于任意属性
`\(k,(k\in{1,2,\cdots,m})\)`，可以定义如下的虚拟变量
`\(D_k\)`：

`$$\begin{align}
D_k=
  \begin{cases}
  1, &amp; \text{if } a_k \\
  0, &amp; \text{if not }  a_k
  \end{cases}
\end{align}$$`

---
### 区域经理年薪案例（虚拟变量）

**区域经理年薪**案例中，**定性变量**`race`（人种，其取值为黄种人/白种人/黑种人），可以构造出3个虚拟变量

`$$\begin{align}
race\{a_1=\text{yellow},a_2=\text{white},a_3=\text{black}\} \\
dummy \Longrightarrow  
  \begin{cases}
    D_1  =
    \begin{cases}
    1, &amp; \text{yellow}\\
    0, &amp; \text{not yellow}
    \end{cases} \\
    D_2 = 
    \begin{cases}
    1, &amp; \text{white}\\
    0, &amp; \text{not white}
    \end{cases} \\
    D_3  =
    \begin{cases}
    1, &amp; \text{black}\\
    0, &amp; \text{not black}
    \end{cases}
  \end{cases}
\end{align}$$`

---
## 虚拟变量体系

**虚拟变量体系**：完整表达某个定性变量全部信息的一组虚拟变量。

正式地，假设定性变量
`\(X\)`具有
`\(m\)`个属性
`\(a_1,a_2,\cdots,a_m\)`，可以用如下一组虚拟变量
`\(D_1,\cdots,D_k,\cdots,D_m\)`完全表达该定性变量：

`$$\begin{align}
X\{a_1,a_2,\cdots,a_m\} \Rightarrow  
  \begin{cases}
    D_1  =
    \begin{cases}
    1, &amp; \text{if } a_1\\
    0, &amp; \text{if not }  a_1
    \end{cases} \\
     \vdots \\
    D_k = 
    \begin{cases}
    1, &amp; \text{if } a_k\\
    0, &amp; \text{if not }  a_k
    \end{cases} \\
    \vdots\\
    D_m  =
    \begin{cases}
    1, &amp; \text{if } a_m\\
    0, &amp; \text{if not }  a_m
    \end{cases}
  \end{cases}
\end{align}$$`


---
### 区域经理年薪案例（虚拟变量体系）

实际数据操作中，一般需要对定性变量
`\(race\)`进行重新编码（recode），生成三个对应的虚拟变量。

<div id="htmlwidget-81c6b04c6c704cbfc5ab" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-81c6b04c6c704cbfc5ab">{"x":{"filter":"none","caption":"<caption>把定性变量转变为虚拟变量体系<\/caption>","data":[["Zhang","Tom","Lee","Jeff","Kevin"],[25,35,27,42,38],[140,195,184,256,207],[2,3,1,5,4],["yellow","white","yellow","white","black"],[1,0,1,0,0],[0,1,0,1,0],[0,0,0,0,1]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>staff<\/th>\n      <th>salary<\/th>\n      <th>sale<\/th>\n      <th>score<\/th>\n      <th>race<\/th>\n      <th>race_yellow<\/th>\n      <th>race_white<\/th>\n      <th>race_black<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","columnDefs":[{"className":"dt-center","targets":"_all"}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>

---
class: center, middle,inverse

# 方差分析模型模型（ANOVA model）

---

## 方差分析模型：定义

**区域经理薪水案例**中，如果不区分变量类型和特征，做如下的回归模型，则回归分析结果将会带来严重的问题。

`$$\begin{align}
salary_i = \beta_1 +\beta_2sale_i +\beta_3score_i + \beta_4 race_i + u_i
\end{align}$$`

事实上，应该将上述模型转换为**虚拟变量回归模型**（Dummy model）。

`$$\begin{align}
salary_i &amp; ={\beta}_1 + &amp;&amp;\beta_2sale_i +\beta_3score_i+{\beta}_4race\_yellow_i+{\beta}_5race\_white_i+u_i \\
salary_i &amp; = &amp;&amp;\beta_2sale_i +\beta_3score_i+{\beta}_4race\_yellow_i+{\beta}_5race\_white_i +{\beta}_6race\_black_i+u_i \\
\end{align}$$`

一个线性回归模型，只要回归元中包含了虚拟变量，这种模型就被称为**虚拟变量回归模型**，也可以称为**方差分析模型** （Analysis of variance, ANOVA）。

**方差分析模型**（Analysis of variance, ANOVA）常用来分析定量化的因变量
`\(Y\)`与定性回归元或虚拟变量之间的统计显著性关系。一般是通过比较不同类别或不同组的均值差，例如采用t检验可以判断两组均值是否有显著的差异。


&gt; **提问**：你还能不能设置成其他类型的模型形式？怎样设置才是正确的**方差分析模型**？

---
## 方差分析模型：本质

`$$\begin{align}
salary_i &amp; =\beta_1 + \beta_2sale_i +\beta_3score_i+\beta_4race\_yellow_i+\beta_5race\_white_i+u_i
\end{align}$$`

很显然，在上述总体回归模型下，可以得到所有3类“分组”情形下的期望年薪水平：

`$$\begin{align}
E(Y| &amp; race\_yellow=1,race\_white=0,sale,score) \\
&amp;=\beta_1+\beta_2sale+\beta_3score + \beta_4 &amp;&amp;\text{(market yellow)} \\
E(Y| &amp; race\_yellow=0,race\_white=1,sale,score) \\
&amp;=\beta_1+\beta_2sale+\beta_3score  + \beta_5 &amp;&amp;\text{(market white)} \\
E(Y| &amp; race\_yellow=0,race\_white=0,sale,score) \\
&amp;=\beta_1 +\beta_2sale+\beta_3score &amp;&amp;\text{(market black)}
\end{align}$$`


---
## 方差分析模型：内涵

`$$\begin{align}
salary_i &amp; =\beta_1 + \beta_2sale_i +\beta_3score_i+\beta_4race\_yellow_i+\beta_5race\_white_i+u_i
\end{align}$$`

上述模型被称其为**有截距**的含有虚拟变量的、加法形式的回归模型。显然，虚拟变量
`\(race\_{black}\)`没有进入模型中；模型设置有截距项
`\(\beta_1\)`。在这种设定下，我们称：

- **黑色(black)**为模型的**基础组**

- **黄色(yellow)**和**白色(white)**分别为模型的**比较组**。

- 有序变量
`\(score\)`为**协变量(covariates)**或**控制变量(control variable)**

- 
`\(\beta_1\)`为**截距系数**，代表基础组的期望水平

- 
`\(\beta_2,\beta_3\)`为**极差系数**，代表的是比较组与基础组期望水平的差距

- 
`\(\beta_4\)`为**平行斜率系数**，代表协变量的影响效应

---
## 方差分析模型的类型：数量关系

根据回归元包含**定量变量**和**虚拟变量**的数量关系，可以将虚拟变量回归模型分为：

- 只含有虚拟变量的回归模型：全部解释变量都是由虚拟变量构成

- 同时含有虚拟变量和定量变量的回归模型：解释变量同时含有虚拟变量和定量变量


---
## 方差分析模型的类型：引入方式


根据模型中虚拟变量**引入方式**的不同，可以划分为：

- 加法模型：虚拟变量以独立项的形式出现在方程中

- 乘法模型：虚拟变量以交叉项的形式出现在方程中

- 混合模型：虚拟变量以独立项和/或交叉项的形式出现在方程中^[有时候模型设置中，某个虚拟变量体系（用来表达某个定性变量）的独立项可以完全不出现在方程中（也即没有它们的加法形式），而却可以出现它们与其他变量的交叉项（也即可以出现它们与其他变量的乘法形式）。]
    
    -  完全混合模型
    - 部分混合模型

---
## 方差分析模型的类型：基础组

根据虚拟变量模型是否参照**基础组**，可以划分为：

- 有截距模型：此时模型解释中将有明确的**基础组**，其他组可以直接与之参照对比。

- 无截距模型：此时模型解释中将没有明确的**基础组**，各组间将不直接参照对比。

---
## 方差分析模型的类型：函数形式

根据模型中的因变量
`\(Y\)`是否取对数，可以划分为（半对数或对数模型将蕴含着弹性和斜率的经济学含义，在解释虚拟变量回归模型中往往很有现实意义）：

- 经典线性模型：因变量为
`\(Y\)`

- 半对数模型：因变量为
`\(ln(Y)\)`

---
## 方差分析模型的类型：应用情景

根据虚拟变量模型**应用情景**的不同，可以划分为：

- 截面数据虚拟变量回归模型：此时虚拟变量用于表达回归元为定性变量的情形

- 时间序列季节虚拟变量回归模型：此时虚拟变量用于表达季节周期

- 分段线性虚拟变量回归模型：此时虚拟变量用于表达**阀值**分段


---
## 方差分析模型的类型：综合

对于具体的实证分析案例，我们往往需要根据变量的属性和特征，构建不同类型的虚拟变量回归模型，比较不同模型的回归分析结果，甄选并得到其中相对理想的模型。

例如，仅是考虑**基础组**的有截距模型，可能用到的各类备选组合模型至少包括：

- 只含有虚拟变量的、加法形式的**经典回归模型**
- 只含有虚拟变量的、加法形式的**半对数回归模型**
- 只含有虚拟变量的、乘法形式的**经典回归模型**
- 只含有虚拟变量的、乘法形式的**半对数回归模型**
- 
`\(\cdots\)`
- 同时含有虚拟变量和定量变量的、加法形式的**经典回归模型**
- 同时含有虚拟变量和定量变量的、加法形式的**半对数回归模型**
- 同时含有虚拟变量和定量变量的、乘法形式的**经典回归模型**
- 同时含有虚拟变量和定量变量的、乘法形式的**半对数回归模型**
- 
`\(\cdots\)`

---
class: center, middle,inverse

# 只含有一个定性变量的ANOVA模型

---
## 公立学校教师薪水案例：数据




<div id="htmlwidget-1f327fe2a948487e080c" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-1f327fe2a948487e080c">{"x":{"filter":"none","caption":"<caption>美国三个区域公立学校教师的薪水n=(51)<\/caption>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51"],["Connecticut","Illinois","Indiana","Iowa","Kansas","Maine","Massachusetts","Michigan","Minnesota","Missouri","Nebraska","New Hampshire","New Jersey","New York","North Dakota","Ohio","Pennsylvania","Rhode Island","South Dakota","Vermont","Wisconsin","Alabama","Arkansas","Delaware","District of Columbia","Florida","Georgia","Kentucky","Louisiana","Maryland","Mississippi","North Carolina","Oklahoma","South Carolina","Tennessee","Texas","Virginia","West Virginia","Alaska","Arizona","California","Colorado","Hawaii","Idaho","Montana","Nevada","New Mexico","Oregon","Utah","Washington","Wyoming"],["M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","South","South","South","South","South","South","South","South","South","South","South","South","South","South","South","South","South","West","West","West","West","West","West","West","West","West","West","West","West","West"],[60822,58246,47831,43130,43334,41596,58624,54895,49634,41839,42044,46527,59920,58537,38822,51937,54970,55956,35378,48370,47901,43389,44245,54680,59000,45308,49905,43646,42816,56927,40182,46410,42379,44133,43816,44897,44727,40531,54658,45941,63640,45833,51922,42798,41225,45342,42780,50911,40566,47882,50692],[12436,9275,8935,7807,8373,11285,12596,9880,9675,7840,7900,10206,13781,13551,7807,10034,10711,11089,7911,12475,9965,7706,8402,12036,15508,7762,8534,8300,8519,9771,7215,7675,6944,8377,6979,7547,9275,9886,10171,5585,8486,8861,9879,7042,8361,6755,8622,8649,5347,7958,11596]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>state<\/th>\n      <th>Region<\/th>\n      <th>Salary<\/th>\n      <th>Spend<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"dom":"tip","columnDefs":[{"className":"dt-center","targets":"_all"},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>


- 变量
`\(Salary\)`表示公立学校教师的平均薪水；变量
`\(Spend\)`表示公立学校教师的平均支出；

- 
`\(state\)`表示公立学校所在州名称；
`\(Region\)`表示州所属的区位（`West`表示**西部**州；`M.E.N`表示**中东北部**州；`South`表示**南部**州）。


---
## 公立学校教师薪水案例：描述统计

<div id="htmlwidget-d54fe0f4a57c81ec5903" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-d54fe0f4a57c81ec5903">{"x":{"filter":"none","caption":"<caption>三个区域公立学校教师的平均薪水n=(51)<\/caption>","data":[["M.E.N","South","West"],[21,17,13],[49538.7142857143,46293.5882352941,48014.6153846154],[60822,59000,63640],[35378,40182,40566],[7645.47168030107,5543.64696137416,6400.04621778184]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>Region<\/th>\n      <th>N.state<\/th>\n      <th>Mean.Salary<\/th>\n      <th>Max.Salary<\/th>\n      <th>Min.Salary<\/th>\n      <th>SD.Salary<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","columnDefs":[{"className":"dt-center","targets":"_all"}],"order":[],"autoWidth":false,"orderClasses":false,"rowCallback":"function(row, data) {\nDTWidget.formatRound(this, row, data, 2, 2, 3, ',', '.');\nDTWidget.formatRound(this, row, data, 3, 2, 3, ',', '.');\nDTWidget.formatRound(this, row, data, 4, 2, 3, ',', '.');\nDTWidget.formatRound(this, row, data, 5, 2, 3, ',', '.');\n}"}},"evals":["options.rowCallback"],"jsHooks":[]}</script>

根据以上简单的汇总计算：

- 教师的平均薪水：**中东北部**为49 538.71 美元；**南部**为46 293.59 美元；
西部为48 104.62美元。

- 那么，三个地区的平均薪水在**统计上**也彼此不同吗?


---
## 公立学校教师薪水案例：虚拟变量体系

根据前述定义，我们可以将**定性变量**
`\(Region\)`设置为如下的**虚拟变量体系**：

.pull-left[

`$$\begin{align}
Region\{West; \quad M.E.N; \quad South \} \\
\Rightarrow  
  \begin{cases}
    D_1  =
    \begin{cases}
    1, &amp; \text{if } West\\
    0, &amp; \text{if not }  West
    \end{cases} \\
    D_2 = 
    \begin{cases}
    1, &amp; \text{if } M.E.N\\
    0, &amp; \text{if not }  M.E.N
    \end{cases} \\
    D_3  =
    \begin{cases}
    1, &amp; \text{if } South\\
    0, &amp; \text{if not }  South
    \end{cases}
  \end{cases}
\end{align}$$`

]

.pull-right[

&lt;img src="pic/chpt-10-region-show.png" width="656" style="display: block; margin: auto;" /&gt;

]

---
## 公立学校教师薪水案例：虚拟变量变换

实际建模之前，我们需要把定性变量
`\(Region\)`进行**数据变换**，得到虚拟变量的数据：

<div id="htmlwidget-780d17f773046b539cce" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-780d17f773046b539cce">{"x":{"filter":"none","caption":"<caption>把定性变量Region处理成虚拟变量n=(51)<\/caption>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51"],["Connecticut","Illinois","Indiana","Iowa","Kansas","Maine","Massachusetts","Michigan","Minnesota","Missouri","Nebraska","New Hampshire","New Jersey","New York","North Dakota","Ohio","Pennsylvania","Rhode Island","South Dakota","Vermont","Wisconsin","Alabama","Arkansas","Delaware","District of Columbia","Florida","Georgia","Kentucky","Louisiana","Maryland","Mississippi","North Carolina","Oklahoma","South Carolina","Tennessee","Texas","Virginia","West Virginia","Alaska","Arizona","California","Colorado","Hawaii","Idaho","Montana","Nevada","New Mexico","Oregon","Utah","Washington","Wyoming"],["M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","South","South","South","South","South","South","South","South","South","South","South","South","South","South","South","South","South","West","West","West","West","West","West","West","West","West","West","West","West","West"],[60822,58246,47831,43130,43334,41596,58624,54895,49634,41839,42044,46527,59920,58537,38822,51937,54970,55956,35378,48370,47901,43389,44245,54680,59000,45308,49905,43646,42816,56927,40182,46410,42379,44133,43816,44897,44727,40531,54658,45941,63640,45833,51922,42798,41225,45342,42780,50911,40566,47882,50692],[12436,9275,8935,7807,8373,11285,12596,9880,9675,7840,7900,10206,13781,13551,7807,10034,10711,11089,7911,12475,9965,7706,8402,12036,15508,7762,8534,8300,8519,9771,7215,7675,6944,8377,6979,7547,9275,9886,10171,5585,8486,8861,9879,7042,8361,6755,8622,8649,5347,7958,11596],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>state<\/th>\n      <th>Region<\/th>\n      <th>Salary<\/th>\n      <th>Spend<\/th>\n      <th>D1<\/th>\n      <th>D2<\/th>\n      <th>D3<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"dom":"tip","columnDefs":[{"className":"dt-center","targets":"_all"},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>

---
## 公立学校教师薪水案例：PRM1

我们可以构建薪水（
`\(Salary\)`）对区域虚拟变量（
`\(D2;D3\)`）的**有截距**总体回归模型PRM：

`$$\begin {align} 
Salary_{i}=\beta_{1}+\beta_{2} D2_{ i}+\beta_{3} D3_{ i}+u_{i}
\end {align}$$`

理论上，我们可以得到三个区域教师薪水的期望值：

.pull-left[

`$$\begin{align}
E(Salary|  D2=1,D3=0) 
&amp;=\beta_1+\beta_2 &amp;&amp;\text{(M.E.N)} \\
E(Salary|  D2=0,D3=1) 
&amp;=\beta_1+\beta_3 &amp;&amp;\text{(South)} \\
E(Salary|  D2=0,D3=0) 
&amp;=\beta_1  &amp;&amp;\text{(West)}
\end{align}$$`

]

.pull-right[

&lt;img src="pic/chpt-10-region-show.png" width="656" style="display: block; margin: auto;" /&gt;

]

---
## 公立学校教师薪水案例：OLS估计1



`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{Salary}=&amp;&amp;+48014.62&amp;&amp;+1524.10D2&amp;&amp;-1721.03D3\\ &amp;\text{(t)}&amp;&amp;(25.8532)&amp;&amp;(0.6449)&amp;&amp;(-0.6976)\\&amp;\text{(se)}&amp;&amp;(1857.2037)&amp;&amp;(2363.1394)&amp;&amp;(2467.1508)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.0440;&amp;&amp; \bar{R^2}=0.0041\\&amp; &amp;&amp; F^{\ast}=1.10;&amp;&amp; p=0.3399 \end{alignedat} \end{equation}$$`

&lt;img src="pic/chpt-10-salary-main-ill.png" width="651" style="display: block; margin: auto;" /&gt;

&gt; - 基础组是谁？极差系数的含义？
&gt; - 三个区域的平均薪水具有统计上的显著差异吗？

---
## 公立学校教师薪水案例：OLS估计1

&lt;img src="pic/chpt-10-salary-coef.png" width="506" style="display: block; margin: auto;" /&gt;


.pull-left[
&gt; 提问：
- 基础组该怎样确定？
- 有什么要求么？

]

.pull-right[

&lt;img src="pic/chpt-10-region-show.png" width="454" style="display: block; margin: auto;" /&gt;

]

---
## 公立学校教师薪水案例：PRM2

我们也可以构建薪水（
`\(Salary\)`）对区域虚拟变量（
`\(D1;D2;D3\)`）的**无截距**总体回归模型PRM：

`$$\begin {align} 
Salary_{i}=\alpha_{1} D1_{ i}+\alpha_{2} D2_{ i}+\alpha_{3} D3_{ i}+u_{i}
\end {align}$$`

理论上，我们可以得到三个区域教师薪水的期望值：

.pull-left[

`$$\begin{align}
E(Salary|  D1=0,D2=1,D3=0) 
&amp;=\alpha_2 &amp;&amp;\text{(M.E.N)} \\
E(Salary|  D1=0,D2=0,D3=1) 
&amp;=\alpha_3 &amp;&amp;\text{(South)} \\
E(Salary|  D1=1,D2=0,D3=0) 
&amp;=\alpha_1  &amp;&amp;\text{(West)}
\end{align}$$`

]

.pull-right[

&lt;img src="pic/chpt-10-region-show.png" width="656" style="display: block; margin: auto;" /&gt;

]

---
## 公立学校教师薪水案例：OLS估计2



`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{Salary}=&amp;&amp;+48014.62D1&amp;&amp;+49538.71D2&amp;&amp;+46293.59D3\\ &amp;\text{(t)}&amp;&amp;(25.8532)&amp;&amp;(33.9018)&amp;&amp;(28.5045)\\&amp;\text{(se)}&amp;&amp;(1857.2037)&amp;&amp;(1461.2400)&amp;&amp;(1624.0775)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.9821;&amp;&amp; \bar{R^2}=0.9810\\&amp; &amp;&amp; F^{\ast}=876.74;&amp;&amp; p=0.0000 \end{alignedat} \end{equation}$$`

---
## 公立学校教师薪水案例：OLS估计2

&lt;img src="pic/chpt-10-salary-coef2.png" width="574" style="display: block; margin: auto;" /&gt;


.pull-left[
&gt; 提问：
- 此时谁是基础组？
- 回归模型有没有基础组，很重要么？

]

.pull-right[

&lt;img src="pic/chpt-10-region-show.png" width="454" style="display: block; margin: auto;" /&gt;

]

---
## 虚拟变量模型的构建规则

若定性因素具有m个相互排斥属性(或几个水平)：

- **规则1**：当回归模型有截距项时，只能设(m-1)个虚拟变量；

- **规则2**：当回归模型无截距项时，则可引入m个虚拟变量。否则，就会陷入“虚拟变量陷阱”。（为什么？）

- **规则3**：在虚拟变量的设置中：基础类型、肯定类型取值为1；比较类型、否定类型取值为0。

&gt; **思考**：规则1和规则2分别建立虚拟变量回归模型，哪种更好呢？

---
## 虚拟变量模型的构建规则：示例

**建模1**: (正确模型)使用m-1个虚拟变量，并设定为**有截距**：

`$$\begin {align} 
Salary_{i}=\beta_{1}+\beta_{2} D2_{ i}+\beta_{3} D3_{ i}+u_{i}
\end {align}$$`

**建模2**: (正确模型)使用m个虚拟变量，并设定为**无截距**：

`$$\begin {align} 
Salary_{i}=\alpha_{1} D1_{ i}+\alpha_{2} D2_{ i}+\alpha_{3} D3_{ i}+u_{i}
\end {align}$$`

**建模3**: (错误模型)使用m个虚拟变量，并设定为**有截距**：

`$$\begin {align} 
Salary_{i}=\gamma_{0}+\gamma_{1} D1_{ i}+\gamma_{2} D2_{ i}+\gamma_{3} D3_{ i}+u_{i}
\end {align}$$`


&gt; **提问**：
- 模型1和模型2的回归系数涵义是一样的么？
- 执意采用OLS方法估计模型3，会有什么后果？

---
## 虚拟变量模型的构建规则：R软件示例

.pull-left[


```r
mod.main3 &lt;- "Salary ~1+ D1+D2 +D3"
lm.main3 &lt;- lm(mod.main3, data_demon)
summary(lm.main3)
```

```

Call:
lm(formula = mod.main3, data = data_demon)

Residuals:
   Min     1Q Median     3Q    Max 
-14161  -4566  -1638   4632  15625 

Coefficients: (1 not defined because of singularities)
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)    46294       1624   28.50   &lt;2e-16 ***
D1              1721       2467    0.70     0.49    
D2              3245       2185    1.49     0.14    
D3                NA         NA      NA       NA    
---
Signif. codes:  
0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 6700 on 48 degrees of freedom
Multiple R-squared:  0.044,	Adjusted R-squared:  0.00413 
F-statistic:  1.1 on 2 and 48 DF,  p-value: 0.34
```

]

.pull-right[

对于错误的**建模3**，有些统计软件（如R软件）会自动去掉一个多于的虚拟变量

`$$\begin {align} 
Salary_{i}=\gamma_{0}+\gamma_{1} D1_{ i}+\gamma_{2} D2_{ i}+\gamma_{3} D3_{ i}+u_{i}
\end {align}$$`

]




---
class: center, middle,inverse

# 同时含有一个定性变量
# 和定量变量的ANOVA模型


---
## 公立学校教师薪水案例：数据

把定性变量
`\(Region\)`进行**数据变换**，得到数据：

<div id="htmlwidget-f3a52fea1e4e0296d6ba" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-f3a52fea1e4e0296d6ba">{"x":{"filter":"none","caption":"<caption>把定性变量Region处理成虚拟变量n=(51)<\/caption>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51"],["Connecticut","Illinois","Indiana","Iowa","Kansas","Maine","Massachusetts","Michigan","Minnesota","Missouri","Nebraska","New Hampshire","New Jersey","New York","North Dakota","Ohio","Pennsylvania","Rhode Island","South Dakota","Vermont","Wisconsin","Alabama","Arkansas","Delaware","District of Columbia","Florida","Georgia","Kentucky","Louisiana","Maryland","Mississippi","North Carolina","Oklahoma","South Carolina","Tennessee","Texas","Virginia","West Virginia","Alaska","Arizona","California","Colorado","Hawaii","Idaho","Montana","Nevada","New Mexico","Oregon","Utah","Washington","Wyoming"],["M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","South","South","South","South","South","South","South","South","South","South","South","South","South","South","South","South","South","West","West","West","West","West","West","West","West","West","West","West","West","West"],[60822,58246,47831,43130,43334,41596,58624,54895,49634,41839,42044,46527,59920,58537,38822,51937,54970,55956,35378,48370,47901,43389,44245,54680,59000,45308,49905,43646,42816,56927,40182,46410,42379,44133,43816,44897,44727,40531,54658,45941,63640,45833,51922,42798,41225,45342,42780,50911,40566,47882,50692],[12436,9275,8935,7807,8373,11285,12596,9880,9675,7840,7900,10206,13781,13551,7807,10034,10711,11089,7911,12475,9965,7706,8402,12036,15508,7762,8534,8300,8519,9771,7215,7675,6944,8377,6979,7547,9275,9886,10171,5585,8486,8861,9879,7042,8361,6755,8622,8649,5347,7958,11596],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>state<\/th>\n      <th>Region<\/th>\n      <th>Salary<\/th>\n      <th>Spend<\/th>\n      <th>D1<\/th>\n      <th>D2<\/th>\n      <th>D3<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"dom":"tip","columnDefs":[{"className":"dt-center","targets":"_all"},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>

## 公立学校教师薪水案例：PRM1

我们可以构建薪水（
`\(Salary\)`）对区域虚拟变量（
`\(D2;D3\)`）和定量变量
`\(Spend\)`的**有截距**总体回归模型PRM：

`$$\begin {align} 
Salary_{i}=\beta_{1}+\beta_{2} D2_{ i}+\beta_{3} D3_{ i}+\lambda Spend_i+u_{i}
\end {align}$$`

理论上，我们可以得到三个区域教师薪水的期望值：

.pull-left[

`$$\begin{align}
E(Salary|  D2=1,D3=0) 
&amp;=\beta_1+\beta_2 +\lambda Spend &amp;&amp;\text{(M.E.N)} \\
E(Salary|  D2=0,D3=1) 
&amp;=\beta_1+\beta_3 +\lambda Spend &amp;&amp;\text{(South)} \\
E(Salary|  D2=0,D3=0) 
&amp;=\beta_1 +\lambda Spend &amp;&amp;\text{(West)}
\end{align}$$`

]

.pull-right[

&lt;img src="pic/chpt-10-region-show.png" width="656" style="display: block; margin: auto;" /&gt;

---
## 公立学校教师薪水案例：OLS估计1



`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{Salary}=&amp;&amp;+28694.92&amp;&amp;-2954.13D2&amp;&amp;-3112.19D3&amp;&amp;+2.34Spend\\ &amp;\text{(t)}&amp;&amp;(8.7953)&amp;&amp;(-1.5860)&amp;&amp;(-1.7101)&amp;&amp;(6.5152)\\&amp;\text{(se)}&amp;&amp;(3262.5213)&amp;&amp;(1862.5756)&amp;&amp;(1819.8725)&amp;&amp;(0.3592)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.4977;&amp;&amp; \bar{R^2}=0.4656\\&amp; &amp;&amp; F^{\ast}=15.52;&amp;&amp; p=0.0000 \end{alignedat} \end{equation}$$`

&lt;img src="pic/chpt-10-region-show.png" width="454" style="display: block; margin: auto;" /&gt;

---
## 公立学校教师薪水案例：OLS估计1




&lt;img src="10-dummy-model-slide_files/figure-html/unnamed-chunk-27-1.png" style="display: block; margin: auto;" /&gt;


&gt; **提问1**：大白话解释上述回归函数！**思考1**：基准组是什么？谁是协变量？**思考2**：三条线为什么是平行的？**思考3**：统计上来看，南部线和西部线是不一样的么？

---
## 公立学校教师薪水案例：PRM2

我们可以构建薪水（
`\(Salary\)`）对区域虚拟变量（
`\(D1; D2;D3\)`）和定量变量
`\(Spend\)`的**无截距**总体回归模型PRM：

`$$\begin {align} 
Salary_{i}=\alpha_{1} D1_{ i}+\alpha_{2} D2_{ i}+\alpha_{3} D3_{ i}+\lambda Spend_i+u_{i}
\end {align}$$`

理论上，我们可以得到三个区域教师薪水的期望值：

.pull-left[

`$$\begin{align}
E(Salary|  D1=0,D2=1,D3=0;Spend) 
&amp;=\alpha_2 +\lambda Spend &amp;&amp;\text{(M.E.N)} \\
E(Salary|  D1=0,D2=0,D3=1;Spend) 
&amp;=\alpha_3 +\lambda Spend &amp;&amp;\text{(South)} \\
E(Salary|  D1=1,D2=0,D3=0;Spend) 
&amp;=\alpha_1 +\lambda Spend &amp;&amp;\text{(West)}
\end{align}$$`

]

.pull-right[

&lt;img src="pic/chpt-10-region-show.png" width="656" style="display: block; margin: auto;" /&gt;
]


---
## 公立学校教师薪水案例：OLS估计2



`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{Salary}=&amp;&amp;+28694.92D1&amp;&amp;+25740.79D2&amp;&amp;+25582.72D3&amp;&amp;+2.34Spend\\ &amp;\text{(t)}&amp;&amp;(8.7953)&amp;&amp;(6.7627)&amp;&amp;(7.5372)&amp;&amp;(6.5152)\\&amp;\text{(se)}&amp;&amp;(3262.5213)&amp;&amp;(3806.2835)&amp;&amp;(3394.1819)&amp;&amp;(0.3592)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.9906;&amp;&amp; \bar{R^2}=0.9898\\&amp; &amp;&amp; F^{\ast}=1235.97;&amp;&amp; p=0.0000 \end{alignedat} \end{equation}$$`


---
## 公立学校教师薪水案例：OLS估计2

&lt;img src="10-dummy-model-slide_files/figure-html/unnamed-chunk-31-1.png" style="display: block; margin: auto;" /&gt;

&gt; **提问1**：大白话解释上述回归函数！**思考1**：基准组是什么？谁是协变量？**思考2**：三条线为什么是平行的？**思考3**：统计上来看，南部线和西部线是不一样的么？**思考4**：**有截距模型**和**无截距模型**的图形为什么是一样的？


---
class: center, middle,inverse

# 同时含有多个定性变量
# 和定量变量的ANOVA模型






---
## 虚拟变量的引入方式（定义）

如果自变量中存在k个定性变量（
`\(X_{1i},X_{2i},\cdots,X_{ki}\)`），而且每个定性变量还有自己的属性个数（
`\(X_{ki} \quad (a_1,a_2,\cdots, a_m)\)`）。那么把这些**定性变量**转换成各自的**虚拟变量体系**后，虚拟变量在模型中出现的关系则可以有多种形式：

--

1. 虚拟变量以**加法形式**引入的回归模型：是指各个**定性变量**的虚拟变量体系，**各自**以**独立项**的形式出现在模型中。

2. 虚拟变量以**乘法形式**引入的回归模型：是指各个**定性变量**的虚拟变量体系，存在**相互**以**交叉项**的形式出现在模型中。

3. 虚拟变量以**混合形式**（既有加法形式也有乘法形式）引入的回归模型：是指各个**定性变量**的虚拟变量体系，及有**各自**以**独立项**的形式，也有**相互**以**交叉项**的形式出现在模型中。又具体分为两种情形：

    - 完全混合模型：两个定性变量的虚拟变量体系，既有各自**独立项**，又有它们相互间完全**交叉项**。
    
    - 部分混合模型：两个定性变量的虚拟变量体系，既有各自**独立项**，又有它们相互间不完全的**交叉项**（也即部分交叉）。


---
## 虚拟变量的引入方式（示例）

为了研究工人工资的影响因素，我们可以考虑如下变量：

- 定量变量：工资
`\(wage\)`；年龄
`\(age\)`

- 定性变量：教育程度
`\(edu\{a_1=\text{ill},a_2=\text{pri},a_3=\text{mid},a_4=\text{hig}\}\)`；工作部门
`\(dpt\{a_1=\text{tem},a_2=\text{per}\}\)`；性别
`\(sex\{a_1=\text{f},a_2=\text{m}\}\)`。

&gt; 教育程度edu：ill表示文盲；pri表示初等教育；mid表示中等教育；hig表示高等教育。

&gt; 工作类型dpt：tem表示临时工；per表示合同工。

&gt; 性别sex：f表示女性；m表示男性。

---
## 虚拟变量的引入方式（示例）

因为涉及到三个定性变量，我们可以将他们转换为各自的**虚拟变量体系**：

--

.pull-left[

**教育程度**定性变量`edu`：

`$$\begin{align}
&amp;edu\{a_1=\text{ill},a_2=\text{pri},a_3=\text{mid} ,a_4=\text{hig}\} \\
&amp;dummy \Longrightarrow  
  \begin{cases}
    edu\_ill  =
    \begin{cases}
    1, &amp; \text{ill}\\
    0, &amp; \text{not ill}
    \end{cases} \\
    edu\_pri = 
    \begin{cases}
    1, &amp; \text{pri}\\
    0, &amp; \text{not pri}
    \end{cases} \\
    edu\_mid  =
    \begin{cases}
    1, &amp; \text{mid}\\
    0, &amp; \text{not mid}
    \end{cases}\\
     edu\_hig  =
    \begin{cases}
    1, &amp; \text{hig}\\
    0, &amp; \text{not hig}
    \end{cases}
  \end{cases}
\end{align}$$`

]

--

.pull-right[

**工作类型**定性变量`dpt`：

`$$\begin{align}
&amp;dpt\{a_1=\text{tem},a_2=\text{per}\} \\
&amp;dummy \Longrightarrow  
  \begin{cases}
    dpt\_tem  =
    \begin{cases}
    1, &amp; \text{tem}\\
    0, &amp; \text{not tem}
    \end{cases} \\
    dpt\_per = 
    \begin{cases}
    1, &amp; \text{per}\\
    0, &amp; \text{not per}
    \end{cases} 
  \end{cases}
\end{align}$$`

**性别**定性变量`sex`：

`$$\begin{align}
&amp;sex\{a_1=\text{f},a_2=\text{m}\} \\
&amp;dummy \Longrightarrow  
  \begin{cases}
    sex\_f  =
    \begin{cases}
    1, &amp; \text{f}\\
    0, &amp; \text{not f}
    \end{cases} \\
    sex\_m = 
    \begin{cases}
    1, &amp; \text{m}\\
    0, &amp; \text{not m}
    \end{cases} 
  \end{cases}
\end{align}$$`

]


---
## 虚拟变量的引入方式（示例:加法模型）


`$$\begin{equation} \begin{alignedat}{999} &amp;wage=&amp;&amp; + \beta_{1} &amp;&amp; + \beta_{2} edu_{pri}&amp;&amp; + \beta_{3} edu_{mid}&amp;&amp; + \beta_{4} edu_{hig}&amp;&amp; + \beta_{5} dpt_{per}&amp;&amp; + \beta_{6} sex_{m}&amp;&amp; + \beta_{7} age&amp;&amp;+u_i\\ \end{alignedat} \end{equation}$$`

假定我们关注这样两个群体：

--

**A群体**：年龄为30岁的、女性（
`\(sex_m=0\)`）、**受过高等教育**（
`\(edu_pri=0,edu_mid=0,edu_hig=1\)`）的、拥有一份**合同工**的（
`\(dpt_per=1\)`）。

`$$\begin{align}
E(wage&amp;|age=30;edu_{pri}= 0;edu_{mid}= 0;edu_{hig}= 1;dpt_{per}= 1;sex_{m}= 0)\\
=&amp;+\beta_{1}+\beta_{2}(0)+\beta_{3}(0)+\beta_{4}(1)+\beta_{5}(1)+\beta_{6}(0)+\beta_{7}(30)\\
=&amp;+\beta_{1}+\beta_{4}+\beta_{5}+30\beta_{7}\\
\end{align}$$`

--

**B群体**：年龄为30岁的、女性（
`\(sex_m=0\)`）、**受过高等教育**（
`\(edu_pri=0,edu_mid=0,edu_hig=1\)`）的、拥有一份**临时工**的（
`\(dpt_per=0\)`）。

`$$\begin{align}
E(wage&amp;|age=30;edu_{pri}= 0;edu_{mid}= 0;edu_{hig}= 1;dpt_{per}= 0;sex_{m}= 0)\\
=&amp;+\beta_{1}+\beta_{2}(0)+\beta_{3}(0)+\beta_{4}(1)+\beta_{5}(0)+\beta_{6}(0)+\beta_{7}(30)\\
=&amp;+\beta_{1}+\beta_{4}+30\beta_{7}\\
\end{align}$$`

---
## 虚拟变量的引入方式（示例:加法模型）


`$$\begin{equation} \begin{alignedat}{999} &amp;wage=&amp;&amp; + \beta_{1} &amp;&amp; + \beta_{2} edu_{pri}&amp;&amp; + \beta_{3} edu_{mid}&amp;&amp; + \beta_{4} edu_{hig}&amp;&amp; + \beta_{5} dpt_{per}&amp;&amp; + \beta_{6} sex_{m}&amp;&amp; + \beta_{7} age&amp;&amp;+u_i\\ \end{alignedat} \end{equation}$$`

如果
`\(\beta_5&gt;0\)`，这将意味着：

--

- 只要拥有一份**合同工**（
`\(dpt_{per}=1\)`）。那么，**在其他同等情况下**，这个人的工资都要高于拥有一份**临时工**（
`\(dpt_{per}=0\)`）的人。——无论是高学历的同等条件（
`\(edu_{pri}=0,edu_{mid}=0,edu_{hig}=1\)`），还是中等学历的同等条件（
`\(edu_{pri}=1,edu_{mid}=0,edu_{hig}=0\)`），还是文盲学历的同等条件（
`\(edu_{pri}=0,edu_{mid}=0,edu_{hig}=0\)`）。

--

- 换言之，**工作类型**（dpt）与**受教育程度**（edu）是**独立地**作用于**工资**（wage）的！

---
## 虚拟变量的引入方式（示例:乘法模型）


`$$\begin{equation} \begin{alignedat}{999} &amp;wage=&amp;&amp; + \beta_{1} &amp;&amp; + \beta_{2} sex_{m}&amp;&amp; + \beta_{3} age&amp;&amp; + \beta_{4} edu_{pri} \ast dpt_{per}\\ &amp;\text{(cont.)}&amp;&amp; + \beta_{5} dpt_{per} \ast edu_{mid}&amp;&amp; + \beta_{6} dpt_{per} \ast edu_{hig}&amp;&amp;+u_i\\ \end{alignedat} \end{equation}$$`

假定我们关注这样两个群体：

--

**A群体**：年龄为30岁的、女性（
`\(sex_m=0\)`）、**受过高等教育**（
`\(edu_pri=0,edu_mid=0,edu_hig=1\)`）的、拥有一份**合同工**的（
`\(dpt_per=1\)`）。

`$$\begin{align}
E(wage&amp;|age=30;edu_{pri}= 0;edu_{mid}= 0;edu_{hig}= 1;dpt_{per}= 1;sex_{m}= 0)\\
=&amp;+\beta_{1}+\beta_{2}(0)+\beta_{3}(30)+\beta_{4}(0)\cdot(1)+\beta_{5}(1)\cdot(0)+\beta_{6}(1)\cdot(1)\\
=&amp;+\beta_{1}+30\beta_{3}+\beta_{6}\\
\end{align}$$`

--

**B群体**：年龄为30岁的、女性（
`\(sex_m=0\)`）、**受过高等教育**（
`\(edu_pri=0,edu_mid=0,edu_hig=1\)`）的、拥有一份**临时工**的（
`\(dpt_per=0\)`）。

`$$\begin{align}
E(wage&amp;|age=30;edu_{pri}= 0;edu_{mid}= 0;edu_{hig}= 1;dpt_{per}= 0;sex_{m}= 0)\\
=&amp;+\beta_{1}+\beta_{2}(0)+\beta_{3}(30)+\beta_{4}(0)\cdot(0)+\beta_{5}(0)\cdot(0)+\beta_{6}(0)\cdot(1)\\
=&amp;+\beta_{1}+30\beta_{3}\\
\end{align}$$`

---
## 虚拟变量的引入方式（示例:乘法模型）


`$$\begin{equation} \begin{alignedat}{999} &amp;wage=&amp;&amp; + \beta_{1} &amp;&amp; + \beta_{2} sex_{m}&amp;&amp; + \beta_{3} age&amp;&amp; + \beta_{4} edu_{pri} \ast dpt_{per}\\ &amp;\text{(cont.)}&amp;&amp; + \beta_{5} dpt_{per} \ast edu_{mid}&amp;&amp; + \beta_{6} dpt_{per} \ast edu_{hig}&amp;&amp;+u_i\\ \end{alignedat} \end{equation}$$`

如果
`\(\beta_6&gt;0\)`且显著，这将意味着：

--

- **在其他同等情况下**，一个拥有一份**合同工**（
`\(dpt_{per}=1\)`）且拥有**高学历**（
`\(edu_{hig}=1\)`）的人。这个人的工资都要**高于**拥有一份**临时工**（
`\(dpt_{per}=0\)`）或**没有**受过高学历教育（
`\(edu_{hig}=0\)`）的人。——包括：临时工&amp;文盲；临时工&amp;初等学历；临时工&amp;中等学历；合同工&amp;文盲；合同工&amp;初等学历；合同工&amp;中等学历。

--

- 换言之，**工作类型**（dpt）与**受教育程度**（edu）是**交互地**作用于**工资**（wage）的！——此处重点针对拥有高学历还是不拥有有高学历。


---
## 虚拟变量的引入方式（示例:混合模型）


`$$\begin{equation} \begin{alignedat}{999} &amp;wage=&amp;&amp; + \beta_{1} &amp;&amp; + \beta_{2} sex_{m}&amp;&amp; + \beta_{3} dpt_{per}&amp;&amp; + \beta_{4} age&amp;&amp; + \beta_{5} edu_{pri} \ast dpt_{per}\\ &amp;\text{(cont.)}&amp;&amp; + \beta_{6} edu_{mid} \ast dpt_{per}&amp;&amp; + \beta_{7} edu_{hig} \ast dpt_{per}&amp;&amp;+u_i\\ \end{alignedat} \end{equation}$$`

假定我们关注这样两个群体：

--

**A群体**：年龄为30岁的、女性（
`\(sex_m=0\)`）、**受过高等教育**（
`\(edu_pri=0,edu_mid=0,edu_hig=1\)`）的、拥有一份**合同工**的（
`\(dpt_per=1\)`）。

`$$\begin{align}
E(wage&amp;|age=30;edu_{pri}= 0;edu_{mid}= 0;edu_{hig}= 1;dpt_{per}= 1;sex_{m}= 0)\\
=&amp;+\beta_{1}+\beta_{2}(0)+\beta_{3}(1)+\beta_{4}(30)+\beta_{5}(0)\cdot(1)+\beta_{6}(0)\cdot(1)+\beta_{7}(1)\cdot(1)\\
=&amp;+\beta_{1}+\beta_{3}+30\beta_{4}+\beta_{7}\\
\end{align}$$`

--

**B群体**：年龄为30岁的、女性（
`\(sex_m=0\)`）、**受过高等教育**（
`\(edu_pri=0,edu_mid=0,edu_hig=1\)`）的、拥有一份**临时工**的（
`\(dpt_per=0\)`）。

`$$\begin{align}
E(wage&amp;|age=30;edu_{pri}= 0;edu_{mid}= 0;edu_{hig}= 1;dpt_{per}= 0;sex_{m}= 0)\\
=&amp;+\beta_{1}+\beta_{2}(0)+\beta_{3}(0)+\beta_{4}(30)+\beta_{5}(0)\cdot(0)+\beta_{6}(0)\cdot(0)+\beta_{7}(1)\cdot(0)\\
=&amp;+\beta_{1}+30\beta_{4}\\
\end{align}$$`



---
class: center, middle,inverse

# 印度工人工资案例

---
## 数据：原始

**印度工人工资**：114位印度工人工资方面的数据如下。

<div id="htmlwidget-13f2eaa5f445ad122ee8" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-13f2eaa5f445ad122ee8">{"x":{"filter":"none","caption":"<caption>印度工人工资(n=114)<\/caption>","data":[[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114],[117,375,175,100,162.5,300,175,287.5,350,385,395,224,91.8,119,377,400,139.5,139.5,54,342,77.5,156,350,427,40,65,162.5,162.5,162.5,325,18,127.6,30,189.5,50,112,82,87.5,600,116.5,75,127,324,150,135,62.5,97,54,120.5,950,120,132,30,24,75,42,100,135.5,107,90,162,49.16,81,105,200,80,125,500,100,105,100,140,150,131,120,122,79,110,370,261.15,129.5,107.7,20,18,120,40.5,120,75,52,115.25,102.5,272.5,94.25,30,30,25,47.5,175,150,50,175,50,85.32,111,47.5,40.5,47,25,15,25,25,75,53.84,50],[26,42,33,33,30,35,40,50,42,30,45,48,35,38,46,57,44,30,62,56,19,26,57,55,15,14,25,28,24,55,19,25,19,62,25,27,22,25,35,28,27,22,26,30,25,18,25,16,27,47,57,38,18,12,55,18,32,41,48,45,40,22,20,40,30,26,22,21,19,35,30,30,36,55,21,20,60,23,46,23,33,26,14,12,38,17,34,18,19,33,27,43,22,38,17,22,25,50,24,25,40,16,26,23,46,37,41,28,13,18,11,45,14,26],["pri","pri","pri","pri","pri","mid","mid","mid","mid","mid","mid","hig","hig","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","pri","pri","pri","pri","pri","pri","pri","pri","pri","pri","mid","mid","mid","mid","mid","mid","mid","mid","mid","hig","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","mid","hig","hig","hig","ill","ill","ill","ill","ill","ill","ill","ill","pri","pri","mid","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill"],["per","per","per","per","per","per","per","per","per","per","per","per","per","per","per","per","per","per","per","per","per","per","per","per","per","per","per","per","per","per","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","per","per","per","per","per","per","per","per","per","per","per","per","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem"],["f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>obs<\/th>\n      <th>wage<\/th>\n      <th>age<\/th>\n      <th>edu<\/th>\n      <th>dpt<\/th>\n      <th>sex<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"dom":"tip","columnDefs":[{"className":"dt-center","targets":"_all"}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>


---
## 数据：变量定义

变量说明见下表：

<div id="htmlwidget-62def92eea66f5dfadef" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-62def92eea66f5dfadef">{"x":{"filter":"none","caption":"<caption>变量定义及说明<\/caption>","data":[["obs","wage","age","edu","dpt","sex"],["工人编号","工人工资","年龄","教育水平","合同类型","性别"],["序号(observations)","美元/周(\\$/week)","岁(year)","ill=文盲(illiteracy)；pri=初等教育(primary)；mid=中等教育(middle)；hig=高等教育(higher)","tem=短期合同(temporary)；per=长期合同(permanent)","f=女(female)；m=男(male)"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>variable<\/th>\n      <th>label<\/th>\n      <th>remark<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","columnDefs":[{"className":"dt-center","targets":"_all"},{"width":"800px","targets":[1,2]}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>

---
##数据：定性变量的属性统计


<div id="htmlwidget-9205a007aa09d76308b9" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-9205a007aa09d76308b9">{"x":{"filter":"none","caption":"<caption>定性变量及其属性的统计表(n=114)<\/caption>","data":[["edu","edu","edu","edu","dpt","dpt","sex","sex"],["ill","pri","mid","hig","tem","per","f","m"],[74,17,17,6,72,42,89,25]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>定性变量<\/th>\n      <th>属性<\/th>\n      <th>频次<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","columnDefs":[{"className":"dt-center","targets":"_all"}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>


---
## 数据：定性变量的虚拟变量变换



将基础组设定为{文盲，临时工，女性}（也即{illiteracy，temporary，female}）。则可以将全部定性变量的基础组属性{illiteracy，temporary，female}分别设置为虚拟变量`edu_ill`、`dpt_tem`和`sex_f`。

.pull-left[

**教育程度**定性变量`edu`：

`$$\begin{align}
&amp;edu\{a_1=\text{ill},a_2=\text{pri},a_3=\text{mid} ,a_4=\text{hig}\} \\
&amp;dummy \Longrightarrow  
  \begin{cases}
    edu\_ill  =
    \begin{cases}
    1, &amp; \text{ill}\\
    0, &amp; \text{not ill}
    \end{cases} \\
    edu\_pri = 
    \begin{cases}
    1, &amp; \text{pri}\\
    0, &amp; \text{not pri}
    \end{cases} \\
    edu\_mid  =
    \begin{cases}
    1, &amp; \text{mid}\\
    0, &amp; \text{not mid}
    \end{cases}\\
     edu\_hig  =
    \begin{cases}
    1, &amp; \text{hig}\\
    0, &amp; \text{not hig}
    \end{cases}
  \end{cases}
\end{align}$$`

]

.pull-right[

**工作类型**定性变量`dpt`：

`$$\begin{align}
&amp;dpt\{a_1=\text{tem},a_2=\text{per}\} \\
&amp;dummy \Longrightarrow  
  \begin{cases}
    dpt\_tem  =
    \begin{cases}
    1, &amp; \text{tem}\\
    0, &amp; \text{not tem}
    \end{cases} \\
    dpt\_per = 
    \begin{cases}
    1, &amp; \text{per}\\
    0, &amp; \text{not per}
    \end{cases} 
  \end{cases}
\end{align}$$`

**性别**定性变量`sex`：

`$$\begin{align}
&amp;sex\{a_1=\text{f},a_2=\text{m}\} \\
&amp;dummy \Longrightarrow  
  \begin{cases}
    sex\_f  =
    \begin{cases}
    1, &amp; \text{f}\\
    0, &amp; \text{not f}
    \end{cases} \\
    sex\_m = 
    \begin{cases}
    1, &amp; \text{m}\\
    0, &amp; \text{not m}
    \end{cases} 
  \end{cases}
\end{align}$$`

]

---
## 数据：教育变量的虚拟变量变换

<div id="htmlwidget-0384faf0d4a2f027c984" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-0384faf0d4a2f027c984">{"x":{"filter":"none","caption":"<caption>用虚拟变量系统完全表达定性变量edu (n=114)<\/caption>","data":[[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114],["pri","pri","pri","pri","pri","mid","mid","mid","mid","mid","mid","hig","hig","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","pri","pri","pri","pri","pri","pri","pri","pri","pri","pri","mid","mid","mid","mid","mid","mid","mid","mid","mid","hig","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","mid","hig","hig","hig","ill","ill","ill","ill","ill","ill","ill","ill","pri","pri","mid","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill"],[0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>obs<\/th>\n      <th>edu<\/th>\n      <th>edu_ill<\/th>\n      <th>edu_pri<\/th>\n      <th>edu_mid<\/th>\n      <th>edu_hig<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"dom":"tip","columnDefs":[{"className":"dt-center","targets":"_all"}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>

---
## 数据：工作部门变量的虚拟变量变换

<div id="htmlwidget-463c9978fde48fee321b" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-463c9978fde48fee321b">{"x":{"filter":"none","caption":"<caption>用虚拟变量系统完全表达定性变量dpt (n=114)<\/caption>","data":[[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114],["per","per","per","per","per","per","per","per","per","per","per","per","per","per","per","per","per","per","per","per","per","per","per","per","per","per","per","per","per","per","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","per","per","per","per","per","per","per","per","per","per","per","per","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem"],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>obs<\/th>\n      <th>dpt<\/th>\n      <th>dpt_tem<\/th>\n      <th>dpt_per<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"dom":"tip","columnDefs":[{"className":"dt-center","targets":"_all"}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>


---
## 数据：性别变量的虚拟变量变换

<div id="htmlwidget-0657b37887d9f940118b" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-0657b37887d9f940118b">{"x":{"filter":"none","caption":"<caption>用虚拟变量系统完全表达定性变量sex (n=114)<\/caption>","data":[[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114],["f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m"],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>obs<\/th>\n      <th>sex<\/th>\n      <th>sex_f<\/th>\n      <th>sex_m<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"dom":"tip","columnDefs":[{"className":"dt-center","targets":"_all"}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>

---
## 加法模型：总体回归模型PRM

同时含虚拟变量和定量变量的、加法形式的经典回归模型：

`$$\begin{equation} \begin{alignedat}{999} &amp;wage=&amp;&amp; + \beta_{1} &amp;&amp; + \beta_{2} edu_{pri}&amp;&amp; + \beta_{3} edu_{mid}&amp;&amp; + \beta_{4} edu_{hig}&amp;&amp; + \beta_{5} dpt_{per}&amp;&amp; + \beta_{6} sex_{m}&amp;&amp; + \beta_{7} age&amp;&amp;+u_i\\ \end{alignedat} \end{equation}$$`

OLS估计的简要报告如下：

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{wage}=&amp;&amp;+6.79&amp;&amp;+23.96edu_{pri}&amp;&amp;+61.59edu_{mid}&amp;&amp;+150.49edu_{hig}\\ &amp;\text{(t)}&amp;&amp;(0.2130)&amp;&amp;(0.7734)&amp;&amp;(1.9867)&amp;&amp;(3.0054)\\&amp;\text{(se)}&amp;&amp;(31.8931)&amp;&amp;(30.9789)&amp;&amp;(31.0035)&amp;&amp;(50.0725)\\&amp;\text{(cont.)}&amp;&amp;+31.16dpt_{per}&amp;&amp;-83.20sex_{m}&amp;&amp;+3.99age\\&amp;\text{(t)}&amp;&amp;(1.3141)&amp;&amp;(-3.0819)&amp;&amp;(4.5129)\\&amp;\text{(se)}&amp;&amp;(23.7120)&amp;&amp;(26.9981)&amp;&amp;(0.8835)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.3450;&amp;&amp; \bar{R^2}=0.3083\\&amp; &amp;&amp; F^{\ast}=9.39;&amp;&amp; p=0.0000\\ \end{alignedat} \end{equation}$$`

---
## 加法模型：EViews报告

&lt;img src="pic/chpt-10-both-plus.png" width="577" style="display: block; margin: auto;" /&gt;


---
## 加法模型：基础组

* 基础组（**文盲 &amp; 短期合同 &amp; 女性**），也即(**illiteracy &amp; temporary &amp; female**)的期望工资收入为（给定**年龄**为30岁）：

`$$\begin{align}
E(wage&amp;|age=30;edu_{pri}= 0;edu_{mid}= 0;edu_{hig}= 0;dpt_{per}= 0;sex_{m}= 0)\\
=&amp;+\beta_{1}+\beta_{2}(0)+\beta_{3}(0)+\beta_{4}(0)+\beta_{5}(0)+\beta_{6}(0)+\beta_{7}(30)\\
=&amp;+\beta_{1}+30\beta_{7}\\
\end{align}$$`

`$$\begin{align}
(\widehat{wage}&amp;|age=30;edu_{pri}= 0;edu_{mid}= 0;edu_{hig}= 0;dpt_{per}= 0;sex_{m}= 0)\\
=&amp;+\hat{\beta}_{1}+\hat{\beta}_{2}(0)+\hat{\beta}_{3}(0)+\hat{\beta}_{4}(0)\\
&amp;+\hat{\beta}_{5}(0)+\hat{\beta}_{6}(0)+\hat{\beta}_{7}(30)\\
=&amp;+[6.79]+[23.96]\cdot(0)+[61.59]\cdot(0)+[150.49]\cdot(0)\\
&amp;+[31.16]\cdot(0)+[-83.20]\cdot(0)+[3.99]\cdot(30)\\
=&amp;126.4104\\
\end{align}$$`


---
## 加法模型：比较组1

比较组1（**高等学历 &amp; 短期合同 &amp; 女性**），也即(**high &amp; temporary &amp; female**)的期望工资收入为（给定**年龄**为30岁）：

`$$\begin{align}
E(wage&amp;|age=30;edu_{pri}= 0;edu_{mid}= 0;edu_{hig}= 1;dpt_{per}= 0;sex_{m}= 0)\\
=&amp;+\beta_{1}+\beta_{2}(0)+\beta_{3}(0)+\beta_{4}(1)+\beta_{5}(0)+\beta_{6}(0)+\beta_{7}(30)\\
=&amp;+\beta_{1}+\beta_{4}+30\beta_{7}\\
\end{align}$$`


`$$\begin{align}
(\widehat{wage}&amp;|age=30;edu_{pri}= 0;edu_{mid}= 0;edu_{hig}= 1;dpt_{per}= 0;sex_{m}= 0)\\
=&amp;+\hat{\beta}_{1}+\hat{\beta}_{2}(0)+\hat{\beta}_{3}(0)+\hat{\beta}_{4}(1)\\
&amp;+\hat{\beta}_{5}(0)+\hat{\beta}_{6}(0)+\hat{\beta}_{7}(30)\\
=&amp;+[6.79]+[23.96]\cdot(0)+[61.59]\cdot(0)+[150.49]\cdot(1)\\
&amp;+[31.16]\cdot(0)+[-83.20]\cdot(0)+[3.99]\cdot(30)\\
=&amp;276.8995\\
\end{align}$$`

---
## 加法模型：比较组2

比较组2（**高等教育 &amp; 长期合同 &amp; 女性**），也即(**higher &amp; permanent &amp; female**)的期望工资收入为（给定**年龄**为30岁）：

`$$\begin{align}
E(wage&amp;|age=30;edu_{pri}= 0;edu_{mid}= 0;edu_{hig}= 1;dpt_{per}= 1;sex_{m}= 0)\\
=&amp;+\beta_{1}+\beta_{2}(0)+\beta_{3}(0)+\beta_{4}(1)+\beta_{5}(1)+\beta_{6}(0)+\beta_{7}(30)\\
=&amp;+\beta_{1}+\beta_{4}+\beta_{5}+30\beta_{7}\\
\end{align}$$`

`$$\begin{align}
(\widehat{wage}&amp;|age=30;edu_{pri}= 0;edu_{mid}= 0;edu_{hig}= 1;dpt_{per}= 1;sex_{m}= 0)\\
=&amp;+\hat{\beta}_{1}+\hat{\beta}_{2}(0)+\hat{\beta}_{3}(0)+\hat{\beta}_{4}(1)\\
&amp;+\hat{\beta}_{5}(1)+\hat{\beta}_{6}(0)+\hat{\beta}_{7}(30)\\
=&amp;+[6.79]+[23.96]\cdot(0)+[61.59]\cdot(0)+[150.49]\cdot(1)\\
&amp;+[31.16]\cdot(1)+[-83.20]\cdot(0)+[3.99]\cdot(30)\\
=&amp;308.0604\\
\end{align}$$`

---
## 乘法模型：总体回归模型PRM

同时含虚拟变量和定量变量的、加法形式的经典回归模型：

`$$\begin{equation} \begin{alignedat}{999} &amp;wage=&amp;&amp; + \beta_{1} &amp;&amp; + \beta_{2} sex_{m}&amp;&amp; + \beta_{3} age&amp;&amp; + \beta_{4} edu_{pri} \ast dpt_{per}&amp;&amp; + \beta_{5} dpt_{per} \ast edu_{mid}&amp;&amp; + \beta_{6} dpt_{per} \ast edu_{hig}&amp;&amp;+u_i\\ \end{alignedat} \end{equation}$$`

OLS估计的简要报告如下：

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{wage}=&amp;&amp;+22.92&amp;&amp;-71.41sex_{m}&amp;&amp;+4.11age&amp;&amp;+28.21edu_{pri} \ast dpt_{per}\\ &amp;\text{(t)}&amp;&amp;(0.7366)&amp;&amp;(-2.5720)&amp;&amp;(4.6325)&amp;&amp;(0.5166)\\&amp;\text{(se)}&amp;&amp;(31.1120)&amp;&amp;(27.7639)&amp;&amp;(0.8870)&amp;&amp;(54.5979)\\&amp;\text{(cont.)}&amp;&amp;+112.68dpt_{per} \ast edu_{mid}&amp;&amp;+33.12dpt_{per} \ast edu_{hig}\\&amp;\text{(t)}&amp;&amp;(2.4012)&amp;&amp;(0.5965)\\&amp;\text{(se)}&amp;&amp;(46.9258)&amp;&amp;(55.5274)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.2872;&amp;&amp; \bar{R^2}=0.2542\\&amp; &amp;&amp; F^{\ast}=8.70;&amp;&amp; p=0.0000\\ \end{alignedat} \end{equation}$$`

---
## 乘法模型：EViews报告

&lt;img src="pic/chpt-10-both-prod-pure.png" width="577" style="display: block; margin: auto;" /&gt;

---
## 乘法模型：基础组

* 基础组（**文盲 &amp; 短期合同 &amp; 女性**），也即(**illiteracy &amp; temporary &amp; female**)的期望工资收入为（给定**年龄**为30岁）：

`$$\begin{align}
E(wage&amp;|age=30;edu_{pri}= 0;edu_{mid}= 0;edu_{hig}= 0;dpt_{per}= 0;sex_{m}= 0)\\
=&amp;+\beta_{1}+\beta_{2}(0)+\beta_{3}(30)+\beta_{4}(0)\cdot(0)+\beta_{5}(0)\cdot(0)+\beta_{6}(0)\cdot(0)\\
=&amp;+\beta_{1}+30\beta_{3}\\
\end{align}$$`

`$$\begin{align}
(\widehat{wage}&amp;|age=30;edu_{pri}= 0;edu_{mid}= 0;edu_{hig}= 0;dpt_{per}= 0;sex_{m}= 0)\\
=&amp;+\hat{\beta}_{1}+\hat{\beta}_{2}(0)+\hat{\beta}_{3}(30)+\hat{\beta}_{4}(0)\\
&amp;+\hat{\beta}_{5}(0)+\hat{\beta}_{6}(0)\\
=&amp;+[22.92]+[-71.41]\cdot(0)+[4.11]\cdot(30)+[28.21]\cdot(0)\\
&amp;+[112.68]\cdot(0)+[33.12]\cdot(0)\\
=&amp;146.1879\\
\end{align}$$`


---
## 乘法模型：比较组1

比较组1（**高等学历 &amp; 短期合同 &amp; 女性**），也即(**high &amp; temporary &amp; female**)的期望工资收入为（给定**年龄**为30岁）：

`$$\begin{align}
E(wage&amp;|age=30;edu_{pri}= 0;edu_{mid}= 0;edu_{hig}= 1;dpt_{per}= 0;sex_{m}= 0)\\
=&amp;+\beta_{1}+\beta_{2}(0)+\beta_{3}(30)+\beta_{4}(0)\cdot(0)+\beta_{5}(0)\cdot(0)+\beta_{6}(0)\cdot(1)\\
=&amp;+\beta_{1}+30\beta_{3}\\
\end{align}$$`


`$$\begin{align}
(\widehat{wage}&amp;|age=30;edu_{pri}= 0;edu_{mid}= 0;edu_{hig}= 1;dpt_{per}= 0;sex_{m}= 0)\\
=&amp;+\hat{\beta}_{1}+\hat{\beta}_{2}(0)+\hat{\beta}_{3}(30)+\hat{\beta}_{4}(0)\\
&amp;+\hat{\beta}_{5}(0)+\hat{\beta}_{6}(0)\\
=&amp;+[22.92]+[-71.41]\cdot(0)+[4.11]\cdot(30)+[28.21]\cdot(0)\\
&amp;+[112.68]\cdot(0)+[33.12]\cdot(0)\\
=&amp;146.1879\\
\end{align}$$`

---
## 乘法模型：比较组2

比较组2（**高等教育 &amp; 长期合同 &amp; 女性**），也即(**higher &amp; permanent &amp; female**)的期望工资收入为（给定**年龄**为30岁）：

`$$\begin{align}
E(wage&amp;|age=30;edu_{pri}= 0;edu_{mid}= 0;edu_{hig}= 1;dpt_{per}= 1;sex_{m}= 0)\\
=&amp;+\beta_{1}+\beta_{2}(0)+\beta_{3}(30)+\beta_{4}(0)\cdot(1)+\beta_{5}(1)\cdot(0)+\beta_{6}(1)\cdot(1)\\
=&amp;+\beta_{1}+30\beta_{3}+\beta_{6}\\
\end{align}$$`

`$$\begin{align}
(\widehat{wage}&amp;|age=30;edu_{pri}= 0;edu_{mid}= 0;edu_{hig}= 1;dpt_{per}= 1;sex_{m}= 0)\\
=&amp;+\hat{\beta}_{1}+\hat{\beta}_{2}(0)+\hat{\beta}_{3}(30)+\hat{\beta}_{4}(0)\\
&amp;+\hat{\beta}_{5}(0)+\hat{\beta}_{6}(1)\\
=&amp;+[22.92]+[-71.41]\cdot(0)+[4.11]\cdot(30)+[28.21]\cdot(0)\\
&amp;+[112.68]\cdot(0)+[33.12]\cdot(1)\\
=&amp;179.3103\\
\end{align}$$`

---
## 时间序列季节虚拟变量模型

**时间序列季节虚拟变量模型**：是指时间变量以虚拟变量形式进入回归方程的模型，它是虚拟变量回归模型的一种特定形式及应用。  

- 季节模式（seasonal pattern）：大多数时间序列经济变量，通常表现出来的季节性往复行为或现象。

- 季节调整（seasonal adjusted）：将时间序列经济变量的季节性变化成分去除，从而得到一个新的变量序列的处理过程。  

事实上，一个时间序列经济变量往往同时存在四个成分，分别是：

- **季节成分**（seasonal component）

- **周期成分**（cyclical component）

- **趋势成分**（trend component）

- **严格随机成分**（strictly random component）

---
## 时间序列季节虚拟变量模型

如果把定性变量季节（season：Q1；Q2；Q3；Q4）变换为**虚拟变量体系**，则分别可以构建以第一季度为**基础组**的时间序列季节虚拟变量模型和**无基础组**的时间序列季节虚拟变量模型（
`\(X_t\)`为定量变量）。

`$$\begin{align}
Y_t=\beta_1+\beta_2X_t+\lambda_2D2_t+\lambda_3D3_t+\lambda_4D4_t+u_t \\
Y_t=\beta_2X_t+\lambda_1D1_t+\lambda_2D2_t+\lambda_3D3_t+\lambda_4D4_t+u_t 
\end{align}$$`

---
### 时间序列季节虚拟变量模型：数据



<div id="htmlwidget-55dcf0506ac39b066a54" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-55dcf0506ac39b066a54">{"x":{"filter":"none","caption":"<caption>交通事故数据 (n=108)<\/caption>","data":[[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108],[1981,1981,1981,1981,1981,1981,1981,1981,1981,1981,1981,1981,1982,1982,1982,1982,1982,1982,1982,1982,1982,1982,1982,1982,1983,1983,1983,1983,1983,1983,1983,1983,1983,1983,1983,1983,1984,1984,1984,1984,1984,1984,1984,1984,1984,1984,1984,1984,1985,1985,1985,1985,1985,1985,1985,1985,1985,1985,1985,1985,1986,1986,1986,1986,1986,1986,1986,1986,1986,1986,1986,1986,1987,1987,1987,1987,1987,1987,1987,1987,1987,1987,1987,1987,1988,1988,1988,1988,1988,1988,1988,1988,1988,1988,1988,1988,1989,1989,1989,1989,1989,1989,1989,1989,1989,1989,1989,1989],["1","2","3","4","5","6","7","8","9","10","11","12","1","2","3","4","5","6","7","8","9","10","11","12","1","2","3","4","5","6","7","8","9","10","11","12","1","2","3","4","5","6","7","8","9","10","11","12","1","2","3","4","5","6","7","8","9","10","11","12","1","2","3","4","5","6","7","8","9","10","11","12","1","2","3","4","5","6","7","8","9","10","11","12","1","2","3","4","5","6","7","8","9","10","11","12","1","2","3","4","5","6","7","8","9","10","11","12"],[40511,36034,40328,37699,38816,38900,38625,39539,38070,40676,39270,39734,36672,32699,41283,36455,36690,35837,36850,36284,36791,38366,37741,38331,37201,35901,40354,38276,36544,36127,37446,38977,39443,40098,41483,43493,35242,35215,39151,37808,39706,38857,40083,41797,42034,43836,44638,45369,38642,38616,44493,41134,42369,42430,41219,43359,41422,43961,45906,44165,43522,42104,47128,44892,46833,46349,48098,49329,48899,49025,46975,50266,45158,44303,47529,45364,47072,47090,48880,48357,46768,52326,48475,51924,43569,42585,45944,47003,46066,45719,47161,47558,47052,48297,49136,52971,43142,42475,49753,45161,46083,45540,46325,46742,47932,48678,47971,47251]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>obs<\/th>\n      <th>year<\/th>\n      <th>month<\/th>\n      <th>totacc<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":6,"dom":"tip","columnDefs":[{"className":"dt-center","targets":"_all"}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[6,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>

---
### 时间序列季节虚拟变量模型：散点图

&lt;img src="10-dummy-model-slide_files/figure-html/unnamed-chunk-69-1.png" style="display: block; margin: auto;" /&gt;


---
### 时间序列季节虚拟变量模型：虚拟变量

<div id="htmlwidget-723ffbee888c866d9ee1" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-723ffbee888c866d9ee1">{"x":{"filter":"none","caption":"<caption>将月份month变换成虚拟变量系统(n=108)<\/caption>","data":[[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108],[1981,1981,1981,1981,1981,1981,1981,1981,1981,1981,1981,1981,1982,1982,1982,1982,1982,1982,1982,1982,1982,1982,1982,1982,1983,1983,1983,1983,1983,1983,1983,1983,1983,1983,1983,1983,1984,1984,1984,1984,1984,1984,1984,1984,1984,1984,1984,1984,1985,1985,1985,1985,1985,1985,1985,1985,1985,1985,1985,1985,1986,1986,1986,1986,1986,1986,1986,1986,1986,1986,1986,1986,1987,1987,1987,1987,1987,1987,1987,1987,1987,1987,1987,1987,1988,1988,1988,1988,1988,1988,1988,1988,1988,1988,1988,1988,1989,1989,1989,1989,1989,1989,1989,1989,1989,1989,1989,1989],["1","2","3","4","5","6","7","8","9","10","11","12","1","2","3","4","5","6","7","8","9","10","11","12","1","2","3","4","5","6","7","8","9","10","11","12","1","2","3","4","5","6","7","8","9","10","11","12","1","2","3","4","5","6","7","8","9","10","11","12","1","2","3","4","5","6","7","8","9","10","11","12","1","2","3","4","5","6","7","8","9","10","11","12","1","2","3","4","5","6","7","8","9","10","11","12","1","2","3","4","5","6","7","8","9","10","11","12"],[40511,36034,40328,37699,38816,38900,38625,39539,38070,40676,39270,39734,36672,32699,41283,36455,36690,35837,36850,36284,36791,38366,37741,38331,37201,35901,40354,38276,36544,36127,37446,38977,39443,40098,41483,43493,35242,35215,39151,37808,39706,38857,40083,41797,42034,43836,44638,45369,38642,38616,44493,41134,42369,42430,41219,43359,41422,43961,45906,44165,43522,42104,47128,44892,46833,46349,48098,49329,48899,49025,46975,50266,45158,44303,47529,45364,47072,47090,48880,48357,46768,52326,48475,51924,43569,42585,45944,47003,46066,45719,47161,47558,47052,48297,49136,52971,43142,42475,49753,45161,46083,45540,46325,46742,47932,48678,47971,47251],[1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0],[0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0],[0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0],[0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0],[0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0],[0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0],[0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0],[0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0],[0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>obs<\/th>\n      <th>year<\/th>\n      <th>month<\/th>\n      <th>totacc<\/th>\n      <th>jan<\/th>\n      <th>feb<\/th>\n      <th>mar<\/th>\n      <th>apr<\/th>\n      <th>may<\/th>\n      <th>jun<\/th>\n      <th>jul<\/th>\n      <th>aug<\/th>\n      <th>sep<\/th>\n      <th>oct<\/th>\n      <th>nov<\/th>\n      <th>dec<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":6,"dom":"tip","scrollX":true,"scrollCollapse":true,"columnDefs":[{"className":"dt-center","targets":"_all"}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[6,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>


---
### 时间序列季节虚拟变量模型：模型设定PRM

我们以1月份为基础组，构建如下的有截距虚拟变量回归模型：

`$$\begin{equation} \begin{alignedat}{999} &amp;log(totacc)=&amp;&amp; + \beta_{1} &amp;&amp; + \beta_{2} feb&amp;&amp; + \beta_{3} mar&amp;&amp; + \beta_{4} apr\\ &amp;\text{(cont.)}&amp;&amp; + \beta_{5} may&amp;&amp; + \beta_{6} jun&amp;&amp; + \beta_{7} aug&amp;&amp; + \beta_{8} sep\\ &amp;\text{(cont.)}&amp;&amp; + \beta_{9} oct&amp;&amp; + \beta_{10} nov&amp;&amp; + \beta_{11} dec&amp;&amp;+u_i\\ \end{alignedat} \end{equation}$$`

---
### 时间序列季节虚拟变量模型：OLS估计

以上模型的OLS估计结果如下：

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{log(totacc)}=&amp;&amp;+10.63&amp;&amp;-0.07feb&amp;&amp;+0.06mar&amp;&amp;-0.00apr\\ &amp;\text{(t)}&amp;&amp;(433.2562)&amp;&amp;(-1.5759)&amp;&amp;(1.3715)&amp;&amp;(-0.0072)\\&amp;\text{(se)}&amp;&amp;(0.0245)&amp;&amp;(0.0425)&amp;&amp;(0.0425)&amp;&amp;(0.0425)\\&amp;\text{(cont.)}&amp;&amp;+0.02may&amp;&amp;+0.01jun&amp;&amp;+0.05aug&amp;&amp;+0.04sep\\&amp;\text{(t)}&amp;&amp;(0.3778)&amp;&amp;(0.1622)&amp;&amp;(1.0867)&amp;&amp;(0.8778)\\&amp;\text{(se)}&amp;&amp;(0.0425)&amp;&amp;(0.0425)&amp;&amp;(0.0425)&amp;&amp;(0.0425)\\&amp;\text{(cont.)}&amp;&amp;+0.08oct&amp;&amp;+0.07nov&amp;&amp;+0.10dec\\&amp;\text{(t)}&amp;&amp;(1.8779)&amp;&amp;(1.6876)&amp;&amp;(2.3376)\\&amp;\text{(se)}&amp;&amp;(0.0425)&amp;&amp;(0.0425)&amp;&amp;(0.0425)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.1644;&amp;&amp; \bar{R^2}=0.0783\\&amp; &amp;&amp; F^{\ast}=1.91;&amp;&amp; p=0.0529\\ \end{alignedat} \end{equation}$$`

---
## 分段线性回归模型

**分段现象**：在经济关系中，当解释变量
`\(X\)`的值达到某一水平/阀值
`\(X^\ast\)`之前，与被解释变量之间存在某种线性关系；当解释变量X的值达到或者超过水平/阀值
`\(X^\ast\)`以后，与被解释变量的关系就会发生变化。因而总体看来，似乎被明显“分段”了。

**分段线性回归模型**（piecewise linear regression）：是指用虚拟变量估计不同水平/阀值的解释变量
`\(X\)`对被解释变量
`\(Y\)`的影响的一类线性回归模型。它是虚拟变量回归模型的一种特定形式及应用。

- 一个阀值的分段线性回归模型：

`$$\begin{align}
Y_i &amp; =\beta_1+\beta_2X_i+\lambda(X_i-X^{\ast})D_i+u_i 
\end{align}$$`

- 两个阀值的分段线性回归模型：

`$$\begin{align}
Y_i &amp; =\beta_1+\beta_2X_i+\lambda_1(X_i-X^{\ast}_1)D1_i+\lambda_2(X_i-X^{\ast}_2)D2_i+u_i 
\end{align}$$`

---
### 分段线性回归模型：数据




<div id="htmlwidget-3ca6e13c126fdd60eb3e" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-3ca6e13c126fdd60eb3e">{"x":{"filter":"none","caption":"<caption>供给和需求数据 (n=54)<\/caption>","data":[[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54],[1155,362,357,111,703,494,410,63,616,468,973,235,180,69,305,106,155,422,44,1008,225,321,1001,531,143,251,216,57,146,226,169,32,75,102,4,68,102,462,295,196,50,739,287,226,706,127,85,234,153,4,373,54,81,18],[39.3,23.5,22.4,6.1,35.9,35.5,23.2,9.1,27.5,28.6,41.3,16.9,18.2,9,28.6,12.7,11.8,27.9,21.6,45.9,11.4,16.6,40.7,22.4,17.4,14.3,14.6,6.6,10.6,14.3,3.4,5.1,4.1,4.1,1.7,7.5,7.8,22.6,8.6,7.7,7.8,34.7,15.6,18.5,35,16.5,11.3,7.7,14.8,2,12.4,9.2,11.8,3.9]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>obs<\/th>\n      <th>demand<\/th>\n      <th>offer<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"dom":"tip","columnDefs":[{"className":"dt-center","targets":"_all"}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>

???
案例参考(https://stackoverflow.com/questions/8758646/piecewise-regression-with-r-plotting-the-segments)

---
## 分段线性回归模型：散点图

&lt;img src="10-dummy-model-slide_files/figure-html/unnamed-chunk-75-1.png" style="display: block; margin: auto;" /&gt;

---
## 分段线性回归模型：虚拟变量

<div id="htmlwidget-2e4eab5170e0490f667f" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-2e4eab5170e0490f667f">{"x":{"filter":"none","caption":"<caption>用offer的阀值22.4来设定虚拟变量系统(n=54)<\/caption>","data":[[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54],[1155,362,357,111,703,494,410,63,616,468,973,235,180,69,305,106,155,422,44,1008,225,321,1001,531,143,251,216,57,146,226,169,32,75,102,4,68,102,462,295,196,50,739,287,226,706,127,85,234,153,4,373,54,81,18],[39.3,23.5,22.4,6.1,35.9,35.5,23.2,9.1,27.5,28.6,41.3,16.9,18.2,9,28.6,12.7,11.8,27.9,21.6,45.9,11.4,16.6,40.7,22.4,17.4,14.3,14.6,6.6,10.6,14.3,3.4,5.1,4.1,4.1,1.7,7.5,7.8,22.6,8.6,7.7,7.8,34.7,15.6,18.5,35,16.5,11.3,7.7,14.8,2,12.4,9.2,11.8,3.9],[0,0,0,1,0,0,0,1,0,0,0,1,1,1,0,1,1,0,1,0,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1],[1,1,0,0,1,1,1,0,1,1,1,0,0,0,1,0,0,1,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>obs<\/th>\n      <th>demand<\/th>\n      <th>offer<\/th>\n      <th>D1<\/th>\n      <th>D2<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"dom":"tip","columnDefs":[{"className":"dt-center","targets":"_all"}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>


`$$\begin{align}
&amp;level \quad \{a_1: \quad &lt;22.4,a_2: \quad &gt;22.4\} \\
&amp;dummy \Longrightarrow  
  \begin{cases}
    D1  =
    \begin{cases}
    1, &amp; \text{offer &lt; 22.4}\\
    0, &amp; \text{other}
    \end{cases} \\
    D2 = 
    \begin{cases}
    1, &amp; \text{offer &gt; 22.4}\\
    0, &amp; \text{other}
    \end{cases} 
  \end{cases}
\end{align}$$`

---
## 分段线性回归模型：模型估计

我们以offer=22.4为门阀值，构建如下的分段线性回归模型：

`$$\begin{equation} \begin{alignedat}{999} &amp;demand=&amp;&amp; + \beta_{1} &amp;&amp; + \beta_{2} offer&amp;&amp; + \beta_{3} I(offer - 22.4) \ast D1&amp;&amp;+u_i\\ \end{alignedat} \end{equation}$$`

以上模型的OLS估计结果如下：

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{demand}=&amp;&amp;-434.61&amp;&amp;+33.19offer&amp;&amp;-19.88I(offer - 22.4) \ast D1\\ &amp;\text{(t)}&amp;&amp;(-4.8602)&amp;&amp;(11.1818)&amp;&amp;(-4.0721)\\&amp;\text{(se)}&amp;&amp;(89.4227)&amp;&amp;(2.9685)&amp;&amp;(4.8828)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.8630;&amp;&amp; \bar{R^2}=0.8576\\&amp; &amp;&amp; F^{\ast}=160.60;&amp;&amp; p=0.0000 \end{alignedat} \end{equation}$$`

---
## 分段线性回归模型：回归线

&lt;img src="10-dummy-model-slide_files/figure-html/unnamed-chunk-79-1.png" style="display: block; margin: auto;" /&gt;




---
background-image: url("pic/thank-you-gif-funny-little-yellow.gif")
class: inverse,center
# 本章结束
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
