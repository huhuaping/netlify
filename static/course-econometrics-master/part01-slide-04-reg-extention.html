<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>part01-slide-04-reg-extention.utf8</title>
    <meta charset="utf-8" />
    <link href="libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="libs/remark-css-0.0.1/default-fonts.css" rel="stylesheet" />
    <link href="libs/remark-css-0.0.1/duke-blue.css" rel="stylesheet" />
    <link href="libs/remark-css-0.0.1/hygge-duke.css" rel="stylesheet" />
    <script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
    <script src="libs/jquery-1.12.4/jquery.min.js"></script>
    <link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
    <script src="libs/datatables-binding-0.15/datatables.js"></script>
    <link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
    <link href="libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
    <script src="libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>
    <script src="libs/kePrint-0.0.1/kePrint.js"></script>
    <link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
    <link rel="stylesheet" href="libs/cc-fonts.css" type="text/css" />
    <link rel="stylesheet" href="libs/figure-captions.css" type="text/css" />
    <link rel="stylesheet" href="libs/mycss/my-custom.css" type="text/css" />
    <link rel="stylesheet" href="libs/mycss/footer-header.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">

background-image: url("pic/backup/summer.jpg")
class: center,middle

# .red[计量经济学II]
# (Econometrics II)

&lt;!---    chakra: libs/remark-latest.min.js ---&gt;


### .red[胡华平]

### 西北农林科技大学

### 经济管理学院数量经济教研室

### huhuaping01@hotmail.com

### 2020-10-13










---
class: inverse, middle, center

# 模块1：计量经济学基础

## Chapter 01. 经典模型

## Chapter 02. 矩阵分析

## Chapter 03. 放宽假设

##.red[ Chapter 04. 扩展方法]

---
class: center, middle,inverse
# 第04章：扩展方法

[4.1 模型函数形式](#mod-form)

[4.2 虚拟变量模型](#mod-dummy)

[4.3 自相关问题(auto-correlation)](#auto)


---
class: center, middle, duke-softblue
name: mod-form

# 4.1 模型函数形式


.pull-left[
[4.1.1 过原点回归](#no-intercept)

[4.1.2 尺度与测量单位](#scale)

[4.1.3 标准化变量回归](#standard)

]

.pull-right[
[4.1.4 对数线性模型](#log-log)

[4.1.5 半对数模型](#semi-log)

[4.1.6 倒数模型](#reciprocal-mod)

[4.1.7 函数模型的选择](#options)
]

---
layout: false
class: inverse, center, middle, duke-softblue
name: no-intercept

# 4.1.1 过原点回归 

---
layout: true
  
&lt;div class="my-header"&gt;&lt;/div&gt;

&lt;div class="my-footer"&gt;&lt;span&gt;huhuaping@   第04章：扩展方法   
&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;
4.1 模型函数形式
&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;
4.1.1 过原点回归 &lt;/span&gt;&lt;/div&gt; 

---

## 过原点回归的模型形式

**过原点回归**（regression through the origin）：没有截距项的线性模型

在实践中，双变量PRM过原点回归采取如下的形式：

`$$\begin {align} 
Y_{i}=\beta_{2} X_{i}+u_{i}
\end {align}$$`

适用于这种模型的例子：

- 弗里德曼的持久收入假说(permanent income hypothesis)；

- 资本资产定价模型( the capital Asset Pricing Model, CAPM )等。

---

## 资本资产定价模型（CAPM）

资本资产定价模型( the capital Asset Pricing Model, CAPM )：

`$$\begin {align} 
\left(E R_{i}-r_{f}\right)=\beta_{i}\left(E R_{m}-r_{f}\right)
 \end {align}$$`
 
其中：
- `\(ER_i\)`证券
`\(i\)`的期望回报率；

- `\(ER_m\)`市场证券组合的期望回报率（如标准普尔S&amp;P500综合股票指数）；

- `\(r_f\)`为无风险回报率（90天国债回报率）。

- `\(\beta_i\)`为系数，表明第
`\(i\)`种证券回报率与市场互动程度的度量。(注:不要把这个
`\(\beta_i\)`和双变量回归的斜率系数
`\(\beta_2\)`混同起来。)

一个大于1的
`\(\beta_i\)`意味着证券
`\(i\)`是一种易波动或进攻型证券；一个小于1的
`\(\beta_i\)`意味着证券
`\(i\)`是一种防御型证券。

---

## 资本资产定价模型（CAPM）

`$$\begin {align} 
R_{i}-r_{f} &amp;=\beta_{i}\left(R_{m}-r_{f}\right)+u_{i} \\ 
R_{i}-r_{f} &amp;=\alpha_{i}+\beta_{i}\left(R_{m}-r_{f}\right)+u_{i}
\end  {align}$$`
 
- 如果CAPM成立，则预期
`\(\alpha_i\)`为0。


- 这样的模型如何估计呢？

---

## 资本资产定价模型（CAPM）

这类模型的SRM可以写成：

`$$\begin {align} 
Y_{i}  &amp; =\hat{\beta}_{2} X_{i}+\mathrm{e}_{i} \\ 
\end {align}$$`

OLS方法下求解回归系数：

`$$\begin {align} 
\sum \mathrm{e}_{i}^{2} &amp; =\sum\left(Y_{i}-\hat{\beta}_{2} X_{i}\right)^{2}
\end {align}$$`
 
`$$\begin {align} 
  \frac{\partial \sum \mathrm{e}_{i}^{2}}{\partial \hat{\beta}_{2}} &amp;=2 \sum\left(Y_{i}-\hat{\beta}_{2} X_{i}\right)\left(-X_{i}\right)=0 \\ 
  \hat{\beta}_{2}&amp;=\frac{\sum X_{i} Y_{i}}{\sum X_{i}^{2}}=\frac{\sum X_{i}\left(\beta_{2} X_{i}+u_{i}\right)}{\sum X_{i}^{2}}=\beta_{2}+\frac{\sum X_{i} u_{i}}{\sum X_{i}^{2}} \\ E\left(\hat{\beta}_{2}\right)&amp;=\beta_{2}
\end {align}$$`

---

## 资本资产定价模型（CAPM）

OLS方法下求解得到的方差：

`$$\begin{align}
Var\left(\hat{\beta}_{2}\right)&amp;=E\left(\hat{\beta}_{2}-\beta_{2}\right)^{2} \\
&amp;= E\left[\frac{\sum X_{i} u_{i}}{\sum X_{i}^{2}}\right]^{2} \\ 
&amp;= \frac{\sigma^{2}}{\sum X_{i}^{2}}
\end{align}$$`

`$$\begin {align} 
\hat{\sigma}^{2}=\frac{\sum e_{i}^{2}}{n-1}; \quad \mathrm{E}\left(\hat{\sigma}^{2}\right)=\sigma^{2}
\end {align}$$`

---

## 资本资产定价模型（CAPM）

OLS估计量对比：无截距和有截距的差异：

.pull-left[
`$$\begin {align} 
Y_{i}  &amp; =\hat{\beta}_{2} X_{i}+\mathrm{e}_{i} \\ 
\end {align}$$`

`$$\begin {align} 
\hat{\beta}_{2}=\frac{\sum X_{i} Y_{i}}{\sum X_{i}^{2}} \\ Var\left(\hat{\beta}_{2}\right)=\frac{\sigma^{2}}{\sum X_{i}^{2}} \\ \hat{\sigma}^{2}=\frac{\sum \mathrm{e}_{i}^{2}}{n-1}
\end {align}$$`

]

.pull-right[
`$$\begin {align} 
Y_{i}  &amp; =\hat{\beta}_{1}  +\hat{\beta}_{2} X_{i}+\mathrm{e}_{i} \\ 
\end {align}$$`

`$$\begin {align} 
\hat{\beta}_{2} &amp;=\frac{\sum x_{i} y_{i}}{\sum x_{i}^{2}} \\ 
Var\left(\hat{\beta}_{2}\right) &amp;=\frac{\sigma^{2}}{\sum x_{i}^{2}} \\ 
\hat{\sigma}^{2} &amp;=\frac{\sum \mathrm{e}_{i}^{2}}{n-2}
\end {align}$$`

]

第一，对有截距项的模型来说，总有
`\(\sum{e_i}=0\)`；对无截距项的模型来说，
`\(\sum{e_i}=0\)`不一定成立，只有
`\(\sum{e_iX_i}=0\)`成立。

第二，对有截距项的模型，判定系数
`\(r^2 \geq 0\)`；但是，对无截距模型来说，
`\(r^2\)`时可能出现负值。

---

## 资本资产定价模型（CAPM）

过原点回归的判定系数
`\(r^2\)`的计算公式如下：

`$$\begin {align} 
TSS &amp;=\sum y_{i}^{2}=\sum Y_{i}^{2}-n \overline{Y}^{2} \\
RSS &amp;=\sum e_{i}^{2}=\sum Y_{i}^{2}-\hat{\beta}_{2}^{2} \sum X_{i}^{2}\\
r^2 &amp;= 1- \frac{RSS}{TSS}  &gt;0; \quad r^2 = 1- \frac{RSS}{TSS} &lt;0;
\end {align}$$`

因此，对于无截距模型，我们给出拟合优度指标为**毛判定系数**（Raw 
`\(r^2\)`）：

`$$\begin {align} 
Raw \quad r^{2} = \frac{\sum\left(X_{i} Y_{i}\right)^{2}}{\sum X_{i}^{2} \sum Y_{i}^{2}} 
\end {align}$$`

**启示**：

- 第一，尽管模型含有截距项，但若该项的出现是统计上不显著的(即统计上等于零) ，则从任何实际方面考虑，都可认为这个结果是一个过原点回归模型。
- 第二，如果在模型中确实有截距，而我们却执意拟合一个过原点回归，我们就犯了**设定错误**。

---

### 资本资产定价模型（CAPM）：数据



1980.01-1999.12年间104 种股票构成的一个指数的超额回报率
`\(Y_t\)`(%)和英国总体股票指数的超额回报率
`\(X_t\)`(%)的月度数据共n=240个月观测。其中超额回报率指的是超过无风险资产回报率的部分。

<div id="htmlwidget-1b30245deead73ac9948" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-1b30245deead73ac9948">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208","209","210","211","212","213","214","215","216","217","218","219","220","221","222","223","224","225","226","227","228","229","230","231","232","233","234","235","236","237","238","239","240"],[1980,1980,1980,1980,1980,1980,1980,1980,1980,1980,1980,1980,1981,1981,1981,1981,1981,1981,1981,1981,1981,1981,1981,1981,1982,1982,1982,1982,1982,1982,1982,1982,1982,1982,1982,1982,1983,1983,1983,1983,1983,1983,1983,1983,1983,1983,1983,1983,1984,1984,1984,1984,1984,1984,1984,1984,1984,1984,1984,1984,1985,1985,1985,1985,1985,1985,1985,1985,1985,1985,1985,1985,1986,1986,1986,1986,1986,1986,1986,1986,1986,1986,1986,1986,1987,1987,1987,1987,1987,1987,1987,1987,1987,1987,1987,1987,1988,1988,1988,1988,1988,1988,1988,1988,1988,1988,1988,1988,1989,1989,1989,1989,1989,1989,1989,1989,1989,1989,1989,1989,1990,1990,1990,1990,1990,1990,1990,1990,1990,1990,1990,1990,1991,1991,1991,1991,1991,1991,1991,1991,1991,1991,1991,1991,1992,1992,1992,1992,1992,1992,1992,1992,1992,1992,1992,1992,1993,1993,1993,1993,1993,1993,1993,1993,1993,1993,1993,1993,1994,1994,1994,1994,1994,1994,1994,1994,1994,1994,1994,1994,1995,1995,1995,1995,1995,1995,1995,1995,1995,1995,1995,1995,1996,1996,1996,1996,1996,1996,1996,1996,1996,1996,1996,1996,1997,1997,1997,1997,1997,1997,1997,1997,1997,1997,1997,1997,1998,1998,1998,1998,1998,1998,1998,1998,1998,1998,1998,1998,1999,1999,1999,1999,1999,1999,1999,1999,1999,1999,1999,1999],[1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11,12],[7.263448,6.339896,-9.285217,0.793291,-2.902421,8.613151,3.982063,-1.150171,3.486126,4.32985,0.936875,-5.202456,-2.082757,2.728523,0.653397,6.436072,-4.259198,0.54391,-0.486846,2.844,-16.45721,4.468938,5.88552,-0.390698,2.499568,-4.033607,3.042526,0.734565,2.779732,-5.900116,3.005344,3.954991,2.547127,4.329008,0.191941,-0.921676,3.394683,0.758714,1.862074,6.797751,-1.699254,4.092592,-2.926299,1.773424,-2.800816,-1.505395,4.186963,1.201417,6.769321,-1.686027,5.245806,1.72871,-7.279076,-0.779471,-2.439635,8.445978,1.22108,2.733387,5.127533,3.191555,3.907839,-1.708568,0.435219,0.958068,1.095477,-6.816109,2.785054,3.900209,-4.203004,5.601798,1.570094,-1.084427,0.77867,6.470651,8.953781,-2.387762,-2.873839,3.440269,-5.891053,6.375582,-5.734839,3.630884,-1.316067,3.521601,8.673413,6.914362,-0.460661,4.295976,7.719693,3.039888,2.510224,-3.039443,3.787092,-27.86969,-9.956367,7.975866,3.936938,-0.327971,-2.161544,2.721788,-0.514825,3.128797,0.181502,-7.892364,3.347082,3.158592,-4.81647,-0.00855,13.46098,-0.764475,2.298491,0.762075,-0.495796,1.206636,4.637026,2.680874,-5.303858,-7.210656,5.350186,4.106246,-3.629547,-5.205804,-2.183245,-5.408564,10.57599,-0.338612,-2.213162,-8.476177,-7.459414,-0.085888,5.03477,-1.767715,0.189108,10.38741,2.921914,0.97172,-0.431782,-3.342925,5.242812,2.880655,-1.121472,-3.969578,-5.707995,1.502567,2.599565,0.135881,-6.146138,10.45737,1.415987,-8.261109,-3.778812,-5.386818,11.19436,3.99987,3.620675,2.887222,1.336746,1.240274,0.407144,-1.73493,1.111534,1.354128,1.943062,4.96198,-1.61873,4.215409,1.88036,5.826353,2.973541,-5.479858,-5.784547,1.157083,-6.356199,-0.843584,5.779953,3.29813,-7.11001,2.968006,-1.531245,0.26428,-2.420388,0.138795,3.231657,2.215805,3.856814,-0.952204,4.020036,1.4236,-0.037913,-1.176553,3.760277,0.434626,1.906345,0.301899,-0.314132,3.034332,-1.497346,-0.894677,-0.532816,3.863737,2.118255,-0.853553,1.770341,1.702552,3.465753,1.115253,-2.057818,3.570899,1.95348,2.4587,2.992341,-0.457968,8.111279,-6.967124,-0.155925,3.853283,7.379466,4.299098,3.41078,-0.081495,-1.613131,-0.397289,-2.237365,-12.4632,-5.170735,11.70545,-0.3802,4.986705,2.493728,0.937105,4.280083,3.960824,-4.499198,3.656746,-2.503972,-0.121902,-5.388032,4.01099,6.265313,4.045659],[6.080228,-0.924186,-3.286174,5.211977,-16.16421,-1.054704,11.17238,-11.06328,-16.777,-7.021834,-9.716846,5.215706,-6.612001,4.264498,4.916711,22.20496,-11.29869,-5.770508,-5.217765,16.1962,-17.16995,1.105335,11.68534,-2.301452,8.643728,-11.12908,1.724628,0.15788,-1.875203,-10.62482,-5.761136,5.481432,-17.02207,7.625421,-6.575722,-2.37283,17.52375,1.354656,16.26861,-6.074547,-0.826651,3.807882,0.575701,3.755563,-5.365927,-3.750303,4.898752,4.379256,16.56016,1.523127,1.020608,-3.899308,-14.32502,3.056627,-0.021536,3.355102,0.100007,1.69125,8.200753,3.527866,4.554588,5.365479,4.525231,2.944654,-0.2686,-3.661041,-4.540505,9.195292,-1.894817,12.00661,1.233987,-1.44633,6.023619,10.51236,13.40071,-7.796263,0.21154,6.471111,-9.037476,-5.478381,-6.756882,-2.56496,2.456599,1.476421,17.0694,7.565727,-3.239326,3.662578,7.157455,4.774901,4.237702,-0.881352,11.49688,-35.56618,-14.59137,14.87272,1.748599,-0.606016,-6.078095,3.976154,-1.05091,3.317857,0.4071,-11.87932,-8.801026,6.784211,-10.20578,-6.738054,12.83904,3.302861,-0.155918,3.623091,-1.167681,-1.221603,5.262903,4.845013,-5.069565,-13.57964,1.100608,4.925083,-2.532069,-6.601873,-1.023769,-7.097917,6.376627,1.861975,-5.591527,-15.31759,-10.17227,-2.217396,5.974206,-0.857289,-3.780185,20.64721,10.94068,-3.14564,-3.142888,-1.960866,7.330964,7.854388,2.539178,-1.233245,-11.74604,1.078226,5.937905,4.113184,-0.655199,15.2843,3.994518,-11.94451,-2.530701,-9.842366,18.11574,0.20095,1.125853,7.639181,2.919569,-1.062404,1.292641,0.420241,-2.514081,0.419362,4.374024,1.733528,-3.659809,5.856908,-1.36555,-1.346979,12.89579,-5.346701,-7.614727,10.22043,-6.928422,-5.065919,7.483499,1.828763,-5.692933,-2.426962,2.125101,-4.225371,-6.302392,1.278676,10.90891,2.497849,2.891527,-3.773,8.776289,2.882561,2.146913,-4.590105,-1.293255,-4.244102,6.647089,1.635901,7.85819,0.789545,-0.907725,-0.392247,-1.035896,2.556816,3.13183,-0.020947,-5.312288,-5.196177,-0.753247,-2.474344,2.476478,-1.119104,3.352076,-1.910172,0.142815,10.50199,12.98502,-4.134762,-4.14858,-1.752478,-3.349122,14.07471,7.791651,5.154679,3.293686,-13.25462,-7.714206,-15.2634,-15.22865,15.96218,-8.684089,17.13842,-1.468449,8.5036,10.89431,13.03497,-5.654672,8.321969,0.507652,-5.022981,-2.305449,-1.876879,1.348825,-2.641649]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>year<\/th>\n      <th>month<\/th>\n      <th>X<\/th>\n      <th>Y<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"tip","columnDefs":[{"targets":4,"render":"function(data, type, row, meta) { return DTWidget.formatRound(data, 4, 3, \",\", \".\"); }"},{"targets":3,"render":"function(data, type, row, meta) { return DTWidget.formatRound(data, 4, 3, \",\", \".\"); }"},{"className":"dt-center","targets":"_all"},{"visible":false,"targets":0},{"orderable":false,"targets":0}],"pageLength":8,"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[8,10,25,50,100]}},"evals":["options.columnDefs.0.render","options.columnDefs.1.render"],"jsHooks":[]}</script>

---

### 资本资产定价模型（CAPM）：散点图

下面先直接给出二者的散点图：

&lt;img src="part01-slide-04-reg-extention_files/figure-html/unnamed-chunk-4-1.png" style="display: block; margin: auto;" /&gt;

---

### 资本资产定价模型（CAPM）：回归结果

两类模型回归结果对比：

.pull-left[
**无截距模型**：

`$$\begin {align} 
Y_{i}  &amp; =\hat{\beta}_{2} X_{i}+\mathrm{e}_{i} 
\end {align}$$`

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{Y}=&amp;&amp;+1.16X\\ &amp;\text{(t)}&amp;&amp;(15.5320)\\&amp;\text{(se)}&amp;&amp;(0.0744)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.5023;&amp;&amp; \bar{R^2}=0.5003\\&amp; &amp;&amp; F^{\ast}=241.24;&amp;&amp; p=0.0000 \end{alignedat} \end{equation}$$`

]

.pull-right[
**有截距模型**：

`$$\begin {align} 
Y_{i}  &amp; =\hat{\beta}_{1} +\hat{\beta}_{2} X_{i}+\mathrm{e}_{i} 
\end {align}$$`

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{Y}=&amp;&amp;-0.45&amp;&amp;+1.17X\\ &amp;\text{(t)}&amp;&amp;(-1.2329)&amp;&amp;(15.5350)\\&amp;\text{(se)}&amp;&amp;(0.3629)&amp;&amp;(0.0754)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.5035;&amp;&amp; \bar{R^2}=0.5014\\&amp; &amp;&amp; F^{\ast}=241.34;&amp;&amp; p=0.0000 \end{alignedat} \end{equation}$$`

]


---
layout: false
class: inverse, center, middle, duke-softblue
name: scale

# 4.1.2 尺度与测量单位

---
layout: true
  
&lt;div class="my-header"&gt;&lt;/div&gt;

&lt;div class="my-footer"&gt;&lt;span&gt;huhuaping@   第04章：扩展方法   
&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;
4.1 模型函数形式
&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;
4.1.2 尺度与测量单位 &lt;/span&gt;&lt;/div&gt; 

---

## 案例数据



在回归分析中，因变量Y和解释变量X的测量单位的不同会造成回归结果的差异吗？

<div id="htmlwidget-90523b8c63893f57db0a" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-90523b8c63893f57db0a">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16"],["1990 ","1991 ","1992 ","1993 ","1994 ","1995 ","1996 ","1997 ","1998 ","1999  ","2000 ","2001 ","2002","2003","2004 ","2005 "],[886.6,829.1,878.3,953.5,1042.3,1109.6,1209.2,1320.6,1455,1576.3,1679,1629.4,1544.6,1596.9,1713.9,1842],[886600,829100,878300,953500,1042300,1109600,1209200,1320600,1455000,1576300,1679000,1629400,1544600,1596900,1713900,1842000],[7112.5,7100.5,7336.6,7532.7,7835.5,8031.7,8328.9,8703.5,9066.9,9470.3,9817,9890.7,10048.8,10301,10703.5,11048.6],[7112500,7100500,7336600,7532700,7835500,8031700,8328900,8703500,9066900,9470300,9817000,9890700,10048800,10301000,10703500,11048600],[-1.29421322424925,-1.46237119822207,-1.31848646223142,-1.09856507714001,-0.838870675595908,-0.642052733885118,-0.350773878099163,-0.0249860815674826,0.368064904553324,0.722805117473368,1.02314988142134,0.878095350829133,0.630098895300528,0.783049539453194,1.12521446040657,1.49984118155297],[-1.34591381872393,-1.35497190595521,-1.17675403967979,-1.02872979750864,-0.800164063039362,-0.652064336807947,-0.427725709713265,-0.144962419976832,0.129346655010407,0.433849354101909,0.695552591025618,0.751184343437725,0.870524642709828,1.06089544268721,1.36471878523637,1.62521427719591]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Year<\/th>\n      <th>GPDIB<\/th>\n      <th>GPDIM<\/th>\n      <th>GDPB<\/th>\n      <th>GDPM<\/th>\n      <th>GPDIB_std<\/th>\n      <th>GDPB_std<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"tip","columnDefs":[{"targets":6,"render":"function(data, type, row, meta) { return DTWidget.formatRound(data, 4, 3, \",\", \".\"); }"},{"targets":7,"render":"function(data, type, row, meta) { return DTWidget.formatRound(data, 4, 3, \",\", \".\"); }"},{"className":"dt-center","targets":"_all"},{"visible":false,"targets":0},{"orderable":false,"targets":0}],"pageLength":5,"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":["options.columnDefs.0.render","options.columnDefs.1.render"],"jsHooks":[]}</script>

- GPDIB = 以2000年**10亿**(Billions)美元计国内私人总投资；
GPDIM = 以2000年**百万**(millions)美元计国内私人总投资；

- GDPB = 以2000年**10亿**(Billions)美元计GDP总值；
GDPM = 以2000年**百万**(millions)美元计GDP总值；


---

## 尺度变换

把某一测量单位下的回归模型，变换为另一测量单位的回归模型：

`$$\begin {align} 
Y_{i}  &amp; =\hat{\beta}_{1} +\hat{\beta}_{2} X_{i}+\mathrm{e}_{i}\\
Y^{\ast}_{i}  &amp; =\hat{\beta}^{\ast}_{1} +\hat{\beta}^{\ast}_{2} X_{i}+\mathrm{e}^{\ast}_{i}
\end {align}$$`

**尺度因子**：
`\(\omega_1;\omega_2\)`分别表示为Y和X的尺度因子。

`$$\begin {align} 
Y_{i}^{*}=\omega_{1} Y_{i} \quad X_{i}^{*}=\omega_{2} X_{i}
\end {align}$$`

如果
`\((Y_i;X_i)\)`都是以**10亿**(billion)美元计量的，我们把它们改为用**百万**(million)美元去度量，就会有：

`$$\begin {align} 
Y_{i}^{*}=1000 Y_{i}; \quad X_{i}^{*}=1000 X_{i}; \quad \omega_{1}=\omega_{2}=1000
\end {align}$$`

---

## OLS估计

进行数据转换，新模型的OLS估计量如下：

`$$\begin {align} 
Y_{i}  &amp; =\hat{\beta}_{1} +\hat{\beta}_{2} X_{i}+\mathrm{e}_{i}\\
Y^{\ast}_{i}  &amp; =\hat{\beta}^{\ast}_{1} +\hat{\beta}^{\ast}_{2} X_{i}+\mathrm{e}^{\ast}_{i} \\
Y_{i}^{*}&amp;=\omega_{1} Y_{i} ; \quad X_{i}^{*}=\omega_{2} X_{i} ; \quad e_{i}^{*}=\omega_{1} e_{i}
\end {align}$$`

`$$\begin {align} 
\hat{\beta}_{2} * &amp;=\frac{\sum x_{i}^{*} y_{i}^{*}}{\sum x_{i}^{* 2}} \quad &amp;&amp; \Leftarrow
\operatorname{var}\left(\hat{\beta}_{2}^{*}\right)=\frac{\sigma^{* 2}}{\sum x_{i}^{* 2}}\\
\hat{\beta}_{1}^{*}&amp;=\overline{Y}^{*}-\hat{\beta}_{2}^{*} \overline{X}^{*} \quad &amp;&amp; \Leftarrow
\operatorname{var}\left(\hat{\beta}_{1}^{*}\right)=\frac{\sum X_{i}^{* 2}}{n \sum x_{i}^{* 2}} \cdot \sigma^{* 2}\\
\hat{\sigma}^{* 2} &amp;=\frac{\sum e_{i}^{* 2}}{n-2}
 \end {align}$$`

---

## OLS估计

进行数据转换，两个模型下OLS估计量有如下关系：

`$$\begin {align} 
Y_{i}  &amp; =\hat{\beta}_{1} +\hat{\beta}_{2} X_{i}+\mathrm{e}_{i}\\
Y^{\ast}_{i}  &amp; =\hat{\beta}^{\ast}_{1} +\hat{\beta}^{\ast}_{2} X_{i}+\mathrm{e}^{\ast}_{i} \\
Y_{i}^{*}&amp;=\omega_{1} Y_{i} ; \quad X_{i}^{*}=\omega_{2} X_{i} ; \quad e_{i}^{*}=\omega_{1} e_{i}
\end {align}$$`

`$$\begin {align} 
\hat{\beta}_{2}^{*} &amp;=\left(\frac{\omega_{1}}{\omega_{2}}\right) \hat{\beta}_{2} &amp;&amp; \Leftarrow 
\operatorname{var}\left(\hat{\beta}_{2}^{*}\right) =\left(\frac{\omega_{1}}{\omega_{2}}\right)^{2} \operatorname{var}\left(\hat{\beta}_{2}\right) \\
\operatorname{var}\left(\hat{\beta}_{2}^{*}\right) &amp;=\left(\frac{\omega_{1}}{\omega_{2}}\right)^{2} \operatorname{var}\left(\hat{\beta}_{2}\right) &amp;&amp;\Leftarrow
\operatorname{var}\left(\hat{\beta}_{1}^{*}\right)  =\omega_{1}^{2} \operatorname{var}\left(\hat{\beta}_{1}\right) \\
\hat{\sigma}^{* 2} &amp; =\omega_{1}^{2} \hat{\sigma}^{2} \\
r_{x y}^{2} &amp; =r_{x * y^{*}}^{2}
\end {align}$$`


---

## 相关结论

`$$\begin {align} 
Y_{i}  &amp; =\hat{\beta}_{1} +\hat{\beta}_{2} X_{i}+\mathrm{e}_{i}\\
Y^{\ast}_{i}  &amp; =\hat{\beta}^{\ast}_{1} +\hat{\beta}^{\ast}_{2} X_{i}+\mathrm{e}^{\ast}_{i} \\
Y_{i}^{*}&amp;=\omega_{1} Y_{i} ; \quad X_{i}^{*}=\omega_{2} X_{i} ; \quad e_{i}^{*}=\omega_{1} e_{i}
\end {align}$$`

模型对比，得出如下主要结论：

- 
`\(\omega_1=\omega_2\)` ，即尺度因子相等时，**斜率系数**及其**标准误**不受尺度从（
`\(Y_i,X_i\)`）到（
`\(Y_i^{\ast},X_i^{\ast}\)`）的影响。**截距**及其**标准误**却放大或缩小至
`\(\omega_1\)`倍。

- 
`\(X_i\)`尺度不变
`\(\omega_2=1\)`，
`\(Y_i\)`尺度因子
`\(\omega_1\)`变化，那么，斜率和截距系数以及它们各自的标准误都要乘以同样的因子
`\(\omega_1\)`。

- 
`\(Y_i\)`尺度不变
`\(\omega_1=1\)` ，而
`\(X_i\)`尺度因子
`\(\omega_2\)`变化，那么，斜率系数及其标准误都要乘以因子
`\(1/\omega_1\)`，而截距系数及其标准误不变。


---

### 案例分析结果

--
.pull-left[
GPDI和GDP都以十亿美元计算：

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{GPDIB}=&amp;&amp;-926.09&amp;&amp;+0.25GDPB\\ &amp;\text{(t)}&amp;&amp;(-7.9590)&amp;&amp;(19.5824)\\&amp;\text{(se)}&amp;&amp;(116.3577)&amp;&amp;(0.0129)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.9648;&amp;&amp; \bar{R^2}=0.9623\\&amp; &amp;&amp; F^{\ast}=383.47;&amp;&amp; p=0.0000 \end{alignedat} \end{equation}$$`


GPDI和GDP都以百万美元计算：
`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{GPDIM}=&amp;&amp;-926090.39&amp;&amp;+0.25GDPM\\ &amp;\text{(t)}&amp;&amp;(-7.9590)&amp;&amp;(19.5824)\\&amp;\text{(se)}&amp;&amp;(116357.6965)&amp;&amp;(0.0129)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.9648;&amp;&amp; \bar{R^2}=0.9623\\&amp; &amp;&amp; F^{\ast}=383.47;&amp;&amp; p=0.0000 \end{alignedat} \end{equation}$$`

]

--

.pull-right[
GPDI以十亿美元计算而GDP以百万美元计算:
`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{GPDIB}=&amp;&amp;-926.09&amp;&amp;+0.00GDPM\\ &amp;\text{(t)}&amp;&amp;(-7.9590)&amp;&amp;(19.5824)\\&amp;\text{(se)}&amp;&amp;(116.3577)&amp;&amp;(0.0000)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.9648;&amp;&amp; \bar{R^2}=0.9623\\&amp; &amp;&amp; F^{\ast}=383.47;&amp;&amp; p=0.0000 \end{alignedat} \end{equation}$$`

GPDl以百万美元计算而GDP 以十亿美元计算：

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{GPDIM}=&amp;&amp;-926090.39&amp;&amp;+253.52GDPB\\ &amp;\text{(t)}&amp;&amp;(-7.9590)&amp;&amp;(19.5824)\\&amp;\text{(se)}&amp;&amp;(116357.6965)&amp;&amp;(12.9465)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.9648;&amp;&amp; \bar{R^2}=0.9623\\&amp; &amp;&amp; F^{\ast}=383.47;&amp;&amp; p=0.0000 \end{alignedat} \end{equation}$$`
]

---

layout: false
class: inverse, center, middle, duke-softblue
name: standard

# 4.1.3 标准化变量回归

---

layout: true
  
&lt;div class="my-header"&gt;&lt;/div&gt;

&lt;div class="my-footer"&gt;&lt;span&gt;huhuaping@   第04章：扩展方法   
&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;
4.1 模型函数形式
&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;
4.1.3 标准化变量回归 &lt;/span&gt;&lt;/div&gt; 

---

## 标准化变量回归

假设如下双变量回归：

`$$\begin {align} 
Y_{i}  &amp; =\hat{\beta}_{1} +\hat{\beta}_{2} X_{i}+\mathrm{e}_{i}
\end {align}$$`

对Y和X作如下标准化变换，得到相应的**标准化变量**：

`$$\begin {align} 
Y_{i}^* &amp; =\frac{Y_{i}-\overline{Y}}{S_{Y}}; \quad X_{i}^ *=\frac{X_{i}-\overline{X}}{S_{X}}
\end {align}$$`

- 标准化变量的特征是：其均值总是0 和标准差总是1。

得到如下新的双变量回归模型:

`$$\begin {align} 
Y_{i}^* &amp; =\hat{\beta}_{1}^{*}+\hat{\beta}_{2}^{*} X_{i}+e_{i}^{*} \\ 
&amp;=\hat{\beta}_{2}^{*} X_{i}+e_{i}^{*} 
\end {align}$$`

- 对标准化的回归子和回归元做回归，截距项总是零!

- 实际上变成了过原点回归模型!

---

## 标准化变量回归

模型比较与结论：

- 第一，由于标准化回归本质上是一个过原点回归，而我们在已经指出通常过原点回归的不能使用
`\(r^2\)`，所以我们就没有给出其
`\(r^2\)`值。

- 第二，传统模型的系数与这里的系数之间存在一种有趣的关系。在双变量情形中，这种关系如下（证明过程略：自学练习题！）：

`$$\begin {align} 
\hat{\beta}_{2}^{*}=\frac{\mathrm{S}_{X}}{\mathrm{S}_{\mathrm{Y}}} \hat{\beta}_{2}
\end {align}$$`

- 第三，在多元回归中，变量标准化可以去除多个自变量之间数量尺度(量纲)的差别，因而具有一定的优点！

---

### 标准化数据变换

下面我们对以十亿美元计的GPDIB和GDPB进行标准化数据变换：

<div id="htmlwidget-2d2661ae7af69a32ca7d" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-2d2661ae7af69a32ca7d">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16"],["1990 ","1991 ","1992 ","1993 ","1994 ","1995 ","1996 ","1997 ","1998 ","1999  ","2000 ","2001 ","2002","2003","2004 ","2005 "],[886.6,829.1,878.3,953.5,1042.3,1109.6,1209.2,1320.6,1455,1576.3,1679,1629.4,1544.6,1596.9,1713.9,1842],[7112.5,7100.5,7336.6,7532.7,7835.5,8031.7,8328.9,8703.5,9066.9,9470.3,9817,9890.7,10048.8,10301,10703.5,11048.6],[-1.29421322424925,-1.46237119822207,-1.31848646223142,-1.09856507714001,-0.838870675595908,-0.642052733885118,-0.350773878099163,-0.0249860815674826,0.368064904553324,0.722805117473368,1.02314988142134,0.878095350829133,0.630098895300528,0.783049539453194,1.12521446040657,1.49984118155297],[-1.34591381872393,-1.35497190595521,-1.17675403967979,-1.02872979750864,-0.800164063039362,-0.652064336807947,-0.427725709713265,-0.144962419976832,0.129346655010407,0.433849354101909,0.695552591025618,0.751184343437725,0.870524642709828,1.06089544268721,1.36471878523637,1.62521427719591]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Year<\/th>\n      <th>GPDIB<\/th>\n      <th>GDPB<\/th>\n      <th>GPDIB_std<\/th>\n      <th>GDPB_std<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"tip","columnDefs":[{"targets":4,"render":"function(data, type, row, meta) { return DTWidget.formatRound(data, 4, 3, \",\", \".\"); }"},{"targets":5,"render":"function(data, type, row, meta) { return DTWidget.formatRound(data, 4, 3, \",\", \".\"); }"},{"className":"dt-center","targets":"_all"},{"visible":false,"targets":0},{"orderable":false,"targets":0}],"pageLength":8,"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[8,10,25,50,100]}},"evals":["options.columnDefs.0.render","options.columnDefs.1.render"],"jsHooks":[]}</script>

---

### OLS比较

GPDI和GDP都以十亿美元计算：

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{GPDIB}=&amp;&amp;-926.09&amp;&amp;+0.25GDPB\\ &amp;\text{(t)}&amp;&amp;(-7.9590)&amp;&amp;(19.5824)\\&amp;\text{(se)}&amp;&amp;(116.3577)&amp;&amp;(0.0129)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.9648;&amp;&amp; \bar{R^2}=0.9623\\&amp; &amp;&amp; F^{\ast}=383.47;&amp;&amp; p=0.0000 \end{alignedat} \end{equation}$$`

标准化变量后的模型估计：

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{GPDIB_std}=&amp;&amp;+0.98GDPB_{std}\\ &amp;\text{(t)}&amp;&amp;(20.2697)\\&amp;\text{(se)}&amp;&amp;(0.0485)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.9648;&amp;&amp; \bar{R^2}=0.9624\\&amp; &amp;&amp; F^{\ast}=410.86;&amp;&amp; p=0.0000 \end{alignedat} \end{equation}$$`

---
layout: false
class: inverse, middle, center
# 回归模型的函数形式

### 对数线性模型

### 半对数模型

### 倒数模型

---
layout: false
class: inverse, center, middle, duke-softblue
name:log-log

# 4.1.4 对数线性模型

---
layout: true
  
&lt;div class="my-header"&gt;&lt;/div&gt;

&lt;div class="my-footer"&gt;&lt;span&gt;huhuaping@   第04章：扩展方法   
&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;
4.1 模型函数形式
&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;
4.1.4 对数线性模型 &lt;/span&gt;&lt;/div&gt; 

---

## 对数线性模型的形式

**指数回归模型**（exponential regression model）

`$$\begin {align} 
Y_{i}=\beta_{1} X_{i}^{\beta_{2}} e^{u_{i}}
\end {align}$$`

可化为：

`$$\begin {align} 
 \ln Y_{i} &amp;=\ln \beta_{1}+\beta_{2} \ln X_{i}+u_{i} \\ 
 \ln Y_{i} &amp;=\alpha+\beta_{2} \ln X_{i}+u_{i}  &amp;&amp; \Leftarrow \alpha=\ln \beta_{1}
\end {align}$$`

这种模型被称为对数-对数(log-log)，双对数(double-log)或对数一线性(log-linear)模型。进而有：

`$$\begin {align} 
Y_{i}^{*}&amp;=\alpha+\beta_{2} X_{i}^{*}+u_{i} &amp;&amp;\Leftarrow 
\left[ Y_{i}^{*}=\ln Y_{i} ; \quad  
X_{i}^{*}=\ln X_{i} \right]
\end {align}$$`
 
从而可用OLS方法可以得到BLUE估计量：

`$$\begin {align} 
Y_{i}^{*}=\hat{\alpha}+\hat{\beta}_{2} X_{i}^{*}+\mathrm{e}_{i}
\end {align}$$`

---

## 对数线性模型：学会如何测度弹性

双数线性模型：

`$$\begin {align} 
\ln Y_{i}&amp;=\alpha+\beta_{2} \ln X_{i}+u_{i} \\
Y_{i}^{*}&amp;=\hat{\alpha}+\hat{\beta}_{2} X_{i}^{*}+\mathrm{e}_{i}
&amp;&amp; \Leftarrow \hat{\alpha}=\ln \hat{\beta}_{1}
\end {align}$$`

`$$\begin {align} 
\beta_{2}=\frac{d(\ln Y)}{d(\ln X)}=\frac{\frac{1}{Y} d Y}{\frac{1}{X} d X}=\frac{d Y / Y}{d X / X}
\end {align}$$`

斜率就是Y对X的弹性！如果Y代表商品需求量Q，X代表商品价格P，则就表示该商品的需求价格弹性。

---

## 学会如何测度弹性

双数线性模型有如下性质：

- Y对X的弹性在整个研究范围内是常数，一直为
`\(\beta_2\)`，因此这种模型也称为不变弹性模型(constant elasticity model)。

- 虽然
`\(\hat{\alpha}\)`和
`\(\hat{\beta}_2\)`是无偏估计量，但是进入原始模型的参数
`\(\beta_1\)`的估计值
`\(\hat{\beta}_1\)`却是有偏估计，而且
`\(\beta_{1}=antilog\hat{\alpha}\)`。

&lt;img src="pic/chpt5-elasticity.png" width="536" style="display: block; margin: auto;" /&gt;

---

### 耐用品消费案例



耐用品支出与个人消费总支出的关系：

<div id="htmlwidget-835bc5b264676e5743b2" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-835bc5b264676e5743b2">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15"],["2003-I ","2003-II ","2003-III ","2003-IV","2004-I ","2004-II ","2004-III ","2004-IV","2005-I ","2005-II ","2005-III ","2005-IV  ","2006-I ","2006-II ","2006-III "],[971.4,1009.8,1049.6,1051.4,1067,1071.4,1093.9,1110.3,1116.8,1150.8,1175.9,1137.9,1190.5,1190.3,1208.8],[7184.9,7249.3,7352.9,7394.3,7479.8,7534.4,7607.1,7687.1,7739.4,7819.8,7895.3,7910.2,8003.8,8055,8111.2],[6.87873832991164,6.91750757042482,6.95616441818982,6.95787788838535,6.97260625130175,6.97672148344686,6.99750457112575,7.01238552806022,7.01822273200811,7.04821263167739,7.06978909082937,7.03693973736296,7.08212866592692,7.08196065517383,7.09738341095853],[8.87973688053179,8.88866019146317,8.90285007221254,8.90846471211142,8.91996133264314,8.92723447948929,8.93683730069767,8.94729887824071,8.95407944419915,8.96441425776473,8.97402292470118,8.97590834489212,8.98767170788518,8.99404829561107,9.00100110163837]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>obs<\/th>\n      <th>EXPDUR<\/th>\n      <th>PCEXP<\/th>\n      <th>ln_expdur<\/th>\n      <th>ln_pcexp<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"tip","columnDefs":[{"targets":4,"render":"function(data, type, row, meta) { return DTWidget.formatRound(data, 4, 3, \",\", \".\"); }"},{"targets":5,"render":"function(data, type, row, meta) { return DTWidget.formatRound(data, 4, 3, \",\", \".\"); }"},{"className":"dt-center","targets":"_all"},{"visible":false,"targets":0},{"orderable":false,"targets":0}],"pageLength":5,"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":["options.columnDefs.0.render","options.columnDefs.1.render"],"jsHooks":[]}</script>

其中：PCEXP=个人消费支出, EXPDUR=耐用品消费支出，单位10亿美元（按2000年价格计）

---

### 耐用品消费案例

假设我们想求出耐用品支出对个人消费总支出的**斜率**。

将耐用品支出相对于个人消费总支出做散点图：

&lt;img src="part01-slide-04-reg-extention_files/figure-html/unnamed-chunk-19-1.png" style="display: block; margin: auto;" /&gt;

---

### 耐用品消费案例

假设我们想求出耐用品支出对个人消费总支出的**弹性**。

将耐用品支出的**对数**相对于个人消费总支出的**对数**做散点图：

&lt;img src="part01-slide-04-reg-extention_files/figure-html/unnamed-chunk-20-1.png" style="display: block; margin: auto;" /&gt;



---

### 耐用品消费案例

耐用品消费案例中，我们可以实证得到如下的**双对数模型**：

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{log(EXPDUR)}=&amp;&amp;-7.54&amp;&amp;+1.63log(PCEXP)\\ &amp;\text{(t)}&amp;&amp;(-10.5309)&amp;&amp;(20.3152)\\&amp;\text{(se)}&amp;&amp;(0.7161)&amp;&amp;(0.0801)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.9695;&amp;&amp; \bar{R^2}=0.9671\\&amp; &amp;&amp; F^{\ast}=412.71;&amp;&amp; p=0.0000 \end{alignedat} \end{equation}$$`

---
layout: false
class: inverse, center, middle, duke-softblue
name: semi-log

# 4.1.5 半对数模型

---
layout: true
  
&lt;div class="my-header"&gt;&lt;/div&gt;

&lt;div class="my-footer"&gt;&lt;span&gt;huhuaping@   第04章：扩展方法   
&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;
4.1 模型函数形式
&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;
4.1.5 半对数模型 &lt;/span&gt;&lt;/div&gt; 

---

## 线性到对数模型

怎样测量增长率？经济学家、企业人员与政府常常对于求出某些经济变量的增长率感兴趣，如人口、GNP、货币供给、就业、生产力、贸易赤字等。

`$$\begin {align} 
Y_{t}=Y_{0}(1+r)^{t}
\end {align}$$`

`\(Y_t\)`＝时期t的劳务实际支出；
`\(Y_0\)`＝劳务实际支出的初始值(为2002年第四季度末的值)；r是Y的复合增长率。

<div id="htmlwidget-edf2b89f1a010646a34a" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-edf2b89f1a010646a34a">{"x":{"filter":"none","caption":"<caption>劳务支出数据<\/caption>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15"],["2003-I ","2003-II ","2003-III ","2003-IV","2004-I ","2004-II ","2004-III ","2004-IV","2005-I ","2005-II ","2005-III ","2005-IV  ","2006-I ","2006-II ","2006-III "],[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15],[4143.3,4161.3,4190.7,4220.2,4268.2,4308.4,4341.5,4377.4,4395.3,4420,4454.5,4476.7,4494.5,4535.4,4566.6],[8.32924785075199,8.33358280443735,8.34062306340162,8.34763779927196,8.35894747167987,8.36832188447661,8.3759751895007,8.38421021980998,8.38829106717538,8.39389497507174,8.4016701001607,8.40664144683783,8.41060970601345,8.41966856152619,8.4265242245014]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>obs<\/th>\n      <th>t<\/th>\n      <th>EXPSERVICES<\/th>\n      <th>ln_expservices<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"tip","columnDefs":[{"targets":4,"render":"function(data, type, row, meta) { return DTWidget.formatRound(data, 4, 3, \",\", \".\"); }"},{"className":"dt-center","targets":"_all"},{"visible":false,"targets":0},{"orderable":false,"targets":0}],"pageLength":4,"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[4,10,25,50,100]}},"evals":["options.columnDefs.0.render"],"jsHooks":[]}</script>

---

## 线性到对数模型

半对数模型(semilog models)：

- 线性到对数模型(log-lin model)：只有回归子Y取对数

- 对数到线性模型(lin-log model)：只有回归元X取对数


---

## 线性到对数模型

半对数模型的形式：

`$$\begin {align} 
Y_{t} &amp;=Y_{0}(1+r)^{t} \\ 
\ln Y_{t} &amp;=\ln Y_{0}+t \ln (1+r)  \\ 
\ln Y_{t} &amp;=\beta_{1}+\beta_{2} t &amp;&amp; \Leftarrow 
\left[ \beta_{1}=\ln Y_{0}; \quad  \beta_{2}=\ln (1+r) \right]\\ 
\ln Y_{t} &amp;=\beta_{1}+\beta_{2} t+u_{t}
\end {align}$$`

斜率
`\(\beta_2\)`的经济学含义：

`$$\begin {align} 
\beta_{2}=\frac{d \ln Y}{d t}=\frac{d Y / Y}{d t}
 \end {align}$$`
 
**恒定相对增长率模型**：上述模型描述了因变量Y的恒定相对增长率

- 恒定相对增长模型：
`\(\beta_2 &gt; 0\)`

- 恒定相对衰减模型：
`\(\beta_2 &lt; 0\)`


---

### 散点图1


&lt;img src="part01-slide-04-reg-extention_files/figure-html/unnamed-chunk-23-1.png" style="display: block; margin: auto;" /&gt;

---

### 散点图2

&lt;img src="part01-slide-04-reg-extention_files/figure-html/unnamed-chunk-24-1.png" style="display: block; margin: auto;" /&gt;


---

### OLS估计

半对数模型：线性到对数模型

`$$\begin {align} 
\ln Y_{t} &amp;=\beta_{1}+\beta_{2} t+u_{t} &amp;&amp; \Leftarrow 
\left[ \beta_{1}=\ln Y_{0}; \quad  \beta_{2}=\ln (1+r) \right]
\end {align}$$`

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{log(EXPSERVICES)}=&amp;&amp;+8.32&amp;&amp;+0.01t\\ &amp;\text{(t)}&amp;&amp;(5186.2999)&amp;&amp;(39.9648)\\&amp;\text{(se)}&amp;&amp;(0.0016)&amp;&amp;(0.0002)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.9919;&amp;&amp; \bar{R^2}=0.9913\\&amp; &amp;&amp; F^{\ast}=1597.18;&amp;&amp; p=0.0000 \end{alignedat} \end{equation}$$`

.pull-left[
`$$\begin {align} 
\begin{aligned} \hat{\beta}_{2} &amp;=\ln (1+r)=0.00705 \\ 
r &amp;=\operatorname{antilog}\left(\hat{\beta}_{2}\right)-1 \\ &amp;=\operatorname{antilog}(0.00705)-1 \\ &amp;=0.00708 \end{aligned}
\end {align}$$`
]

.pull-right[
- 
`\(\hat{\beta}_{2}=0.00705\)`表示**瞬时增长率**

- 
`\(r=0.00708\)`表示**复合增长率**
]

---

### 回归结果比较

下面做一个对比模型。线性趋势模型：Y直接对时间t回归：

`$$\begin {align} 
Y_{t}=\beta_{1}+\beta_{2} t+u_{t}
 \end {align}$$`

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{EXPSERVICES}=&amp;&amp;+4111.54&amp;&amp;+30.67t\\ &amp;\text{(t)}&amp;&amp;(655.5628)&amp;&amp;(44.4671)\\&amp;\text{(se)}&amp;&amp;(6.2718)&amp;&amp;(0.6898)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.9935;&amp;&amp; \bar{R^2}=0.9930\\&amp; &amp;&amp; F^{\ast}=1977.32;&amp;&amp; p=0.0000 \end{alignedat} \end{equation}$$`

**解释如下**：在2003年第1季度至2006年第3季度期间，劳务支出以每季度约300 亿美元的绝对速度(注意不是相对速度)增加，即劳务支出有上涨的趋势。


---

## 对数到线性模型(lin-log model)

如果我们的目的是测量X的一个百分比变化时，Y的绝对变化量，则要用**对数到线性模型**（lin-log model）。

`$$\begin {align} 
Y_{t}=\beta_{1}+\beta_{2} \ln X_{i}+u_{i}
\end {align}$$`


`$$\begin {align} 
\beta_2 &amp; =\frac{d Y}{d \ln X}=\frac{d Y}{d X / X}=\frac{\Delta \mathrm{Y}}{\Delta \mathrm{X} / X} \\
\Delta \mathrm{Y} &amp; =\beta_{2} \frac{\Delta \mathrm{X}}{\mathrm{X}}
\end {align}$$`

例如：恩格尔支出(Engel expenditure) 模型：

- “用于食物的总支出以算术级数增加，而总支出以几何级数增加。”

---

### 家庭食物支出案例



食物支出（`foodexp`）与家庭总支出（`totalexp`）的关系：

<div id="htmlwidget-851f3a47cc982581fc44" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-851f3a47cc982581fc44">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55"],[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55],[217,196,303,270,325,260,300,325,336,345,325,362,315,355,325,370,390,420,410,383,315,267,420,300,410,220,403,350,390,385,470,322,540,433,295,340,500,450,415,540,360,450,395,430,332,397,446,480,352,410,380,610,530,360,305],[382,388,391,415,456,460,472,478,494,516,525,554,575,579,585,586,590,608,610,616,618,623,627,630,635,640,648,650,655,662,663,677,680,690,695,695,695,720,721,730,731,733,745,751,752,752,769,773,773,775,785,788,790,795,801],[5.94542060860658,5.96100533962327,5.96870755998537,6.0282785202307,6.12249280951439,6.13122648948314,6.15697898558556,6.16961073249146,6.20253551718792,6.24610676548156,6.26339826259162,6.31716468674728,6.35437004079735,6.361302477573,6.37161184723186,6.37331978957701,6.38012253689976,6.41017488196617,6.41345895716736,6.42324696353352,6.42648845745769,6.43454651878745,6.44094654063292,6.44571981938558,6.45362499889269,6.46146817635372,6.47389069635227,6.47697236288968,6.48463523563525,6.49526555593701,6.49677499018586,6.51767127291227,6.52209279817015,6.5366915975913,6.54391184556479,6.54391184556479,6.54391184556479,6.5792512120101,6.58063913728495,6.59304453414244,6.59441345974978,6.59714570188665,6.61338421837956,6.62140565176413,6.62273632394984,6.62273632394984,6.64509096950564,6.65027904858742,6.65027904858742,6.65286302935335,6.66568371778241,6.66949808985788,6.67203294546107,6.67834211465433,6.68586094706836]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>obs<\/th>\n      <th>foodexp<\/th>\n      <th>totalexp<\/th>\n      <th>ln_totalexp<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"tip","columnDefs":[{"targets":4,"render":"function(data, type, row, meta) { return DTWidget.formatRound(data, 4, 3, \",\", \".\"); }"},{"className":"dt-center","targets":"_all"},{"visible":false,"targets":0},{"orderable":false,"targets":0}],"pageLength":5,"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":["options.columnDefs.0.render"],"jsHooks":[]}</script>

---

### 家庭食物支出案例

原始数据作散点图：

&lt;img src="part01-slide-04-reg-extention_files/figure-html/unnamed-chunk-29-1.png" style="display: block; margin: auto;" /&gt;

---

### 家庭食物支出案例

对家庭总支出取对数`ln(totalexp)`，再做散点图：

&lt;img src="part01-slide-04-reg-extention_files/figure-html/unnamed-chunk-30-1.png" style="display: block; margin: auto;" /&gt;

---

### 家庭食物支出案例

.pull-left[
构建如下对数到线性模型：
`$$\begin {align} 
Y_{t}=\beta_{1}+\beta_{2} \ln X_{i}+u_{i}
\end {align}$$`

家庭食物支出案例的OLS估计结果如下：

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{foodexp}=&amp;&amp;-1283.91&amp;&amp;+257.27log(totalexp)\\ &amp;\text{(t)}&amp;&amp;(-4.3848)&amp;&amp;(5.6625)\\&amp;\text{(se)}&amp;&amp;(292.8105)&amp;&amp;(45.4341)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.3769;&amp;&amp; \bar{R^2}=0.3652\\&amp; &amp;&amp; F^{\ast}=32.06;&amp;&amp; p=0.0000 \end{alignedat} \end{equation}$$`

]

.pull-right[
对比构建如下经典线性模型及其OLS估计结果：
`$$\begin {align} 
Y_{t}=\beta_{1}+\beta_{2} X_{i}+u_{i}
\end {align}$$`


`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{foodexp}=&amp;&amp;+94.21&amp;&amp;+0.44totalexp\\ &amp;\text{(t)}&amp;&amp;(1.8524)&amp;&amp;(5.5770)\\&amp;\text{(se)}&amp;&amp;(50.8563)&amp;&amp;(0.0783)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.3698;&amp;&amp; \bar{R^2}=0.3579\\&amp; &amp;&amp; F^{\ast}=31.10;&amp;&amp; p=0.0000 \end{alignedat} \end{equation}$$`
]

---
layout: false
class: inverse, center, middle, duke-softblue
name: reciprocal-mod

# 4.1.6 倒数模型

---
layout: true
  
&lt;div class="my-header"&gt;&lt;/div&gt;

&lt;div class="my-footer"&gt;&lt;span&gt;huhuaping@   第04章：扩展方法   
&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;
4.1 模型函数形式
&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;
4.1.7 倒数模型 &lt;/span&gt;&lt;/div&gt; 

---

## 倒数模型

.pull-left[
**形式**：

`$$\begin {align} 
Y_{i}=\beta_{1}+\beta_{2}\left(\frac{1}{X_{i}}\right)+u_{i}
 \end {align}$$`
 
**特征**：总有一条内在的渐近线！

- a.平均固定成本(AFC)曲线

- b.菲利普斯曲线（Phillips curve）

- c.恩格尔曲线（the Engel expenditure curve）

]

.pull-right[

&lt;img src="pic/chpt4-reciprocal-model.png" width="567" style="display: block; margin: auto;" /&gt;



`$$\begin {align} 
X \rightarrow \infty ;
\quad \beta_{2}\left(\frac{1}{X}\right) \rightarrow 0 ;
\quad Y \rightarrow \beta_{1}
\end {align}$$`

]
 
---

### 儿童死亡率案例



儿童死亡率（`CM`，千分数）与人均GNP（`PGNP`，1980年的人均GNP）的关系：

<div id="htmlwidget-b9e42d8c1f623dab16b2" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-b9e42d8c1f623dab16b2">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64"],[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64],[128,204,202,197,96,209,170,240,241,55,75,129,24,165,94,96,148,98,161,118,269,189,126,12,167,135,107,72,128,27,152,224,142,104,287,41,312,77,142,262,215,246,191,182,37,103,67,143,83,223,240,312,12,52,79,61,168,28,121,115,186,47,178,142],[1870,130,310,570,2050,200,670,300,120,290,1180,900,1730,1150,1160,1270,580,660,420,1080,290,270,560,4240,240,430,3020,1420,420,19830,420,530,8640,350,230,1620,190,2090,900,230,140,330,1010,300,1730,780,1300,930,690,200,450,280,4430,270,1340,670,410,4370,1310,1470,300,3630,220,560],[0.00053475935828877,0.00769230769230769,0.0032258064516129,0.00175438596491228,0.00048780487804878,0.005,0.00149253731343284,0.00333333333333333,0.00833333333333333,0.00344827586206897,0.000847457627118644,0.00111111111111111,0.000578034682080925,0.000869565217391304,0.000862068965517241,0.00078740157480315,0.00172413793103448,0.00151515151515152,0.00238095238095238,0.000925925925925926,0.00344827586206897,0.0037037037037037,0.00178571428571429,0.000235849056603774,0.00416666666666667,0.00232558139534884,0.00033112582781457,0.000704225352112676,0.00238095238095238,5.04286434694907e-05,0.00238095238095238,0.00188679245283019,0.000115740740740741,0.00285714285714286,0.00434782608695652,0.000617283950617284,0.00526315789473684,0.000478468899521531,0.00111111111111111,0.00434782608695652,0.00714285714285714,0.00303030303030303,0.00099009900990099,0.00333333333333333,0.000578034682080925,0.00128205128205128,0.000769230769230769,0.0010752688172043,0.00144927536231884,0.005,0.00222222222222222,0.00357142857142857,0.000225733634311512,0.0037037037037037,0.000746268656716418,0.00149253731343284,0.0024390243902439,0.00022883295194508,0.000763358778625954,0.000680272108843537,0.00333333333333333,0.000275482093663912,0.00454545454545455,0.00178571428571429]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>obs<\/th>\n      <th>CM<\/th>\n      <th>PGNP<\/th>\n      <th>rep_PGNP<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"tip","columnDefs":[{"targets":4,"render":"function(data, type, row, meta) { return DTWidget.formatRound(data, 4, 3, \",\", \".\"); }"},{"className":"dt-center","targets":"_all"},{"visible":false,"targets":0},{"orderable":false,"targets":0}],"pageLength":5,"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":["options.columnDefs.0.render"],"jsHooks":[]}</script>

---

### 儿童死亡率案例

原始数据作散点图：

&lt;img src="part01-slide-04-reg-extention_files/figure-html/unnamed-chunk-36-1.png" style="display: block; margin: auto;" /&gt;

---

### 儿童死亡率案例

把PGNP取倒数
`\(1/PGNP\)`再作散点图：

&lt;img src="part01-slide-04-reg-extention_files/figure-html/unnamed-chunk-37-1.png" style="display: block; margin: auto;" /&gt;

---

### 儿童死亡率案例


.pull-left[
构建如下倒数模型：
`$$\begin {align} 
Y_{i}=\beta_{1}+\beta_{2}\left(\frac{1}{X_{i}}\right)+u_{i}
 \end {align}$$`

儿童死亡率案例倒数模型的OLS估计结果如下：

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{CM}=&amp;&amp;+81.79&amp;&amp;+27273.17rep_{PGNP}\\ &amp;\text{(t)}&amp;&amp;(7.5511)&amp;&amp;(7.2535)\\&amp;\text{(se)}&amp;&amp;(10.8321)&amp;&amp;(3759.9992)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.4591;&amp;&amp; \bar{R^2}=0.4503\\&amp; &amp;&amp; F^{\ast}=52.61;&amp;&amp; p=0.0000 \end{alignedat} \end{equation}$$`

]

.pull-right[
对比构建如下经典线性模型：
`$$\begin {align} 
Y_{t}=\beta_{1}+\beta_{2} X_{i}+u_{i}
\end {align}$$`

其OLS估计结果如下：

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{CM}=&amp;&amp;+157.42&amp;&amp;-0.01PGNP\\ &amp;\text{(t)}&amp;&amp;(15.9893)&amp;&amp;(-3.5157)\\&amp;\text{(se)}&amp;&amp;(9.8456)&amp;&amp;(0.0032)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.1662;&amp;&amp; \bar{R^2}=0.1528\\&amp; &amp;&amp; F^{\ast}=12.36;&amp;&amp; p=0.0008 \end{alignedat} \end{equation}$$`
]


---

### 菲利普斯曲线



通货膨胀率（`infrate`，%）与失业率（`unrate`，%）的关系：

<div id="htmlwidget-265564ef2f745e496b9e" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-265564ef2f745e496b9e">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47"],["1960 ","1961 ","1962 ","1963 ","1964 ","1965 ","1966 ","1967 ","1968 ","1969 ","1970 ","1971 ","1972 ","1973 ","1974 ","1975 ","1976 ","1977 ","1978 ","1979 ","1980 ","1981 ","1982 ","1983 ","1984 ","1985 ","1986 ","1987 ","1988 ","1989 ","1990 ","1991 ","1992 ","1993 ","1994 ","1995 ","1996 ","1997 ","1998 ","1999 ","2000 ","2001 ","2002 ","2003 ","2004","2005","2006"],[1.71821305841924,1.0135135135135,1.00334448160535,1.32450331125829,1.30718954248366,1.61290322580645,2.85714285714285,3.08641975308642,4.19161676646706,5.45977011494255,5.72207084468663,4.38144329896908,3.20987654320987,6.22009569377991,11.036036036036,9.12778904665314,5.76208178438662,6.50263620386644,7.59075907590759,11.3496932515337,13.4986225895317,10.3155339805825,6.16061606160615,3.21243523316062,4.31726907630523,3.56111645813281,1.85873605947955,3.64963503649635,4.13732394366197,4.81825866441251,5.4032258064516,4.20811017597552,3.01027900146845,2.99358517462579,2.56055363321799,2.834008097166,2.95275590551181,2.2944550669216,1.55763239875389,2.20858895705521,3.36134453781512,2.84552845528456,1.5810276679842,2.27904391328516,2.66304347826087,3.38803599788248,3.22580645161289],[5.5,6.7,5.5,5.7,5.2,4.5,3.8,3.8,3.6,3.5,4.9,5.9,5.6,4.9,5.6,8.5,7.7,7.1,6.1,5.8,7.1,7.6,9.7,9.6,7.5,7.2,7,6.2,5.5,5.3,5.6,6.8,7.5,6.9,6.1,5.6,5.4,4.9,4.5,4.2,4,4.7,5.8,6,5.5,5.1,4.6],[0.181818181818182,0.149253731343284,0.181818181818182,0.175438596491228,0.192307692307692,0.222222222222222,0.263157894736842,0.263157894736842,0.277777777777778,0.285714285714286,0.204081632653061,0.169491525423729,0.178571428571429,0.204081632653061,0.178571428571429,0.117647058823529,0.12987012987013,0.140845070422535,0.163934426229508,0.172413793103448,0.140845070422535,0.131578947368421,0.103092783505155,0.104166666666667,0.133333333333333,0.138888888888889,0.142857142857143,0.161290322580645,0.181818181818182,0.188679245283019,0.178571428571429,0.147058823529412,0.133333333333333,0.144927536231884,0.163934426229508,0.178571428571429,0.185185185185185,0.204081632653061,0.222222222222222,0.238095238095238,0.25,0.212765957446809,0.172413793103448,0.166666666666667,0.181818181818182,0.196078431372549,0.217391304347826]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>year<\/th>\n      <th>infrate<\/th>\n      <th>unrate<\/th>\n      <th>rep_unrate<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"tip","columnDefs":[{"targets":2,"render":"function(data, type, row, meta) { return DTWidget.formatRound(data, 4, 3, \",\", \".\"); }"},{"targets":4,"render":"function(data, type, row, meta) { return DTWidget.formatRound(data, 4, 3, \",\", \".\"); }"},{"className":"dt-center","targets":"_all"},{"visible":false,"targets":0},{"orderable":false,"targets":0}],"pageLength":5,"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":["options.columnDefs.0.render","options.columnDefs.1.render"],"jsHooks":[]}</script>

---

### 菲利普斯曲线

原始数据作散点图：

&lt;img src="part01-slide-04-reg-extention_files/figure-html/unnamed-chunk-42-1.png" style="display: block; margin: auto;" /&gt;

---

### 菲利普斯曲线

把失业率`unrate`取倒数
`\(1/unrate\)`再作散点图：

&lt;img src="part01-slide-04-reg-extention_files/figure-html/unnamed-chunk-43-1.png" style="display: block; margin: auto;" /&gt;

---

### 菲利普斯曲线

.pull-left[
构建如下倒数模型：
`$$\begin {align} 
Y_{i}=\beta_{1}+\beta_{2}\left(\frac{1}{X_{i}}\right)+u_{i}
 \end {align}$$`

菲利普斯曲线案例倒数模型的OLS估计结果如下：

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{infrate}=&amp;&amp;+7.37&amp;&amp;-17.37rep_{unrate}\\ &amp;\text{(t)}&amp;&amp;(4.1723)&amp;&amp;(-1.8212)\\&amp;\text{(se)}&amp;&amp;(1.7670)&amp;&amp;(9.5364)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.0686;&amp;&amp; \bar{R^2}=0.0479\\&amp; &amp;&amp; F^{\ast}=3.32;&amp;&amp; p=0.0752 \end{alignedat} \end{equation}$$`

]

.pull-right[
对比构建如下经典线性模型及其OLS估计结果：
`$$\begin {align} 
Y_{t}=\beta_{1}+\beta_{2} X_{i}+u_{i}
\end {align}$$`


`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{infrate}=&amp;&amp;+0.81&amp;&amp;+0.59unrate\\ &amp;\text{(t)}&amp;&amp;(0.4642)&amp;&amp;(2.0377)\\&amp;\text{(se)}&amp;&amp;(1.7347)&amp;&amp;(0.2874)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.0845;&amp;&amp; \bar{R^2}=0.0641\\&amp; &amp;&amp; F^{\ast}=4.15;&amp;&amp; p=0.0475 \end{alignedat} \end{equation}$$`
]

---
layout: false
class: inverse, center, middle, duke-softblue
name: options

# 4.1.7 函数形式的选择 

---
layout: true
  
&lt;div class="my-header"&gt;&lt;/div&gt;

&lt;div class="my-footer"&gt;&lt;span&gt;huhuaping@   第04章：扩展方法   
&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;
4.1 模型函数形式
&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;
4.1.8 函数形式的选择 &lt;/span&gt;&lt;/div&gt; 

---

## 技巧和经验

选择适当模型时，需要一些技巧和经验：

1. 模型背后的理论(如菲利普斯曲线〉可能给出了一个特定的函数形式。

2. 最好能求出回归子相对回归元的变化率〈即斜率〉和回归子对回归元的弹性(见下页ppt)。

3. 所选模型的系数应该满足一定的先验预期。

4. 有时多个模型都能相当不错地拟合一个给定的数据集。

5. 通常不应该过分强调这个指标

6. 在有些情形中，确定一个特定的函数形式不是那么容易，此时我们或许可以使用所谓的博克斯-考克斯变换(Box-Cox transformations)

---

## 计算表一览

&lt;table class="table" style="margin-left: auto; margin-right: auto;"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:center;"&gt; 模型 &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; 方程 &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; 斜率 &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; 点弹性 &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; 平均弹性 &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:center;"&gt; models &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; eq &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; \(\frac{dY}{dX}\) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; \(\frac{dY}{dX}\cdot\frac{X_i}{Y_i}\) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; \(\frac{dY}{dX}\cdot\frac{\bar{X}}{\bar{Y}}\) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:center;"&gt; \(M_1\)线性模型 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; \(Y_i=\beta_1+\beta_2X_i+u_i\) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; \(\beta_2\) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; \(\beta_2{X_i}/{Y_i}\) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; \(\beta_2{\bar{X}}/{\bar{Y}}\) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:center;"&gt; \(M_2\)过原点模型 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; \(Y_i=\beta_2X_i+u_i\) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; \(\beta_2\) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; \(\beta_2{X_i}/{Y_i}\) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; \(\beta_2{\bar{X}}/{\bar{Y}}\) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:center;"&gt; \(M_3\)双对数模型 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; \(ln(Y_i)=\beta_1+\beta_2ln(X_i)+u_i\) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; \(\beta_2Y_i/X_i\) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; \(\beta_2\) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; \(\beta_2\) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:center;"&gt; \(M_4\)线性到对数模型 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; \(ln(Y_i)=\beta_1+\beta_2X_i+u_i\) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; \(\beta_2Y_i\) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; \(\beta_2{X_i}\) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; \(\beta_2{\bar{X}}\) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:center;"&gt; \(M_5\)对数到线性模型 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; \(Y_i=\beta_1+\beta_2ln(X_i)+u_i\) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; \(\beta_2/X_i\) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; \(\beta_2/{Y_i}\) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; \(\beta_2/{\bar{Y}}\) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:center;"&gt; \(M_6\)倒数模型 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; \(Y_i=\beta_1+\beta_2/X_i+u_i\) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; \(-\beta_2/X_i^2\) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; \(-\beta_2/({X_i}{Y_i})\) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; \(-\beta_2/({\bar{X}}{\bar{Y}})\) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:center;"&gt; \(M_7\)对数倒数模型 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; \(ln(Y_i)=\beta_1-\beta_2/X_i+u_i\) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; \(\beta_2Y_i/X_i^2\) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; \(\beta_2/{X_i}\) &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; \(\beta_2/{\bar{X}}\) &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---
class: center, middle,duke-softblue
name: mod-dummy

# 4.2 虚拟变量回归模型



.pull-left[

[4.2.0 相关知识回顾](#review)

[4.2.1 虚拟变量的设置规则](#rule)

[4.2.2 方差分析(ANOVA) 模型](#dummy-mod)

[4.2.3 只含有一个定性变量的ANOVA模型](#one)

[4.2.4 同时含有一个定性和一个定量变量的ANOVA 模型](#one-one)



]

.pull-right[

[4.2.5 同时含有多个定性和定量变量的ANOVA 模型](#multiple)

[4.2.6 印度工人工资案例](#example)

[4.2.7 时间序列季节虚拟变量模型](#series)

[4.2.8 分段线性回归模型](#piecewise)

]

---
layout: false
class: inverse, center, middle, duke-softblue
name: review

# 4.2.0 相关知识回顾

---
layout: true
  
&lt;div class="my-header"&gt;&lt;/div&gt;

&lt;div class="my-footer"&gt;&lt;span&gt;huhuaping@   第04章：扩展方法   
&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;
4.2 虚拟变量回归模型
&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;
4.2.0 相关知识回顾 &lt;/span&gt;&lt;/div&gt; 


---

## 变量类型


**定量变量**（Quantitative variable）一般也称为连续变量，是由测量或计数、统计所得到的量，可以通过数值表达，并具有直接的数值含义。

**定性变量**（qualitative variables）：又被称为指标变量（indicator variables）、分类变量（categorical variables），主要用于区分事物性质差异，往往用语义类别表达，没有直接的数值含义。

- 性别（男；女）

- 肤色（黄色；白色；黑色；其他）

- 种族、宗教、国籍、地区、政治动乱和党派等。

&gt; **提问**：定性变量怎样表达出来？如何数量化？

---

## 变量尺度

**变量尺度**（Variable scale）：刻画的是变量的数值含义或数值关系。它将意味着在数值含义和关系上，变量是有层次级别的差异性。根据变量层级不同，具体可以分为由低到高的4个层级：

- **名义尺度（nominal scale）变量**：这类变量只用于属性分类，不具备任何数值含义或数值关系，也即不能加、减、乘、除，也不能比较大小。

- **序数尺度（order scale）变量**：这类变量具备很少的数值含义或数值关系，它可以比较大小，但不能进行加、减、乘、除。

- **区间尺度（interval scale）变量**：这类变量具备一定的数值含义或数值关系，它可以比较大小，也可以进行加、减，但不能进行乘、除。

- **比率尺度（ratio scale）变量**：这类变量具备最多的数值含义或数值关系，它可以比较大小，也可以进行加、减、乘、除。

---

### 区域经理年薪案例（数据）



<div id="htmlwidget-47aa6d202b6173818211" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-47aa6d202b6173818211">{"x":{"filter":"none","caption":"<caption>变量类型和变量尺度<\/caption>","data":[["Zhang","Tom","Lee","Jeff","Kevin"],[25,35,27,42,38],[140,195,184,256,207],[2,3,1,5,4],["yellow","white","yellow","white","black"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>staff<\/th>\n      <th>salary<\/th>\n      <th>sale<\/th>\n      <th>score<\/th>\n      <th>race<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","columnDefs":[{"className":"dt-center","targets":"_all"},{"visible":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>

**区域经理年薪案例**中，公司有五名区域经理，分别负责不同的国际市场。

定量变量
`\(salary\)`表示区域经理的年薪（万元）；变量
`\(sale\)`表示负责市场的销售额；变量
`\(score\)`表示客户对区域经理的评价（1表示很不满意，2表示不满意，3表示一般，4表示很满意，5表示非常满意）；变量
`\(race\)`表示区域市场主要消费群体的肤色（yellow表示黄色消费群体、white表示白色消费群体，black表示黑色消费群体）。

---

### 区域经理年薪案例（变量）

<div id="htmlwidget-f83729c68f1010078a44" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-f83729c68f1010078a44">{"x":{"filter":"none","caption":"<caption>变量类型和变量尺度<\/caption>","data":[["Zhang","Tom","Lee","Jeff","Kevin"],[25,35,27,42,38],[140,195,184,256,207],[2,3,1,5,4],["yellow","white","yellow","white","black"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>staff<\/th>\n      <th>salary<\/th>\n      <th>sale<\/th>\n      <th>score<\/th>\n      <th>race<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","columnDefs":[{"className":"dt-center","targets":"_all"},{"visible":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>

根据以上定义，**区域经理年薪案例**中，可以认为年薪
`\(salary\)`、销售额
`\(sale\)`，以及客户评价
`\(score\)`为**定量变量**，消费群体主要肤色
`\(race\)`为**定性变量**。

从变量的度量尺度来看：

- 年薪
`\(salary\)`和销售额
`\(sale\)`两个变量为**比率尺度**变量
- 客户评价
`\(score\)`变量为**序数尺度**变量
- 消费群体主要肤色
`\(race\)`为**名义尺度**变量


---
layout: false
class: inverse, center, middle, duke-softblue
name: rule

# 4.2.1 虚拟变量的设置规则

---
layout: true
  
&lt;div class="my-header"&gt;&lt;/div&gt;

&lt;div class="my-footer"&gt;&lt;span&gt;huhuaping@   第04章：扩展方法   
&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;
4.2 虚拟变量回归模型
&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;
4.2.1 虚拟变量的设置规则 &lt;/span&gt;&lt;/div&gt; 


---

## 定性变量对回归模型的影响

计量经济学建模分析中，我们常常需要把一些**定性变量**（Qualitative variables）（如性别、地区、党派等）作为自变量放入回归模型中。从**变量层次**（Variable Scale）来看，这些变量没有具体的取值，只有特定属性类别。例如，性别变量的具体取值往往为男或女。显然，诸如此类的变量如果直接放到线性回归模型中，将会产生一系列的参数估计、模型解释等问题。

`$$\begin{align}
salary_i = \beta_1 +\beta_2sale_i +\beta_3score_i + \beta_4 race_i + u_i
\end{align}$$`

- 一个**定性变量**的不同数据取值，称为该定性变量的**属性**。

- 定性变量的任一属性，都可以设置为一个**虚拟变量**。

- 我们可以用一套**虚拟变量体系**来完全表达一个定性变量。

- 按照一定的规则构建虚拟变量回归模型，从而避免参数估计、模型解释等问题的出现。

---

## 虚拟变量的定义

**虚拟变量**（dummy variable）：将取值为0和1的**人造变量**称为虚拟变量。

- 对定性变量的量化可采用虚拟变量的方式实现。

- 一般而言，1表示出现（或具备）某种属性，0表示没有（或不具备）某种属性。

对于某定性变量的任一特定属性，可以构造出一个虚拟变量（记为D），使得该虚拟变量能够表达这一属性。同时，给该虚拟变量D赋值为1，记为具备这一属性；给该虚拟变量赋值为0，记为不具备该属性。

正式地，假设定性变量
`\(X\)`具有
`\(m\)`个属性
`\(a_1,a_2,\cdots,a_m\)`，对于任意属性
`\(k,(k\in{1,2,\cdots,m})\)`，可以定义如下的虚拟变量
`\(D_k\)`：

`$$\begin{align}
D_k=
  \begin{cases}
  1, &amp; \text{if } a_k \\
  0, &amp; \text{if not }  a_k
  \end{cases}
\end{align}$$`

---

### 区域经理年薪案例（虚拟变量）

**区域经理年薪**案例中，**定性变量**`race`（人种，其取值为黄种人/白种人/黑种人），可以构造出3个虚拟变量

`$$\begin{align}
race\{a_1=\text{yellow},a_2=\text{white},a_3=\text{black}\} \\
dummy \Longrightarrow  
  \begin{cases}
    D_1  =
    \begin{cases}
    1, &amp; \text{yellow}\\
    0, &amp; \text{not yellow}
    \end{cases} \\
    D_2 = 
    \begin{cases}
    1, &amp; \text{white}\\
    0, &amp; \text{not white}
    \end{cases} \\
    D_3  =
    \begin{cases}
    1, &amp; \text{black}\\
    0, &amp; \text{not black}
    \end{cases}
  \end{cases}
\end{align}$$`

---

## 虚拟变量体系

**虚拟变量体系**：完整表达某个定性变量全部信息的一组虚拟变量。

正式地，假设定性变量
`\(X\)`具有
`\(m\)`个属性
`\(a_1,a_2,\cdots,a_m\)`，可以用如下一组虚拟变量
`\(D_1,\cdots,D_k,\cdots,D_m\)`完全表达该定性变量：

`$$\begin{align}
X\{a_1,a_2,\cdots,a_m\} \Rightarrow  
  \begin{cases}
    D_1  =
    \begin{cases}
    1, &amp; \text{if } a_1\\
    0, &amp; \text{if not }  a_1
    \end{cases} \\
     \vdots \\
    D_k = 
    \begin{cases}
    1, &amp; \text{if } a_k\\
    0, &amp; \text{if not }  a_k
    \end{cases} \\
    \vdots\\
    D_m  =
    \begin{cases}
    1, &amp; \text{if } a_m\\
    0, &amp; \text{if not }  a_m
    \end{cases}
  \end{cases}
\end{align}$$`


---

### 区域经理年薪案例（虚拟变量体系）

实际数据操作中，一般需要对定性变量
`\(race\)`进行重新编码（recode），生成三个对应的虚拟变量。

<div id="htmlwidget-eff628ae92dda25d10b7" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-eff628ae92dda25d10b7">{"x":{"filter":"none","caption":"<caption>把定性变量转变为虚拟变量体系<\/caption>","data":[["Zhang","Tom","Lee","Jeff","Kevin"],[25,35,27,42,38],[140,195,184,256,207],[2,3,1,5,4],["yellow","white","yellow","white","black"],[0,0,0,0,1],[0,1,0,1,0],[1,0,1,0,0]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>staff<\/th>\n      <th>salary<\/th>\n      <th>sale<\/th>\n      <th>score<\/th>\n      <th>race<\/th>\n      <th>race_black<\/th>\n      <th>race_white<\/th>\n      <th>race_yellow<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","columnDefs":[{"className":"dt-center","targets":"_all"},{"visible":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>


---
layout: false
class: inverse, center, middle, duke-softblue
name: dummy-mod

# 4.2.2 方差分析模型模型（ANOVA model）

---
layout: true
  
&lt;div class="my-header"&gt;&lt;/div&gt;

&lt;div class="my-footer"&gt;&lt;span&gt;huhuaping@   第04章：扩展方法   
&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;
4.2 虚拟变量回归模型
&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;
4.2.2 方差分析模型模型（ANOVA model） &lt;/span&gt;&lt;/div&gt; 

---

## 定义

**区域经理薪水案例**中，如果不区分变量类型和特征，做如下的回归模型，则回归分析结果将会带来严重的问题。

`$$\begin{align}
salary_i = \beta_1 +\beta_2sale_i +\beta_3score_i + \beta_4 race_i + u_i
\end{align}$$`

事实上，应该将上述模型转换为**虚拟变量回归模型**（Dummy model）。

`$$\begin{align}
salary_i &amp; ={\beta}_1 + &amp;&amp;\beta_2sale_i +\beta_3score_i+{\beta}_4race\_yellow_i+{\beta}_5race\_white_i+u_i \\
salary_i &amp; = &amp;&amp;\beta_2sale_i +\beta_3score_i+{\beta}_4race\_yellow_i+{\beta}_5race\_white_i +{\beta}_6race\_black_i+u_i \\
\end{align}$$`

一个线性回归模型，只要回归元中包含了虚拟变量，这种模型就被称为**虚拟变量回归模型**，也可以称为**方差分析模型** （Analysis of variance, ANOVA）。

**方差分析模型**（Analysis of variance, ANOVA）常用来分析定量化的因变量
`\(Y\)`与定性回归元或虚拟变量之间的统计显著性关系。一般是通过比较不同类别或不同组的均值差，例如采用t检验可以判断两组均值是否有显著的差异。


&gt; **提问**：你还能不能设置成其他类型的模型形式？怎样设置才是正确的**方差分析模型**？

---

## 方差分析模型：本质

`$$\begin{align}
salary_i &amp; =\beta_1 + \beta_2sale_i +\beta_3score_i+\beta_4race\_yellow_i+\beta_5race\_white_i+u_i
\end{align}$$`

很显然，在上述总体回归模型下，可以得到所有3类“分组”情形下的期望年薪水平：

`$$\begin{align}
E(Y| &amp; race\_yellow=1,race\_white=0,sale,score) \\
&amp;=\beta_1+\beta_2sale+\beta_3score + \beta_4 &amp;&amp;\text{(market yellow)} \\
E(Y| &amp; race\_yellow=0,race\_white=1,sale,score) \\
&amp;=\beta_1+\beta_2sale+\beta_3score  + \beta_5 &amp;&amp;\text{(market white)} \\
E(Y| &amp; race\_yellow=0,race\_white=0,sale,score) \\
&amp;=\beta_1 +\beta_2sale+\beta_3score &amp;&amp;\text{(market black)}
\end{align}$$`


---

## 方差分析模型：内涵

`$$\begin{align}
salary_i &amp; =\beta_1 + \beta_2sale_i +\beta_3score_i+\beta_4race\_yellow_i+\beta_5race\_white_i+u_i
\end{align}$$`

上述模型被称其为**有截距**的含有虚拟变量的、加法形式的回归模型。显然，虚拟变量
`\(race\_{black}\)`没有进入模型中；模型设置有截距项
`\(\beta_1\)`。在这种设定下，我们称：

- **黑色(black)**为模型的**基础组**

- **黄色(yellow)**和**白色(white)**分别为模型的**比较组**。

- 有序变量
`\(score\)`为**协变量(covariates)**或**控制变量(control variable)**

- 
`\(\beta_1\)`为**截距系数**，代表基础组的期望水平

- 
`\(\beta_2;\beta_3\)`为**平行斜率系数**，代表协变量的影响效应

- 
`\(\beta_4,\beta_5\)`为**极差系数**，代表的是比较组与基础组期望水平的差距


---

## 方差分析模型的类型：数量关系

根据回归元包含**定量变量**和**虚拟变量**的数量关系，可以将虚拟变量回归模型分为：

- 只含有虚拟变量的回归模型：全部解释变量都是由虚拟变量构成

- 同时含有虚拟变量和定量变量的回归模型：解释变量同时含有虚拟变量和定量变量


---

## 方差分析模型的类型：引入方式


根据模型中虚拟变量**引入方式**的不同，可以划分为：

- 加法模型：虚拟变量以独立项的形式出现在方程中

- 乘法模型：虚拟变量以交叉项的形式出现在方程中

- 混合模型：虚拟变量以独立项和/或交叉项的形式出现在方程中^[有时候模型设置中，某个虚拟变量体系（用来表达某个定性变量）的独立项可以完全不出现在方程中（也即没有它们的加法形式），而却可以出现它们与其他变量的交叉项（也即可以出现它们与其他变量的乘法形式）。]
    
    -  完全混合模型
    - 部分混合模型

---

## 方差分析模型的类型：基础组

根据虚拟变量模型是否参照**基础组**，可以划分为：

- 有截距模型：此时模型解释中将有明确的**基础组**，其他组可以直接与之参照对比。

- 无截距模型：此时模型解释中将没有明确的**基础组**，各组间将不直接参照对比。

---

## 方差分析模型的类型：函数形式

根据模型中的因变量
`\(Y\)`是否取对数，可以划分为（半对数或对数模型将蕴含着弹性和斜率的经济学含义，在解释虚拟变量回归模型中往往很有现实意义）：

- 经典线性模型：因变量为
`\(Y\)`

- 半对数模型：因变量为
`\(ln(Y)\)`

---

## 方差分析模型的类型：应用情景

根据虚拟变量模型**应用情景**的不同，可以划分为：

- 截面数据虚拟变量回归模型：此时虚拟变量用于表达回归元为定性变量的情形

- 时间序列季节虚拟变量回归模型：此时虚拟变量用于表达季节周期

- 分段线性虚拟变量回归模型：此时虚拟变量用于表达**阀值**分段


---

## 方差分析模型的类型：综合

对于具体的实证分析案例，我们往往需要根据变量的属性和特征，构建不同类型的虚拟变量回归模型，比较不同模型的回归分析结果，甄选并得到其中相对理想的模型。

例如，仅是考虑**基础组**的有截距模型，可能用到的各类备选组合模型至少包括：

- 只含有虚拟变量的、加法形式的**经典回归模型**
- 只含有虚拟变量的、加法形式的**半对数回归模型**
- 只含有虚拟变量的、乘法形式的**经典回归模型**
- 只含有虚拟变量的、乘法形式的**半对数回归模型**
- 
`\(\cdots\)`
- 同时含有虚拟变量和定量变量的、加法形式的**经典回归模型**
- 同时含有虚拟变量和定量变量的、加法形式的**半对数回归模型**
- 同时含有虚拟变量和定量变量的、乘法形式的**经典回归模型**
- 同时含有虚拟变量和定量变量的、乘法形式的**半对数回归模型**
- 
`\(\cdots\)`

---
layout: false
class: inverse, center, middle, duke-softblue
name: one

# 4.2.3 只含有一个定性变量的ANOVA模型

---
layout: true
  
&lt;div class="my-header"&gt;&lt;/div&gt;

&lt;div class="my-footer"&gt;&lt;span&gt;huhuaping@   第04章：扩展方法   
&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;
4.2 虚拟变量回归模型
&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;
4.2.3 只含有一个定性变量的ANOVA模型 &lt;/span&gt;&lt;/div&gt; 

---
class: center, middle,duke-orange

## 公立学校教师薪水案例

---

### 变量

一项研究关注于对美国51个州公立学校教师薪水的分析：

- 变量
`\(Salary\)`表示公立学校教师的平均薪水；变量
`\(Spend\)`表示公立学校教师的平均支出；

- 
`\(state\)`表示公立学校所在州名称；
`\(Region\)`表示州所属的区位（`West`表示**西部**州；`M.E.N`表示**中东北部**州；`South`表示**南部**州）。

&lt;img src="pic/chpt-10-region-show.png" width="454" style="display: block; margin: auto;" /&gt;

---

### 数据




<div id="htmlwidget-02545bd843d69065f91f" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-02545bd843d69065f91f">{"x":{"filter":"none","caption":"<caption>美国三个区域公立学校教师的薪水n=(51)<\/caption>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51"],["Connecticut","Illinois","Indiana","Iowa","Kansas","Maine","Massachusetts","Michigan","Minnesota","Missouri","Nebraska","New Hampshire","New Jersey","New York","North Dakota","Ohio","Pennsylvania","Rhode Island","South Dakota","Vermont","Wisconsin","Alabama","Arkansas","Delaware","District of Columbia","Florida","Georgia","Kentucky","Louisiana","Maryland","Mississippi","North Carolina","Oklahoma","South Carolina","Tennessee","Texas","Virginia","West Virginia","Alaska","Arizona","California","Colorado","Hawaii","Idaho","Montana","Nevada","New Mexico","Oregon","Utah","Washington","Wyoming"],["M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","South","South","South","South","South","South","South","South","South","South","South","South","South","South","South","South","South","West","West","West","West","West","West","West","West","West","West","West","West","West"],[60822,58246,47831,43130,43334,41596,58624,54895,49634,41839,42044,46527,59920,58537,38822,51937,54970,55956,35378,48370,47901,43389,44245,54680,59000,45308,49905,43646,42816,56927,40182,46410,42379,44133,43816,44897,44727,40531,54658,45941,63640,45833,51922,42798,41225,45342,42780,50911,40566,47882,50692],[12436,9275,8935,7807,8373,11285,12596,9880,9675,7840,7900,10206,13781,13551,7807,10034,10711,11089,7911,12475,9965,7706,8402,12036,15508,7762,8534,8300,8519,9771,7215,7675,6944,8377,6979,7547,9275,9886,10171,5585,8486,8861,9879,7042,8361,6755,8622,8649,5347,7958,11596]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>state<\/th>\n      <th>Region<\/th>\n      <th>Salary<\/th>\n      <th>Spend<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"tip","columnDefs":[{"className":"dt-center","targets":"_all"},{"visible":false,"targets":0},{"orderable":false,"targets":0}],"pageLength":9,"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[9,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>





---

### 描述统计

<div id="htmlwidget-3de909955c7361b9cc90" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-3de909955c7361b9cc90">{"x":{"filter":"none","caption":"<caption>三个区域公立学校教师的平均薪水n=(51)<\/caption>","data":[["M.E.N","South","West"],[21,17,13],[49538.7142857143,46293.5882352941,48014.6153846154],[60822,59000,63640],[35378,40182,40566],[7645.47168030107,5543.64696137416,6400.04621778184]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>Region<\/th>\n      <th>N.state<\/th>\n      <th>Mean.Salary<\/th>\n      <th>Max.Salary<\/th>\n      <th>Min.Salary<\/th>\n      <th>SD.Salary<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","columnDefs":[{"targets":2,"render":"function(data, type, row, meta) { return DTWidget.formatRound(data, 2, 3, \",\", \".\"); }"},{"targets":3,"render":"function(data, type, row, meta) { return DTWidget.formatRound(data, 2, 3, \",\", \".\"); }"},{"targets":4,"render":"function(data, type, row, meta) { return DTWidget.formatRound(data, 2, 3, \",\", \".\"); }"},{"targets":5,"render":"function(data, type, row, meta) { return DTWidget.formatRound(data, 2, 3, \",\", \".\"); }"},{"className":"dt-center","targets":"_all"},{"visible":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":["options.columnDefs.0.render","options.columnDefs.1.render","options.columnDefs.2.render","options.columnDefs.3.render"],"jsHooks":[]}</script>

根据以上简单的汇总计算：

- 教师的平均薪水：**中东北部**为49 538.71 美元；**南部**为46 293.59 美元；
西部为48 104.62美元。

- 那么，三个地区的平均薪水在**统计上**也彼此不同吗?


---

### 虚拟变量体系

根据前述定义，我们可以将**定性变量**
`\(Region\)`设置为如下的**虚拟变量体系**：

.pull-left[

`$$\begin{align}
Region\{West; \quad M.E.N; \quad South \} \\
\Rightarrow  
  \begin{cases}
    D_1  =
    \begin{cases}
    1, &amp; \text{if } West\\
    0, &amp; \text{if not }  West
    \end{cases} \\
    D_2 = 
    \begin{cases}
    1, &amp; \text{if } M.E.N\\
    0, &amp; \text{if not }  M.E.N
    \end{cases} \\
    D_3  =
    \begin{cases}
    1, &amp; \text{if } South\\
    0, &amp; \text{if not }  South
    \end{cases}
  \end{cases}
\end{align}$$`

]

.pull-right[

&lt;img src="pic/chpt-10-region-show.png" width="656" style="display: block; margin: auto;" /&gt;

]

---

### 虚拟变量变换

实际建模之前，我们需要把定性变量
`\(Region\)`进行**数据变换**，得到虚拟变量的数据：

<div id="htmlwidget-7a2a32dd31625ade35bd" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-7a2a32dd31625ade35bd">{"x":{"filter":"none","caption":"<caption>把定性变量Region处理成虚拟变量n=(51)<\/caption>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51"],["Connecticut","Illinois","Indiana","Iowa","Kansas","Maine","Massachusetts","Michigan","Minnesota","Missouri","Nebraska","New Hampshire","New Jersey","New York","North Dakota","Ohio","Pennsylvania","Rhode Island","South Dakota","Vermont","Wisconsin","Alabama","Arkansas","Delaware","District of Columbia","Florida","Georgia","Kentucky","Louisiana","Maryland","Mississippi","North Carolina","Oklahoma","South Carolina","Tennessee","Texas","Virginia","West Virginia","Alaska","Arizona","California","Colorado","Hawaii","Idaho","Montana","Nevada","New Mexico","Oregon","Utah","Washington","Wyoming"],["M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","South","South","South","South","South","South","South","South","South","South","South","South","South","South","South","South","South","West","West","West","West","West","West","West","West","West","West","West","West","West"],[60822,58246,47831,43130,43334,41596,58624,54895,49634,41839,42044,46527,59920,58537,38822,51937,54970,55956,35378,48370,47901,43389,44245,54680,59000,45308,49905,43646,42816,56927,40182,46410,42379,44133,43816,44897,44727,40531,54658,45941,63640,45833,51922,42798,41225,45342,42780,50911,40566,47882,50692],[12436,9275,8935,7807,8373,11285,12596,9880,9675,7840,7900,10206,13781,13551,7807,10034,10711,11089,7911,12475,9965,7706,8402,12036,15508,7762,8534,8300,8519,9771,7215,7675,6944,8377,6979,7547,9275,9886,10171,5585,8486,8861,9879,7042,8361,6755,8622,8649,5347,7958,11596],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>state<\/th>\n      <th>Region<\/th>\n      <th>Salary<\/th>\n      <th>Spend<\/th>\n      <th>D1<\/th>\n      <th>D2<\/th>\n      <th>D3<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"tip","columnDefs":[{"className":"dt-center","targets":"_all"},{"visible":false,"targets":0},{"orderable":false,"targets":0}],"pageLength":5,"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>

---

### 有截距虚拟变量模型：PRM1

我们可以构建薪水（
`\(Salary\)`）对区域虚拟变量（
`\(D2;D3\)`）的**有截距**总体回归模型PRM：

`$$\begin {align} 
Salary_{i}=\beta_{1}+\beta_{2} D2_{ i}+\beta_{3} D3_{ i}+u_{i}
\end {align}$$`

理论上，我们可以得到三个区域教师薪水的期望值：

.pull-left[

`$$\begin{align}
E(Salary|  D2=1,D3=0) 
&amp;=\beta_1+\beta_2 &amp;&amp;\text{(M.E.N)} \\
E(Salary|  D2=0,D3=1) 
&amp;=\beta_1+\beta_3 &amp;&amp;\text{(South)} \\
E(Salary|  D2=0,D3=0) 
&amp;=\beta_1  &amp;&amp;\text{(West)}
\end{align}$$`

]

.pull-right[

&lt;img src="pic/chpt-10-region-show.png" width="656" style="display: block; margin: auto;" /&gt;

]

---

### 有截距虚拟变量模型：OLS估计



`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{Salary}=&amp;&amp;+48014.62&amp;&amp;+1524.10D2&amp;&amp;-1721.03D3\\ &amp;\text{(t)}&amp;&amp;(25.8532)&amp;&amp;(0.6449)&amp;&amp;(-0.6976)\\&amp;\text{(se)}&amp;&amp;(1857.2037)&amp;&amp;(2363.1394)&amp;&amp;(2467.1508)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.0440;&amp;&amp; \bar{R^2}=0.0041\\&amp; &amp;&amp; F^{\ast}=1.10;&amp;&amp; p=0.3399 \end{alignedat} \end{equation}$$`

&lt;img src="pic/chpt-10-salary-main-ill.png" width="651" style="display: block; margin: auto;" /&gt;

&gt; - 基础组是谁？极差系数的含义？
&gt; - 三个区域的平均薪水具有统计上的显著差异吗？

---

### 有截距虚拟变量模型：OLS估计

&lt;img src="pic/chpt-10-salary-coef.png" width="506" style="display: block; margin: auto;" /&gt;


.pull-left[
&gt; 提问：
- 基础组该怎样确定？
- 有什么要求么？

]

.pull-right[

&lt;img src="pic/chpt-10-region-show.png" width="454" style="display: block; margin: auto;" /&gt;

]

---

### 无截距虚拟变量模型：PRM2

我们也可以构建薪水（
`\(Salary\)`）对区域虚拟变量（
`\(D1;D2;D3\)`）的**无截距**总体回归模型PRM：

`$$\begin {align} 
Salary_{i}=\alpha_{1} D1_{ i}+\alpha_{2} D2_{ i}+\alpha_{3} D3_{ i}+u_{i}
\end {align}$$`

理论上，我们可以得到三个区域教师薪水的期望值：

.pull-left[

`$$\begin{align}
E(Salary|  D1=0,D2=1,D3=0) 
&amp;=\alpha_2 &amp;&amp;\text{(M.E.N)} \\
E(Salary|  D1=0,D2=0,D3=1) 
&amp;=\alpha_3 &amp;&amp;\text{(South)} \\
E(Salary|  D1=1,D2=0,D3=0) 
&amp;=\alpha_1  &amp;&amp;\text{(West)}
\end{align}$$`

]

.pull-right[

&lt;img src="pic/chpt-10-region-show.png" width="656" style="display: block; margin: auto;" /&gt;

]

---

### 无截距虚拟变量模型：OLS估计



`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{Salary}=&amp;&amp;+48014.62D1&amp;&amp;+49538.71D2&amp;&amp;+46293.59D3\\ &amp;\text{(t)}&amp;&amp;(25.8532)&amp;&amp;(33.9018)&amp;&amp;(28.5045)\\&amp;\text{(se)}&amp;&amp;(1857.2037)&amp;&amp;(1461.2400)&amp;&amp;(1624.0775)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.9821;&amp;&amp; \bar{R^2}=0.9810\\&amp; &amp;&amp; F^{\ast}=876.74;&amp;&amp; p=0.0000 \end{alignedat} \end{equation}$$`

---

### 无截距虚拟变量模型：OLS估计

&lt;img src="pic/chpt-10-salary-coef2.png" width="574" style="display: block; margin: auto;" /&gt;


.pull-left[
&gt; 提问：
- 此时谁是基础组？
- 回归模型有没有基础组，很重要么？

]

.pull-right[

&lt;img src="pic/chpt-10-region-show.png" width="454" style="display: block; margin: auto;" /&gt;

]

---

## 虚拟变量模型的构建规则

若定性因素具有m个相互排斥属性(或几个水平)：

- **规则1**：当回归模型有截距项时，只能设(m-1)个虚拟变量；

- **规则2**：当回归模型无截距项时，则可引入m个虚拟变量。否则，就会陷入“虚拟变量陷阱”。（为什么？）

- **规则3**：在虚拟变量的设置中：基础类型、肯定类型取值为1；比较类型、否定类型取值为0。

&gt; **思考**：规则1和规则2分别建立虚拟变量回归模型，哪种更好呢？

---

## 虚拟变量模型的构建规则：示例

**建模1**: (正确模型)使用m-1个虚拟变量，并设定为**有截距**：

`$$\begin {align} 
Salary_{i}=\beta_{1}+\beta_{2} D2_{ i}+\beta_{3} D3_{ i}+u_{i}
\end {align}$$`

**建模2**: (正确模型)使用m个虚拟变量，并设定为**无截距**：

`$$\begin {align} 
Salary_{i}=\alpha_{1} D1_{ i}+\alpha_{2} D2_{ i}+\alpha_{3} D3_{ i}+u_{i}
\end {align}$$`

**建模3**: (错误模型)使用m个虚拟变量，并设定为**有截距**：

`$$\begin {align} 
Salary_{i}=\gamma_{0}+\gamma_{1} D1_{ i}+\gamma_{2} D2_{ i}+\gamma_{3} D3_{ i}+u_{i}
\end {align}$$`


&gt; **提问**：
- 模型1和模型2的回归系数涵义是一样的么？
- 执意采用OLS方法估计模型3，会有什么后果？

---

## 虚拟变量模型的构建规则：R软件示例

.pull-left[


```r
mod.main3 &lt;- "Salary ~1+ D1+D2 +D3"
lm.main3 &lt;- lm(mod.main3, data_demon)
summary(lm.main3)
```

```

Call:
lm(formula = mod.main3, data = data_demon)

Residuals:
   Min     1Q Median     3Q    Max 
-14161  -4566  -1638   4632  15625 

Coefficients: (1 not defined because of singularities)
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)    46294       1624  28.505   &lt;2e-16 ***
D1              1721       2467   0.698    0.489    
D2              3245       2185   1.485    0.144    
D3                NA         NA      NA       NA    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 6696 on 48 degrees of freedom
Multiple R-squared:  0.04397,	Adjusted R-squared:  0.004134 
F-statistic: 1.104 on 2 and 48 DF,  p-value: 0.3399
```

]

.pull-right[

对于错误的**建模3**，有些统计软件（如R软件）会自动去掉一个多于的虚拟变量

`$$\begin {align} 
Salary_{i}=\gamma_{0}+\gamma_{1} D1_{ i}+\gamma_{2} D2_{ i}+\gamma_{3} D3_{ i}+u_{i}
\end {align}$$`

]



---

layout: false
class: inverse, center, middle, duke-softblue
name: one-one

# 4.2.4 同时含有一个定性变量
# 和定量变量的ANOVA模型

---
layout: true
  
&lt;div class="my-header"&gt;&lt;/div&gt;

&lt;div class="my-footer"&gt;&lt;span&gt;huhuaping@   第04章：扩展方法   
&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;
4.2 虚拟变量回归模型
&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;
4.2.4 同时含有一个定性变量和定量变量的ANOVA模型 &lt;/span&gt;&lt;/div&gt; 

---

class: center, middle,duke-orange

## 公立学校教师薪水案例

---

### 数据

把定性变量
`\(Region\)`进行**数据变换**，得到数据：

<div id="htmlwidget-9edeeea30170aad72ecf" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-9edeeea30170aad72ecf">{"x":{"filter":"none","caption":"<caption>把定性变量Region处理成虚拟变量n=(51)<\/caption>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51"],["Connecticut","Illinois","Indiana","Iowa","Kansas","Maine","Massachusetts","Michigan","Minnesota","Missouri","Nebraska","New Hampshire","New Jersey","New York","North Dakota","Ohio","Pennsylvania","Rhode Island","South Dakota","Vermont","Wisconsin","Alabama","Arkansas","Delaware","District of Columbia","Florida","Georgia","Kentucky","Louisiana","Maryland","Mississippi","North Carolina","Oklahoma","South Carolina","Tennessee","Texas","Virginia","West Virginia","Alaska","Arizona","California","Colorado","Hawaii","Idaho","Montana","Nevada","New Mexico","Oregon","Utah","Washington","Wyoming"],["M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","M.E.N","South","South","South","South","South","South","South","South","South","South","South","South","South","South","South","South","South","West","West","West","West","West","West","West","West","West","West","West","West","West"],[60822,58246,47831,43130,43334,41596,58624,54895,49634,41839,42044,46527,59920,58537,38822,51937,54970,55956,35378,48370,47901,43389,44245,54680,59000,45308,49905,43646,42816,56927,40182,46410,42379,44133,43816,44897,44727,40531,54658,45941,63640,45833,51922,42798,41225,45342,42780,50911,40566,47882,50692],[12436,9275,8935,7807,8373,11285,12596,9880,9675,7840,7900,10206,13781,13551,7807,10034,10711,11089,7911,12475,9965,7706,8402,12036,15508,7762,8534,8300,8519,9771,7215,7675,6944,8377,6979,7547,9275,9886,10171,5585,8486,8861,9879,7042,8361,6755,8622,8649,5347,7958,11596],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>state<\/th>\n      <th>Region<\/th>\n      <th>Salary<\/th>\n      <th>Spend<\/th>\n      <th>D1<\/th>\n      <th>D2<\/th>\n      <th>D3<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"tip","columnDefs":[{"className":"dt-center","targets":"_all"},{"visible":false,"targets":0},{"orderable":false,"targets":0}],"pageLength":5,"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>

---

### 有截距虚拟变量模型：PRM1

我们可以构建薪水（
`\(Salary\)`）对区域虚拟变量（
`\(D2;D3\)`）和定量变量
`\(Spend\)`的**有截距**总体回归模型PRM：

`$$\begin {align} 
Salary_{i}=\beta_{1}+\beta_{2} D2_{ i}+\beta_{3} D3_{ i}+\lambda Spend_i+u_{i}
\end {align}$$`

理论上，我们可以得到三个区域教师薪水的期望值：

.pull-left[

`$$\begin{align}
E(Salary|  D2=1,D3=0) 
&amp;=\beta_1+\beta_2 +\lambda Spend &amp;&amp;\text{(M.E.N)} \\
E(Salary|  D2=0,D3=1) 
&amp;=\beta_1+\beta_3 +\lambda Spend &amp;&amp;\text{(South)} \\
E(Salary|  D2=0,D3=0) 
&amp;=\beta_1 +\lambda Spend &amp;&amp;\text{(West)}
\end{align}$$`

]

.pull-right[

&lt;img src="pic/chpt-10-region-show.png" width="656" style="display: block; margin: auto;" /&gt;
]

---

### 有截距虚拟变量模型：OLS估计



`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{Salary}=&amp;&amp;+28694.92&amp;&amp;-2954.13D2&amp;&amp;-3112.19D3&amp;&amp;+2.34Spend\\ &amp;\text{(t)}&amp;&amp;(8.7953)&amp;&amp;(-1.5860)&amp;&amp;(-1.7101)&amp;&amp;(6.5152)\\&amp;\text{(se)}&amp;&amp;(3262.5213)&amp;&amp;(1862.5756)&amp;&amp;(1819.8725)&amp;&amp;(0.3592)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.4977;&amp;&amp; \bar{R^2}=0.4656\\&amp; &amp;&amp; F^{\ast}=15.52;&amp;&amp; p=0.0000 \end{alignedat} \end{equation}$$`

.pull-left[
 **提问1**：大白话解释上述回归函数！
 
 **思考1**：基准组是什么？谁是协变量？
 
 **思考2**：三条线为什么是平行的？
 
 **思考3**：统计上来看，南部线和西部线是不一样的么？
 
]

.pull-right[

&lt;img src="pic/chpt-10-region-show.png" width="454" style="display: block; margin: auto;" /&gt;
]

---

### 有截距虚拟变量模型：OLS估计




&lt;img src="part01-slide-04-reg-extention_files/figure-html/unnamed-chunk-74-1.png" style="display: block; margin: auto;" /&gt;


---

### 无截距虚拟变量模型：PRM2

我们可以构建薪水（
`\(Salary\)`）对区域虚拟变量（
`\(D1; D2;D3\)`）和定量变量
`\(Spend\)`的**无截距**总体回归模型PRM：

`$$\begin {align} 
Salary_{i}=\alpha_{1} D1_{ i}+\alpha_{2} D2_{ i}+\alpha_{3} D3_{ i}+\lambda Spend_i+u_{i}
\end {align}$$`

理论上，我们可以得到三个区域教师薪水的期望值：

.pull-left[

`$$\begin{align}
E(Salary|  D1=0,D2=1,D3=0;Spend) 
&amp;=\alpha_2 +\lambda Spend &amp;&amp;\text{(M.E.N)} \\
E(Salary|  D1=0,D2=0,D3=1;Spend) 
&amp;=\alpha_3 +\lambda Spend &amp;&amp;\text{(South)} \\
E(Salary|  D1=1,D2=0,D3=0;Spend) 
&amp;=\alpha_1 +\lambda Spend &amp;&amp;\text{(West)}
\end{align}$$`

]

.pull-right[

&lt;img src="pic/chpt-10-region-show.png" width="656" style="display: block; margin: auto;" /&gt;
]


---

### 无截距虚拟变量模型：OLS估计



`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{Salary}=&amp;&amp;+28694.92D1&amp;&amp;+25740.79D2&amp;&amp;+25582.72D3&amp;&amp;+2.34Spend\\ &amp;\text{(t)}&amp;&amp;(8.7953)&amp;&amp;(6.7627)&amp;&amp;(7.5372)&amp;&amp;(6.5152)\\&amp;\text{(se)}&amp;&amp;(3262.5213)&amp;&amp;(3806.2835)&amp;&amp;(3394.1819)&amp;&amp;(0.3592)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.9906;&amp;&amp; \bar{R^2}=0.9898\\&amp; &amp;&amp; F^{\ast}=1235.97;&amp;&amp; p=0.0000 \end{alignedat} \end{equation}$$`

.pull-left[

- **提问1**：大白话解释上述回归函数！

- **思考1**：基准组是什么？谁是协变量？

- **思考2**：三条线为什么是平行的？

- **思考3**：统计上来看，南部线和西部线是不一样的么？

- **思考4**：**有截距模型**和**无截距模型**的图形为什么是一样的？

]

.pull-right[

&lt;img src="pic/chpt-10-region-show.png" width="454" style="display: block; margin: auto;" /&gt;
]

---

### 无截距虚拟变量模型：OLS估计

&lt;img src="part01-slide-04-reg-extention_files/figure-html/unnamed-chunk-79-1.png" style="display: block; margin: auto;" /&gt;


---

layout: false
class: inverse, center, middle, duke-softblue
name: multiple

# 4.2.5 同时含有多个定性变量
# 和定量变量的ANOVA模型

---

layout: true
  
&lt;div class="my-header"&gt;&lt;/div&gt;

&lt;div class="my-footer"&gt;&lt;span&gt;huhuaping@   第04章：扩展方法   
&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;
4.2 虚拟变量回归模型
&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;
4.2.5 同时含有多个定性变量和定量变量的ANOVA模型 &lt;/span&gt;&lt;/div&gt; 






---

## 虚拟变量的引入方式（定义）

如果自变量中存在k个定性变量（
`\(X_{1i},X_{2i},\cdots,X_{ki}\)`），而且每个定性变量还有自己的属性个数（
`\(X_{ki} \quad (a_1,a_2,\cdots, a_m)\)`）。那么把这些**定性变量**转换成各自的**虚拟变量体系**后，虚拟变量在模型中出现的关系则可以有多种形式：

--

1. 虚拟变量以**加法形式**引入的回归模型：是指各个**定性变量**的虚拟变量体系，**各自**以**独立项**的形式出现在模型中。

2. 虚拟变量以**乘法形式**引入的回归模型：是指各个**定性变量**的虚拟变量体系，存在**相互**以**交叉项**的形式出现在模型中。

3. 虚拟变量以**混合形式**（既有加法形式也有乘法形式）引入的回归模型：是指各个**定性变量**的虚拟变量体系，及有**各自**以**独立项**的形式，也有**相互**以**交叉项**的形式出现在模型中。又具体分为两种情形：

    - 完全混合模型：两个定性变量的虚拟变量体系，既有各自**独立项**，又有它们相互间完全**交叉项**。
    
    - 部分混合模型：两个定性变量的虚拟变量体系，既有各自**独立项**，又有它们相互间不完全的**交叉项**（也即部分交叉）。


---

## 虚拟变量的引入方式（示例）

为了研究工人工资的影响因素，我们可以考虑如下变量：

- 定量变量：工资
`\(wage\)`；年龄
`\(age\)`

- 定性变量：教育程度
`\(edu\{a_1=\text{ill},a_2=\text{pri},a_3=\text{mid},a_4=\text{hig}\}\)`；工作部门
`\(dpt\{a_1=\text{tem},a_2=\text{per}\}\)`；性别
`\(sex\{a_1=\text{f},a_2=\text{m}\}\)`。

&gt; 教育程度edu：ill表示文盲；pri表示初等教育；mid表示中等教育；hig表示高等教育。

&gt; 工作类型dpt：tem表示临时工；per表示合同工。

&gt; 性别sex：f表示女性；m表示男性。

---
class: page-font-21
## 虚拟变量的引入方式（示例）

因为涉及到三个定性变量，我们可以将他们转换为各自的**虚拟变量体系**：

--

.pull-left[

**教育程度**定性变量`edu`：

`$$\begin{align}
&amp;edu\{a_1=\text{ill},a_2=\text{pri},a_3=\text{mid} ,a_4=\text{hig}\} \\
&amp;dummy \Longrightarrow  
  \begin{cases}
    edu\_ill  =
    \begin{cases}
    1, &amp; \text{ill}\\
    0, &amp; \text{not ill}
    \end{cases} \\
    edu\_pri = 
    \begin{cases}
    1, &amp; \text{pri}\\
    0, &amp; \text{not pri}
    \end{cases} \\
    edu\_mid  =
    \begin{cases}
    1, &amp; \text{mid}\\
    0, &amp; \text{not mid}
    \end{cases}\\
     edu\_hig  =
    \begin{cases}
    1, &amp; \text{hig}\\
    0, &amp; \text{not hig}
    \end{cases}
  \end{cases}
\end{align}$$`

]

--

.pull-right[

**工作类型**定性变量`dpt`：

`$$\begin{align}
&amp;dpt\{a_1=\text{tem},a_2=\text{per}\} \\
&amp;dummy \Longrightarrow  
  \begin{cases}
    dpt\_tem  =
    \begin{cases}
    1, &amp; \text{tem}\\
    0, &amp; \text{not tem}
    \end{cases} \\
    dpt\_per = 
    \begin{cases}
    1, &amp; \text{per}\\
    0, &amp; \text{not per}
    \end{cases} 
  \end{cases}
\end{align}$$`

**性别**定性变量`sex`：

`$$\begin{align}
&amp;sex\{a_1=\text{f},a_2=\text{m}\} \\
&amp;dummy \Longrightarrow  
  \begin{cases}
    sex\_f  =
    \begin{cases}
    1, &amp; \text{f}\\
    0, &amp; \text{not f}
    \end{cases} \\
    sex\_m = 
    \begin{cases}
    1, &amp; \text{m}\\
    0, &amp; \text{not m}
    \end{cases} 
  \end{cases}
\end{align}$$`

]


---

## 虚拟变量的引入方式（示例:加法模型）


`$$\begin{equation} \begin{alignedat}{999} &amp;wage=&amp;&amp; + \beta_{1} &amp;&amp; + \beta_{2} edu_{pri}&amp;&amp; + \beta_{3} edu_{mid}&amp;&amp; + \beta_{4} edu_{hig}&amp;&amp; + \beta_{5} dpt_{per}&amp;&amp; + \beta_{6} sex_{m}&amp;&amp; + \beta_{7} age&amp;&amp;+u_i\\ \end{alignedat} \end{equation}$$`

假定我们关注这样两个群体：

--

**A群体**：年龄为30岁的、女性（
`\(sex_m=0\)`）、**受过高等教育**（
`\(edu_pri=0,edu_mid=0,edu_hig=1\)`）的、拥有一份**合同工**的（
`\(dpt_per=1\)`）。

`$$\begin{align}
E(wage&amp;|age=30;edu_{pri}= 0;edu_{mid}= 0;edu_{hig}= 1;dpt_{per}= 1;sex_{m}= 0)\\
=&amp;+\beta_{1}+\beta_{2}(0)+\beta_{3}(0)+\beta_{4}(1)+\beta_{5}(1)+\beta_{6}(0)+\beta_{7}(30)\\
=&amp;+\beta_{1}+\beta_{4}+\beta_{5}+30\beta_{7}\\
\end{align}$$`

--

**B群体**：年龄为30岁的、女性（
`\(sex_m=0\)`）、**受过高等教育**（
`\(edu_pri=0,edu_mid=0,edu_hig=1\)`）的、拥有一份**临时工**的（
`\(dpt_per=0\)`）。

`$$\begin{align}
E(wage&amp;|age=30;edu_{pri}= 0;edu_{mid}= 0;edu_{hig}= 1;dpt_{per}= 0;sex_{m}= 0)\\
=&amp;+\beta_{1}+\beta_{2}(0)+\beta_{3}(0)+\beta_{4}(1)+\beta_{5}(0)+\beta_{6}(0)+\beta_{7}(30)\\
=&amp;+\beta_{1}+\beta_{4}+30\beta_{7}\\
\end{align}$$`

---

## 虚拟变量的引入方式（示例:加法模型）


`$$\begin{equation} \begin{alignedat}{999} &amp;wage=&amp;&amp; + \beta_{1} &amp;&amp; + \beta_{2} edu_{pri}&amp;&amp; + \beta_{3} edu_{mid}&amp;&amp; + \beta_{4} edu_{hig}&amp;&amp; + \beta_{5} dpt_{per}&amp;&amp; + \beta_{6} sex_{m}&amp;&amp; + \beta_{7} age&amp;&amp;+u_i\\ \end{alignedat} \end{equation}$$`

如果
`\(\beta_5&gt;0\)`，这将意味着：

--

- 只要拥有一份**合同工**（
`\(dpt_{per}=1\)`）。那么，**在其他同等情况下**，这个人的工资都要高于拥有一份**临时工**（
`\(dpt_{per}=0\)`）的人。——无论是高学历的同等条件（
`\(edu_{pri}=0,edu_{mid}=0,edu_{hig}=1\)`），还是中等学历的同等条件（
`\(edu_{pri}=1,edu_{mid}=0,edu_{hig}=0\)`），还是文盲学历的同等条件（
`\(edu_{pri}=0,edu_{mid}=0,edu_{hig}=0\)`）。

--

- 换言之，**工作类型**（dpt）与**受教育程度**（edu）是**独立地**作用于**工资**（wage）的！

---

## 虚拟变量的引入方式（示例:乘法模型）


`$$\begin{equation} \begin{alignedat}{999} &amp;wage=&amp;&amp; + \beta_{1} &amp;&amp; + \beta_{2} sex_{m}&amp;&amp; + \beta_{3} age&amp;&amp; + \beta_{4} edu_{pri} \ast dpt_{per}\\ &amp;\text{(cont.)}&amp;&amp; + \beta_{5} dpt_{per} \ast edu_{mid}&amp;&amp; + \beta_{6} dpt_{per} \ast edu_{hig}&amp;&amp;+u_i\\ \end{alignedat} \end{equation}$$`

假定我们关注这样两个群体：

--

**A群体**：年龄为30岁的、女性（
`\(sex_m=0\)`）、**受过高等教育**（
`\(edu_pri=0,edu_mid=0,edu_hig=1\)`）的、拥有一份**合同工**的（
`\(dpt_per=1\)`）。

`$$\begin{align}
E(wage&amp;|age=30;edu_{pri}= 0;edu_{mid}= 0;edu_{hig}= 1;dpt_{per}= 1;sex_{m}= 0)\\
=&amp;+\beta_{1}+\beta_{2}(0)+\beta_{3}(30)+\beta_{4}(0)\cdot(1)+\beta_{5}(1)\cdot(0)+\beta_{6}(1)\cdot(1)\\
=&amp;+\beta_{1}+30\beta_{3}+\beta_{6}\\
\end{align}$$`

--

**B群体**：年龄为30岁的、女性（
`\(sex_m=0\)`）、**受过高等教育**（
`\(edu_pri=0,edu_mid=0,edu_hig=1\)`）的、拥有一份**临时工**的（
`\(dpt_per=0\)`）。

`$$\begin{align}
E(wage&amp;|age=30;edu_{pri}= 0;edu_{mid}= 0;edu_{hig}= 1;dpt_{per}= 0;sex_{m}= 0)\\
=&amp;+\beta_{1}+\beta_{2}(0)+\beta_{3}(30)+\beta_{4}(0)\cdot(0)+\beta_{5}(0)\cdot(0)+\beta_{6}(0)\cdot(1)\\
=&amp;+\beta_{1}+30\beta_{3}\\
\end{align}$$`

---

## 虚拟变量的引入方式（示例:乘法模型）


`$$\begin{equation} \begin{alignedat}{999} &amp;wage=&amp;&amp; + \beta_{1} &amp;&amp; + \beta_{2} sex_{m}&amp;&amp; + \beta_{3} age&amp;&amp; + \beta_{4} edu_{pri} \ast dpt_{per}\\ &amp;\text{(cont.)}&amp;&amp; + \beta_{5} dpt_{per} \ast edu_{mid}&amp;&amp; + \beta_{6} dpt_{per} \ast edu_{hig}&amp;&amp;+u_i\\ \end{alignedat} \end{equation}$$`

如果
`\(\beta_6&gt;0\)`且显著，这将意味着：

--

- **在其他同等情况下**，一个拥有一份**合同工**（
`\(dpt_{per}=1\)`）且拥有**高学历**（
`\(edu_{hig}=1\)`）的人。这个人的工资都要**高于**拥有一份**临时工**（
`\(dpt_{per}=0\)`）或**没有**受过高学历教育（
`\(edu_{hig}=0\)`）的人。——包括：临时工&amp;文盲；临时工&amp;初等学历；临时工&amp;中等学历；合同工&amp;文盲；合同工&amp;初等学历；合同工&amp;中等学历。

--

- 换言之，**工作类型**（dpt）与**受教育程度**（edu）是**交互地**作用于**工资**（wage）的！——此处重点针对拥有高学历还是不拥有有高学历。


---

## 虚拟变量的引入方式（示例:混合模型）


`$$\begin{equation} \begin{alignedat}{999} &amp;wage=&amp;&amp; + \beta_{1} &amp;&amp; + \beta_{2} sex_{m}&amp;&amp; + \beta_{3} dpt_{per}&amp;&amp; + \beta_{4} age&amp;&amp; + \beta_{5} edu_{pri} \ast dpt_{per}\\ &amp;\text{(cont.)}&amp;&amp; + \beta_{6} edu_{mid} \ast dpt_{per}&amp;&amp; + \beta_{7} edu_{hig} \ast dpt_{per}&amp;&amp;+u_i\\ \end{alignedat} \end{equation}$$`

假定我们关注这样两个群体：

--

**A群体**：年龄为30岁的、女性（
`\(sex_m=0\)`）、**受过高等教育**（
`\(edu_pri=0,edu_mid=0,edu_hig=1\)`）的、拥有一份**合同工**的（
`\(dpt_per=1\)`）。

`$$\begin{align}
E(wage&amp;|age=30;edu_{pri}= 0;edu_{mid}= 0;edu_{hig}= 1;dpt_{per}= 1;sex_{m}= 0)\\
=&amp;+\beta_{1}+\beta_{2}(0)+\beta_{3}(1)+\beta_{4}(30)+\beta_{5}(0)\cdot(1)+\beta_{6}(0)\cdot(1)+\beta_{7}(1)\cdot(1)\\
=&amp;+\beta_{1}+\beta_{3}+30\beta_{4}+\beta_{7}\\
\end{align}$$`

--

**B群体**：年龄为30岁的、女性（
`\(sex_m=0\)`）、**受过高等教育**（
`\(edu_pri=0,edu_mid=0,edu_hig=1\)`）的、拥有一份**临时工**的（
`\(dpt_per=0\)`）。

`$$\begin{align}
E(wage&amp;|age=30;edu_{pri}= 0;edu_{mid}= 0;edu_{hig}= 1;dpt_{per}= 0;sex_{m}= 0)\\
=&amp;+\beta_{1}+\beta_{2}(0)+\beta_{3}(0)+\beta_{4}(30)+\beta_{5}(0)\cdot(0)+\beta_{6}(0)\cdot(0)+\beta_{7}(1)\cdot(0)\\
=&amp;+\beta_{1}+30\beta_{4}\\
\end{align}$$`



---
class: center, middle,duke-orange

## 印度工人工资案例

---
layout: false
class: inverse, center, middle, duke-softblue
name: example

# 4.2.6 印度工人工资案例

---
layout: true
  
&lt;div class="my-header"&gt;&lt;/div&gt;

&lt;div class="my-footer"&gt;&lt;span&gt;huhuaping@   第04章：扩展方法   
&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;
4.2 虚拟变量回归模型
&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;
4.2.6 印度工人工资案例 &lt;/span&gt;&lt;/div&gt; 

---

### 数据：原始

**印度工人工资**：114位印度工人工资方面的数据如下。

<div id="htmlwidget-213808146f4ea4b76b58" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-213808146f4ea4b76b58">{"x":{"filter":"none","caption":"<caption>印度工人工资(n=114)<\/caption>","data":[[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114],[117,375,175,100,162.5,300,175,287.5,350,385,395,224,91.8,119,377,400,139.5,139.5,54,342,77.5,156,350,427,40,65,162.5,162.5,162.5,325,18,127.6,30,189.5,50,112,82,87.5,600,116.5,75,127,324,150,135,62.5,97,54,120.5,950,120,132,30,24,75,42,100,135.5,107,90,162,49.16,81,105,200,80,125,500,100,105,100,140,150,131,120,122,79,110,370,261.15,129.5,107.7,20,18,120,40.5,120,75,52,115.25,102.5,272.5,94.25,30,30,25,47.5,175,150,50,175,50,85.32,111,47.5,40.5,47,25,15,25,25,75,53.84,50],[26,42,33,33,30,35,40,50,42,30,45,48,35,38,46,57,44,30,62,56,19,26,57,55,15,14,25,28,24,55,19,25,19,62,25,27,22,25,35,28,27,22,26,30,25,18,25,16,27,47,57,38,18,12,55,18,32,41,48,45,40,22,20,40,30,26,22,21,19,35,30,30,36,55,21,20,60,23,46,23,33,26,14,12,38,17,34,18,19,33,27,43,22,38,17,22,25,50,24,25,40,16,26,23,46,37,41,28,13,18,11,45,14,26],["pri","pri","pri","pri","pri","mid","mid","mid","mid","mid","mid","hig","hig","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","pri","pri","pri","pri","pri","pri","pri","pri","pri","pri","mid","mid","mid","mid","mid","mid","mid","mid","mid","hig","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill","mid","hig","hig","hig","ill","ill","ill","ill","ill","ill","ill","ill","pri","pri","mid","ill","ill","ill","ill","ill","ill","ill","ill","ill","ill"],["per","per","per","per","per","per","per","per","per","per","per","per","per","per","per","per","per","per","per","per","per","per","per","per","per","per","per","per","per","per","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","per","per","per","per","per","per","per","per","per","per","per","per","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem","tem"],["f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>obs<\/th>\n      <th>wage<\/th>\n      <th>age<\/th>\n      <th>edu<\/th>\n      <th>dpt<\/th>\n      <th>sex<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"tip","columnDefs":[{"className":"dt-center","targets":"_all"},{"visible":false,"targets":0}],"pageLength":5,"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>


---

### 数据：变量定义

变量说明见下表：

&lt;table class="table" style="font-size: 20px; margin-left: auto; margin-right: auto;"&gt;
&lt;caption style="font-size: initial !important;"&gt;变量定义及说明&lt;/caption&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:center;"&gt; variable &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; label &lt;/th&gt;
   &lt;th style="text-align:center;"&gt; remark &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:center;"&gt; obs &lt;/td&gt;
   &lt;td style="text-align:center;width: 6em; "&gt; 工人编号 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 序号(observations) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:center;"&gt; wage &lt;/td&gt;
   &lt;td style="text-align:center;width: 6em; "&gt; 工人工资 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 美元/周(\$/week) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:center;"&gt; age &lt;/td&gt;
   &lt;td style="text-align:center;width: 6em; "&gt; 年龄 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; 岁(year) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:center;"&gt; edu &lt;/td&gt;
   &lt;td style="text-align:center;width: 6em; "&gt; 教育水平 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; ill=文盲(illiteracy)；pri=初等教育(primary)；mid=中等教育(middle)；hig=高等教育(higher) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:center;"&gt; dpt &lt;/td&gt;
   &lt;td style="text-align:center;width: 6em; "&gt; 合同类型 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; tem=短期合同(temporary)；per=长期合同(permanent) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:center;"&gt; sex &lt;/td&gt;
   &lt;td style="text-align:center;width: 6em; "&gt; 性别 &lt;/td&gt;
   &lt;td style="text-align:center;"&gt; f=女(female)；m=男(male) &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;


---

### 数据：定性变量的属性统计


<div id="htmlwidget-bc8509392f4c93ceaac5" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-bc8509392f4c93ceaac5">{"x":{"filter":"none","caption":"<caption>定性变量及其属性的统计表(n=114)<\/caption>","data":[["edu","edu","edu","edu","dpt","dpt","sex","sex"],["ill","pri","mid","hig","tem","per","f","m"],[74,17,17,6,72,42,89,25]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>定性变量<\/th>\n      <th>属性<\/th>\n      <th>频次<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","columnDefs":[{"className":"dt-center","targets":"_all"},{"visible":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>


---
class: page-font-20
### 数据：定性变量的虚拟变量变换



将基础组设定为{文盲，临时工，女性}（也即{illiteracy，temporary，female}）。则可以将全部定性变量的基础组属性{illiteracy，temporary，female}分别设置为虚拟变量`edu_ill`、`dpt_tem`和`sex_f`。

.pull-left[

**教育程度**定性变量`edu`：

`$$\begin{align}
&amp;edu\{a_1=\text{ill},a_2=\text{pri},a_3=\text{mid} ,a_4=\text{hig}\} \\
&amp;dummy \Longrightarrow  
  \begin{cases}
    edu\_ill  =
    \begin{cases}
    1, &amp; \text{ill}\\
    0, &amp; \text{not ill}
    \end{cases} \\
    edu\_pri = 
    \begin{cases}
    1, &amp; \text{pri}\\
    0, &amp; \text{not pri}
    \end{cases} \\
    edu\_mid  =
    \begin{cases}
    1, &amp; \text{mid}\\
    0, &amp; \text{not mid}
    \end{cases}\\
     edu\_hig  =
    \begin{cases}
    1, &amp; \text{hig}\\
    0, &amp; \text{not hig}
    \end{cases}
  \end{cases}
\end{align}$$`

]

.pull-right[

**工作类型**定性变量`dpt`：

`$$\begin{align}
&amp;dpt\{a_1=\text{tem},a_2=\text{per}\} \\
&amp;dummy \Longrightarrow  
  \begin{cases}
    dpt\_tem  =
    \begin{cases}
    1, &amp; \text{tem}\\
    0, &amp; \text{not tem}
    \end{cases} \\
    dpt\_per = 
    \begin{cases}
    1, &amp; \text{per}\\
    0, &amp; \text{not per}
    \end{cases} 
  \end{cases}
\end{align}$$`

**性别**定性变量`sex`：

`$$\begin{align}
&amp;sex\{a_1=\text{f},a_2=\text{m}\} \\
&amp;dummy \Longrightarrow  
  \begin{cases}
    sex\_f  =
    \begin{cases}
    1, &amp; \text{f}\\
    0, &amp; \text{not f}
    \end{cases} \\
    sex\_m = 
    \begin{cases}
    1, &amp; \text{m}\\
    0, &amp; \text{not m}
    \end{cases} 
  \end{cases}
\end{align}$$`

]

---

### 数据：教育变量的虚拟变量变换

<div id="htmlwidget-8967f5c148991bdc7f7c" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-8967f5c148991bdc7f7c">{"x":{"filter":"none","caption":"<caption>用虚拟变量系统完全表达定性变量edu (n=114)<\/caption>","data":[[92,18,10,5],["hig","ill","mid","pri"],[0,1,0,0],[0,0,0,1],[0,0,1,0],[1,0,0,0]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>obs<\/th>\n      <th>edu<\/th>\n      <th>edu_ill<\/th>\n      <th>edu_pri<\/th>\n      <th>edu_mid<\/th>\n      <th>edu_hig<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","columnDefs":[{"className":"dt-center","targets":"_all"},{"visible":false,"targets":0}],"pageLength":4,"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[4,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>

---

### 数据：工作部门变量的虚拟变量变换

<div id="htmlwidget-2d85757e0d2ac92e4add" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-2d85757e0d2ac92e4add">{"x":{"filter":"none","caption":"<caption>用虚拟变量系统完全表达定性变量dpt (n=114)<\/caption>","data":[[5,35],["per","tem"],[0,1],[1,0]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>obs<\/th>\n      <th>dpt<\/th>\n      <th>dpt_tem<\/th>\n      <th>dpt_per<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","columnDefs":[{"className":"dt-center","targets":"_all"},{"visible":false,"targets":0}],"pageLength":3,"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[3,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>


---

### 数据：性别变量的虚拟变量变换

<div id="htmlwidget-76fec66890dbde7a8b7e" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-76fec66890dbde7a8b7e">{"x":{"filter":"none","caption":"<caption>用虚拟变量系统完全表达定性变量sex (n=114)<\/caption>","data":[[2,91],["f","m"],[1,0],[0,1]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>obs<\/th>\n      <th>sex<\/th>\n      <th>sex_f<\/th>\n      <th>sex_m<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","columnDefs":[{"className":"dt-center","targets":"_all"},{"visible":false,"targets":0}],"pageLength":5,"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>

---

### 加法模型：总体回归模型PRM

同时含虚拟变量和定量变量的、加法形式的经典回归模型：

`$$\begin{equation} \begin{alignedat}{999} &amp;wage=&amp;&amp; + \beta_{1} &amp;&amp; + \beta_{2} edu_{pri}&amp;&amp; + \beta_{3} edu_{mid}&amp;&amp; + \beta_{4} edu_{hig}&amp;&amp; + \beta_{5} dpt_{per}&amp;&amp; + \beta_{6} sex_{m}&amp;&amp; + \beta_{7} age&amp;&amp;+u_i\\ \end{alignedat} \end{equation}$$`

OLS估计的简要报告如下：

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{wage}=&amp;&amp;+6.79&amp;&amp;+23.96edu_{pri}&amp;&amp;+61.59edu_{mid}&amp;&amp;+150.49edu_{hig}\\ &amp;\text{(t)}&amp;&amp;(0.2130)&amp;&amp;(0.7734)&amp;&amp;(1.9867)&amp;&amp;(3.0054)\\&amp;\text{(se)}&amp;&amp;(31.8931)&amp;&amp;(30.9789)&amp;&amp;(31.0035)&amp;&amp;(50.0725)\\&amp;\text{(cont.)}&amp;&amp;+31.16dpt_{per}&amp;&amp;-83.20sex_{m}&amp;&amp;+3.99age\\&amp;\text{(t)}&amp;&amp;(1.3141)&amp;&amp;(-3.0819)&amp;&amp;(4.5129)\\&amp;\text{(se)}&amp;&amp;(23.7120)&amp;&amp;(26.9981)&amp;&amp;(0.8835)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.3450;&amp;&amp; \bar{R^2}=0.3083\\&amp; &amp;&amp; F^{\ast}=9.39;&amp;&amp; p=0.0000\\ \end{alignedat} \end{equation}$$`

---

### 加法模型：EViews报告

&lt;img src="pic/chpt-10-both-plus.png" width="577" style="display: block; margin: auto;" /&gt;


---

### 加法模型：基础组

* 基础组（**文盲 &amp; 短期合同 &amp; 女性**），也即(**illiteracy &amp; temporary &amp; female**)的期望工资收入为（给定**年龄**为30岁）：

`$$\begin{align}
E(wage&amp;|age=30;edu_{pri}= 0;edu_{mid}= 0;edu_{hig}= 0;dpt_{per}= 0;sex_{m}= 0)\\
=&amp;+\beta_{1}+\beta_{2}(0)+\beta_{3}(0)+\beta_{4}(0)+\beta_{5}(0)+\beta_{6}(0)+\beta_{7}(30)\\
=&amp;+\beta_{1}+30\beta_{7}\\
\end{align}$$`

`$$\begin{align}
(\widehat{wage}&amp;|age=30;edu_{pri}= 0;edu_{mid}= 0;edu_{hig}= 0;dpt_{per}= 0;sex_{m}= 0)\\
=&amp;+\hat{\beta}_{1}+\hat{\beta}_{2}(0)+\hat{\beta}_{3}(0)+\hat{\beta}_{4}(0)\\
&amp;+\hat{\beta}_{5}(0)+\hat{\beta}_{6}(0)+\hat{\beta}_{7}(30)\\
=&amp;+[6.79]+[23.96]\cdot(0)+[61.59]\cdot(0)+[150.49]\cdot(0)\\
&amp;+[31.16]\cdot(0)+[-83.20]\cdot(0)+[3.99]\cdot(30)\\
=&amp;126.4104\\
\end{align}$$`


---

### 加法模型：比较组1

比较组1（**高等学历 &amp; 短期合同 &amp; 女性**），也即(**high &amp; temporary &amp; female**)的期望工资收入为（给定**年龄**为30岁）：

`$$\begin{align}
E(wage&amp;|age=30;edu_{pri}= 0;edu_{mid}= 0;edu_{hig}= 1;dpt_{per}= 0;sex_{m}= 0)\\
=&amp;+\beta_{1}+\beta_{2}(0)+\beta_{3}(0)+\beta_{4}(1)+\beta_{5}(0)+\beta_{6}(0)+\beta_{7}(30)\\
=&amp;+\beta_{1}+\beta_{4}+30\beta_{7}\\
\end{align}$$`


`$$\begin{align}
(\widehat{wage}&amp;|age=30;edu_{pri}= 0;edu_{mid}= 0;edu_{hig}= 1;dpt_{per}= 0;sex_{m}= 0)\\
=&amp;+\hat{\beta}_{1}+\hat{\beta}_{2}(0)+\hat{\beta}_{3}(0)+\hat{\beta}_{4}(1)\\
&amp;+\hat{\beta}_{5}(0)+\hat{\beta}_{6}(0)+\hat{\beta}_{7}(30)\\
=&amp;+[6.79]+[23.96]\cdot(0)+[61.59]\cdot(0)+[150.49]\cdot(1)\\
&amp;+[31.16]\cdot(0)+[-83.20]\cdot(0)+[3.99]\cdot(30)\\
=&amp;276.8995\\
\end{align}$$`

---

### 加法模型：比较组2

比较组2（**高等教育 &amp; 长期合同 &amp; 女性**），也即(**higher &amp; permanent &amp; female**)的期望工资收入为（给定**年龄**为30岁）：

`$$\begin{align}
E(wage&amp;|age=30;edu_{pri}= 0;edu_{mid}= 0;edu_{hig}= 1;dpt_{per}= 1;sex_{m}= 0)\\
=&amp;+\beta_{1}+\beta_{2}(0)+\beta_{3}(0)+\beta_{4}(1)+\beta_{5}(1)+\beta_{6}(0)+\beta_{7}(30)\\
=&amp;+\beta_{1}+\beta_{4}+\beta_{5}+30\beta_{7}\\
\end{align}$$`

`$$\begin{align}
(\widehat{wage}&amp;|age=30;edu_{pri}= 0;edu_{mid}= 0;edu_{hig}= 1;dpt_{per}= 1;sex_{m}= 0)\\
=&amp;+\hat{\beta}_{1}+\hat{\beta}_{2}(0)+\hat{\beta}_{3}(0)+\hat{\beta}_{4}(1)\\
&amp;+\hat{\beta}_{5}(1)+\hat{\beta}_{6}(0)+\hat{\beta}_{7}(30)\\
=&amp;+[6.79]+[23.96]\cdot(0)+[61.59]\cdot(0)+[150.49]\cdot(1)\\
&amp;+[31.16]\cdot(1)+[-83.20]\cdot(0)+[3.99]\cdot(30)\\
=&amp;308.0604\\
\end{align}$$`

---

### 乘法模型：总体回归模型PRM

同时含虚拟变量和定量变量的、加法形式的经典回归模型：

`$$\begin{equation} \begin{alignedat}{999} &amp;wage=&amp;&amp; + \beta_{1} &amp;&amp; + \beta_{2} sex_{m}&amp;&amp; + \beta_{3} age&amp;&amp; + \beta_{4} edu_{pri} \ast dpt_{per}&amp;&amp; + \beta_{5} dpt_{per} \ast edu_{mid}&amp;&amp; + \beta_{6} dpt_{per} \ast edu_{hig}&amp;&amp;+u_i\\ \end{alignedat} \end{equation}$$`

OLS估计的简要报告如下：

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{wage}=&amp;&amp;+22.92&amp;&amp;-71.41sex_{m}&amp;&amp;+4.11age&amp;&amp;+28.21edu_{pri} \ast dpt_{per}\\ &amp;\text{(t)}&amp;&amp;(0.7366)&amp;&amp;(-2.5720)&amp;&amp;(4.6325)&amp;&amp;(0.5166)\\&amp;\text{(se)}&amp;&amp;(31.1120)&amp;&amp;(27.7639)&amp;&amp;(0.8870)&amp;&amp;(54.5979)\\&amp;\text{(cont.)}&amp;&amp;+112.68dpt_{per} \ast edu_{mid}&amp;&amp;+33.12dpt_{per} \ast edu_{hig}\\&amp;\text{(t)}&amp;&amp;(2.4012)&amp;&amp;(0.5965)\\&amp;\text{(se)}&amp;&amp;(46.9258)&amp;&amp;(55.5274)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.2872;&amp;&amp; \bar{R^2}=0.2542\\&amp; &amp;&amp; F^{\ast}=8.70;&amp;&amp; p=0.0000\\ \end{alignedat} \end{equation}$$`

---

### 乘法模型：EViews报告

&lt;img src="pic/chpt-10-both-prod-pure.png" width="577" style="display: block; margin: auto;" /&gt;

---

### 乘法模型：基础组

* 基础组（**文盲 &amp; 短期合同 &amp; 女性**），也即(**illiteracy &amp; temporary &amp; female**)的期望工资收入为（给定**年龄**为30岁）：

`$$\begin{align}
E(wage&amp;|age=30;edu_{pri}= 0;edu_{mid}= 0;edu_{hig}= 0;dpt_{per}= 0;sex_{m}= 0)\\
=&amp;+\beta_{1}+\beta_{2}(0)+\beta_{3}(30)+\beta_{4}(0)\cdot(0)+\beta_{5}(0)\cdot(0)+\beta_{6}(0)\cdot(0)\\
=&amp;+\beta_{1}+30\beta_{3}\\
\end{align}$$`

`$$\begin{align}
(\widehat{wage}&amp;|age=30;edu_{pri}= 0;edu_{mid}= 0;edu_{hig}= 0;dpt_{per}= 0;sex_{m}= 0)\\
=&amp;+\hat{\beta}_{1}+\hat{\beta}_{2}(0)+\hat{\beta}_{3}(30)+\hat{\beta}_{4}(0)\\
&amp;+\hat{\beta}_{5}(0)+\hat{\beta}_{6}(0)\\
=&amp;+[22.92]+[-71.41]\cdot(0)+[4.11]\cdot(30)+[28.21]\cdot(0)\\
&amp;+[112.68]\cdot(0)+[33.12]\cdot(0)\\
=&amp;146.1879\\
\end{align}$$`


---

### 乘法模型：比较组1

比较组1（**高等学历 &amp; 短期合同 &amp; 女性**），也即(**high &amp; temporary &amp; female**)的期望工资收入为（给定**年龄**为30岁）：

`$$\begin{align}
E(wage&amp;|age=30;edu_{pri}= 0;edu_{mid}= 0;edu_{hig}= 1;dpt_{per}= 0;sex_{m}= 0)\\
=&amp;+\beta_{1}+\beta_{2}(0)+\beta_{3}(30)+\beta_{4}(0)\cdot(0)+\beta_{5}(0)\cdot(0)+\beta_{6}(0)\cdot(1)\\
=&amp;+\beta_{1}+30\beta_{3}\\
\end{align}$$`


`$$\begin{align}
(\widehat{wage}&amp;|age=30;edu_{pri}= 0;edu_{mid}= 0;edu_{hig}= 1;dpt_{per}= 0;sex_{m}= 0)\\
=&amp;+\hat{\beta}_{1}+\hat{\beta}_{2}(0)+\hat{\beta}_{3}(30)+\hat{\beta}_{4}(0)\\
&amp;+\hat{\beta}_{5}(0)+\hat{\beta}_{6}(0)\\
=&amp;+[22.92]+[-71.41]\cdot(0)+[4.11]\cdot(30)+[28.21]\cdot(0)\\
&amp;+[112.68]\cdot(0)+[33.12]\cdot(0)\\
=&amp;146.1879\\
\end{align}$$`

---

### 乘法模型：比较组2

比较组2（**高等教育 &amp; 长期合同 &amp; 女性**），也即(**higher &amp; permanent &amp; female**)的期望工资收入为（给定**年龄**为30岁）：

`$$\begin{align}
E(wage&amp;|age=30;edu_{pri}= 0;edu_{mid}= 0;edu_{hig}= 1;dpt_{per}= 1;sex_{m}= 0)\\
=&amp;+\beta_{1}+\beta_{2}(0)+\beta_{3}(30)+\beta_{4}(0)\cdot(1)+\beta_{5}(1)\cdot(0)+\beta_{6}(1)\cdot(1)\\
=&amp;+\beta_{1}+30\beta_{3}+\beta_{6}\\
\end{align}$$`

`$$\begin{align}
(\widehat{wage}&amp;|age=30;edu_{pri}= 0;edu_{mid}= 0;edu_{hig}= 1;dpt_{per}= 1;sex_{m}= 0)\\
=&amp;+\hat{\beta}_{1}+\hat{\beta}_{2}(0)+\hat{\beta}_{3}(30)+\hat{\beta}_{4}(0)\\
&amp;+\hat{\beta}_{5}(0)+\hat{\beta}_{6}(1)\\
=&amp;+[22.92]+[-71.41]\cdot(0)+[4.11]\cdot(30)+[28.21]\cdot(0)\\
&amp;+[112.68]\cdot(0)+[33.12]\cdot(1)\\
=&amp;179.3103\\
\end{align}$$`

---

layout: false
class: inverse, center, middle, duke-softblue
name: series

# 4.2.7 时间序列季节虚拟变量模型

---

layout: true
  
&lt;div class="my-header"&gt;&lt;/div&gt;

&lt;div class="my-footer"&gt;&lt;span&gt;huhuaping@   第04章：扩展方法   
&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;
4.2 虚拟变量回归模型
&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;
4.2.7 时间序列季节虚拟变量模型 &lt;/span&gt;&lt;/div&gt; 

---

## 时间序列季节虚拟变量模型

**时间序列季节虚拟变量模型**：是指时间变量以虚拟变量形式进入回归方程的模型，它是虚拟变量回归模型的一种特定形式及应用。  

- 季节模式（seasonal pattern）：大多数时间序列经济变量，通常表现出来的季节性往复行为或现象。

- 季节调整（seasonal adjusted）：将时间序列经济变量的季节性变化成分去除，从而得到一个新的变量序列的处理过程。  

事实上，一个时间序列经济变量往往同时存在四个成分，分别是：

- **季节成分**（seasonal component）

- **周期成分**（cyclical component）

- **趋势成分**（trend component）

- **严格随机成分**（strictly random component）

---

## 时间序列季节虚拟变量模型

如果把定性变量季节（season：Q1；Q2；Q3；Q4）变换为**虚拟变量体系**，则分别可以构建以第一季度为**基础组**的时间序列季节虚拟变量模型和**无基础组**的时间序列季节虚拟变量模型（
`\(X_t\)`为定量变量）。

`$$\begin{align}
Y_t=\beta_1+\beta_2X_t+\lambda_2D2_t+\lambda_3D3_t+\lambda_4D4_t+u_t \\
Y_t=\beta_2X_t+\lambda_1D1_t+\lambda_2D2_t+\lambda_3D3_t+\lambda_4D4_t+u_t 
\end{align}$$`

---

class: center, middle,duke-orange
## 交通事故案例

---

### 数据



<div id="htmlwidget-ab7e43a561ad03c68fbd" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-ab7e43a561ad03c68fbd">{"x":{"filter":"none","caption":"<caption>交通事故数据 (n=108)<\/caption>","data":[[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108],[1981,1981,1981,1981,1981,1981,1981,1981,1981,1981,1981,1981,1982,1982,1982,1982,1982,1982,1982,1982,1982,1982,1982,1982,1983,1983,1983,1983,1983,1983,1983,1983,1983,1983,1983,1983,1984,1984,1984,1984,1984,1984,1984,1984,1984,1984,1984,1984,1985,1985,1985,1985,1985,1985,1985,1985,1985,1985,1985,1985,1986,1986,1986,1986,1986,1986,1986,1986,1986,1986,1986,1986,1987,1987,1987,1987,1987,1987,1987,1987,1987,1987,1987,1987,1988,1988,1988,1988,1988,1988,1988,1988,1988,1988,1988,1988,1989,1989,1989,1989,1989,1989,1989,1989,1989,1989,1989,1989],["1","2","3","4","5","6","7","8","9","10","11","12","1","2","3","4","5","6","7","8","9","10","11","12","1","2","3","4","5","6","7","8","9","10","11","12","1","2","3","4","5","6","7","8","9","10","11","12","1","2","3","4","5","6","7","8","9","10","11","12","1","2","3","4","5","6","7","8","9","10","11","12","1","2","3","4","5","6","7","8","9","10","11","12","1","2","3","4","5","6","7","8","9","10","11","12","1","2","3","4","5","6","7","8","9","10","11","12"],[40511,36034,40328,37699,38816,38900,38625,39539,38070,40676,39270,39734,36672,32699,41283,36455,36690,35837,36850,36284,36791,38366,37741,38331,37201,35901,40354,38276,36544,36127,37446,38977,39443,40098,41483,43493,35242,35215,39151,37808,39706,38857,40083,41797,42034,43836,44638,45369,38642,38616,44493,41134,42369,42430,41219,43359,41422,43961,45906,44165,43522,42104,47128,44892,46833,46349,48098,49329,48899,49025,46975,50266,45158,44303,47529,45364,47072,47090,48880,48357,46768,52326,48475,51924,43569,42585,45944,47003,46066,45719,47161,47558,47052,48297,49136,52971,43142,42475,49753,45161,46083,45540,46325,46742,47932,48678,47971,47251]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>obs<\/th>\n      <th>year<\/th>\n      <th>month<\/th>\n      <th>totacc<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"tip","columnDefs":[{"className":"dt-center","targets":"_all"},{"visible":false,"targets":0}],"pageLength":6,"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[6,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>

---

### 散点图

&lt;img src="part01-slide-04-reg-extention_files/figure-html/unnamed-chunk-117-1.png" style="display: block; margin: auto;" /&gt;


---

### 虚拟变量

<div id="htmlwidget-50a0cb93be3c8a7dd7b9" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-50a0cb93be3c8a7dd7b9">{"x":{"filter":"none","caption":"<caption>将月份month变换成虚拟变量系统(n=108)<\/caption>","data":[[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108],[1981,1981,1981,1981,1981,1981,1981,1981,1981,1981,1981,1981,1982,1982,1982,1982,1982,1982,1982,1982,1982,1982,1982,1982,1983,1983,1983,1983,1983,1983,1983,1983,1983,1983,1983,1983,1984,1984,1984,1984,1984,1984,1984,1984,1984,1984,1984,1984,1985,1985,1985,1985,1985,1985,1985,1985,1985,1985,1985,1985,1986,1986,1986,1986,1986,1986,1986,1986,1986,1986,1986,1986,1987,1987,1987,1987,1987,1987,1987,1987,1987,1987,1987,1987,1988,1988,1988,1988,1988,1988,1988,1988,1988,1988,1988,1988,1989,1989,1989,1989,1989,1989,1989,1989,1989,1989,1989,1989],["1","2","3","4","5","6","7","8","9","10","11","12","1","2","3","4","5","6","7","8","9","10","11","12","1","2","3","4","5","6","7","8","9","10","11","12","1","2","3","4","5","6","7","8","9","10","11","12","1","2","3","4","5","6","7","8","9","10","11","12","1","2","3","4","5","6","7","8","9","10","11","12","1","2","3","4","5","6","7","8","9","10","11","12","1","2","3","4","5","6","7","8","9","10","11","12","1","2","3","4","5","6","7","8","9","10","11","12"],[40511,36034,40328,37699,38816,38900,38625,39539,38070,40676,39270,39734,36672,32699,41283,36455,36690,35837,36850,36284,36791,38366,37741,38331,37201,35901,40354,38276,36544,36127,37446,38977,39443,40098,41483,43493,35242,35215,39151,37808,39706,38857,40083,41797,42034,43836,44638,45369,38642,38616,44493,41134,42369,42430,41219,43359,41422,43961,45906,44165,43522,42104,47128,44892,46833,46349,48098,49329,48899,49025,46975,50266,45158,44303,47529,45364,47072,47090,48880,48357,46768,52326,48475,51924,43569,42585,45944,47003,46066,45719,47161,47558,47052,48297,49136,52971,43142,42475,49753,45161,46083,45540,46325,46742,47932,48678,47971,47251],[1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0],[0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0],[0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0],[0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0],[0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0],[0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0],[0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0],[0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0],[0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>obs<\/th>\n      <th>year<\/th>\n      <th>month<\/th>\n      <th>totacc<\/th>\n      <th>jan<\/th>\n      <th>feb<\/th>\n      <th>mar<\/th>\n      <th>apr<\/th>\n      <th>may<\/th>\n      <th>jun<\/th>\n      <th>jul<\/th>\n      <th>aug<\/th>\n      <th>sep<\/th>\n      <th>oct<\/th>\n      <th>nov<\/th>\n      <th>dec<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"tip","columnDefs":[{"className":"dt-center","targets":"_all"},{"visible":false,"targets":0}],"pageLength":6,"scrollX":true,"scrollCollapse":true,"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[6,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>


---

### 模型设定PRM

我们以1月份为基础组，构建如下的有截距虚拟变量回归模型：

`$$\begin{equation} \begin{alignedat}{999} &amp;log(totacc)=&amp;&amp; + \beta_{1} &amp;&amp; + \beta_{2} feb&amp;&amp; + \beta_{3} mar&amp;&amp; + \beta_{4} apr\\ &amp;\text{(cont.)}&amp;&amp; + \beta_{5} may&amp;&amp; + \beta_{6} jun&amp;&amp; + \beta_{7} aug&amp;&amp; + \beta_{8} sep\\ &amp;\text{(cont.)}&amp;&amp; + \beta_{9} oct&amp;&amp; + \beta_{10} nov&amp;&amp; + \beta_{11} dec&amp;&amp;+u_i\\ \end{alignedat} \end{equation}$$`

---

### OLS估计

以上模型的OLS估计结果如下：

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{log(totacc)}=&amp;&amp;+10.63&amp;&amp;-0.07feb&amp;&amp;+0.06mar&amp;&amp;-0.00apr\\ &amp;\text{(t)}&amp;&amp;(433.2562)&amp;&amp;(-1.5759)&amp;&amp;(1.3715)&amp;&amp;(-0.0072)\\&amp;\text{(se)}&amp;&amp;(0.0245)&amp;&amp;(0.0425)&amp;&amp;(0.0425)&amp;&amp;(0.0425)\\&amp;\text{(cont.)}&amp;&amp;+0.02may&amp;&amp;+0.01jun&amp;&amp;+0.05aug&amp;&amp;+0.04sep\\&amp;\text{(t)}&amp;&amp;(0.3778)&amp;&amp;(0.1622)&amp;&amp;(1.0867)&amp;&amp;(0.8778)\\&amp;\text{(se)}&amp;&amp;(0.0425)&amp;&amp;(0.0425)&amp;&amp;(0.0425)&amp;&amp;(0.0425)\\&amp;\text{(cont.)}&amp;&amp;+0.08oct&amp;&amp;+0.07nov&amp;&amp;+0.10dec\\&amp;\text{(t)}&amp;&amp;(1.8779)&amp;&amp;(1.6876)&amp;&amp;(2.3376)\\&amp;\text{(se)}&amp;&amp;(0.0425)&amp;&amp;(0.0425)&amp;&amp;(0.0425)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.1644;&amp;&amp; \bar{R^2}=0.0783\\&amp; &amp;&amp; F^{\ast}=1.91;&amp;&amp; p=0.0529\\ \end{alignedat} \end{equation}$$`

---

layout: false
class: inverse, center, middle, duke-softblue
name: piecewise

#4.2.8 分段线性回归模型

---

layout: true
  
&lt;div class="my-header"&gt;&lt;/div&gt;

&lt;div class="my-footer"&gt;&lt;span&gt;huhuaping@   第04章：扩展方法   
&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;
4.2 虚拟变量回归模型
&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;
4.2.8 分段线性回归模型 &lt;/span&gt;&lt;/div&gt; 

---

## 分段线性回归模型

**分段现象**：在经济关系中，当解释变量
`\(X\)`的值达到某一水平/阀值
`\(X^\ast\)`之前，与被解释变量之间存在某种线性关系；当解释变量X的值达到或者超过水平/阀值
`\(X^\ast\)`以后，与被解释变量的关系就会发生变化。因而总体看来，似乎被明显“分段”了。

**分段线性回归模型**（piecewise linear regression）：是指用虚拟变量估计不同水平/阀值的解释变量
`\(X\)`对被解释变量
`\(Y\)`的影响的一类线性回归模型。它是虚拟变量回归模型的一种特定形式及应用。

- 一个阀值的分段线性回归模型：

`$$\begin{align}
Y_i &amp; =\beta_1+\beta_2X_i+\lambda(X_i-X^{\ast})D_i+u_i 
\end{align}$$`

- 两个阀值的分段线性回归模型：

`$$\begin{align}
Y_i &amp; =\beta_1+\beta_2X_i+\lambda_1(X_i-X^{\ast}_1)D1_i+\lambda_2(X_i-X^{\ast}_2)D2_i+u_i 
\end{align}$$`

---

class: center, middle,duke-orange
## 供给和需求分析案例

---

### 数据




<div id="htmlwidget-f6b99dc637b69e3adc8b" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-f6b99dc637b69e3adc8b">{"x":{"filter":"none","caption":"<caption>供给和需求数据 (n=54)<\/caption>","data":[[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54],[1155,362,357,111,703,494,410,63,616,468,973,235,180,69,305,106,155,422,44,1008,225,321,1001,531,143,251,216,57,146,226,169,32,75,102,4,68,102,462,295,196,50,739,287,226,706,127,85,234,153,4,373,54,81,18],[39.3,23.5,22.4,6.1,35.9,35.5,23.2,9.1,27.5,28.6,41.3,16.9,18.2,9,28.6,12.7,11.8,27.9,21.6,45.9,11.4,16.6,40.7,22.4,17.4,14.3,14.6,6.6,10.6,14.3,3.4,5.1,4.1,4.1,1.7,7.5,7.8,22.6,8.6,7.7,7.8,34.7,15.6,18.5,35,16.5,11.3,7.7,14.8,2,12.4,9.2,11.8,3.9]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>obs<\/th>\n      <th>demand<\/th>\n      <th>offer<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"tip","columnDefs":[{"className":"dt-center","targets":"_all"},{"visible":false,"targets":0}],"pageLength":5,"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>

???
案例参考(https://stackoverflow.com/questions/8758646/piecewise-regression-with-r-plotting-the-segments)

---

### 散点图

&lt;img src="part01-slide-04-reg-extention_files/figure-html/unnamed-chunk-123-1.png" style="display: block; margin: auto;" /&gt;


---

### 虚拟变量体系

使用某些特定的方法，我们可以把数据的阀值设置为22.4，并对数据进行虚拟变量变换：

`$$\begin{align}
&amp;level \quad \{a_1: \quad &lt;22.4,a_2: \quad &gt;22.4\} \\
&amp;dummy \Longrightarrow  
  \begin{cases}
    D1  =
    \begin{cases}
    1, &amp; \text{offer &lt; 22.4}\\
    0, &amp; \text{other}
    \end{cases} \\
    D2 = 
    \begin{cases}
    1, &amp; \text{offer &gt; 22.4}\\
    0, &amp; \text{other}
    \end{cases} 
  \end{cases}
\end{align}$$`

---

### 虚拟变量变换

<div id="htmlwidget-56cc3512b1293c57ced5" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-56cc3512b1293c57ced5">{"x":{"filter":"none","caption":"<caption>用offer的阀值22.4来设定虚拟变量系统(n=54)<\/caption>","data":[[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54],[1155,362,357,111,703,494,410,63,616,468,973,235,180,69,305,106,155,422,44,1008,225,321,1001,531,143,251,216,57,146,226,169,32,75,102,4,68,102,462,295,196,50,739,287,226,706,127,85,234,153,4,373,54,81,18],[39.3,23.5,22.4,6.1,35.9,35.5,23.2,9.1,27.5,28.6,41.3,16.9,18.2,9,28.6,12.7,11.8,27.9,21.6,45.9,11.4,16.6,40.7,22.4,17.4,14.3,14.6,6.6,10.6,14.3,3.4,5.1,4.1,4.1,1.7,7.5,7.8,22.6,8.6,7.7,7.8,34.7,15.6,18.5,35,16.5,11.3,7.7,14.8,2,12.4,9.2,11.8,3.9],[0,0,0,1,0,0,0,1,0,0,0,1,1,1,0,1,1,0,1,0,1,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1],[1,1,0,0,1,1,1,0,1,1,1,0,0,0,1,0,0,1,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>obs<\/th>\n      <th>demand<\/th>\n      <th>offer<\/th>\n      <th>D1<\/th>\n      <th>D2<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"tip","columnDefs":[{"className":"dt-center","targets":"_all"},{"visible":false,"targets":0}],"pageLength":8,"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[8,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>


---

### 模型估计

我们以offer=22.4为门阀值，构建如下的分段线性回归模型：

`$$\begin{equation} \begin{alignedat}{999} &amp;demand=&amp;&amp; + \beta_{1} &amp;&amp; + \beta_{2} offer&amp;&amp; + \beta_{3} I(offer - 22.4) \ast D1&amp;&amp;+u_i\\ \end{alignedat} \end{equation}$$`

以上模型的OLS估计结果如下：

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{demand}=&amp;&amp;-434.61&amp;&amp;+33.19offer&amp;&amp;-19.88I(offer - 22.4) \ast D1\\ &amp;\text{(t)}&amp;&amp;(-4.8602)&amp;&amp;(11.1818)&amp;&amp;(-4.0721)\\&amp;\text{(se)}&amp;&amp;(89.4227)&amp;&amp;(2.9685)&amp;&amp;(4.8828)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.8630;&amp;&amp; \bar{R^2}=0.8576\\&amp; &amp;&amp; F^{\ast}=160.60;&amp;&amp; p=0.0000 \end{alignedat} \end{equation}$$`

---

### 回归线

&lt;img src="part01-slide-04-reg-extention_files/figure-html/unnamed-chunk-127-1.png" style="display: block; margin: auto;" /&gt;




---

layout: false
background-image: url("pic/thank-you-gif-funny-little-yellow.gif")
class: inverse,center
# 本章结束
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
