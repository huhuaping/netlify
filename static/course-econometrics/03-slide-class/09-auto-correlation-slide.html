<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>09-auto-correlation-slide.knit</title>
    <meta charset="utf-8" />
    <script src="libs/header-attrs-2.16/header-attrs.js"></script>
    <link href="libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="libs/remark-css-0.0.1/duke-blue.css" rel="stylesheet" />
    <link href="libs/remark-css-0.0.1/hygge-duke.css" rel="stylesheet" />
    <link href="libs/tachyons-4.12.0/tachyons.min.css" rel="stylesheet" />
    <link href="libs/panelset-0.2.6/panelset.css" rel="stylesheet" />
    <script src="libs/panelset-0.2.6/panelset.js"></script>
    <script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
    <link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
    <script src="libs/datatables-binding-0.24/datatables.js"></script>
    <script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
    <link href="libs/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="libs/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="libs/dt-core-1.11.3/js/jquery.dataTables.min.js"></script>
    <link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
    <script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
    <link rel="stylesheet" href="../mycss/my-theme.css" type="text/css" />
    <link rel="stylesheet" href="../mycss/my-font.css" type="text/css" />
    <link rel="stylesheet" href="../mycss/my-custom-for-video-roomy.css" type="text/css" />
    <link rel="stylesheet" href="../mycss/text-box.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">

background-image: url("../pic/slide-front-page.jpg")
class: center,middle

# 计量经济学(Econometrics)

### 胡华平

### 西北农林科技大学

### 经济管理学院数量经济教研室

### huhuaping01@hotmail.com

### 2023-02-15



<div>
<style type="text/css">.xaringan-extra-logo {
width: 110px;
height: 70px;
z-index: 0;
background-image: url(../pic/logo/nwafu-logo-circle-wb.png);
background-size: contain;
background-repeat: no-repeat;
position: absolute;
top:0.2em;left:1em;
}
</style>
<script>(function () {
  let tries = 0
  function addLogo () {
    if (typeof slideshow === 'undefined') {
      tries += 1
      if (tries < 10) {
        setTimeout(addLogo, 100)
      }
    } else {
      document.querySelectorAll('.remark-slide-content:not(.title-slide):not(.inverse):not(.hide_logo)')
        .forEach(function (slide) {
          const logo = document.createElement('div')
          logo.classList = 'xaringan-extra-logo'
          logo.href = null
          slide.appendChild(logo)
        })
    }
  }
  document.addEventListener('DOMContentLoaded', addLogo)
})()</script>
</div>


---
class: center, middle, duke-orange,hide_logo
name: chapter09

# 第9章：放宽基本假设：序列自相关性


[9.1 序列自相关性的定义和来源](#definition)

[9.2 序列自相关性的影响和后果](#effect)

[9.3 序列自相关性问题的诊断](#diagnose)

[9.4 序列自相关性问题的矫正](#adjust)


---
layout: false
class: center, middle, duke-softblue,hide_logo
name: definition

# 9.1 序列自相关性的定义和来源

---
layout: true
  
&lt;div class="my-header-h2"&gt;&lt;/div&gt;
&lt;div class="watermark1"&gt;&lt;/div&gt;
&lt;div class="watermark2"&gt;&lt;/div&gt;
&lt;div class="watermark3"&gt;&lt;/div&gt;

&lt;div class="my-footer"&gt;&lt;span&gt;huhuaping@   &lt;a href="#chapter09"&gt;第09章 放宽基本假设：序列自相关性&lt;/a&gt;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;
&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;
&lt;a href="#definition"&gt;9.1 序列自相关性的定义和来源&lt;/a&gt; &lt;/span&gt;&lt;/div&gt; 

---

## 自相关的概念与内涵

**滞后变量**（lag variable）：对某个时间序列变量进行**滞后变换**后得到的新变量。

例如对时间序列变量
`\(Z_{2,t} \quad (t \in 1,2,\cdots, T)\)`进行滞后变换可以得到多个**滞后变量**：
`\(Z_{2,t-1};Z_{2,t-2};\cdots;Z_{2,t-p};\cdots ; Z_{2,t-(T-1)}\)`。

---

## 自相关的概念与内涵

**时间序列数据**的两种相关关系：

- **序列相关**（serial correlation）：两个不同时间序列变量之间（或/及它们的滞后变量之间）
的（线性）相关关系。

`$$\begin{align}
&amp; cor(Z_{2,t},Z_{3,t})\\
&amp; cor(Z_{2,t},Z_{3,t-1}); \quad \cdots; \quad cor(Z_{2,t},Z_{3,t-p}). \quad p \in 1,2,\cdots, T-1 \\
&amp; cor(Z_{2,t-1},Z_{3,t}); \quad \cdots; \quad cor(Z_{2,t-p},Z_{3,t}). \quad p \in 1,2,\cdots, T-1
\end{align}$$`

- **自相关**（autocorrelation）：某个时间序列变量与其自身滞后变量的（线性）相关关系。

`$$\begin{align}
&amp; cor(Z_{2,t},Z_{2,t-1}); \quad cor(Z_{2,t},Z_{2,t-2}); \quad \cdots; \quad cor(Z_{2,t},Z_{2,t-p}). \quad p \in 1,2,\cdots, T-1 
\end{align}$$`

---

## 自相关的概念与内涵

k变量总体回归模型(PRM)

`$$\begin {align} 
Y_{t}=\beta_{1}+\beta_{2} X_{2t}+\beta_{3} X_{3t}+ \cdots +\beta_{k} X_{kt}+u_{t} 
\end {align}$$`

**经典线性回归模型假定**（CLRM）在随机干扰项
`\(u_i\)`之间不存在**自相关**，也即：

`$$\begin{align}
E(u_tu_{t-p}) &amp;=0;\quad p \in 1,2,\cdots, T-1
\end{align}$$`

如果随机干扰项
`\(u_i\)`出现自相关时，则意味着**违背**了CLRM假设（其他假设仍旧成立）：

`$$\begin{align}
E(u_tu_{t-p}) &amp; \neq 0;\quad p \in 1,2,\cdots, T-1
\end{align}$$`

---

## 自相关的概念与内涵（模拟演示）

随机干扰项
`\(u_t\)`的几种自相关模式和非自相关模式可以表示为：

&lt;img src="../pic/chpt9-correlation-demo1.png" width="770" style="display: block; margin: auto;" /&gt;

---

## 产生自相关的原因1

**产生自相关的原因1**：**时间惯性**的普遍存在。大多数经济时间序列变量都有**时间惯性**。


- GNP、价格指数、生产、就业和失业等时间序列变量都呈现出商业循环。


---

## 产生自相关的原因2

**产生自相关的原因2-1**：**模型设定偏误**——应含而未含某些重要变量（excluded variables）
。

- 以牛肉需求模型为例。其中：
`\(Y_t\)`表示牛肉需求量；
`\(X_{2t}\)`表示牛肉价格；
`\(X_{3t}\)`表示消费者收入；
`\(X_{4t}\)`表示猪肉价格。

`$$\begin {align} 
Y_{t}=\beta_{1}+\beta_{2} X_{2t}+\beta_{3} X_{3t}+ \beta_{4} X_{4t}+u_{t} 
\end {align}$$`

- 如果我们把上述模型做成如下情形，在**猪肉价格**影响**牛肉消费**的情形下，新模型的残差
`\(v_t\)`将表现出某种系统的模式。也即模型出现了错误设定，导致随机干扰项不满足CLRM假设。

`$$\begin {align} 
Y_{t}=\alpha_{1}+\alpha_{2} X_{2t}+\alpha_{3} X_{3t}+v_{t} 
\end {align}$$`

---

## 产生自相关的原因2

**产生自相关的原因2-2**：**模型设定偏误**——不正确的函数形式。

.pull-left[
- 以企业边际成本-产出模型为例。如果“真实”的边际成本决定模型为：

`$$\begin {align} 
Cost_{t}=\beta_{1}+\beta_{2} Output_t+\beta_{3} Output_t^2+u_{t} 
\end {align}$$`

]

.pull-right[

- 如果我们把上述模型做成如下情形（模型错误设定），由于模型函数形式的错误使用，残差
`\(v_t\)`将反映出自相关性质（因为
`\(v_t = \beta_3Output_t^2 +u_t\)`）。

`$$\begin {align} 
Cost_{t} &amp; =\alpha_{1}+\alpha_{2} Output_t+v_{t} 
\end {align}$$`

]

&lt;img src="../pic/chpt9-correlation-source-2.png" width="332" style="display: block; margin: auto;" /&gt;


---

## 产生自相关的原因3

**产生自相关的原因3**：蛛网现象（Cobweb phenomenon）的存在。

- 以农产品供给模型为例。如果在
当期（t期）价格
`\(P_t\)`的低于前一期（t-1期）价格
`\(P_{t-1}\)`，那么在**未来1期**（t+1期），农户将会决定生产更少的农产品。如此往复决策，将会使得形成蛛网生产和价格模式。

`$$\begin {align} 
Supply_{t} &amp; =\beta_{1}+\beta_{2} P_{t-1}+u_{t} 
\end {align}$$`


---

## 产生自相关的原因4

**产生自相关的原因4**：**滞后效应**的普遍存在。

- 以消费支出模型为例。当期消费（t期）还会受到前期（t-1期）消费水平的影响。这种带有因变量的滞后变量
`\(Consumption_{t-1}\)`的回归也叫**自回归**（auto-regression）。


`$$\begin {align} 
Consumption_{t}=\beta_{1}+\beta_{2} Income_t+\beta_3 Consumption_{t-1}+u_{t}
\end {align}$$`


---

## 产生自相关的原因5

**产生自相关的原因5**：数据的**“编造”**。

-从月度数据计算得出季度数据，会减小波动，引进匀滑作用，使扰动项出现系统性模式

- 数据的内插（interpolation）：人口普查10年一次

- 数据的外推（extrapolation）

---

## 产生自相关的原因6

**产生自相关的原因6**：数据的**“变换”**。

- 例如，有时候我们可以构造如下的**一阶差分模型**，这类模型也被称为**动态回归模型**（Dynamic regression）。

`$$\begin {align} 
Y_{t} &amp;=\beta_{1}+\beta_{2} X_{t}+u_{t}\\
Y_{t-1} &amp;=\beta_{1}+\beta_{2} X_{t-1}+u_{t-1}\\
\Delta Y_{t} &amp;=\beta_{2} \Delta X_{t}+\Delta u_{t} \\
\Delta Y_{t} &amp;=\beta_{2} \Delta X_{t}+v_{t}
\end {align}$$`

- 如果
`\(Y_t\)`和
`\(X_t\)`都是已经经过了对数化处理，则一阶差分变换后的模型中随机干扰项
`\(v_t\)`将会出现自相关模式。


---

## 产生自相关的原因7

**产生自相关的原因7**：时间序列**非平稳性**的广泛存在。

`$$\begin {align} 
Y_{t} &amp;=\beta_{1}+\beta_{2} X_{t}+u_{t}
\end {align}$$`

- 因变量
`\(Y_t\)`和自变量
`\(X_t\)`很可能都是非平稳的。因此随机干扰项
`\(u_t\)`也是非平稳的。此时，随机干扰项将表现出自相关。

---

## 自相关的几种模式：视角1

**直接观察视角**：我们可以从随机干扰项
`\(u_t\)`与其滞后变量
`\(u_{t-1},u_{t-2},\cdots, u_{t-p},\cdots, u_{t-(T-1)}\)`的散点图来观察自相关模式（比较容易理解）。

&lt;img src="../pic/chpt9-correlation-demo2.png" width="450" style="display: block; margin: auto;" /&gt;

???

“幸福的家庭大抵类似，不幸的家庭各不相同!”——列夫托尔斯泰

“随机干扰项不相关只有一种情形（理想状态），而自相关则可以有各种千奇百怪的情形（普遍现实）”。




---

## 自相关的几种模式：视角2

**间接观察视角**：我们可以从随机干扰项
`\(u_t\)`随时间t的散点图变化来观察自相关模式（不太好理解）。

&lt;img src="../pic/chpt9-correlation-demo1.png" width="770" style="display: block; margin: auto;" /&gt;

???

“幸福的家庭大抵类似，不幸的家庭各不相同!”——列夫托尔斯泰

“随机干扰项不相关只有一种情形（理想状态），而自相关则可以有各种千奇百怪的情形（普遍现实）”。


---
layout: false
class: center, middle, duke-softblue,hide_logo
name: effect

# 9.2 序列自相关性的影响和后果

---
layout: true
  
&lt;div class="my-header-h2"&gt;&lt;/div&gt;
&lt;div class="watermark1"&gt;&lt;/div&gt;
&lt;div class="watermark2"&gt;&lt;/div&gt;
&lt;div class="watermark3"&gt;&lt;/div&gt;

&lt;div class="my-footer"&gt;&lt;span&gt;huhuaping@   &lt;a href="#chapter09"&gt;第09章 放宽基本假设：序列自相关性&lt;/a&gt;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;
&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;
 &lt;a href="#effect"&gt;9.2 序列自相关性的影响和后果 &lt;/a&gt;&lt;/span&gt;&lt;/div&gt; 

---

## 马尔可夫1阶自回归

下面给出自相关情形为**马尔可夫1阶自回归模式**：

`$$\begin{aligned} 
Y_{t} &amp;=\beta_{1}+\beta_{2} X_{t}+u_{t} \\ 
u_{t} &amp;=\rho u_{t-1}+\varepsilon_{t}  &amp;&amp; \leftarrow \left[-1 &lt;\rho&lt;1 \right]
\end{aligned}$$`

其中：

- 
`\(\rho\)`被称为自协方差系数(coefficient of autocovariance)

`$$\begin{aligned} 
\rho &amp;=\frac{E\left[\left(u_{t}-E\left(u_{t}\right)\right)\left(u_{t-1}-E\left(u_{t-1}\right)\right)\right]} {\sqrt{\operatorname{var}\left(u_{t}\right)} \sqrt{\operatorname{var}\left(u_{t-1}\right)}}  =\frac{E\left(u_{t} u_{t-1}\right)}{\operatorname{var}\left(u_{t-1}\right)} \end{aligned}$$`


- 
`\(\varepsilon_t\)`是满足以下标准CLRM假定的随机干扰项。此时
`\(\varepsilon_t\)`也被成为**白噪声**误差项(white noise error Term)。

`$$\begin {align} 
E\left(\varepsilon_{t}\right) &amp;=0 \\ var\left(\varepsilon_{t}\right) &amp;=\sigma^{2} \\ 
cov\left(\varepsilon_{t}, \varepsilon_{t+s}\right) &amp;=0； \quad s \neq 0
\end {align}$$`

---

## 出现自相关性时的态度1

**态度1**：忽视自相关性，坚持错误地使用CLRM假设下OLS方法的各种公式。

`$$\begin{aligned} 
Y_{t} &amp;=\beta_{1}+\beta_{2} X_{t}+u_{t} \\ 
u_{t} &amp;=\rho u_{t-1}+\varepsilon_{t}  &amp;&amp; \leftarrow \left[-1 &lt;\rho&lt;1 \right]
\end{aligned}$$`

在**自相关性**存在的情形下（马尔科夫1阶自相关），却坚持使用OLS方法下的方差公式：

`$$\begin {align} 
\hat{\beta}_{2} \parallel_{OLS}^{CLRM} 
=\frac{\sum x_{t} y_{t}}{\sum x_{t}^{2}}
=\frac{n \sum X_{t} Y_{t}-\sum X_{t} \sum Y_{t}}{n \sum X_{t}^{2}-\left(\sum X_{t}\right)^{2}}
\end {align}$$`

`$$\begin {align} 
\operatorname{var}\left(\hat{\beta}_{2}\right) \parallel_{OLS}^{CLRM} 
=\frac{\sigma^{2}}{\sum x_{t}^{2}}
\end {align}$$`

- 坚持使用的方差公式
`\(\operatorname{var}\left(\hat{\beta}_{2}\right) \parallel_{OLS}^{CLRM}\)`是有偏的，可能高估或低估其真实方差
`\(\operatorname{var}\left(\hat{\beta}_{2}\right)\)`。
- 坚持使用回归误差方差公式
`\(\hat{\sigma}^{2} \parallel_{OLS}^{CLRM}=\frac{\sum \mathrm{e}_{i}^{2}}{n-2}\)`，并不是真值
`\(\sigma^2\)`的**无偏估计量**。
- 进一步地，置信区间、t检验和F检验也将不准确。


---

## 出现自相关性时的态度2

**态度2**：承认“**自相关性**”这一事实，但仍旧使用OLS方法。

`$$\begin{aligned} 
Y_{t} &amp;=\beta_{1}+\beta_{2} X_{t}+u_{t} \\ 
u_{t} &amp;=\rho u_{t-1}+\varepsilon_{t}  &amp;&amp; \leftarrow \left[-1 &lt;\rho&lt;1 \right]
\end{aligned}$$`

在**自相关性**存在的情形下（马尔科夫1阶自相关），仍旧使用OLS方法，得到估计量及其方差的**“新公式”**（细节见下一页slide）：

`$$\begin {align} 
\hat{\beta}_{2} \parallel_{OLS}^{AR1} 
=\frac{\sum x_{t} y_{t}}{\sum x_{t}^{2}}
=\frac{n \sum X_{t} Y_{t}-\sum X_{t} \sum Y_{t}}{n \sum X_{t}^{2}-\left(\sum X_{t}\right)^{2}}
\end {align}$$`

`$$\begin {align} 
\operatorname{var}\left(\hat{\beta}_{2}\right) \parallel_{OLS}^{AR1} =\frac{\sigma^{2}}{\sum x_{t}^{2}} \frac{1+r \rho}{1-r \rho }= {var}\left(\hat{\beta}_{2}\right) \parallel_{OLS}^{CLRM} \cdot \frac{1+r \rho}{1-r \rho }
\end {align}$$`


- 系数估计量仍是**一致的**；方差公式是**有偏的**，可能高估或低估其真实方差
`\(\operatorname{var}\left(\hat{\beta}_{2}\right)\)`。

- 请验证
`\(r=0.6,\rho=0.8\)`时，二者的大小关系？


---

### 附录：方差计算细节

给定马尔科夫1阶自相关情形（AR(1)）：

`$$\begin{aligned} 
Y_{t} &amp;=\beta_{1}+\beta_{2} X_{t}+u_{t} \\ 
u_{t} &amp;=\rho u_{t-1}+\varepsilon_{t}  &amp;&amp; \leftarrow \left[-1 &lt;\rho&lt;1 \right]
\end{aligned}$$`

`$$\begin{aligned} 
\operatorname{var}\left(u_{t}\right) &amp;=E\left(u_{t}^{2}\right)=\frac{\sigma_{\varepsilon}^{2}}{1-\rho^{2}} \\ 
\operatorname{cov}\left(u_{t}, u_{t-s}\right) &amp;=\operatorname{cov}\left(u_{t}, u_{t+s}\right)=E\left(u_{t} u_{t-s}\right)=\rho^{s} \frac{\sigma_{\varepsilon}^{2}}{1-\rho^{2}} \\
\operatorname{cor}\left(u_{t}, u_{t-s}\right) &amp;=\operatorname{cor}\left(u_{t}, u_{t+s}\right)=\rho^{s}
\end{aligned}$$`

---

### 附录：方差计算细节

`$$\begin {align} 
\operatorname{var}\left(\hat{\beta}_{2}\right)^{AR1}_{OLS}
&amp;=\frac{\sigma^{2}}{\sum x_{t}^{2}}\left[1+2 \rho \frac{\sum x_{t} x_{t-1}}{\sum x_{t}^{2}}+2 \rho^{2} \frac{\sum x_{t} x_{t-2}}{\sum x_{t}^{2}}+\cdots+2 \rho^{n-1} \frac{x_{1} x_{n}}{\sum x_{t}^{2}}\right] \\
&amp;=\frac{\sigma^{2}}{\sum x_{t}^{2}} \frac{1+r \rho}{1-r \rho } \quad \quad \leftarrow \left[ if \quad X_t=rX_{t-1}+v_t \right]
\end {align}$$`

- 若
`\(\rho=1\)`，上述方差和协方差将不能定义；

- 若
`\(|\rho|&lt; 1\)`，
`\(u_t\)`的均值、方差和协方差都不随时间而变化。AR(1)过程被称为是**平稳的**。此时，协方差的值将随着两个误差的时间间隔越远而越小。

&lt;!--- 假设
`\(X_t\)`服从自相关系数为
`\(r\)`的一阶自回归模式
`\(X_t=rX_{t-1}+v_t\)`，则方差公式可以进一步化简为：
---&gt;

---

## 出现自相关性时的态度3

**态度3**：在**自相关性**存在的情形下，首先想办法消除自相关性，再使用OLS方法。**广义最小二乘法**（GLS）下（如**广义差分方程法**），估计量及其方差公式最终为写成：

`$$\begin {align} 
\hat{\beta}_{2} \parallel_{\mathrm{GLS}}^{AR1} 
&amp; =\frac{\sum_{t=2}^{n}\left(x_{t}-\rho x_{t-1}\right)\left(y_{t}-\rho y_{t-1}\right)}{\sum_{t=2}^{n}\left(x_{t}-\rho x_{t-1}\right)^{2}}+C 
&amp;&amp; \leftarrow \left[ \text{C is a correction factor} \right]
\end {align}$$`

`$$\begin {align} 
\operatorname{var} (\hat{\beta}_{2})_{\mathrm{GLS}}^{AR1}
&amp; =\frac{\sigma^{2}}{\sum_{t=2}^{n}\left(x_{t}-\rho x_{t-1}\right)^{2}}+D 
&amp;&amp; \leftarrow \left[ \text{D is a correction factor} \right]
\end {align}$$`


- 系数估计量是一致的

- 方差公式是无偏的，其期望将等于真实方差
`\(\operatorname{var}\left(\hat{\beta}_{2}\right)\)`。

- 此时，GLS得到的才是**BLUE**！（证明过程略）

???


&gt; 提示：GLS中我们通过变量变换把额外的信息（异方差性或**自相关性**）包括到估计程序中去，而在OLS 中我们并不直接考虑这种附加信息。



---

## 出现自相关性时的态度：总结

- **态度1**：“把头埋进沙堆的鸵鸟”

`$$\begin {align} 
\operatorname{var}\left(\hat{\beta}_{2}\right) \parallel_{OLS}^{CLRM} 
=\frac{\sigma^{2}}{\sum x_{t}^{2}}
\end {align}$$`

- **态度2**：“将错就错地走下去”

`$$\begin {align} 
\operatorname{var}\left(\hat{\beta}_{2}\right) \parallel_{OLS}^{AR1} =\frac{\sigma^{2}}{\sum x_{t}^{2}} \frac{1+r \rho}{1-r \rho }= {var}\left(\hat{\beta}_{2}\right) \parallel_{OLS}^{CLRM} \cdot \frac{1+r \rho}{1-r \rho }
\end {align}$$`

- **态度3**：“直面困难找出路”

`$$\begin {align} 
\operatorname{var} (\hat{\beta}_{2})_{\mathrm{GLS}}^{AR1}
&amp; =\frac{\sigma^{2}}{\sum_{t=2}^{n}\left(x_{t}-\rho x_{t-1}\right)^{2}}+D 
&amp;&amp; \leftarrow \left[ \text{D is a correction factor} \right]
\end {align}$$`

---

## 出现自相关时使用OLS 的后果

在自相关出现时，OLS 估计量仍是线性的、无偏的和一致性的，但不再是有效的（亦即最小方差）。那么，如果我们继续使用OLS估计量，我们平常的假设检验程序会遇到什么问题呢?主要有：

- 参数估计不再是有效估计量(亦即不再是方差最小)

- 参数的显著性检验失去意义

- 模型的预测失效

下面分两种情形来讨论其后果：

- **态度1**：忽视自相关，采用OLS估计

- **态度2**：考虑自相关，采用OLS估计

---

## 出现自相关时使用OLS 的后果（态度1和态度2）

对于**态度1**和**态度2**，执意采用OLS估计，将会：残差方差可能低估真实方差；高估可决系数；或低估考虑一阶自回归的方差；检验无效，得出错误的结论。

`$$\begin{aligned} 
Y_{t} &amp;=\beta_{1}+\beta_{2} X_{t}+u_{t} \\ 
u_{t} &amp;=\rho u_{t-1}+\varepsilon_{t}  &amp;&amp; \leftarrow \left[-1 &lt;\rho&lt;1 \right]
\end{aligned}$$`

.pull-left[
CLRM条件下采用OLS估计：

`$$\begin {align} 
\hat{\beta}_{2} \parallel_{OLS}^{CLRM} 
&amp; = \frac{\sum x_{t} y_{t}}{\sum x_{t}^{2}}\\
\operatorname{var}\left(\hat{\beta}_{2}\right) \parallel_{OLS}^{CLRM} 
&amp; = \frac{\sigma^{2}}{\sum x_{t}^{2}}\\
\hat{\sigma}^{2} \parallel_{OLS}^{CLRM}
&amp; = \frac{\sum \mathrm{e}_{i}^{2}}{n-2} \\
\quad E \left( \hat{\sigma}^2\parallel_{OLS}^{CLRM} \right) &amp;=\sigma^2
\end {align}$$`


]


.pull-right[
AR(1)情形下使用OLS估计：

`$$\begin {align} 
\hat{\beta}_{2} \parallel_{OLS}^{AR1} 
&amp; = \frac{\sum x_{t} y_{t}}{\sum x_{t}^{2}} \\
\operatorname{var}\left(\hat{\beta}_{2}\right) \parallel_{OLS}^{AR1}  &amp;=\frac{\sigma^{2}}{\sum x_{t}^{2}} \frac{1+r \rho}{1-r \rho } \\
\hat{\sigma}^{2} \parallel_{OLS}^{AR1} 
&amp; =\frac{\sigma^{2}\left\{n-\left[\frac{2}{(1-\rho)}-2 \rho r\right]\right\}}{n-2} \\
\quad E\left( \hat{\sigma}^{2} \parallel_{OLS}^{AR1}  \right) &amp;&lt; \sigma^{2}
\end {align}$$`

]

---

## 出现自相关时使用OLS 的后果

实际经济分析中，**正自相关性**一般更为普遍，也即
`\((0 &lt; \rho &lt; 1; 0&lt; r &lt;1)\)`。此时：

`$$\begin {align} 
\operatorname{var}\left(\hat{\beta}_{2}\right) \parallel_{OLS}^{AR1} &amp;=\frac{\sigma^{2}}{\sum x_{t}^{2}} \frac{1+r \rho}{1-r \rho }= {var}\left(\hat{\beta}_{2}\right) \parallel_{OLS}^{CLRM} \cdot \frac{1+r \rho}{1-r \rho } \\
\operatorname{var}\left(\hat{\beta}_{2}\right) \parallel_{OLS}^{AR1}
&amp; &gt; {var}\left(\hat{\beta}_{2}\right) \parallel_{OLS}^{CLRM}
\quad  \quad  \leftarrow \left[ \text{if} \quad 0 &lt; \rho &lt; 1; 0&lt; r &lt;1 \right]
\end {align}$$`

---

## 出现自相关时使用OLS 的后果

事实上，在AR(1)情形下采用广义最小二乘法（GLS）才能得到**BLUE**，也即意味着：

`$$\begin {align} 
{var}\left(\hat{\beta}_{2}\right) \parallel_{OLS}^{AR1} &gt; {var}\left(\hat{\beta}_{2}\right) \parallel_{OLS}^{CLRM} &gt; {var}\left(\hat{\beta}_{2}\right) \parallel_{GLS}^{AR1}
\end {align}$$`

同时，也将意味着GLS方法下**斜率系数**的置信区间也将**更窄**：

.pull-left[

&lt;img src="../pic/chpt9-autocorrelation-effect-confidence.png" width="460" style="display: block; margin: auto;" /&gt;

]

---

## 出现自相关时使用OLS 的后果

- 如果一个对斜率参数
`\(\beta_2\)`的点估计值为
`\(b_2\)`，并给定显著性水平为
`\(\alpha=0.05\)`

- 有可能在OLS方法下，95%置信区间检验**不显著**（接受原假设
`\(H_0\)`）；但是在GLS方法下，95%置信区间检验却可以是**显著**的（拒绝原假设
`\(H_0\)`，接受备择假设
`\(H_1\)`）


**启示**：尽管OLS 估计量是无偏的和一致性的，但为了构造置信区间并检验假设，要用GLS而不用OLS！

---

### 蒙特卡洛模拟（数据生成1）



给定如下模拟情景，我们可以生产**存在自相关情形**AR(1)的模拟数据表（观测数
`\(T=\)` 9）：

`$$\begin{aligned} 
Y_{t} &amp;=1 +0.8 X_{t}+u_{t} \\ 
u_{t} &amp;=0.7 u_{t-1}+\varepsilon_{t}  &amp;&amp; \leftarrow \left[ u_0=5 \right]\\
\varepsilon_t &amp; \sim N(0,1) &amp;&amp; \leftarrow \left[ \varepsilon_0=0 \right]
\end{aligned}$$`

---

### 蒙特卡洛模拟（数据生成1）

<div id="htmlwidget-21dc44474b3e8cd160f8" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-21dc44474b3e8cd160f8">{"x":{"filter":"none","vertical":false,"data":[[0,1,2,3,4,5,6,7,8,9],[0,-0.560475646552213,-0.23017748948328,1.55870831414912,0.070508391424576,0.129287735160946,1.71506498688328,0.460916205989202,-1.26506123460653,-0.686852851893526],[5,2.93952435344779,1.82748955793017,2.83795100470024,2.05707409471475,1.56923960146127,2.81353270790617,2.43038910152352,0.43621113645993,-0.381505056371575],[null,1,2,3,4,5,6,7,8,9],[null,4.73952435344779,4.42748955793017,6.23795100470024,6.25707409471475,6.56923960146127,8.61353270790617,9.03038910152352,7.83621113645993,7.81849494362842],[null,0.8,0.64,0.512,0.4096,0.32768,0.262144,0.2097152,0.16777216,0.134217728],[null,0.239524353447787,1.36982251051672,3.95870831414912,3.27050839142458,4.12928773516095,6.51506498688328,6.0609162059892,5.13493876539347,6.51314714810647]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>时期t<\/th>\n      <th>\\( \\epsilon_t \\)<\/th>\n      <th>\\( u_t\\)<\/th>\n      <th>\\( X_t \\)<\/th>\n      <th>\\( Y_t\\)<\/th>\n      <th>\\( E(Y|X_t) \\)<\/th>\n      <th>\\( Y_t^* \\)<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"tip","columnDefs":[{"targets":1,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 4, 3, \",\", \".\", null);\n  }"},{"targets":2,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 4, 3, \",\", \".\", null);\n  }"},{"targets":4,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 4, 3, \",\", \".\", null);\n  }"},{"targets":5,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 4, 3, \",\", \".\", null);\n  }"},{"targets":6,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 4, 3, \",\", \".\", null);\n  }"},{"className":"dt-center","targets":"_all"},{"visible":false,"targets":0}],"pageLength":6,"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[6,10,25,50,100]}},"evals":["options.columnDefs.0.render","options.columnDefs.1.render","options.columnDefs.2.render","options.columnDefs.3.render","options.columnDefs.4.render"],"jsHooks":[]}</script>

---

### 蒙特卡洛模拟（随机干扰项模式1）

**存在自相关情形**AR(1)的模拟数据，随机干扰项
`\(u_t\)`的分布模式如下：

&lt;img src="09-auto-correlation-slide_files/figure-html/unnamed-chunk-8-1.png" style="display: block; margin: auto;" /&gt;


---

### 蒙特卡洛模拟（回归分析1）

对以上存在AR(1)的**模拟数据**，我们构建如下的回归模型，并坚持采用OLS方法得到估计结果：

`$$\begin{equation} \begin{alignedat}{999} &amp;Y_t=&amp;&amp; + \beta_{1} &amp;&amp; + \beta_{2} X_{t}&amp;&amp;+u_t\\ \end{alignedat} \end{equation}$$`

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{Y_t}=&amp;&amp;+4.30&amp;&amp;+0.51X_{t}\\ &amp;\text{(t)}&amp;&amp;(6.7249)&amp;&amp;(4.4750)\\&amp;\text{(se)}&amp;&amp;(0.6389)&amp;&amp;(0.1135)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.7410;&amp;&amp; \bar{R^2}=0.7040\\&amp; &amp;&amp; F^{\ast}=20.03;&amp;&amp; p=0.0029 \end{alignedat} \end{equation}$$`


---

### 蒙特卡洛模拟（回归线1）

对OLS方法下的**样本回归线（SRL1）**绘图，并与**真实的**总体回归线（PRL）进行对比：

&lt;img src="09-auto-correlation-slide_files/figure-html/unnamed-chunk-11-1.png" style="display: block; margin: auto;" /&gt;

`$$\begin{aligned} 
E(Y|X_{t}) &amp;=1 +0.8 X_{t} &amp;&amp; (PRL/PRF) 
\end{aligned}$$`

---

### 蒙特卡洛模拟（数据生成2）

如果我们使用**符合CLRM假设**的模拟数据
`\((Y_t^*, X_t)\)`，其中：

`$$\begin{aligned} 
Y_{t}^* &amp;=1 +0.8 X_{t}+\varepsilon_{t} \\
\varepsilon_t &amp; \sim N(0,1) &amp;&amp; \leftarrow \left[ \varepsilon_0=0 \right]
\end{aligned}$$`


<div id="htmlwidget-5a982514ce28ae593bde" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-5a982514ce28ae593bde">{"x":{"filter":"none","vertical":false,"data":[[0,1,2,3,4,5,6,7,8,9],[0,-0.560475646552213,-0.23017748948328,1.55870831414912,0.070508391424576,0.129287735160946,1.71506498688328,0.460916205989202,-1.26506123460653,-0.686852851893526],[5,2.93952435344779,1.82748955793017,2.83795100470024,2.05707409471475,1.56923960146127,2.81353270790617,2.43038910152352,0.43621113645993,-0.381505056371575],[null,1,2,3,4,5,6,7,8,9],[null,4.73952435344779,4.42748955793017,6.23795100470024,6.25707409471475,6.56923960146127,8.61353270790617,9.03038910152352,7.83621113645993,7.81849494362842],[null,0.8,0.64,0.512,0.4096,0.32768,0.262144,0.2097152,0.16777216,0.134217728],[null,0.239524353447787,1.36982251051672,3.95870831414912,3.27050839142458,4.12928773516095,6.51506498688328,6.0609162059892,5.13493876539347,6.51314714810647]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>时期t<\/th>\n      <th>\\( \\epsilon_t \\)<\/th>\n      <th>\\( u_t\\)<\/th>\n      <th>\\( X_t \\)<\/th>\n      <th>\\( Y_t\\)<\/th>\n      <th>\\( E(Y|X_t) \\)<\/th>\n      <th>\\( Y_t^* \\)<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"tip","columnDefs":[{"targets":1,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 4, 3, \",\", \".\", null);\n  }"},{"targets":2,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 4, 3, \",\", \".\", null);\n  }"},{"targets":4,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 4, 3, \",\", \".\", null);\n  }"},{"targets":5,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 4, 3, \",\", \".\", null);\n  }"},{"targets":6,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 4, 3, \",\", \".\", null);\n  }"},{"className":"dt-center","targets":"_all"},{"visible":false,"targets":0}],"pageLength":6,"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[6,10,25,50,100]}},"evals":["options.columnDefs.0.render","options.columnDefs.1.render","options.columnDefs.2.render","options.columnDefs.3.render","options.columnDefs.4.render"],"jsHooks":[]}</script>

---

### 蒙特卡洛模拟（随机干扰项模式2）

**符合CLRM假设**的模拟数据，随机干扰项
`\(\varepsilon_t\)`的分布模式如下：

&lt;img src="09-auto-correlation-slide_files/figure-html/unnamed-chunk-13-1.png" style="display: block; margin: auto;" /&gt;

---

### 蒙特卡洛模拟（回归分析2）

对以上**符合CLRM假设**模拟数据，我们构建如下的回归模型，并采用OLS方法得到估计结果：

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{NewY_t}=&amp;&amp;+0.48&amp;&amp;+0.73X_{t}\\ &amp;\text{(t)}&amp;&amp;(0.6331)&amp;&amp;(5.4323)\\&amp;\text{(se)}&amp;&amp;(0.7569)&amp;&amp;(0.1345)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.8083;&amp;&amp; \bar{R^2}=0.7809\\&amp; &amp;&amp; F^{\ast}=29.51;&amp;&amp; p=0.0010 \end{alignedat} \end{equation}$$`

.footnote[ 注意：此处的
`\(\widehat{NewY_t}\)`表示
`\(\hat{Y}_t^*\)`]

---

### 蒙特卡洛模拟（回归线2）

对OLS方法下的**样本回归线（SRL2）**绘图，并与**真实的**总体回归线（PRL）进行对比：

&lt;img src="09-auto-correlation-slide_files/figure-html/unnamed-chunk-15-1.png" style="display: block; margin: auto;" /&gt;

`$$\begin{aligned} 
E(Y|X_{t}) &amp;=1 +0.8 X_{t} &amp;&amp; (PRL/PRF) 
\end{aligned}$$`

---

## 工资与生产率案例



&lt;div class="figure" style="text-align: center"&gt;
<div id="htmlwidget-0f735d05eac75555269e" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-0f735d05eac75555269e">{"x":{"filter":"none","vertical":false,"data":[["1960","1961","1962","1963","1964","1965","1966","1967","1968","1969","1970","1971","1972","1973","1974","1975","1976","1977","1978","1979","1980","1981","1982","1983","1984","1985","1986","1987","1988","1989","1990","1991","1992","1993","1994","1995","1996","1997","1998","1999","2000","2001","2002","2003","2004","2005"],[60.8,62.5,64.6,66.1,67.7,69.1,71.7,73.5,76.2,77.3,78.8,80.2,82.6,84.3,83.3,84.1,86.4,87.6,89.1,89.3,89.1,89.3,90.4,90.3,90.7,92,94.9,95.2,96.5,95,96.2,97.4,100,99.7,99,98.7,99.4,100.5,105.2,108,112,113.5,115.7,117.7,119,120.2],[48.9,50.6,52.9,55,56.8,58.8,61.2,62.5,64.7,65,66.3,69,71.2,73.4,72.3,74.8,77.1,78.5,79.3,79.3,79.2,80.8,80.1,83,85.2,87.1,89.7,90.1,91.5,92.4,94.4,95.9,100,100.4,101.3,101.5,104.5,106.5,109.5,112.8,116.1,119.1,124,128.7,132.7,135.7]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>年份Year<\/th>\n      <th>\\( Y_t\\)<\/th>\n      <th>\\( X_t \\)<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"tip","columnDefs":[{"className":"dt-center","targets":"_all"},{"visible":false,"targets":0}],"pageLength":8,"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[8,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
&lt;p class="caption"&gt;1960-2005年间美国商业部门工资与生产率数据(T= 46 )&lt;/p&gt;
&lt;/div&gt;

- 
`\(Y_t\)`表示时均真实工资指数；

- 
`\(X_t\)`表示生产效率指数

---

### 散点图

&lt;img src="09-auto-correlation-slide_files/figure-html/unnamed-chunk-18-1.png" style="display: block; margin: auto;" /&gt;

---

### 回归分析

对以上数据，我们可以分别构建如下的**经典线性回归模型**和**双对数模型**，并坚持采用OLS方法得到估计结果：

.pull-left[

`$$\begin{equation} \begin{alignedat}{999} &amp;Y_t=&amp;&amp; + \beta_{1} &amp;&amp; + \beta_{2} X_{t}&amp;&amp;+u_t\\ \end{alignedat} \end{equation}$$`

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{Y_t}=&amp;&amp;+4.30&amp;&amp;+0.51X_{t}\\ &amp;\text{(t)}&amp;&amp;(6.7249)&amp;&amp;(4.4750)\\&amp;\text{(se)}&amp;&amp;(0.6389)&amp;&amp;(0.1135)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.7410;&amp;&amp; \bar{R^2}=0.7040\\&amp; &amp;&amp; F^{\ast}=20.03;&amp;&amp; p=0.0029 \end{alignedat} \end{equation}$$`

]

.pull-right[

`$$\begin{equation} \begin{alignedat}{999} &amp;log(Y_t)=&amp;&amp; + \beta_{1} &amp;&amp; + \beta_{2} log(X_{t)}&amp;&amp;+u_t\\ \end{alignedat} \end{equation}$$`

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{log(Y_t)}=&amp;&amp;+1.45&amp;&amp;+0.31log(X_{t)}\\ &amp;\text{(t)}&amp;&amp;(15.6171)&amp;&amp;(5.2716)\\&amp;\text{(se)}&amp;&amp;(0.0930)&amp;&amp;(0.0590)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.7988;&amp;&amp; \bar{R^2}=0.7700\\&amp; &amp;&amp; F^{\ast}=27.79;&amp;&amp; p=0.0012 \end{alignedat} \end{equation}$$`

]

思考：

- 我们的数据是否受到自相关问题的困扰？

- 我们如何发现自相关问题并加以纠正?


---

layout: false
class: center, middle, duke-softblue,hide_logo
name: diagnose

# 9.3 序列自相关性问题的诊断

---
layout: true
  
&lt;div class="my-header-h2"&gt;&lt;/div&gt;
&lt;div class="watermark1"&gt;&lt;/div&gt;
&lt;div class="watermark2"&gt;&lt;/div&gt;
&lt;div class="watermark3"&gt;&lt;/div&gt;

&lt;div class="my-footer"&gt;&lt;span&gt;huhuaping@   &lt;a href="#chapter09"&gt;第09章 放宽基本假设：序列自相关性&lt;/a&gt;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;
&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;
 &lt;a href="#diagnose"&gt;9.3 序列自相关性问题的诊断 &lt;/a&gt;&lt;/span&gt;&lt;/div&gt; 

---

## 图示法

**图示法**重点关注模型**残差**序列（
`\(e_t\)`）是否存在某种系统化模式。总体回归模型PRM中随机干扰项
`\(u_t\)`是不能直接观测到，所以可通过观察样本回归模型SRM中残差的行为模式，间接诊断随机干扰项是否存在自相关性问题。

- 图形1：残差序列
`\(e_t\)`**时序图**（serial plot，也即残差
`\(e_t\)`随时期
`\(t\)`的变化图）。

- 图形2：残差序列
`\(e_t\)`与残差1阶滞后序列
`\(e_{t-1}\)`的**散点图**（scatter plot）。

- 图形3：残差序列
`\(e_t\)`与残差p阶滞后序列
`\(e_{t-p},\quad p \in (2,3,\cdots,T-1)\)`的**散点图**（scatter plot）。

---


### 图示法：案例演示（主回归）





首先构建如下双对数**主回归模型**：

`$$\begin{equation} \begin{alignedat}{999} &amp;log(Y_t)=&amp;&amp; + \hat{\beta}_{1} &amp;&amp; + \hat{\beta}_{2} log(X_{t)}&amp;&amp;+e_i\\ \end{alignedat} \end{equation}$$`

双对数主回归模型回归结果为：

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{log(Y_t)}=&amp;&amp;+1.61&amp;&amp;+0.65log(X_{t)}\\ &amp;\text{(t)}&amp;&amp;(29.3680)&amp;&amp;(52.7996)\\&amp;\text{(se)}&amp;&amp;(0.0547)&amp;&amp;(0.0124)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.9845;&amp;&amp; \bar{R^2}=0.9841\\&amp; &amp;&amp; F^{\ast}=2787.80;&amp;&amp; p=0.0000 \end{alignedat} \end{equation}$$`

---

### 图示法：案例演示（主回归EViews报告）

作为对照，下面给出的是主模型的EViews报告：

&lt;img src="../pic/chpt9-eq-main-log-report.png" width="674" style="display: block; margin: auto;" /&gt;

---

### 图示法：案例演示（残差数据）

得到主回归模型的残差序列
`\(e_t\)`、残差1阶滞后序列
`\(e_{t-1}\)`，以及标准化变换的残差序列
`\(e_t^*=\frac{e_t}{S_{e_t}}\)`：

<div id="htmlwidget-efd07531f021030c44f5" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-efd07531f021030c44f5">{"x":{"filter":"none","vertical":false,"data":[["1960","1961","1962","1963","1964","1965","1966","1967","1968","1969","1970","1971","1972","1973","1974","1975","1976","1977","1978","1979","1980","1981","1982","1983","1984","1985","1986","1987","1988","1989","1990","1991","1992","1993","1994","1995","1996","1997","1998","1999","2000","2001","2002","2003","2004","2005"],[60.8,62.5,64.6,66.1,67.7,69.1,71.7,73.5,76.2,77.3,78.8,80.2,82.6,84.3,83.3,84.1,86.4,87.6,89.1,89.3,89.1,89.3,90.4,90.3,90.7,92,94.9,95.2,96.5,95,96.2,97.4,100,99.7,99,98.7,99.4,100.5,105.2,108,112,113.5,115.7,117.7,119,120.2],[48.9,50.6,52.9,55,56.8,58.8,61.2,62.5,64.7,65,66.3,69,71.2,73.4,72.3,74.8,77.1,78.5,79.3,79.3,79.2,80.8,80.1,83,85.2,87.1,89.7,90.1,91.5,92.4,94.4,95.9,100,100.4,101.3,101.5,104.5,106.5,109.5,112.8,116.1,119.1,124,128.7,132.7,135.7],[4.14365731473036,4.16594627768545,4.19493844939706,4.2203291364101,4.24133255505713,4.26390285117273,4.28999498933379,4.30370416684635,4.32626736396854,4.32928456196746,4.34220016165818,4.36823443047259,4.38870510130894,4.40855277717795,4.3987044346993,4.42087572215188,4.44062835598426,4.45236521588442,4.45897836730428,4.45897836730428,4.45815538111186,4.471200145368,4.46552513716292,4.488721055326,4.50578357696217,4.52016850474158,4.53935272514786,4.54225469421105,4.55231109453405,4.55869499350386,4.5726616186498,4.58294375179176,4.61024827524829,4.61285193727268,4.61867245010967,4.61995887354636,4.63895681291718,4.65132147651633,4.66943976578287,4.68880524014734,4.70761226057147,4.7242513382418,4.75054746012397,4.77481157534129,4.79477385186218,4.80935455903348],[-0.0360675257582357,-0.0307797209430978,-0.0267240386085058,-0.0291603895524575,-0.0262463751388961,-0.0283481203991084,-0.0175042417282141,-0.00641876062755877,0.00709409872406357,0.018409393625919,0.0247128352056563,0.0162890843998816,0.0253045792179922,0.0258290878298592,0.0237441144734962,0.0111308448270259,0.0183593198257455,0.0204157820579213,0.030780967172483,0.0330231205781728,0.0316039533649027,0.0208013425144533,0.0387191302352065,0.0144164050969399,0.00177378015892331,0.00162007230746089,0.013470980468026,0.0137252475862659,0.0172319138108862,-0.00481810190332087,-0.00623226097814317,-0.00411754114327431,-0.0050780892601978,-0.0106862603048859,-0.0235525999750852,-0.0278739271069197,-0.0398046992546491,-0.0411637490171985,-0.0135764654792595,-0.0066740130231236,0.0108866107236219,0.00755149867965264,0.000453174075661899,-0.00667256107506024,-0.0156503587506508,-0.0201975369323748],[null,-0.0360675257582357,-0.0307797209430978,-0.0267240386085058,-0.0291603895524575,-0.0262463751388961,-0.0283481203991084,-0.0175042417282141,-0.00641876062755877,0.00709409872406357,0.018409393625919,0.0247128352056563,0.0162890843998816,0.0253045792179922,0.0258290878298592,0.0237441144734962,0.0111308448270259,0.0183593198257455,0.0204157820579213,0.030780967172483,0.0330231205781728,0.0316039533649027,0.0208013425144533,0.0387191302352065,0.0144164050969399,0.00177378015892331,0.00162007230746089,0.013470980468026,0.0137252475862659,0.0172319138108862,-0.00481810190332087,-0.00623226097814317,-0.00411754114327431,-0.0050780892601978,-0.0106862603048859,-0.0235525999750852,-0.0278739271069197,-0.0398046992546491,-0.0411637490171985,-0.0135764654792595,-0.0066740130231236,0.0108866107236219,0.00755149867965264,0.000453174075661899,-0.00667256107506024,-0.0156503587506508],[-1.65208203646377,-1.40987281462878,-1.22410127112186,-1.33569893534769,-1.20222177645103,-1.29849274366111,-0.801786169501765,-0.294012935631698,0.324946966018311,0.843246878519987,1.13197759632934,0.746125584213154,1.15908257878692,1.18310782691301,1.08760510095277,0.509851130700201,0.840953235581496,0.935150002368807,1.4099298984774,1.51263229590177,1.44762698681853,0.952810695494168,1.77353944259621,0.660347040456491,0.0812484437340125,0.0742078171613255,0.617041628914573,0.628688397848024,0.789312121149771,-0.220694362504496,-0.285470272553792,-0.188605001707129,-0.232603148399131,-0.489486825490005,-1.0788327314626,-1.27677220133481,-1.82326420299105,-1.88551581721095,-0.621873396231888,-0.3057048354394,0.498663926520183,0.345898285362291,0.0207577518571853,-0.305638328595281,-0.716868596129299,-0.925153229818397],[-0.0165208203646377,-0.0140987281462878,-0.0122410127112186,-0.0133569893534769,-0.0120222177645103,-0.0129849274366111,-0.00801786169501765,-0.00294012935631698,0.00324946966018311,0.00843246878519987,0.0113197759632934,0.00746125584213155,0.0115908257878692,0.0118310782691301,0.0108760510095277,0.00509851130700201,0.00840953235581496,0.00935150002368807,0.014099298984774,0.0151263229590177,0.0144762698681853,0.00952810695494168,0.0177353944259621,0.00660347040456491,0.000812484437340125,0.000742078171613255,0.00617041628914573,0.00628688397848024,0.00789312121149771,-0.00220694362504496,-0.00285470272553792,-0.00188605001707129,-0.00232603148399131,-0.00489486825490005,-0.010788327314626,-0.0127677220133481,-0.0182326420299105,-0.0188551581721095,-0.00621873396231888,-0.003057048354394,0.00498663926520183,0.00345898285362291,0.000207577518571853,-0.00305638328595281,-0.00716868596129299,-0.00925153229818397]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>Year<\/th>\n      <th>\\( Y_t \\)<\/th>\n      <th>\\( X_t \\)<\/th>\n      <th>\\( \\hat{Y}_t \\)<\/th>\n      <th>\\(e_t \\)<\/th>\n      <th>\\( e_{t-1}\\)<\/th>\n      <th>\\( e_t^* \\)<\/th>\n      <th>\\( e_t^*/100 \\)<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"tip","columnDefs":[{"targets":3,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 4, 3, \",\", \".\", null);\n  }"},{"targets":4,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 4, 3, \",\", \".\", null);\n  }"},{"targets":5,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 4, 3, \",\", \".\", null);\n  }"},{"targets":6,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 4, 3, \",\", \".\", null);\n  }"},{"targets":7,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 4, 3, \",\", \".\", null);\n  }"},{"className":"dt-center","targets":"_all"},{"visible":false,"targets":0}],"pageLength":6,"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[6,10,25,50,100]}},"evals":["options.columnDefs.0.render","options.columnDefs.1.render","options.columnDefs.2.render","options.columnDefs.3.render","options.columnDefs.4.render"],"jsHooks":[]}</script>

&gt; **提示**：
`\(Y_t\)`表示时均真实工资指数；
`\(X_t\)`表示生产效率指数；
`\(e_t^*=\frac{e_t}{S_{e_t}}=\frac{e_t}{\sum{e_t^2}/(T-1)}\)`

---

### 图示法：案例演示（残差模式1）

残差序列（
`\(e_t\)`）和1/100标准化残差（
`\(0.01e_t^*\)`）**时序图**（serial plot，也即时序变量随时期变化图）如下：

&lt;img src="09-auto-correlation-slide_files/figure-html/unnamed-chunk-27-1.png" style="display: block; margin: auto;" /&gt;


&gt; **提示**：`et`表示残差序列（
`\(e_t\)`）；`et.std/100`表示1/100标准化残差序列（
`\(e_t^{\ast}/100\)`）。

---

### 图示法：案例演示（残差模式2）

残差序列
`\(e_t\)`与残差1阶滞后序列
`\(e_{t-1}\)`的**散点图**（scatter plot）为：

&lt;img src="09-auto-correlation-slide_files/figure-html/unnamed-chunk-28-1.png" style="display: block; margin: auto;" /&gt;


&gt; **提示**：因为残差滞后1期序列
`\(e_{t-1}\)`的观测数只有45，所以此处只显示45个观测点。


---

## 辅助回归法

**思路**：利用样本数据，构建并分析残差
`\(e_t\)`序列对
`\(e_{t-1},e_{t-2},\cdots\)`序列的**辅助回归方程**，从而间接判断随机干扰项
`\(u_t\)`的自相关性模式。也即存在如下的对应关系：

`$$\begin {align} 
u_t &amp; = \rho_1 u_{t-1} + \rho_2 u_{t-2} + \cdots + \rho_p u_{t-p} 
&amp;&amp; \quad p \in (1, 2, \cdots, T-1) \\
e_t &amp; = \hat{\rho}_1 e_{t-1} + \hat{\rho}_2 e_{t-2} + \cdots + \hat{\rho}_p e_{t-p} + v_i 
&amp;&amp; \quad p \in (1, 2, \cdots, T-1) 
\end {align}$$`

**步骤**：

- 构建主回归模型，并进行OLS估计，得到残差序列（及其滞后p阶序列）；

- 根据残差图模式，构建相应的**残差辅助回归方程**（无截距模型），根据回归报告，得到**主模型**是否存在自相关性问题的初步结论。

**诊断依据**：

- 如果**残差辅助回归方程**的F检验**显著**，则表明主模型存在**残差辅助回归方程**所示的自相关性问题。

- 如果**残差辅助回归方程**的F检验**不显著**，则表明主模型不存在**残差辅助回归方程**所示的自相关性问题。


---

## 辅助回归法：OLS估计

利用主回归模型的残差序列
`\(e_t\)`，我们可以构建如下的**辅助回归模型**：

`$$\begin {align} 
e_t &amp; = \hat{\rho}_1 e_{t-1}  + v_i 
\end {align}$$`

OLS估计的简要报告如下：

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{et}=&amp;&amp;+0.87et.l1\\ &amp;\text{(t)}&amp;&amp;(12.7360)\\&amp;\text{(se)}&amp;&amp;(0.0681)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.7866;&amp;&amp; \bar{R^2}=0.7818\\&amp; &amp;&amp; F^{\ast}=162.21;&amp;&amp; p=0.0000 \end{alignedat} \end{equation}$$`

&gt; **提示**：`et`表示残差序列
`\(e_t\)`，`et.l1`表示残差序列的1阶滞后变量
`\(e_{t-1}\)`。

---

## 自相关和偏相关分析法

**思路**：分析残差
`\(e_t\)`序列对
`\(e_{t-1},e_{t-2},\cdots\)`序列的自相关和偏相关统计图表报告（**注意滞后阶数的选择**）。

**步骤**：

- 对主模型进行OLS估计，得到残差
`\(e_t\)`序列

- 利用统计软件（`EViews`或`R`等）绘制残差序列的**自相关**和**偏相关**图表

- 观察和比对残差序列的**自相关**和**偏相关**图表，得到**主模型**是否存在自相关性问题的初步结论。

**诊断依据**：

- 观察**自相关**图和**偏相关**图的组合关系，判断残差序列的自相关性模式。

`$$\begin {align} 
e_t &amp; = \hat{\rho}_1 e_{t-1} + \hat{\rho}_2 e_{t-2} + \cdots + \hat{\rho}_p e_{t-p} + v_i
&amp;&amp; \quad p \in (1, 2, \cdots, T-1) 
\end {align}$$`

---

### 案例：残差的自相关分析（ACF）（R软件）

对于工资和劳动率案例，残差
`\(e_t\)`序列的自相关图（ACF）为：


&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="09-auto-correlation-slide_files/figure-html/unnamed-chunk-30-1.png" alt="残差序列et的自相关图（ACF）"  /&gt;
&lt;p class="caption"&gt;残差序列et的自相关图（ACF）&lt;/p&gt;
&lt;/div&gt;

---

### 案例：残差序列的偏自相关分析（PACF）（R软件）

对于工资和劳动率案例，残差
`\(e_t\)`序列的偏自相关图（PACF）为：

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="09-auto-correlation-slide_files/figure-html/unnamed-chunk-31-1.png" alt="残差序列et的偏自相关图"  /&gt;
&lt;p class="caption"&gt;残差序列et的偏自相关图&lt;/p&gt;
&lt;/div&gt;

---

### 案例：残差序列的自相关和偏自相关分析（EViews软件）

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="../pic/chpt9-pacf-test-proc.png" alt="残差自相关和偏相关分析的Eviews操作" width="466" /&gt;
&lt;p class="caption"&gt;残差自相关和偏相关分析的Eviews操作&lt;/p&gt;
&lt;/div&gt;

---

### 案例：残差序列的自相关和偏自相关分析（EViews软件）

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="../pic/chpt9-pacf-test-report.png" alt="残差自相关和偏相关的Eviews报告" width="484" /&gt;
&lt;p class="caption"&gt;残差自相关和偏相关的Eviews报告&lt;/p&gt;
&lt;/div&gt;

---

## 德宾-沃森检验法（Durbin-Watson test）

假设总体回归模型PRM存在如下1阶自相关,则可以认为存在：：

`$$\begin{aligned} 
Y_{t} &amp;=\beta_{1}+\beta_{2} X_{t}+u_{t} \\ 
u_{t} &amp;=\rho u_{t-1}+\varepsilon_{t}  &amp;&amp; \leftarrow \left[-1 &lt;\rho&lt;1 \right]
\end{aligned}$$`

`$$\begin {align} 
Y_{t} &amp;=\hat{\beta}_{1}+\hat{\beta}_{2} X_{t}+e_{t} \\ 
e_t &amp; = \hat{\rho} e_{t-1} + v_i
\end {align}$$`

那么就可以构造得到如下的样本**Durbin-Watson的d统计量**：

`$$\begin {align} 
d=\frac{\sum_{2}^{T}\left(\mathrm{e}_{t}-e_{t-1}\right)^{2}}{\sum_{1}^{T} e_{t}^{2}}
\end {align}$$`

- 它其实是用相继残差的差异的平方和与“残差平方和RSS”之比。

- 由于取相继差异时损失1个观测值，德宾-沃森d统计量的分子只有
`\(T-1\)`次观测值。

---

## 德宾-沃森检验法（Durbin-Watson test）

`$$\begin{align}
d &amp;=\frac{\sum_{2}^{T}\left(\mathrm{e}_{t}-e_{t-1}\right)^{2}}{\sum_{2}^{T} e_{t}^{2}} \\
&amp;=\frac{\sum \mathrm{e}_{t}^{2}+\sum e_{t-1}^{2}-2 \sum e_{t} e_{t-1}}{\sum e_{t}^{2}} 
&amp;&amp; \leftarrow \left[ \sum e_{t}^{2} \approx \sum e_{t-1}^{2} \right]\\ 
&amp; \doteq 2\left(1-\frac{\sum e_{t} e_{t-1}}{\sum e_{t}^{2}}\right) 
&amp;&amp; \leftarrow \left[ \hat{\rho}=\frac{\sum e_{t} e_{t-1}}{\sum e_{t}^{2}} \right] \\ 
&amp;=2(1-\hat{\rho}) \end{align}$$`

因为
`\(0 \leq \hat{\rho} \leq 1\)`，所以德宾-沃森d统计量
`\(0 \leq d \leq 4\)`，并具有如下**特征**：

- 如果
`\(\hat{\rho}=+1\)`，则
`\(d=0\)`，此时残差序列存在**完全1阶正自相关性**。

- 如果
`\(\hat{\rho}=0\)`，则
`\(d=2\)`，此时残差序列不存在**自相关性**。

- 如果
`\(\hat{\rho}=-1\)`，则
`\(d=4\)`，此时残差序列存在**完全1阶负自相关性**。



---

## 德宾-沃森检验法（Durbin-Watson test）

**德宾-沃森检验法的步骤**：

- 对主模型进行OLS估计，得到残差
`\(e_t\)`序列

- 得到主回归方程分析报告中的德宾-沃森d统计量（Durbin-Watson）

- 查找德宾-沃森统计量（Durbin-Watson）理论表，找到理论下界值
`\(d_L\)`和理论上界值
`\(d_U\)`。

- 比较德宾-沃森d统计量与查表值之间的关系，根据诊断依据，得到**主模型**是否存在自相关性问题的初步结论。

&gt;Durbin-Watson统计量服从
`\(\chi^2(n,k,\alpha)\)` 分布，[具体可以参看Eviews在线帮助文档](http://www.eviews.com/help/helpintro.html#page/content/timeser-Testing_for_Serial_Correlation.html)

&gt;下界值
`\(d_L\)`和上界值
`\(d_U\)`的理论值使用bootstrap方法仿真计算得到，与
`\((n,k,\alpha)\)`有关

&gt;下界值
`\(d_L\)`和上界值
`\(d_U\)`的理论查表值可以参考[在线文档](https://www3.nd.edu/~wevans1/econ30331/Durbin_Watson_tables.pdf)

---

## 德宾-沃森检验法（Durbin-Watson test）

**德宾-沃森检验法的诊断依据**（**后视镜法则**）：

-  如果
`\(0&lt; d &lt;d_L\)`，则表明主模可能存在的**1阶正自相关**问题。

-  如果
`\(4-d_L&lt; d &lt;4\)`，则表明主模型可能存在的**1阶负自相关**问题。

&lt;img src="../pic/chpt9-DW-rules1.png" width="826" style="display: block; margin: auto;" /&gt;

---

## 德宾-沃森检验法（Durbin-Watson test）

**德宾-沃森检验法的诊断依据**（**后视镜法则**）：

&lt;img src="../pic/chpt9-DW-rules2.png" width="1500" style="display: block; margin: auto;" /&gt;

---

## 德宾-沃森检验法（Durbin-Watson test）

**德宾-沃森检验法的适用条件**：

- 回归模型含有截距项，如果没有截距项，就必须重新做带有截距的回归

- 解释变量
`\(X_{2t},X_{3t},\cdots,X_{kt}\)`是非随机的，或者说，在反复抽样中是被固定的.

- 随机干扰项
`\(u_t\)`是按**1阶自回归模式**产生的：

`$$\begin{aligned} 
Y_{t} &amp;=\beta_{1}+\beta_{2} X_{2t} +\beta_{3} X_{3t}+ \cdots  +\beta_{k} X_{kt} +u_{t} \\ 
u_{t} &amp;=\rho u_{t-1}+\varepsilon_{t}  &amp;&amp; \leftarrow \left[-1 &lt;\rho&lt;1 \right]
\end{aligned}$$`

- 因变量
`\(Y_t\)`的滞后变量
`\(Y_{t-1}, Y_{t-2}, \cdots,Y_{t-q}\)`不能当作解释变量之一。如模型：

`$$\begin {align} 
Y_{t}=\beta_{1}+\beta_{2} X_{2 t}+\beta_{3} X_{3 t}+\cdots+\beta_{k} X_{k t}+\gamma Y_{t-1}+u_{t}
 \end {align}$$`

- 没有数据缺损，如果数据缺失，d统计量无法补偿。


---

### 案例：德宾-沃森检验（R软件）

工资-劳动率案例中，双对数**主回归模型**及其OLS回归结果为：



`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{log(Y_t)}=&amp;&amp;+1.61&amp;&amp;+0.65log(X_{t)}\\ &amp;\text{(t)}&amp;&amp;(29.3680)&amp;&amp;(52.7996)\\&amp;\text{(se)}&amp;&amp;(0.0547)&amp;&amp;(0.0124)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.9845;&amp;&amp; \bar{R^2}=0.9841\\&amp; &amp;&amp; F^{\ast}=2787.80;&amp;&amp; p=0.0000 \end{alignedat} \end{equation}$$`

---

### 案例：德宾-沃森检验（R软件）

我们可以利用残差序列，采用`R`软件计算得到**德宾-沃森d统计量**：



```

	Durbin-Watson test

data:  lm.main
DW = 0.21756, p-value &lt; 2.2e-16
alternative hypothesis: true autocorrelation is not 0
```

- 根据主回归报告的计算结果，Durbin-Watson的d统计量为
`\(d=\)` 0.2175583。查表可知在当
`\((n='r n',k=3,\alpha=0.05)\)`时，
`\(d_L=1.475,d_U=1.566\)`，表明
`\(0&lt;d&lt;d_L\)`，因此认为主模型可能存在的**1阶正自相关性**问题。 

---

### 案例：德宾-沃森检验（EViews报告）

        
&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="../pic/chpt9-eq-main-log-proc.png" alt="主回归模型Eviews操作" width="553" /&gt;
&lt;p class="caption"&gt;主回归模型Eviews操作&lt;/p&gt;
&lt;/div&gt;

---

### 案例：德宾-沃森检验（EViews报告）

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="../pic/chpt9-eq-main-log-report.png" alt="主回归模型Eviews报告" width="640" /&gt;
&lt;p class="caption"&gt;主回归模型Eviews报告&lt;/p&gt;
&lt;/div&gt;


---

## 拉格朗日乘数检验法（LM test）

**拉格朗日乘数检验**（LM test），也称为布罗施-戈弗雷检验（Breusch-Goldfrey，BG test）。

**拉格朗日乘数检验**假定随机干扰项
`\(u_t\)`服从如下的p阶自回归模式AR(p)：


`$$\begin{aligned} 
Y_{t} &amp;=\beta_{1}+\beta_{2} X_{2t} +\beta_{3} X_{3t}+ \cdots  +\beta_{k} X_{kt} +u_{t} \\ 
u_{t} &amp;=\rho_1 u_{t-1}+ \rho_2 u_{t-2}+ \cdots + \rho_p u_{t-p}+ \varepsilon_{t}
\end{aligned}$$`

**拉格朗日乘数检验**的原假设为：
`\(H_0: \rho_1= \rho_2=\cdots=\rho_p=0\)`


---

## 拉格朗日乘数检验法（LM test）

**拉格朗日乘数检验的适用条件**：

- 可以对**高阶自相关模式**[AR(p)]进行检验

- 允许非随机回归元

- 允许随机干扰项为自回归移动平均ARMA(p,q)模式。也即：

`$$\begin{aligned} 
Y_{t} &amp;=\beta_{1}+\beta_{2} X_{2t} +\beta_{3} X_{3t}+ \cdots  +\beta_{k} X_{kt} +u_{t} \\ 
u_{t} &amp;=\rho_1 u_{t-1}+ \rho_2 u_{t-2}+ \cdots + \rho_p u_{t-p}+ \varepsilon_{t} +\lambda_1\varepsilon_{t-1} +\lambda_2\varepsilon_{2} +\cdots +\lambda_q\varepsilon_{t-q} \\
\varepsilon_{t} &amp; \sim iid N(0,1)
\end{aligned}$$`


---

## 拉格朗日乘数检验法（LM test）

**拉格朗日乘数检验的步骤**：

- 对主模型进行OLS估计，得到残差
`\(e_t\)`序列

- 再利用主回归模型的残差序列，做如下的**LM辅助回归**：

`$$\begin{aligned} 
resid_{t} &amp;=\hat{\alpha}_1 + \hat{\alpha}_2 X_{2t}  + \hat{\alpha}_3 X_{3t} +\cdots + \hat{\alpha}_k X_{kt} 
+\hat{\rho}_1 e_{t-1}+ \hat{\rho}_2 e_{t-2}+ \cdots + \hat{\rho}_p e_{t-p}+ v_t 
\end{aligned}$$`

- 计算**LM辅助回归**方程的判定系数
`\(R^2\)`，并得到如下**LM统计量**（卡方统计量）：

`$$\begin {align} 
LM \equiv {\chi^2}^{\ast}=(n-p)R^2 \sim \chi^{2}(p)
\end {align}$$`

.footnote[

实际EViews操作中，EViews的LM检验报告会对缺失样本数进行提前处理，所以统计量计算会显示`Obs*R-squared`=
`\(n*R^2\)`，而且下面会有一行提示“Presample Missing value lagged residuals set to zero”。具体可以参看EViews[说明](http://www.eviews.com/help/helpintro.html#page/content%2Ftesting-Residual_Diagnostics.html%23ww182888)。

]

---

## 拉格朗日乘数检验法（LM test）

**拉格朗日乘数检验的诊断依据**：

- 如果**LM辅助回归方程**的卡方检验**显著**，也即
`\(LM \equiv {\chi^2}^{\ast} &gt; \chi^2_{1-\alpha}(p)\)`（对应的概率值P&lt; 0.1），则表明**主模型**是存在**LM辅助回归方程**形式的自相关性问题。

- 如果**LM辅助回归方程**的卡方检验**不显著**，也即
`\(LM \equiv {\chi^2}^{\ast}&lt; \chi^2_{1-\alpha}(p)\)`（对应的概率值P&gt;0.1），则表明**主模型**是不存在**LM辅助回归方程**形式的自相关性问题。

---

### 案例：拉格朗日乘数检验

工资-劳动率案例中，双对数**主回归模型**及其OLS回归结果为：



`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{log(Y_t)}=&amp;&amp;+1.61&amp;&amp;+0.65log(X_{t)}\\ &amp;\text{(t)}&amp;&amp;(29.3680)&amp;&amp;(52.7996)\\&amp;\text{(se)}&amp;&amp;(0.0547)&amp;&amp;(0.0124)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.9845;&amp;&amp; \bar{R^2}=0.9841\\&amp; &amp;&amp; F^{\ast}=2787.80;&amp;&amp; p=0.0000 \end{alignedat} \end{equation}$$`

我们可以利用残差序列构建
`\(p=1\)`的**LM辅助回归方程**：


`$$\begin{align} 
e_{t} &amp;=\hat{\alpha}_1 + \hat{\alpha}_2 X_{2t} +\hat{\rho}_1 e_{t-1}+  v_t \end{align}$$`

---

### 案例：拉格朗日乘数检验（R软件）

采用`R`软件的**拉格朗日乘数检验**结果为：


```

	Breusch-Godfrey test for serial correlation of order up to 1

data:  lm.main
LM test = 34.02, df = 1, p-value = 5.456e-09
```


`$$\begin{align}
resid_t = +0.0063 -0.0015log(X_t)+0.8687lag(resid)_1
\end{align}$$`


- 根据LM辅助方程的计算结果，LM统计量为
`\(LM={\chi^2}^{\ast}=\)` 34.0196，其对应的概率值p为0.0000。

- 查表也可知在当
`\(n=\)` 46,
`\(k=\)` 2,
`\(\alpha=0.05\)`时，
`\(\chi^2_{1-\alpha}(p)=\chi^2_{0.95}(\)` 1 )= 3.841459要远远小于样本LM统计量值。

- 因此认为主模型可能存在**自相关性**问题。 

&gt; 提示：
`\(resid_t\)`表示
`\(e_t\)`；
`\(lag(resid)_1\)`表示
`\(e_{t-1}\)`。

---

### 案例：拉格朗日乘数检验（EViews软件）

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="../pic/chpt9-LM-test.png" alt="拉格朗日自相关检验的Eviews操作" width="575" /&gt;
&lt;p class="caption"&gt;拉格朗日自相关检验的Eviews操作&lt;/p&gt;
&lt;/div&gt;

---

### 案例：拉格朗日乘数检验（EViews软件）

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="../pic/chpt9-LM-test-report.png" alt="拉格朗日自相关检验的Eviews报告" width="563" /&gt;
&lt;p class="caption"&gt;拉格朗日自相关检验的Eviews报告&lt;/p&gt;
&lt;/div&gt;

---
layout: false
class: center, middle, duke-softblue,hide_logo
name: adjust

# 9.4 序列自相关性问题的矫正

---
layout: true
  
&lt;div class="my-header-h2"&gt;&lt;/div&gt;
&lt;div class="watermark1"&gt;&lt;/div&gt;
&lt;div class="watermark2"&gt;&lt;/div&gt;
&lt;div class="watermark3"&gt;&lt;/div&gt;

&lt;div class="my-footer"&gt;&lt;span&gt;huhuaping@   &lt;a href="#chapter09"&gt;第09章 放宽基本假设：序列自相关性&lt;/a&gt;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;
&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;
 &lt;a href="#adjust"&gt;9.4 序列自相关性问题的矫正&lt;/a&gt; &lt;/span&gt;&lt;/div&gt; 

---

## 广义差分方程法（自相关系数已知）

**广义差分方程法** ：对主回归方程进行合适的**广义差分变换**，使得变换以后的新模型不再有自相关问题，然后再使用OLS方法估计，从而得到参数估计的**BLUE**。

**广义差分法变换法**属于**广义最小二乘法**（GLS）的一种，专门用来处理随机干扰项出现自相关性问题的一种常用方法。


**广义差分方程法的原理**：如果主模型随机干扰项的**自相关系数**
`\(\rho\)`已知，则可以直接用差分变换得到新模型，容易证明新模型将不再有自相关问题。

---

## 广义差分方程法（自相关系数已知）

下面将说明**1阶自相关**情形AR(1)下的**广义差分变换**的理论过程：

`$$\begin{align}
Y_t &amp; =\beta_1+\beta_2X_{2t}+u_{t} &amp;&amp; \text{(PRM)}\\
u_t &amp; =\rho u_{t-1}+\varepsilon_t &amp;&amp; \text{(AR(1))} \\
\rho Y_{t-1} &amp; =\rho \beta_1+\beta_2\rho X_{2t-1}+\rho u_{t-1} &amp;&amp; \text{(Lag 1 Model)} \\
(Y_t-\rho Y_{t-1}) &amp; =\beta_1(1-\rho)+\beta_2(X_{2t}-\rho X_{2t-1})+(u_t-\rho u_{t-1}) &amp;&amp; (\Delta\text{ Model} ) \\
Y^{\ast}_t &amp; =\beta^{\ast}_1+\beta^{\ast}_2X^{\ast}_{2t}+\varepsilon_{t} &amp;&amp; \text{(Adjusted Model)} 
\end{align}$$`

其中，AR(1)模型中的
`\(\varepsilon_t\sim i.i.d\ \ N(0,\sigma^2_{\varepsilon})\)`。

---

## 广义差分方程法：基于残差辅助方程

**矫正思路**：如果主模型随机干扰项的自相关系数未知，则可以直接用基于残差辅助方程估计得到
`\(\hat{\rho}\)`；再根据
`\(\rho\simeq\hat{\rho}\)`用广义差分变换得到新模型，容易证明新模型将不再有自相关问题。

如下将展示**1阶自相关**AR(1)情形下的广义差分变换的理论过程：

`$$\begin{align}
Y_t &amp; =\beta_1+\beta_2X_{2t}+u_{t} &amp;&amp; \text{PRM} \\
u_t &amp; =\rho u_{t-1}+\varepsilon_t &amp;&amp; \text{AR(1)} \\
Y_t &amp; =\hat{\beta}_1+\hat{\beta}_2X_{2t}+e_{t} &amp;&amp; \text{SRM} \\
e_t &amp; =\hat{\rho}e_{t-1}+v_t &amp;&amp; \text{Auxiliary Model} \\
\rho &amp; \simeq \hat{\rho}  \\
\rho Y_{t-1} &amp; =\rho \beta_1+\beta_2\rho X_{2t-1}+\rho u_{t-1} &amp;&amp; \text{Lag 1 Model} \\
(Y_t-\rho Y_{t-1}) &amp; =\beta_1(1-\rho)+\beta_2(X_{2t}-\rho X_{2t-1})+(u_t-\rho u_{t-1}) &amp;&amp; \Delta1\text{ Model} \\
Y^{\ast}_t &amp; =\beta^{\ast}_1+\beta^{\ast}_2X^{\ast}_{2t}+\varepsilon_{t} &amp;&amp; \text{Adjusted Model} 
\end{align}$$`

其中，AR(1)模型中的
`\(\varepsilon_t\sim i.i.d\ \ N(0,\sigma^2_{\varepsilon})\)`。


---

### 案例矫正：基于残差辅助方程（EViews软件）

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="../pic/chpt9-ar1-extract.png" alt="基于残差辅助方程近似计算自相关系数" width="450" /&gt;
&lt;p class="caption"&gt;基于残差辅助方程近似计算自相关系数&lt;/p&gt;
&lt;/div&gt;

---

### 案例矫正：基于残差辅助方程（EViews软件）

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="../pic/chpt9-adj-ar1.png" alt="基于残差辅助方程的广义差分矫正操作" width="429" /&gt;
&lt;p class="caption"&gt;基于残差辅助方程的广义差分矫正操作&lt;/p&gt;
&lt;/div&gt;

---

### 案例矫正：基于残差辅助方程（EViews软件）

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="../pic/chpt9-adj-ar1-report.png" alt="基于残差辅助方程的广义差分矫正报告" width="660" /&gt;
&lt;p class="caption"&gt;基于残差辅助方程的广义差分矫正报告&lt;/p&gt;
&lt;/div&gt;

---

## 广义差分方程法：基于D-W统计量

**矫正思路**：如果主模型随机干扰项的自相关系数未知，则可以基于Durbin-Waston检验的d统计量计算得到
`\(\hat{\rho}\)`，再根据
`\(\rho\simeq\hat{\rho}\)`用广义差分变换得到新模型，容易证明新模型将不再有自相关问题。

如下将展示一阶自相情形下的广义差分变换的理论过程

`$$\begin{align}
Y_t &amp; =\beta_1+\beta_2X_{2t}+u_{t} &amp;&amp; \text{PRM} \\
u_t &amp; =\rho u_{t-1}+\varepsilon_t &amp;&amp; \text{AR(1)} \\
d   &amp; \simeq2(1-\hat{\rho})      &amp;&amp; \text{Durbin-Waston} \\
\hat{\rho} &amp; \simeq 1-d/2 \\
\rho &amp; \simeq \hat{\rho}  \\
\rho Y_{t-1} &amp; =rho \beta_1+\beta_2\rho X_{2t-1}+\rho u_{t-1} &amp;&amp; \text{Lag 1 Model}\\
(Y_t-\rho Y_{t-1}) &amp; =\beta_1(1-\rho)+\beta_2(X_{2t}-\rho X_{2t-1})+(u_t-\rho u_{t-1}) &amp;&amp; \Delta1\text{ Model} \\
Y^{\ast}_t &amp; =\beta^{\ast}_1+\beta^{\ast}_2X^{\ast}_{2t}+\varepsilon_{t} &amp;&amp; \text{Adjusted Model} 
\end{align}$$`

其中，AR(1)模型中的
`\(\varepsilon_t\sim i.i.d\ \ N(0,\sigma^2_{\varepsilon})\)`。

---

### 案例矫正：基于D-W统计量

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="../pic/chpt9-adj-dw-rho-extract.png" alt="基于Durbin-Waston统计量近似计算自相关系数" width="484" /&gt;
&lt;p class="caption"&gt;基于Durbin-Waston统计量近似计算自相关系数&lt;/p&gt;
&lt;/div&gt;

---

### 案例矫正：基于D-W统计量

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="../pic/chpt9-adj-dw.png" alt="基于Durbin-Waston统计量的广义差分模型矫正操作" width="570" /&gt;
&lt;p class="caption"&gt;基于Durbin-Waston统计量的广义差分模型矫正操作&lt;/p&gt;
&lt;/div&gt;

---

### 案例矫正：基于D-W统计量

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="../pic/chpt9-adj-dw-report.png" alt="基于Durbin-Waston统计量的广义差分模型矫正报告" width="645" /&gt;
&lt;p class="caption"&gt;基于Durbin-Waston统计量的广义差分模型矫正报告&lt;/p&gt;
&lt;/div&gt;


---

## 可行广义最小二乘法(FGLS)：基于迭代法

**矫正思路**：

- 如果主模型随机干扰项的自相关系数未知，而且存在高阶自相关情形，则可以使用基于迭代的**可行广义最小二乘法**(FGLS)计算得到
`\(\hat{\rho_1},\hat{\rho_2},\cdots,\hat{\rho_p}\  \quad p\in(1,2,\cdots)\)`，再根据
`\(\rho\simeq\hat{\rho}\)`用广义差分变换得到新模型，容易证明新模型将不再有自相关问题。

- 这些迭代方法主要包括:

  - **科克伦-奥克特迭代法**(Cochrane-Orcutt iterative procedure) ；
  
  - 科克伦-奥克特两步法(Cochrane-Orcutt two-step procedure) ；
  
  - 德宾两步法(Durbin two-step procedure) ；
  
  - 希尔德雷思-卢扫描或搜寻程序(Hildreth-Lu scanning or search procedure) 等

---

## 可行广义最小二乘法(FGLS)：基于迭代法

如下将展示**科克伦-奥克特迭代法**下对二阶自相关（
`\(AR(p),p=2\)`）情形下的广义差分变换的理论过程

`$$\begin{align}
Y_t &amp; =\beta_1+\beta_2X_{2t}+u_{t} &amp;&amp; \text{PRM} \\
u_t &amp; =\rho_1u_{t-1}+\rho_2u_{t-2}+\varepsilon_t &amp;&amp; \text{AR(2)} \\
\cdots &amp; &amp;&amp; \text{Cochrane-Orcutt iterative} \notag \\
\rho_p &amp; \simeq \hat{\rho_p} \notag \\
\rho_1Y_{t-1} &amp; =\rho_1\beta_1+\beta_2\rho_1X_{2t-1}+\rho_1u_{t-1} &amp;&amp; \text{Lag 1 Model} \\
\rho_2Y_{t-2} &amp; =\rho_2\beta_1+\beta_2\rho_2X_{2t-2}+\rho_2u_{t-2} &amp;&amp; \text{Lag 2 Model} \\
\end{align}$$`

`$$\begin{align}
(Y_t-\rho_1Y_{t-1}-\rho_2Y_{t-2}) &amp; =\beta_1(1-\rho_1-\rho_2)
 +\beta_2(X_{2t}-\rho_1X_{2t-1}-\rho_2X_{2t-2}) \\
&amp; +(u_t-\rho_1u_{t-1}-\rho_2u_{t-2})  
&amp;&amp; \Delta2\text{ Model} \\
Y^{\ast}_t &amp;=\beta^{\ast}_1+\beta^{\ast}_2X^{\ast}_{2t}+\varepsilon_{t} &amp;&amp; \text{Adjusted Model} 
\end{align}$$`

---

### 矫正案例：基于迭代法（FGLS）

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="../pic/chpt9-adj-CO.png" alt="基于科克伦-奥克特迭代法的FGLS模型矫正Eviews操作" width="481" /&gt;
&lt;p class="caption"&gt;基于科克伦-奥克特迭代法的FGLS模型矫正Eviews操作&lt;/p&gt;
&lt;/div&gt;

---

### 矫正案例：基于迭代法（FGLS）

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="../pic/chpt9-adj-CO-report.png" alt="基于科克伦-奥克特迭代法的FGLS模型矫正Eviews报告" width="500" /&gt;
&lt;p class="caption"&gt;基于科克伦-奥克特迭代法的FGLS模型矫正Eviews报告&lt;/p&gt;
&lt;/div&gt;

---

### 矫正案例：基于迭代法（FGLS）

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="../pic/chpt9-adj-co-rho-extract.png" alt="基于科克伦-奥克特迭代法近似计算的自相关系数" width="469" /&gt;
&lt;p class="caption"&gt;基于科克伦-奥克特迭代法近似计算的自相关系数&lt;/p&gt;
&lt;/div&gt;


---

### 一致性标准误校正法（HAC）：尼威-威斯特(Newey-West)

**目标**：直接用尼威-威斯特(Newey-West)一致性标准误矫正流程方法，构建回归分析模型，此时模型的自相关问题将会有所缓解。  

**矫正思路**：利用统计软件（Eviews或R等），进行基于尼威-威斯特(Newey-West)一致性标准误矫正程序的建模分析。  

**理论提示**：（数学表达和证明过程略）

- 异方差-自相关一致性标准误（heteroscedasticity-autocorralation consistent standard errors，HAC）也被简称为尼威-威斯特一致性标准误(Newey-West consistent standard errors)

- 尼威-威斯特(Newey-West)一致性标准误矫正程序或菜单，在主流的统计软件里都会配置

- 尼威-威斯特(Newey-West)一致性标准误矫正程序，严格意义上对于大样本数据是有效的，因此不太适合于小样本数据的情形。

---

### 矫正案例：一致性标准误校正法（HAC）

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="../pic/chpt9-adj-NW.png" alt="尼威-威斯特(Newey-West)矫正法的操作" width="487" /&gt;
&lt;p class="caption"&gt;尼威-威斯特(Newey-West)矫正法的操作&lt;/p&gt;
&lt;/div&gt;

---

### 矫正案例：一致性标准误校正法（HAC）

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="../pic/chpt9-adj-NW-report.png" alt="尼威-威斯特(Newey-West)矫正法的Eviews报告" width="503" /&gt;
&lt;p class="caption"&gt;尼威-威斯特(Newey-West)矫正法的Eviews报告&lt;/p&gt;
&lt;/div&gt;


---
layout:false
background-image: url("../pic/thank-you-gif-funny-little-yellow.gif")
class: inverse,center
# 本章结束
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
