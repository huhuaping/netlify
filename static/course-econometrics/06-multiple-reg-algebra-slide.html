<!DOCTYPE html>
<html>
  <head>
    <title>06-multiple-reg-algebra-slide.utf8.md</title>
    <meta charset="utf-8">
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/default-fonts.css" rel="stylesheet" />
    <link href="libs/remark-css/duke-blue.css" rel="stylesheet" />
    <link href="libs/remark-css/hygge-duke.css" rel="stylesheet" />
    <script src="libs/htmlwidgets/htmlwidgets.js"></script>
    <script src="libs/jquery/jquery.min.js"></script>
    <link href="libs/datatables-css/datatables-crosstalk.css" rel="stylesheet" />
    <script src="libs/datatables-binding/datatables.js"></script>
    <link href="libs/dt-core/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="libs/dt-core/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="libs/dt-core/js/jquery.dataTables.min.js"></script>
    <link href="libs/crosstalk/css/crosstalk.css" rel="stylesheet" />
    <script src="libs/crosstalk/js/crosstalk.min.js"></script>
    <link rel="stylesheet" href="libs\cc-fonts.css" type="text/css" />
    <link rel="stylesheet" href="libs\figure-captions.css" type="text/css" />
    <link rel="stylesheet" href="libs\animate.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">

background-image: url("pic/slide-front-page.jpg")
class: center,middle

# 计量经济学(Econometrics)

### 胡华平

### 西北农林科技大学

### 经济管理学院数量经济教研室

### huhuaping01@hotmail.com

### 2019-03-19





&lt;style type="text/css"&gt;
.remark-slide-content {
    font-size: 22px;
    padding: 1em 4em 1em 4em;
}
&lt;/style&gt;

---
class: center, middle,inverse
# 第6章：多元回归：代数部分



### 估计问题

### 推断问题



---
class: inverse, center, middle
# 多元回归分析：估计问题

---
## 三变量模型：符号与假定

三变量的PRM和PRF为:


`$$\begin {align} 
Y_{i}=\beta_{1}+\beta_{2} X_{2 i}+\beta_{3} X_{3 i}+u_{i} \\ 
E\left(Y_{i} | X_{2 i}, X_{3 i}\right)=\beta_{1}+\beta_{2} X_{2 i}+\beta_{3} X_{3 i}
\end {align}$$`

多元回归分析是以多个解释变量的固定值为条件的回归分析。

我们所获得的，是各个自变量X值固定时，Y的平均值或Y的平均响应（mean response）。


- 
`\(\beta_1\)`：截距项

- 
`\(u_i\)`：表示所有未包含到模型中来的变量对Y的平均影响。

- 
`\(\beta_2,\beta_3\)`：偏回归系数（partial regression coefficients）

- 
`\(i\)`：指第i次观测，当数据为时间序列时用t表示；


---

## 三变量模型：CLRM假设

**CLRM假设1-1**：模型是正确设置的。（这里大有学问，也是一切计量分析问题的根本来源）


**CLRM假设1-2**：模型应该是参数线性的。也即模型中**参数**必须线性，变量可以不是线性

`$$\begin {align} 
Y_{i}=\beta_1+ \beta_{2} X_{2i}+ \beta_{3} X_{3i}+u_{i}
\end {align}$$`

---
## 三变量模型：CLRM假设

**CLRM假设2-1**：X是固定的（给定的）或独立于误差项。也即自变量X**不是**随机变量。

`$$\begin{align}
Cov(X_{2i}, u_i)= Cov(X_{3i}, u_i)= 0, \quad i=1,2, \ldots, n \\ 
E(X_i, u_i)= 0
\end{align}$$`

**CLRM假设2-2**：X变量间不存在**完全共线性**

---

## 三变量模型：CLRM假设

**CLRM假设3-1**：假设随机干扰项均值为零。也即给定
`\(X_i\)`的情形下，假定随机干扰项
`\(u_i\)`的**条件期望**为零。

`$$\begin{align}
E(u|X_{2i},X_{3i})= 0
\end{align}$$`

**CLRM假设3-2**：随机干扰项的方差为同方差。也即给定
`\(X_i\)`的情形下，随机干扰项
`\(u_i\)`的方差，处处都是相等的。记为：

`$$\begin{align}
Var\left(u_i|(X_{2i},X_{3i}) \right) &amp; = E \left[ \left( u_i -E(u_i) \right)^2|(X_{2i},X_{3i}) \right] \\
&amp; = E(u_i^2|X_i)  = E(u_i^2)  \equiv \sigma^2
\end{align}$$`


**CLRM假设3-3**：各个随机干扰之间无自相关。也即给定两个不同的自变量取值（
`\(X_i,X_j;i \neq j\)`）情形下，随机干扰项
`\(u_i,u_j\)`的相关系数为0。或者说
`\(u_i,u_j\)`最好是相互独立的。记为：

在
`\(X_i\)`为给定情形下，且
`\(i,j \in (1, 2, \cdots, n); i \neq j\)`，假定：

`$$\begin{align}
Cov(u_i, u_j|X_i,X_j) &amp; = E \left[ \left( u_i -E(u_i) \right)\left( u_i -E(u_i) \right) \right]  \\
&amp; = E(u_iu_j) \\
&amp; \equiv 0
\end{align}$$`

---

## 对多元回归方程的解释

三变量的PRM和PRF为:

`$$\begin {align} 
Y_{i}=\beta_{1}+\beta_{2} X_{2 i}+\beta_{3} X_{3 i}+u_{i} \\ 
E\left(Y_{i} | X_{2 i}, X_{3 i}\right)=\beta_{1}+\beta_{2} X_{2 i}+\beta_{3} X_{3 i}
\end {align}$$`

多元回归分析是以多个解释变量的固定值为条件的回归分析。

我们所获得的，是各个自变量X值固定时，Y的平均值或Y的平均响应（mean response）。

偏回归系数的含义：

- 
`\(\beta_2\)`度量着在保持
`\(X_{3i}\)`不变的情况下，
`\(X_{2i}\)`每变化1个单位时，Y的均值的变化。换一句话说，   给出
`\(X_{2i}\)`的单位变化对Y均值的“直接”或“净”影响（净在不染有
`\(X_{3i}\)`的影响）。  

- 
`\(\beta_3\)`则给出了
`\(X_{3i}\)`的单位变化对Y均值
`\(E(Y)\)`的“直接”或“净”影响，净在不沾有
`\(X_{2i}\)`的影响。

---
### 儿童死亡率案例：数据



研究关注儿童死亡率（`CM`，千分数）与人均GNP（`PGNP`，1980年的人均GNP）和妇女识字率（`FLR`，百分数）的关系，并构建如下PRM：

`$$\begin{equation} \begin{alignedat}{999} &amp;CM=&amp;&amp; + \beta_{1} &amp;&amp; + \beta_{2} PGNP&amp;&amp; + \beta_{3} FLR&amp;&amp;+u_i\\ \end{alignedat} \end{equation}$$`

<div id="htmlwidget-feed398cc54e791a9058" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-feed398cc54e791a9058">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64"],[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64],[128,204,202,197,96,209,170,240,241,55,75,129,24,165,94,96,148,98,161,118,269,189,126,12,167,135,107,72,128,27,152,224,142,104,287,41,312,77,142,262,215,246,191,182,37,103,67,143,83,223,240,312,12,52,79,61,168,28,121,115,186,47,178,142],[1870,130,310,570,2050,200,670,300,120,290,1180,900,1730,1150,1160,1270,580,660,420,1080,290,270,560,4240,240,430,3020,1420,420,19830,420,530,8640,350,230,1620,190,2090,900,230,140,330,1010,300,1730,780,1300,930,690,200,450,280,4430,270,1340,670,410,4370,1310,1470,300,3630,220,560],[37,22,16,65,76,26,45,29,11,55,87,55,93,31,77,80,30,69,43,47,17,35,58,81,29,65,87,63,49,63,84,23,50,62,31,66,11,88,22,22,12,9,31,19,88,35,85,78,85,33,19,21,79,83,43,88,28,95,41,62,45,85,45,67]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>obs<\/th>\n      <th>CM<\/th>\n      <th>PGNP<\/th>\n      <th>FLR<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"dom":"tip","columnDefs":[{"className":"dt-right","targets":[1,2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>

---
### 儿童死亡率案例：散点图

绘制散点图1：


&lt;img src="06-multiple-reg-algebra-slide_files/figure-html/unnamed-chunk-4-1.png" style="display: block; margin: auto;" /&gt;

---
### 儿童死亡率案例：散点图

绘制散点图2：

&lt;img src="06-multiple-reg-algebra-slide_files/figure-html/unnamed-chunk-5-1.png" style="display: block; margin: auto;" /&gt;



---
### 儿童死亡率案例：二元模型

儿童死亡率的二元回归模型如下：

`$$\begin{equation} \begin{alignedat}{999} &amp;CM=&amp;&amp; + \beta_{1} &amp;&amp; + \beta_{2} PGNP&amp;&amp; + \beta_{3} FLR&amp;&amp;+u_i\\ \end{alignedat} \end{equation}$$`

以上二元回归模型的OLS估计结果如下：

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{CM}=&amp;&amp;+263.64&amp;&amp;-0.01PGNP&amp;&amp;-2.23FLR\\ &amp;\text{(t)}&amp;&amp;(22.7411)&amp;&amp;(-2.8187)&amp;&amp;(-10.6293)\\&amp;\text{(se)}&amp;&amp;(11.5932)&amp;&amp;(0.0020)&amp;&amp;(0.2099)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.7077;&amp;&amp; \bar{R^2}=0.6981\\&amp; &amp;&amp; F^{\ast}=73.83;&amp;&amp; p=0.0000 \end{alignedat} \end{equation}$$`

- 是如何分离出人均国民收入PNGP对CM的“真实”或净影响呢？

- 是如何分离出妇女识字率FLR对CM的“真实”或净影响呢？

---
### 儿童死亡率案例：一元回归重现（PGNP纯影响）

&lt;img src="pic/chpt6-children-mod-demo.png" width="713" style="display: block; margin: auto;" /&gt;

.pull-left[
**步骤1**：妇女识字率FLR对儿童死亡率CM的回归**模型1**：

`$$\begin{equation} \begin{alignedat}{999} &amp;CM=&amp;&amp; + \beta_{1} &amp;&amp; + \beta_{2} FLR&amp;&amp;+e_i\\ \end{alignedat} \end{equation}$$`

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{CM}=&amp;&amp;+263.86&amp;&amp;-2.39FLR\\ &amp;\text{(t)}&amp;&amp;(21.5840)&amp;&amp;(-11.2092)\\&amp;\text{(se)}&amp;&amp;(12.2250)&amp;&amp;(0.2133)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.6696;&amp;&amp; \bar{R^2}=0.6643\\&amp; &amp;&amp; F^{\ast}=125.65;&amp;&amp; p=0.0000 \end{alignedat} \end{equation}$$`
]

.pull-right[
**步骤2**：妇女识字率FLR对人均国民收入PGNP的回归**模型2**：

`$$\begin{equation} \begin{alignedat}{999} &amp;PGNP=&amp;&amp; + \beta_{1} &amp;&amp; + \beta_{2} FLR&amp;&amp;+e_i\\ \end{alignedat} \end{equation}$$`

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{PGNP}=&amp;&amp;-39.30&amp;&amp;+28.14FLR\\ &amp;\text{(t)}&amp;&amp;(-0.0535)&amp;&amp;(2.1950)\\&amp;\text{(se)}&amp;&amp;(734.9526)&amp;&amp;(12.8211)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.0721;&amp;&amp; \bar{R^2}=0.0571\\&amp; &amp;&amp; F^{\ast}=4.82;&amp;&amp; p=0.0319 \end{alignedat} \end{equation}$$`
]

---
### 儿童死亡率案例：一元回归重现（PGNP纯影响）

**步骤3**：分别得到两次一元线性回归的残差
`\(e_{1i}\)`（`resid1`）和
`\(e_{2i}\)`（`resid2`），然后进行**无截距**回归分析：



<div id="htmlwidget-a21da29cc9b12761b21f" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-a21da29cc9b12761b21f">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64"],[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64],[128,204,202,197,96,209,170,240,241,55,75,129,24,165,94,96,148,98,161,118,269,189,126,12,167,135,107,72,128,27,152,224,142,104,287,41,312,77,142,262,215,246,191,182,37,103,67,143,83,223,240,312,12,52,79,61,168,28,121,115,186,47,178,142],[37,22,16,65,76,26,45,29,11,55,87,55,93,31,77,80,30,69,43,47,17,35,58,81,29,65,87,63,49,63,84,23,50,62,31,66,11,88,22,22,12,9,31,19,88,35,85,78,85,33,19,21,79,83,43,88,28,95,41,62,45,85,45,67],[1870,130,310,570,2050,200,670,300,120,290,1180,900,1730,1150,1160,1270,580,660,420,1080,290,270,560,4240,240,430,3020,1420,420,19830,420,530,8640,350,230,1620,190,2090,900,230,140,330,1010,300,1730,780,1300,930,690,200,450,280,4430,270,1340,670,410,4370,1310,1470,300,3630,220,560],[6.66,6.15,7,6.25,3.81,6.44,6.19,5.89,5.89,2.36,3.93,5.99,3.5,7.41,4.21,5,5.27,5.21,6.5,6.12,6.19,5.05,6.16,1.8,4.75,4.1,6.66,7.28,8.12,5.23,5.79,6.5,7.17,6.6,7,3.91,6.7,4.2,5.43,6.5,6.25,7.1,7.1,7,3.46,5.66,4.82,5,4.74,8.49,6.5,6.5,1.69,3.25,7.17,3.52,6.09,2.86,4.88,3.89,6.9,4.1,6.09,7.2],[-47.4151623595669,-7.27260273972617,-23.6155788917896,88.5187263500631,13.8141826288463,7.28938136164971,13.7088058431844,45.4608694376815,3.43194098149071,-77.3862339033763,19.1096389076296,-3.38623390337626,-17.5473849403068,-24.7581385116306,14.2046786541903,23.3761667302221,-44.1486345369746,-0.919289548561203,-0.072186207503445,-33.5102021061277,45.7749171335543,8.8038455897451,0.785254172655541,-58.233337244434,-27.5391305623185,26.5187263500631,51.1096389076296,-41.2622657006248,-18.7292100554399,-86.2622657006248,88.9381508315978,15.1178932856179,-2.33871403009592,-11.6527617259687,97.2418614883694,-65.090777624593,74.4319409814907,23.5001349329735,-69.272602739726,50.727397260274,-20.1775629931653,3.65094893080286,1.24186148836937,-36.4440908157578,-16.4998650670265,-77.1961544102549,6.32864685694171,65.5951746795342,22.3286468569417,38.0228535390572,21.5559091842422,98.33690123493,-63.0143292951219,-13.4523451937461,-82.0721862075034,7.50013493297351,-28.9296265876624,-8.76639288961896,-44.8531782581913,-0.652761725968727,29.7088058431844,-13.6713531430583,21.7088058431844,38.2997184007509],[868.02422926872,-449.835616438353,-100.979554721188,-1219.9707254114,-49.5401718928751,-492.406324249802,-557.11718635417,-476.834355108386,-150.26616995688,-1218.54395588278,-1229.10961837435,-608.543955882784,-847.96568009152,316.880290985891,-967.682848845737,-942.110879704321,-224.977032061248,-1242.54143322284,-750.831832448447,-203.402540259893,-149.122231674049,-675.690416825555,-1032.97198674137,1999.74644334282,-536.834355108386,-1359.9707254114,610.890381625649,-313.685371505676,-919.687894165616,18096.3146284943,-1904.68158751577,-77.9782933912177,7272.16942888152,-1355.54269455281,-603.119709014109,-198.11340236426,-80.26616995688,-347.252295327213,320.164383561644,-349.835616438356,-158.408846909742,116.019183948843,176.880290985891,-195.407585579772,-707.252295327213,-165.690416825555,-1052.82426446863,-1225.8255257986,-1662.82426446863,-689.405062919832,-45.4075855797719,-271.692939485495,2246.03179724854,-2026.53891056291,169.168167551553,-1767.25229532721,-338.691678155525,1735.74896600276,195.453521457276,-235.542694552815,-927.11718635417,1277.17573553137,-1007.11718635417,-1286.25607931712]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>obs<\/th>\n      <th>CM<\/th>\n      <th>FLR<\/th>\n      <th>PGNP<\/th>\n      <th>TFR<\/th>\n      <th>resid1<\/th>\n      <th>resid2<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"dom":"tip","columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,6,7]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100],"rowCallback":"function(row, data) {\nDTWidget.formatRound(this, row, data, 6, 4, 3, ',', '.');\nDTWidget.formatRound(this, row, data, 7, 4, 3, ',', '.');\n}"}},"evals":["options.rowCallback"],"jsHooks":[]}</script>

对两个残差序列进一步构造如下的**无截距**回归模型：

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{resid1}=&amp;&amp;+\hat{\beta}_{1}resid2\\ \end{alignedat} \end{equation}$$`


---
### 儿童死亡率案例：一元回归重现（PGNP纯影响）

&lt;img src="pic/chpt6-children-mod-demo.png" width="713" style="display: block; margin: auto;" /&gt;
.pull-left[
残差模型将得到如下回归分析结果：

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{resid1}=&amp;&amp;-0.01resid2\\ &amp;\text{(t)}&amp;&amp;(-2.8645)\\&amp;\text{(se)}&amp;&amp;(0.0020)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.1152;&amp;&amp; \bar{R^2}=0.1012\\&amp; &amp;&amp; F^{\ast}=8.21;&amp;&amp; p=0.0057 \end{alignedat} \end{equation}$$`
]

.pull-right[
对比原来的二元回归模型结果：

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{CM}=&amp;&amp;+263.64&amp;&amp;-0.01PGNP&amp;&amp;-2.23FLR\\ &amp;\text{(t)}&amp;&amp;(22.7411)&amp;&amp;(-2.8187)&amp;&amp;(-10.6293)\\&amp;\text{(se)}&amp;&amp;(11.5932)&amp;&amp;(0.0020)&amp;&amp;(0.2099)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.7077;&amp;&amp; \bar{R^2}=0.6981\\&amp; &amp;&amp; F^{\ast}=73.83;&amp;&amp; p=0.0000 \end{alignedat} \end{equation}$$`
]

---
### 儿童死亡率案例：一元回归重现（FLR纯影响）

&lt;img src="pic/chpt6-children-mod-demo.png" width="713" style="display: block; margin: auto;" /&gt;

.pull-left[
**步骤1**：人均国民收入PGNP对儿童死亡率CM的回归**模型3**：

`$$\begin{equation} \begin{alignedat}{999} &amp;CM=&amp;&amp; + \beta_{1} &amp;&amp; + \beta_{2} PGNP&amp;&amp;+e_i\\ \end{alignedat} \end{equation}$$`

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{CM}=&amp;&amp;+157.42&amp;&amp;-0.01PGNP\\ &amp;\text{(t)}&amp;&amp;(15.9893)&amp;&amp;(-3.5157)\\&amp;\text{(se)}&amp;&amp;(9.8456)&amp;&amp;(0.0032)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.1662;&amp;&amp; \bar{R^2}=0.1528\\&amp; &amp;&amp; F^{\ast}=12.36;&amp;&amp; p=0.0008 \end{alignedat} \end{equation}$$`
]

.pull-right[
**步骤2**：人均国民收入PGNP对妇女识字率FLR的回归**模型4**：

`$$\begin{equation} \begin{alignedat}{999} &amp;FLR=&amp;&amp; + \beta_{1} &amp;&amp; + \beta_{2} PGNP&amp;&amp;+e_i\\ \end{alignedat} \end{equation}$$`

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{FLR}=&amp;&amp;+47.60&amp;&amp;+0.00PGNP\\ &amp;\text{(t)}&amp;&amp;(13.3876)&amp;&amp;(2.1950)\\&amp;\text{(se)}&amp;&amp;(3.5553)&amp;&amp;(0.0012)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.0721;&amp;&amp; \bar{R^2}=0.0571\\&amp; &amp;&amp; F^{\ast}=4.82;&amp;&amp; p=0.0319 \end{alignedat} \end{equation}$$`
]


---
### 儿童死亡率案例：一元回归重现（FLR纯影响）

**步骤3**：分别得到两次一元线性回归的残差
`\(e_{3i}\)`（`resid3`）和
`\(e_{4i}\)`（`resid4`），然后进行**无截距**回归分析：



<div id="htmlwidget-c7f0432532297f7b3b15" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-c7f0432532297f7b3b15">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64"],[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64],[128,204,202,197,96,209,170,240,241,55,75,129,24,165,94,96,148,98,161,118,269,189,126,12,167,135,107,72,128,27,152,224,142,104,287,41,312,77,142,262,215,246,191,182,37,103,67,143,83,223,240,312,12,52,79,61,168,28,121,115,186,47,178,142],[37,22,16,65,76,26,45,29,11,55,87,55,93,31,77,80,30,69,43,47,17,35,58,81,29,65,87,63,49,63,84,23,50,62,31,66,11,88,22,22,12,9,31,19,88,35,85,78,85,33,19,21,79,83,43,88,28,95,41,62,45,85,45,67],[1870,130,310,570,2050,200,670,300,120,290,1180,900,1730,1150,1160,1270,580,660,420,1080,290,270,560,4240,240,430,3020,1420,420,19830,420,530,8640,350,230,1620,190,2090,900,230,140,330,1010,300,1730,780,1300,930,690,200,450,280,4430,270,1340,670,410,4370,1310,1470,300,3630,220,560],[6.66,6.15,7,6.25,3.81,6.44,6.19,5.89,5.89,2.36,3.93,5.99,3.5,7.41,4.21,5,5.27,5.21,6.5,6.12,6.19,5.05,6.16,1.8,4.75,4.1,6.66,7.28,8.12,5.23,5.79,6.5,7.17,6.6,7,3.91,6.7,4.2,5.43,6.5,6.25,7.1,7.1,7,3.46,5.66,4.82,5,4.74,8.49,6.5,6.5,1.69,3.25,7.17,3.52,6.09,2.86,4.88,3.89,6.9,4.1,6.09,7.2],[-8.17291238519205,48.0529383886408,48.098540032727,46.0532979630739,-38.1273107411058,53.8484501391188,20.1897433208996,85.9848954969445,84.9392938528582,-99.1287490388381,-69.0143853541894,-18.1964323561013,-113.763935886148,20.6446810384629,-50.2416744257545,-46.9915845321462,-2.83305750114357,-51.923901214883,8.34862992633531,-27.1508307120151,114.871250961162,34.6439618895968,-25.0603465727087,-97.2391574047229,12.3030282822491,-17.5377255378821,-16.1037907701965,-69.2869164954077,-24.6513700736647,94.9326738803038,-0.651370073664687,72.5987198199436,82.7644383396079,-49.4468818241427,132.189383746466,-98.0140257797563,156.734805603336,-56.6727325979755,-5.19643235610133,107.189383746466,59.1665829244234,92.3258291042922,45.0536575375069,27.9848954969445,-100.763935886148,-45.5601667854922,-75.6506509247985,-3.85549874875361,-66.5829676075353,67.8484501391188,87.689563533683,157.757606425379,-95.0799112248541,-102.356038110403,-63.1960727816682,-88.8102566791004,15.2349853905527,-79.7617784395495,-21.537006389016,-25.7186938164948,31.9848954969445,-69.1714740874597,23.0757392106839,-9.0603465727087],[-15.3885501127756,-25.9302520941526,-32.3914553374584,15.9423621999888,23.1502466439185,-22.1096089109937,-4.31386182407004,-19.3658329350525,-36.9046296917466,6.6597894673534,36.3793956532301,5.09682292059473,40.9701635209067,-19.5437371395523,26.4306404580419,29.1487940315772,-19.0832602024171,19.7117605783358,-5.67330176392304,-3.36438032271111,-31.3402105326466,-13.2889657278348,8.96798460239464,22.5389405170309,-19.2120985206172,16.3010758336711,31.6648736105482,11.764457995489,0.326698236076959,-35.4063848337358,35.326698236077,-25.9551481903877,-19.7349165415563,13.5060550529181,-17.1864761182113,14.2520099473714,-37.0839865085878,35.047757034295,-27.9031770794053,-26.1864761182113,-35.9558744965584,-39.4427001422701,-19.1850235058699,-29.3658329350525,35.9701635209067,-14.5957082505347,34.0719268243595,28.0199557133771,35.6348933711182,-15.1096089109937,-29.7501689711407,-27.3145881302407,20.0521148713191,34.7110342721652,-8.03056278526399,38.68613817593,-20.6476793615172,36.2058492857544,-9.95369557804634,10.6363459834596,-3.36583293505248,28.1019070637895,-3.16085371580545,17.9679846023946]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>obs<\/th>\n      <th>CM<\/th>\n      <th>FLR<\/th>\n      <th>PGNP<\/th>\n      <th>TFR<\/th>\n      <th>resid3<\/th>\n      <th>resid4<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"dom":"tip","columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,6,7]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100],"rowCallback":"function(row, data) {\nDTWidget.formatRound(this, row, data, 6, 4, 3, ',', '.');\nDTWidget.formatRound(this, row, data, 7, 4, 3, ',', '.');\n}"}},"evals":["options.rowCallback"],"jsHooks":[]}</script>

对两个残差序列进一步构造如下的**无截距**回归模型：

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{resid3}=&amp;&amp;+\hat{\beta}_{1}resid4\\ \end{alignedat} \end{equation}$$`


---
### 儿童死亡率案例：一元回归重现（FLR纯影响）

&lt;img src="pic/chpt6-children-mod-demo.png" width="713" style="display: block; margin: auto;" /&gt;

.pull-left[
残差模型将得到如下回归分析结果：

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{resid3}=&amp;&amp;-2.23resid4\\ &amp;\text{(t)}&amp;&amp;(-10.8021)\\&amp;\text{(se)}&amp;&amp;(0.2066)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.6494;&amp;&amp; \bar{R^2}=0.6438\\&amp; &amp;&amp; F^{\ast}=116.69;&amp;&amp; p=0.0000 \end{alignedat} \end{equation}$$`
]

.pull-right[
对比原来的二元回归模型结果：

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{CM}=&amp;&amp;+263.64&amp;&amp;-0.01PGNP&amp;&amp;-2.23FLR\\ &amp;\text{(t)}&amp;&amp;(22.7411)&amp;&amp;(-2.8187)&amp;&amp;(-10.6293)\\&amp;\text{(se)}&amp;&amp;(11.5932)&amp;&amp;(0.0020)&amp;&amp;(0.2099)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.7077;&amp;&amp; \bar{R^2}=0.6981\\&amp; &amp;&amp; F^{\ast}=73.83;&amp;&amp; p=0.0000 \end{alignedat} \end{equation}$$`
]

---
## 偏回归系数的OLS估计：模型

样本回归函数SRF、样本回归模型SRM、样本回归函数的离差形式：
`$$\begin {align} 
 \hat{Y}_{i} &amp;=\hat{\beta}_{1}+\hat{\beta}_{2} X_{2 i}+\hat{\beta}_{3} X_{3 i} \\ 
 Y_{i} &amp;=\hat{\beta}_{1}+\hat{\beta}_{2} X_{2 i}+\hat{\beta}_{3} X_{3 i}+e_{i} \\ 
 \hat{y}_{i} &amp;=\hat{\beta}_{2} x_{2 i}+\hat{\beta}_{3} x_{3 i}
\end {align}$$`

总体回归函数PRF和总体回归模型PRM：

`$$\begin {align} 
\mathrm{E}\left( Y_{i} | (X_{2 i}, X_{3 i} ) \right) &amp; =\beta_{1}+\beta_{2} X_{2 i}+\beta_{3} X_{3 i} \\ 
Y_{i} &amp;=\beta_{1}+\beta_{2} X_{2 i}+\beta_{3} X_{3 i}+u_{i}
\end {align}$$`

---
## 偏回归系数的OLS估计：OLS方法

`$$\begin {align} 
\begin{array}{c}{\mathrm{E}\left(Y_{i}\left|\left(X_{2 i}, X_{3 i}\right)=\beta_{1}+\beta_{2} X_{2 i}+\beta_{3} X_{3 i}\right.\right.} \\ {Y_{i}=\beta_{1}+\beta_{2} X_{2 i}+\beta_{3} X_{3 i}+u_{i}}\end{array}
\end {align}$$`
 

`$$\begin {align} 
\frac{\partial \sum{e_i^2}} {\partial \hat{\beta}_{1}} &amp; =2 \sum\left(Y_{i}-\hat{\beta}_{1}-\hat{\beta}_{2} X_{2 i}-\hat{\beta}_{3} X_{3 i}\right)(-1)  =0 \\ 
\frac{\partial \sum{e_i^2}} {\partial \hat{\beta}_{2}} &amp; =2 \sum\left(Y_{i}-\hat{\beta}_{1}-\hat{\beta}_{2} X_{2 i}-\hat{\beta}_{3} X_{3 i}\right)\left(-X_{2 i}\right)  =0 \\ 
\frac{\partial \sum e_i^2} {\partial \hat{\beta}_{3}} &amp; =2 \sum\left(Y_{i}-\hat{\beta}_{1}-\hat{\beta}_{2} X_{2 i}-\hat{\beta}_{3} X_{3 i}\right)\left(-X_{3 i}\right)  =0
\end {align}$$`

`$$\begin {align} 
\overline{Y} &amp;=\hat{\beta}_{1}+\hat{\beta}_{2} \overline{X}_{2}+\hat{\beta}_{3} \overline{X}_{3} \\ 
\sum_{i} Y_{2 i} &amp;=\hat{\beta}_{1} \sum X_{2 i}+\hat{\beta}_{2} \sum X_{2 i}^{2}+\hat{\beta}_{3} \sum X_{2 i} X_{3 i} \\ 
\sum Y_{i} X_{3 i} &amp;=\hat{\beta}_{1} \sum X_{3 i}+\hat{\beta}_{2} \sum X_{2 i} X_{3 i}+\hat{\beta}_{3} \sum X_{3 i}^{2}
\end {align}$$`

---

## 回归系数的OLS估计：回归系数

`$$\begin {align} 
\hat{\beta}_{1} &amp;=\overline{Y}-\hat{\beta}_{2} \overline{X}-\hat{\beta}_{3} \overline{X}_{3} \\ 
\hat{\beta}_{2} &amp;=\frac{\left(\sum y_{i} x_{2 i}\right)\left(\sum x_{3 i}^{2}\right)-\left(\sum y_{i} x_{3 i}\right)\left(\sum x_{2 i} x_{3 i}\right)}{\left(\sum x_{2 i}^{2}\right)\left(\sum x_{3 i}^{2}\right)-\left(\sum x_{2 i} x_{3 i}\right)^{2}} \\ 
\hat{\beta}_{3} &amp;=\frac{\left(\sum y_{i} x_{3 i}\right)\left(\sum x_{2 i}^{2}\right)-\left(\sum y_{i} x_{2 i}\right)\left(\sum x_{2 i} x_{3 i}\right)}{\left(\sum x_{2 i}^{2}\right)\left(\sum x_{3 i}^{2}\right)-\left(\sum x_{2 i} x_{3 i}\right)^{2}} 
\end {align}$$`

**偏斜率系数**
`\((\hat{\beta}_2,\hat{\beta}_3)\)`OLS估计量公式的特点：

- 公式是**对称的**。通过对调
`\(x_{2i},x_{3i}\)`而得到另一个。

- 两个方程的分母完全相同。

- 三变量情形是双变量情形的自然而然的推广。


---

## 回归系数的OLS估计：随机干扰项的方差

对于二元回归模型：

`$$\begin {align} 
Y_{i} &amp;=\beta_{1}+\beta_{2} X_{2 i}+\beta_{3} X_{3 i}+u_{i}
\end {align}$$`

在CLRM假设下，
`\(var(u_i) \equiv \sigma^2\)`，可以证明其OLS估计量（证明略）：

.pull-left[
`$$\begin {align} 
\hat{\sigma}^{2}=\frac{\sum \mathrm{e}_{i}^{2}}{n-3}
\end {align}$$`
]


.pull-right[
`$$\begin {align} 
(n-3) \frac{\hat{\sigma}^{2}}{\sigma^{2}} \sim \chi^{2}(n-3)
\end {align}$$`
]

其中：

`$$\begin {align} 
\begin{aligned} \sum e_{i}^{2} &amp;=\sum\left(e_{i} e_{i}\right) =\sum e_{i}\left(y_{i}-\hat{\beta}_{2} x_{2 i}-\hat{\beta}_{3} x_{3 i}\right) \\ 
&amp;=\sum e_{i} y_{i}  &amp;&amp; \leftarrow \left[ \sum e_{i} x_{2 i}=\sum e_{i} x_{3 i}=0 \right] \\
&amp;=\sum y_{i}\left(y_{i}-\hat{\beta}_{2} x_{2 i}-\hat{\beta}_{3} x_{3 i}\right) \\ 
&amp;=\sum y_{i}^{2}-\hat{\beta}_{2} \sum y_{i} x_{2 i}-\hat{\beta}_{3} \sum y_{i} x_{3 i} \end{aligned}
\end {align}$$`

---

## 回归系数的OLS估计：方差和标准差

`\(\hat{\beta}_1\)`的**真实方差**：

`$$\begin {align} 
\operatorname{var}\left(\hat{\beta}_{1}\right) \equiv \sigma_{\hat{\beta}_1}^{2}
=\left[\frac{1}{n}+\frac{\overline{X}_{2}^{2} \sum x_{3 i}^{2}+\overline{X}_{3}^{2} \sum x_{2 i}^{2}-2 \overline{X}_{2} \overline{X}_{3} \sum x_{2 i} x_{3 i}}{\sum x_{2 i}^{2} \sum x_{3 i}^{2}-\left(\sum x_{2 i} x_{3 i}\right)^{2}}\right] \cdot \sigma^{2}
\end {align}$$`


`\(\hat{\beta}_1\)`的**样本方差**：

`$$\begin {align} 
S_{\hat{\beta}_1}^{2}
=\left[\frac{1}{n}+\frac{\overline{X}_{2}^{2} \sum x_{3 i}^{2}+\overline{X}_{3}^{2} \sum x_{2 i}^{2}-2 \overline{X}_{2} \overline{X}_{3} \sum x_{2 i} x_{3 i}}{\sum x_{2 i}^{2} \sum x_{3 i}^{2}-\left(\sum x_{2 i} x_{3 i}\right)^{2}}\right] \cdot \hat{\sigma}^{2}
\end {align}$$`

---

## 回归系数的OLS估计：方差和标准差

`\(\hat{\beta}_2\)`的**真实方差**：

`$$\begin {align} 
\operatorname{var}\left(\hat{\beta}_{2}\right) &amp;\equiv
\sigma_{\hat{\beta}_{2}}^{2}  =\frac{\sum x_{3 i}^{2}}{\left(\sum x_{2 i}^{2}\right)\left(\sum x_{3 i}^{2}\right)-\left(\sum x_{2 i} x_{3 i}\right)^{2}} \sigma^{2} 
\\ 
&amp; =\frac{\sigma^{2}}{\sum x_{2 i}^{2}\left(1-r_{23}^{2}\right)} &amp;&amp; \leftarrow \left[ r_{23}^{2}=\frac{\left(\sum x_{2 i} x_{3 i}\right)^{2}}{\sum x_{2 i}^{2} \sum x_{3 i}^{2}} \right] 
\end {align}$$`


`\(\hat{\beta}_2\)`的**样本方差**：

`$$\begin {align} 
S_{\hat{\beta}_{2}}^{2} 
&amp; =\frac{\sum x_{3 i}^{2}}{\left(\sum x_{2 i}^{2}\right)\left(\sum x_{3 i}^{2}\right)-\left(\sum x_{2 i} x_{3 i}\right)^{2}} \hat{\sigma}^{2} 
\\ 
&amp; =\frac{\hat{\sigma}^{2}}{\sum x_{2 i}^{2}\left(1-r_{23}^{2}\right)} &amp;&amp; \leftarrow \left[ r_{23}^{2}=\frac{\left(\sum x_{2 i} x_{3 i}\right)^{2}}{\sum x_{2 i}^{2} \sum x_{3 i}^{2}} \right] 
\end {align}$$`

---

## 回归系数的OLS估计：方差和标准差

`\(\hat{\beta}_3\)`的**真实方差**：

`$$\begin {align} 
\operatorname{var}\left(\hat{\beta}_{3}\right) &amp;\equiv
\sigma_{\hat{\beta}_{3}}^{2}  =\frac{\sum x_{2 i}^{2}}{\left(\sum x_{2 i}^{2}\right)\left(\sum x_{3 i}^{2}\right)-\left(\sum x_{2 i} x_{3 i}\right)^{2}} \sigma^{2} 
\\ 
&amp; =\frac{\sigma^{2}}{\sum x_{3 i}^{2}\left(1-r_{23}^{2}\right)} &amp;&amp; \leftarrow \left[ r_{23}^{2}=\frac{\left(\sum x_{2 i} x_{3 i}\right)^{2}}{\sum x_{2 i}^{2} \sum x_{3 i}^{2}} \right] 
\end {align}$$`


`\(\hat{\beta}_3\)`的**样本方差**：

`$$\begin {align} 
S_{\hat{\beta}_{3}}^{2} 
&amp; =\frac{\sum x_{2 i}^{2}}{\left(\sum x_{2 i}^{2}\right)\left(\sum x_{3 i}^{2}\right)-\left(\sum x_{2 i} x_{3 i}\right)^{2}} \hat{\sigma}^{2} 
\\ 
&amp; =\frac{\hat{\sigma}^{2}}{\sum x_{3 i}^{2}\left(1-r_{23}^{2}\right)} &amp;&amp; \leftarrow \left[ r_{23}^{2}=\frac{\left(\sum x_{2 i} x_{3 i}\right)^{2}}{\sum x_{2 i}^{2} \sum x_{3 i}^{2}} \right] 
\end {align}$$`

---

## 回归系数的OLS估计：协方差

随机变量
`\(\hat{\beta}_{2}\)`和
`\(\hat{\beta}_{3}\)`之间的**协方差**为：

`$$\begin {align} 
\operatorname{cov}\left(\hat{\beta}_{2}, \hat{\beta}_{3}\right) &amp; =\frac{-r_{23} \sigma^{2}}{\left(1-r_{23}^{2}\right) \sqrt{\sum x_{2 i}^{2}} \sqrt{\sum x_{3 i}^{2}}} &amp;&amp; \leftarrow \left[ r_{23}^{2}=\frac{\left(\sum x_{2 i} x_{3 i}\right)^{2}}{\sum x_{2 i}^{2} \sum x_{3 i}^{2}} \right] 
\end {align}$$`


随机变量
`\(\hat{\beta}_{2}\)`和
`\(\hat{\beta}_{3}\)`之间的**样本协方差**为：

`$$\begin {align} 
S^2_{\hat{\beta}_{2} \hat{\beta}_{3}} &amp; =\frac{-r_{23} \hat{\sigma}^{2}}{\left(1-r_{23}^{2}\right) \sqrt{\sum x_{2 i}^{2}} \sqrt{\sum x_{3 i}^{2}}} &amp;&amp; \leftarrow \left[ r_{23}^{2}=\frac{\left(\sum x_{2 i} x_{3 i}\right)^{2}}{\sum x_{2 i}^{2} \sum x_{3 i}^{2}} \right] 
\end {align}$$`

---
## OLS估计量的特征

**特征1**：三变量回归面通过均值点
`\((\bar{Y},\bar{X}_2, \bar{X}_3)\)`

`$$\begin{align}
\bar{Y} = \hat{\beta}_1 +\hat{\beta}_2\bar{X}_2  +\hat{\beta}_3\bar{X}_3
\end{align}$$`

`$$\begin{align}
\bar{Y} = \hat{\beta}_1 +\hat{\beta}_2\bar{X}_2  +\hat{\beta}_3\bar{X}_3 + \cdots +\hat{\beta}_k\bar{X}_k
\end{align}$$`

**特征2**：
`\(Y_i\)`的**估计值**(
`\(\hat{Y}_i\)`)的均值(
`\(\bar{\hat{Y_i}}\)`)等于Y的样本均值(
`\(\bar{Y}\)`)

`$$\begin{align}
\hat{Y_i} &amp;= \hat{\beta}_1 +\hat{\beta}_2\bar{X}_2 +\hat{\beta}_3\bar{X}_3 \\
&amp; =(\bar{Y} - \hat{\beta}_2\bar{X} -\hat{\beta}_3\bar{X}_3 ) + \hat{\beta_2}X_i +\hat{\beta}_3 X_{3i} \\
&amp; = \bar{Y} - \hat{\beta}_2(X_{2i} - \bar{X}_2) - \hat{\beta}_3(X_{3i} - \bar{X}_3) 
\end{align}$$`

`$$\begin{align}
&amp;\Rightarrow  1/n\sum{\hat{Y_i}} =  1/n\sum{ \left( \bar{Y} - \hat{\beta}_2(X_{2i} - \bar{X}_2) - \hat{\beta}_3(X_{3i} - \bar{X}_3) \right) } \\
&amp;\Rightarrow  \bar{\hat{Y_i}}  = \bar{Y}
\end{align}$$`

---
## OLS估计量的特征

**特征3**：残差的均值(
`\(\bar{e_i}\)`)为零：

`$$\begin{align}
\frac{\partial \sum e_{i}^{2}}{\partial \hat{\beta}_{1}}=2 \sum\left(Y_{i}-\hat{\beta}_{1}-\hat{\beta}_{2} X_{2 i}-\hat{\beta}_{3} X_{3 i}\right)(-1)&amp;=0 \\
\sum{\left[ Y_i- \hat{\beta}_1 - \hat{\beta}_2X_i -\hat{\beta}_{3} X_{3 i}\right]}  &amp;=0 \\
\sum{( Y_i- \hat{Y}_i )} &amp;=0 \\
\sum{e_i}  &amp;=0 \\
\bar{e_i} &amp;=0
\end{align}$$`

---
## OLS估计量的特征

**特征4**：残差(
`\(e_i\)`)和
`\(Y_i\)`的拟合值(
`\(\hat{Y_i}\)`)不相关

`$$\begin{align}
Cov(e_i, \hat{Y_i}) &amp;= E \left[ \left( e_i-E(e_i)\right )\cdot \left( \hat{Y_i}-E(\hat{Y_i})\right ) \right]\\
&amp; = E(e_i \cdot \hat{y_i}) \\
&amp; = \sum \mathrm{e}_{i}\left(\hat{y}_{i}+\bar{Y}\right)\\
&amp; =\sum \mathrm{e}_{i} \hat{y}_{i}+\bar{Y} \sum e_{i}\\
&amp; =0
\end{align}$$`

其中：

`$$\begin {align} 
\sum \hat{y}_{i} \mathrm{e}_{i} &amp;=\hat{\beta}_{2} \sum x_{2 i} e_{i}+\hat{\beta}_{3} \sum x_{3 i} e_{i} &amp;&amp; \leftarrow \left[ \hat{y}_{i}=\hat{\beta}_{2} x_{2 i}+\hat{\beta}_{3} x_{3 i} \right] \\ 
&amp;=\hat{\beta}_{2} \sum\left(X_{2 i}-\overline{X}_{2}\right) e_{i}+\hat{\beta}_{3} \sum\left(X_{3 i}-\overline{X}_{3}\right) e_{i} \\ 
&amp;=\hat{\beta}_{2} \sum X_{2 i} e_{i}-\hat{\beta}_{2} \overline{X}_{2} \sum e_{i}+\hat{\beta}_{3} \sum X_{3 i} e_{i}-\hat{\beta}_{3} \overline{X}_{3} \sum e_{i} \\ &amp;=0 
 \end {align}$$`

---
## OLS估计量的特征

**特征5**：残差(
`\(e_i\)`)和自变量(
`\(X_{2i},X_{3i}\)`)不相关

`$$\begin {align} 
\frac{\partial \sum e_{i}^{2}}{\partial \hat{\beta}_{2}} &amp; =2 \sum\left(Y_{i}-\hat{\beta}_{1}-\hat{\beta}_{2} X_{2 i}-\hat{\beta}_{3} X_{3 i}\right)\left(-X_{2 i}\right)=0 \\ 
\frac{\partial \sum e_{i}^{2}}{\partial \hat{\beta}_{3}} &amp;=2 \sum\left(Y_{i}-\hat{\beta}_{1}-\hat{\beta}_{2} X_{2 i}-\hat{\beta}_{3} X_{3 i}\right)\left(-X_{3 i}\right)=0\\
\sum{e_iX_{2i}} &amp;=0 \\
\sum{e_iX_{3i}} &amp;=0
\end {align}$$`

---
## OLS估计量的特征

**特征6**：
`\(var(\hat{\beta}_2)\)`和
`\(var(\hat{\beta}_2)\)`的关系。

`$$\begin{align}
\operatorname{var}\left(\hat{\beta}_{2}\right)=\sigma_{\hat{\beta}_{2}}^{2} &amp; =\frac{\sigma^{2}}{\sum x_{2 i}^{2}\left(1-r_{23}^{2}\right)} \\
\operatorname{var}\left(\hat{\beta}_{3}\right)=\sigma_{\hat{\beta}_{3}}^{2} &amp;=\frac{\sigma^{2}}{\sum x_{3 i}^{2}\left(1-r_{23}^{2}\right)} \\
r_{23}^{2} &amp;= \frac{\left(\sum x_{2 i} x_{3 i}\right)^{2}}{\sum x_{2 i}^{2} \sum x_{3 i}^{2}}
\end{align}$$`

`$$r_{23} \rightarrow 1, \operatorname{var}\left(\hat{\beta}_{3}\right) \rightarrow \infty ; \operatorname{var}\left(\hat{\beta}_{3}\right) \rightarrow \infty$$`

- 给定
`\(\sum{x_{ki}^2},\sigma^2\)`：真值
`\(\beta_i\)`的估计将变得很困难。

- 给定
`\(\sum{x_{ki}^2},r_{23}^2\)`：
`\(var(\hat{\beta}_i)\)`与总体方差呈正比。

- 给定
`\(\sigma^2,r_{23}^2\)`：
`\(var(\hat{\beta}_i)\)`与
`\(\sum{x_{ki}^2}\)`呈反比。表明
`\(x_{ki}\)`样本值变化越大，真值
`\(\beta_i\)`的估计精度越高！

---
## 多元判定系数

**多元判定系数**：在三变量（或者更多变量）的模型中，衡量Y的变异由变量
`\((X_{2i},X_{3i})\)`等联合解释的比重，记作
`\(R^2\)`。

`$$\begin {align} 
Y_{i} &amp;=\hat{\beta}_{1}+\hat{\beta}_{2} X_{2 i}+\hat{\beta}_{3} X_{3 i}+e_{i} \\ 
\overline{Y} &amp;=\hat{\beta}_{1}+\hat{\beta}_{2} \overline{X}_{2}+\hat{\beta}_{3} \overline{X}_{3} \\ 
y_{i} &amp;=\hat{\beta}_{2} x_{2 i}+\hat{\beta}_{3} x_{3 i}+e_{i} \\ &amp;=\hat{y}_{i}+e_{i} 
\end {align}$$`

`$$\begin{alignedat}{2}
&amp;&amp;(Y_i - \bar{Y}) &amp;&amp;= (\hat{Y}_i - \bar{Y}) &amp;&amp;+ (Y_i - \hat{Y}_i ) \\
&amp;&amp;y_i &amp;&amp;= \hat{y}_i &amp;&amp;+ e_i \\
&amp;&amp;\sum{y_i^2} &amp;&amp;= \sum{\hat{y}_i^2} &amp;&amp;+ \sum{e_i^2} \\
&amp;&amp;TSS &amp;&amp;=ESS &amp;&amp;+RSS
\end{alignedat}$$`

---
## 多元判定系数

`$$\begin {align} 
RSS &amp;= \sum e_{i}^{2}=\sum y_{i}^{2}-\hat{\beta}_{2} \sum y_{i} x_{2 i}-\hat{\beta}_{3} \sum y_{i} x_{3 i} \\
ESS &amp;=\sum \hat{y}_{i}^{2}=\hat{\beta}_{2} \sum y_{i} x_{2 i}+\hat{\beta}_{3} \sum y_{i} x_{3 i} \\
TSS &amp;= \sum y_{i}^{2}=\sum \hat{y}_{i}^{2}+\left(\sum y_{i}^{2}-\hat{\beta}_{2} \sum y_{i} x_{2 i}-\hat{\beta}_{3} \sum y_{i} x_{3 i}\right)
\end {align}$$`

`$$\begin {align} 
R^{2}=\frac{E S S}{T S S}=1-\frac{\mathrm{RSS}}{T S S}=1-\frac{\sum e_{i}^{2}}{\sum y_{i}^{2}}=\frac{\hat{\beta}_{2} \sum y_{i} x_{2 i}+\hat{\beta}_{3} \sum y_{i} x_{3 i}}{\sum y_{i}^{2}}
\end {align}$$`

比较一元回归下的判定系数：

`$$\begin {align} 
r^{2}=\frac{E S S}{T S S}=\frac{\hat{\beta}_{2}^{2} \sum x_{i}^{2}}{\sum y_{i}^{2}}=\hat{\beta}_{2}\left(\frac{\sum x_{i}^{2}}{\sum y_{i}^{2}}\right) 
\end {align}$$`


---
## 多元判定系数

`$$\begin {align} 
R^{2}=\frac{E S S}{T S S}=1-\frac{\mathrm{RSS}}{T S S}=1-\frac{\sum e_{i}^{2}}{\sum y_{i}^{2}}=\frac{\hat{\beta}_{2} \sum y_{i} x_{2 i}+\hat{\beta}_{3} \sum y_{i} x_{3 i}}{\sum y_{i}^{2}}
\end {align}$$`

- 分母部分与
`\(X_{ki}\)`的变量数**无关**：

`$$\sum y_{i}^{2}=\sum\left(Y_{i}-\overline{Y}\right)^{2}$$`

- 分子部分与
`\(X_{ki}\)`的变量数**有关**：

`$$\sum e_{i}^{2}=\sum y_{i}^{2}-\hat{\beta}_{2} \sum y_{i} x_{2 i}-\hat{\beta}_{3} \sum y_{i} x_{3 i}$$`
- 如果
`\(X_{ki}\)`的变量数**增加**，RSS会**减小**，而TSS总是**不变**，因此判定系数
`\(R^2\)`自然会**变大**。一般而言，自变量数越多，判定系数约接近于1。

- 启示：模型选择时，较高的
`\(R^2\)`可能来自解释变量个数的增加，并不能说明模型就一定更好。 

---
## 调整多元判定系数

**调整判定系数**（adjusted R square）： 利用相应的自由度对平方和进行校正，基于此计算得到的判定系数，记为
`\(\bar{R}^2\)`。对于如下的多元回归方程：

`$$\begin {align} 
Y_{i}=\beta_{1}+\beta_{2} X_{2 i}+\beta_{3} X_{3 i} + \cdots +\beta_{k} X_{k i}+u_{i} 
\end {align}$$`

则**调整判定系数**
`\(\bar{R}^2\)`可以计算为：

`$$\begin {align} 
\overline{R}^{2}= 1-\frac{\sum \mathrm{e}_{i}^{2} /(n-k)}{\sum y_{i}^{2} /(n-1)}
\end {align}$$`

---
## 调整多元判定系数

**调整判定系数**
`\(\bar{R}^2\)`还可以计算为：

`$$\begin {align} 
\bar{R}^{2}&amp;=1-\frac{\hat{\sigma}^{2}}{S_{Y}^{2}}  
&amp;&amp; \leftarrow \left[\hat{\sigma}^{2} =\frac{\sum \mathrm{e}_{i}^{2}}{n-k}  \right] \\ 
\bar{R}^{2} &amp;=1-\left(1-R^{2}\right) \frac{n-1}{n-k} 
&amp;&amp; \leftarrow \left[ S_{Y}^{2}=\frac{\sum(Y-\bar{Y})^{2}}{n-1} \right] 
\end {align}$$`

- 如果
`\(k=1\)`，则
`\(R^2= \bar{R}^2\)`。

- 如果
`\(k&gt;1\)`，则
`\(R^2 &gt; \bar{R}^2\)`。表明随着变量数的增多，
`\(\bar{R}^2\)`相对要增大得慢一些。

- 
`\(R^2 \geq 0\)`，但
`\(\bar{R}^2\)`可以小于0

- 不能单凭最高的
`\(\bar{R}^2\)`之值来选择模型，可参考的标准还可以有AIC、APC等。


---
### 模型选择的标准：儿童死亡率案例

人均国民收入PGNP和妇女识字率FLR对儿童死亡率CM的二元回归**模型1**：可以在不同回归元之间进行分配吗？

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{CM}=&amp;&amp;+263.64&amp;&amp;-0.01PGNP&amp;&amp;-2.23FLR\\ &amp;\text{(t)}&amp;&amp;(22.7411)&amp;&amp;(-2.8187)&amp;&amp;(-10.6293)\\&amp;\text{(se)}&amp;&amp;(11.5932)&amp;&amp;(0.0020)&amp;&amp;(0.2099)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.7077;&amp;&amp; \bar{R^2}=0.6981\\&amp; &amp;&amp; F^{\ast}=73.83;&amp;&amp; p=0.0000 \end{alignedat} \end{equation}$$`

.pull-left[
妇女识字率FLR对死亡率CM的回归**模型2**：

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{CM}=&amp;&amp;+263.86&amp;&amp;-2.39FLR\\ &amp;\text{(t)}&amp;&amp;(21.5840)&amp;&amp;(-11.2092)\\&amp;\text{(se)}&amp;&amp;(12.2250)&amp;&amp;(0.2133)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.6696;&amp;&amp; \bar{R^2}=0.6643\\&amp; &amp;&amp; F^{\ast}=125.65;&amp;&amp; p=0.0000 \end{alignedat} \end{equation}$$`

]

.pull-right[
人均国民收入PGNP对死亡率CM的回归**模型3**：

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{CM}=&amp;&amp;+157.42&amp;&amp;-0.01PGNP\\ &amp;\text{(t)}&amp;&amp;(15.9893)&amp;&amp;(-3.5157)\\&amp;\text{(se)}&amp;&amp;(9.8456)&amp;&amp;(0.0032)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.1662;&amp;&amp; \bar{R^2}=0.1528\\&amp; &amp;&amp; F^{\ast}=12.36;&amp;&amp; p=0.0008 \end{alignedat} \end{equation}$$`
]

---
### 模型选择的标准：柯布道格拉斯生产曲线案例

以**柯布道格拉斯生产**模型为例：

`$$\begin {align} 
Y_{i}=\beta_{1} X_{2 i}^{\beta_{2}} X_{3 i}^{\beta_{3}} e^{u_{i}}
\end {align}$$`

`$$\begin {align} 
\ln Y_{i} &amp;=\ln \beta_{1}+\beta_{2} \ln X_{2 i}+\beta_{3} \ln X_{3 i}+u_{i} \\ 
&amp;=\beta_{0}+\beta_{2} \ln X_{2 i}+\beta_{3} \ln X_{3 i}+u_{i} &amp;&amp; \leftarrow \left[ \beta_{0}=\ln \beta_{1} \right]
 \end {align}$$`

---
### 模型选择的标准：柯布道格拉斯生产曲线（数据）


 

&lt;div class="figure" style="text-align: center"&gt;
<div id="htmlwidget-a2be02f0aa249db23782" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-a2be02f0aa249db23782">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51"],["Alabama","Alaska","Arizona","Arkansas","California","Colorado","Connecticut","Delaware","District of Columbia","Florida","Georgia","Hawaii","Idaho","Illinois","Indiana","Iowa","Kansas","Kentucky","Louisiana","Maine","Maryland","Massachusetts","Michigan","Minnesota","Mississippi","Missouri","Montana","Nebraska","Nevada","New Hampshire","New Jersey","New Mexico","New York","North Carolina","North Dakota","Ohio","Oklahoma","Oregon","Pennsylvania","Rhode Island","South Carolina","South Dakota","Tennessee","Texas","Utah","Vermont","Virginia","Washington","West Virginia","Wisconsin","Wyoming"],[38372840,1805427,23736129,26981983,217546032,19462751,28972772,14313157,159921,47289846,63015125,1809052,10511786,105324866,90120459,39079550,22826760,38686340,69910555,7856947,21352966,46044292,92335528,48304274,17207903,47340157,2644567,14650080,7290360,9188322,51298516,20401410,87756129,101268432,3556025,124986166,20451196,34808109,104858322,6541356,37668126,4988905,62828100,172960157,15702637,5418786,49166991,46164427,9185967,66964978,2979475],[424471,19895,206893,304055,1809756,180366,224267,54455,2029,471211,659379,17528,75414,963156,835083,336159,246144,384484,216149,82021,174855,355701,943298,456553,267806,439427,24167,163637,59737,96106,407076,43079,727177,820013,34723,1174540,201284,257820,944998,68987,400317,56524,582241,1120382,150030,48134,425346,313279,89639,694628,15221],[2689076,57997,2308272,1376235,13554116,1790751,1210229,421064,7188,2761281,3540475,146371,848220,5870409,5832503,1795976,1595118,2503693,4726625,415131,1729116,2706065,5294356,2833525,1212281,2404122,334008,627806,522335,507488,3295056,404749,4260353,4086558,184700,6301421,1327353,1456683,5896392,297618,2500071,311251,4126465,11588283,762671,276293,2731669,1945860,685587,3902823,361536]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>state<\/th>\n      <th>Y<\/th>\n      <th>X2<\/th>\n      <th>X3<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"dom":"tip","columnDefs":[{"className":"dt-right","targets":[2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
&lt;p class="caption"&gt;美国51个地区的制造业投入产出数据&lt;/p&gt;
&lt;/div&gt;

---
### 模型选择的标准：柯布道格拉斯生产案例（回归）

双对数模型下：

`$$\begin{equation} \begin{alignedat}{999} &amp;log(Y)=&amp;&amp; + \beta_{1} &amp;&amp; + \beta_{2} log(X2)&amp;&amp; + \beta_{3} log(X3)&amp;&amp;+u_i\\ \end{alignedat} \end{equation}$$`

OLS估计结果为：

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{log(Y)}=&amp;&amp;+3.89&amp;&amp;+0.47log(X2)&amp;&amp;+0.52log(X3)\\ &amp;\text{(t)}&amp;&amp;(9.8115)&amp;&amp;(4.7342)&amp;&amp;(5.3803)\\&amp;\text{(se)}&amp;&amp;(0.3962)&amp;&amp;(0.0989)&amp;&amp;(0.0969)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.9642;&amp;&amp; \bar{R^2}=0.9627\\&amp; &amp;&amp; F^{\ast}=645.93;&amp;&amp; p=0.0000 \end{alignedat} \end{equation}$$`

---
### 模型选择的标准：多项式回归

**多项式回归模型**(polynomial regression models)：


`$$\begin {align} 
Y &amp;=\beta_{1}+\beta_{2} X+\beta_{3} X^{2} \\
Y_{i}&amp;=\beta_{1}+\beta_{2} X_{i}+\beta_{3} X_{i}^{2}+u_{i} \\
Y_{i}&amp;=\beta_{1}+\beta_{2} X_{i}+\beta_{3} X_{i}^{2}+\cdots+\beta_{k} X_{i}^{k}+u_{i} \\
\hat{Y}_{i}&amp;=\hat{\beta}_{1}+\hat{\beta}_{2} X_{2 i}+\hat{\beta}_{3} X_{3 i}
 \end {align}$$`

- 思考1：上述模型是线性回归模型吗？

- 思考2： X与X的诸多幂函数之间是高度相关的吗？有没有违背自变量无多重共线性的CLRM假设？

---
### 模型选择的标准：总生产成本案例（数据）


 

<div id="htmlwidget-37f7b8c79095f4f74b2d" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-37f7b8c79095f4f74b2d">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10"],[1,2,3,4,5,6,7,8,9,10],[193,226,240,244,257,260,274,297,350,420],[1,4,9,16,25,36,49,64,81,100],[1,8,27,64,125,216,343,512,729,1000]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>X<\/th>\n      <th>Y<\/th>\n      <th>XX<\/th>\n      <th>XXX<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"dom":"tip","columnDefs":[{"className":"dt-right","targets":[1,2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>

---
### 模型选择的标准：总生产成本案例（绘图）

产出X与总成本Y的散点图关系如下：

&lt;img src="06-multiple-reg-algebra-slide_files/figure-html/unnamed-chunk-39-1.png" style="display: block; margin: auto;" /&gt;


---
### 模型选择的标准：总生产成本案例（回归）

多项式模型下：

`$$\begin{equation} \begin{alignedat}{999} &amp;Y=&amp;&amp; + \beta_{1} &amp;&amp; + \beta_{2} X&amp;&amp; + \beta_{3} XX&amp;&amp; + \beta_{4} XXX&amp;&amp;+u_i\\ \end{alignedat} \end{equation}$$`

OLS估计结果为：

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{Y}=&amp;&amp;+141.77&amp;&amp;+63.48X&amp;&amp;-12.96XX&amp;&amp;+0.94XXX\\ &amp;\text{(t)}&amp;&amp;(22.2368)&amp;&amp;(13.2837)&amp;&amp;(-13.1501)&amp;&amp;(15.8968)\\&amp;\text{(se)}&amp;&amp;(6.3753)&amp;&amp;(4.7786)&amp;&amp;(0.9857)&amp;&amp;(0.0591)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.9983;&amp;&amp; \bar{R^2}=0.9975\\&amp; &amp;&amp; F^{\ast}=1202.22;&amp;&amp; p=0.0000 \end{alignedat} \end{equation}$$`

---
## 偏相关系数


**偏相关系数**（partial correlation coefficient）：
一个不依赖于
`\(X_{2i}\)`的，对
`\(X_{3i}\)`和
`\(Y_i\)`的影响的一种相关系数。

- 保持
`\(X_{3i}\)`不变，
`\(Y_i\)`和
`\(X_{2i}\)`之间的相关系数：

`$$\begin {align} 
r_{12 \cdot 3}=\frac{r_{12}-r_{13} r_{23}}{\sqrt{\left(1-r_{13}^{2}\right)\left(1-r_{23}^{2}\right)}}
\end {align}$$`

- 保持
`\(X_{2i}\)`不变，
`\(Y_i\)`和
`\(X_{3i}\)`之间的相关系数：

`$$\begin {align} 
r_{13.2}=\frac{r_{13}-r_{12} r_{23}}{\sqrt{\left(1-r_{12}^{2}\right)\left(1-r_{23}^{2}\right)}}
\end {align}$$`

- 保持
`\(Y_i\)`不变，
`\(X_{2i}\)`和
`\(X_{3i}\)`之间的相关系数：

`$$\begin {align} 
r_{23.1}=\frac{r_{23}-r_{12} r_{13}}{\sqrt{\left(1-r_{12}^{2}\right)\left(1-r_{13}^{2}\right)}}
\end {align}$$`

---
## 简单相关系数


**简单相关系数**（simple correlation coefficient）：


- 
`\(Y_i\)`和
`\(X_{2i}\)`之间的相关系数：

`$$\begin {align} 
r_{12}=\frac{\sum y_{i} x_{2 i}}{\sqrt{\sum y_{i}^{2}} \sqrt{\sum x_{2 i}^{2}}}
\end {align}$$`

- 
`\(Y_i\)`和
`\(X_{3i}\)`之间的相关系数：

`$$\begin {align} 
r_{13}=\frac{\sum y_{i} x_{3 i}}{\sqrt{\sum y_{i}^{2}} \sqrt{\sum x_{3 i}^{2}}}
\end {align}$$`

- 
`\(X_{2i}\)`和
`\(X_{3i}\)`之间的相关系数：

`$$\begin {align} 
r_{23}=\frac{\sum x_{2 i} x_{3 i}}{\sqrt{\sum x_{2 i}^{2}} \sqrt{\sum x_{3 i}^{2}}}
\end {align}$$`

---
class: inverse, center, middle
# 多元回归分析：估计问题

---
## N-CLRM假设

**经典正态线性回归模型**(classical normal linear regression model , N-CLRM)：在经典线性回归模型(CLRM)假设中再增加干扰项
`\(u_i\)`服从正态性的相关假设。

- 均值为0：
`\(E(u|X_i)=0\)`

- 同方差：
`\(Var(u_i) \equiv \sigma^2\)`

- 无自相关：
`\(E(u_i,u_j)=0\)`

- 正态性分布：
`\(u_i \sim N(0, \sigma^2)\)`

以上几条也可以统写为：
`\(u_i \sim iid. \  N(0, \sigma^2)\)`

其中，iid表示独立同分布(Independent Identical Distribution, iid)。

---
## 个别回归系数的显著性检验（t检验理论）

`$$\begin {align} 
Y_{i}=\beta_{1}+\beta_{2} X_{2 i}+\beta_{3} X_{3 i}+u_{i} 
\end {align}$$`

二元线性回归模型，在N-CLRM假设容易得到：

`$$\begin{align} 
T_1&amp;=\frac{\hat{\beta}_{1}-\beta_{1}}{S_{\hat{\beta}_{1}}} \sim t(n-3)  \\
T_2&amp;=\frac{\hat{\beta}_{2}-\beta_{2}}{S_{\hat{\beta}_{2}}}
 \sim t(n-3) \\
T_3&amp;=\frac{\hat{\beta}_{3}-\beta_{3}}{S_{\hat{\beta}_{3}}}
 \sim t(n-3)
\end{align}$$`

---
## 个别回归系数的显著性检验（t检验理论）

其中：

`$$\begin {align} 
S_{\hat{\beta}_1}^{2}
=\left[\frac{1}{n}+\frac{\overline{X}_{2}^{2} \sum x_{3 i}^{2}+\overline{X}_{3}^{2} \sum x_{2 i}^{2}-2 \overline{X}_{2} \overline{X}_{3} \sum x_{2 i} x_{3 i}}{\sum x_{2 i}^{2} \sum x_{3 i}^{2}-\left(\sum x_{2 i} x_{3 i}\right)^{2}}\right] \cdot \hat{\sigma}^{2}
\end {align}$$`

`$$\begin {align} 
S_{\hat{\beta}_{2}}^{2} 
&amp;  =\frac{\hat{\sigma}^{2}}{\sum x_{2 i}^{2}\left(1-r_{23}^{2}\right)} &amp;&amp; \leftarrow \left[ r_{23}^{2}=\frac{\left(\sum x_{2 i} x_{3 i}\right)^{2}}{\sum x_{2 i}^{2} \sum x_{3 i}^{2}} \right] 
\end {align}$$`

`$$\begin {align} 
S_{\hat{\beta}_{3}}^{2} 
&amp; =\frac{\hat{\sigma}^{2}}{\sum x_{3 i}^{2}\left(1-r_{23}^{2}\right)} &amp;&amp; \leftarrow \left[ r_{23}^{2}=\frac{\left(\sum x_{2 i} x_{3 i}\right)^{2}}{\sum x_{2 i}^{2} \sum x_{3 i}^{2}} \right] 
\end {align}$$`

`$$\begin {align} 
\hat{\sigma}^{2}=\frac{\sum \mathrm{e}_{i}^{2}}{n-3}
= \frac{1}{n-3}\left(\sum y_{i}^{2}-\hat{\beta}_{2} \sum y_{i} x_{2 i}-\hat{\beta}_{3} \sum y_{i} x_{3 i}\right)
\end {align}$$`

---
## 个别回归系数的显著性检验（t检验理论）

假设：

`$$H_0: \beta_i =0; \quad H_1: \beta_i \neq 0, \quad i  \in (1,2,3)$$`
基于
`\(H_0\)`可以得到：

`$$\begin{align} 
t^{\ast}_{\hat{\beta}_1}&amp;=\frac{\hat{\beta}_{1}-\beta_{1}}{S_{\hat{\beta}_{1}}} \\
t^{\ast}_{\hat{\beta}_2}&amp;=\frac{\hat{\beta}_{2}-\beta_{2}}{S_{\hat{\beta}_{2}}}
\\
t^{\ast}_{\hat{\beta}_3}&amp;=\frac{\hat{\beta}_{3}-\beta_{3}}{S_{\hat{\beta}_{3}}}
\end{align}$$`

---
## 个别回归系数的显著性检验（t检验理论）

给定显著性水平
`\(\alpha=0.05\)`下，查出统计量的**理论分布值**。
`\(t_{1-\alpha/2}(n-3)\)`。

得到显著性检验的判断结论。

- 若
`\(|t^{\ast}_{\hat{\beta}_2}| &gt; t_{1-\alpha/2}(n-2)\)`，则
`\(\beta_i\)`的t检验结果**显著**。换言之，在显著性水平
`\(\alpha=0.05\)`下，应**显著**地拒绝原假设
`\(H_0\)`，接受备择假设
`\(H_1\)`，认为回归参数
`\(\beta_i \neq 0\)`。
    
- 若
`\(|t^{\ast}_{\hat{\beta}_i}| &lt; t_{1-\alpha/2}(n-2)\)`，则
`\(\beta_i\)`的t检验结果**不显著**。换言之，在显著性水平
`\(\alpha=0.05\)`下，不能**显著**地拒绝原假设
`\(H_0\)`，只能暂时接受原假设
`\(H_0\)`，认为回归参数
`\(\beta_i = 0\)`。

---
## 个别回归系数的显著性检验（t检验案例）

儿童死亡率的二元回归模型如下：

`$$\begin{equation} \begin{alignedat}{999} &amp;CM=&amp;&amp; + \beta_{1} &amp;&amp; + \beta_{2} PGNP&amp;&amp; + \beta_{3} FLR&amp;&amp;+u_i\\ \end{alignedat} \end{equation}$$`

以上二元回归模型的OLS估计结果如下：

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{CM}=&amp;&amp;+263.64&amp;&amp;-0.01PGNP&amp;&amp;-2.23FLR\\ &amp;\text{(t)}&amp;&amp;(22.7411)&amp;&amp;(-2.8187)&amp;&amp;(-10.6293)\\&amp;\text{(se)}&amp;&amp;(11.5932)&amp;&amp;(0.0020)&amp;&amp;(0.2099)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.7077;&amp;&amp; \bar{R^2}=0.6981\\&amp; &amp;&amp; F^{\ast}=73.83;&amp;&amp; p=0.0000 \end{alignedat} \end{equation}$$`

---
## 样本回归模型的整体显著性检验（F检验）


`$$\begin {align} 
Y_{i}=\beta_{1}+\beta_{2} X_{2 i}+\beta_{3} X_{3 i}+u_{i} 
\end {align}$$`

`$$\begin{alignedat}{2}
&amp;&amp;(Y_i - \bar{Y}) &amp;&amp;= (\hat{Y}_i - \bar{Y}) &amp;&amp;+ (Y_i - \hat{Y}_i ) \\
&amp;&amp;y_i &amp;&amp;= \hat{y}_i &amp;&amp;+ e_i \\
&amp;&amp;\sum{y_i^2} &amp;&amp;= \sum{\hat{y}_i^2} &amp;&amp;+ \sum{e_i^2} \\
&amp;&amp;TSS &amp;&amp;=ESS &amp;&amp;+RSS
\end{alignedat}$$`



&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; 变异来源 &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; 平方和符号SS &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; 平方和计算公式 &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; 自由度df &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; 均方和符号MSS &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; 均方和计算公式 &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 回归平方和 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; ESS &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; \(\hat{\beta}_2\sum{y_ix_{2i}}+\hat{\beta}_3\sum{y_ix_{3i}}\) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 2 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; \(MSS_{ESS}\) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; \(ESS/df_{ESS}=\sum{\hat{y}_i^2}/2 \) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 残差平方和 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; RSS &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; \(\sum{(Y_i-\hat{Y_i})^2}=\sum{e_i^2}\) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; n-3 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; \(MSS_{RSS}\) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; \(RSS/df_{RSS}=\frac{\sum{e_i^2}}{n-3}\) &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 总平方和 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; TSS &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; \(\sum{(Y_i-\bar{Y_i})^2}=\sum{y_i^2}\) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; n-1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; \(MSS_{TSS}\) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; \(TSS/df_{TSS}=\frac{\sum{y_i^2}}{n-1}\) &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---
## 样本回归模型的整体显著性检验（F检验）

在原假设下：

`$$H_0: \beta_2 = \beta_3= 0; \quad H_1: \text{not all} \quad \beta_j = 0, \quad j \in 2, 3$$`
有：

`$$\begin {align} 
F^{*}=\frac{MSS_{ESS}}{MSS_{RSS}}=\frac{ESS / df_{\mathrm{Ess}}}{RSS /d f_{\mathrm{RSS}}}=\frac{\left(\hat{\beta}_{2} \sum y_{i} x_{2 i}+\hat{\beta}_{3} \sum \mathrm{y}_{i} x_{3 i}\right) / 2}{\sum \mathrm{e}_{i}^{2} /(n-3)} \sim \mathrm{F}(2, \mathrm{n}-3)
\end {align}$$`

---
## k变量回归模型的F检验

k变量回归模型下：

`$$\begin{align}
Y_i = \beta_1 + \beta_2X_{2i} + \beta_3X_{3i}+ \cdots + \beta_kX_{ki}+ u_i
\end{align}$$`

给出如下假设：
`$$H_0: \beta_2 = \beta_3 =\cdots= \beta_k= 0; \quad H_1: \text{not all} \quad \beta_j = 0, \quad j \in 2, 3, \cdots, k$$`

F样本统计量可以表达为：

`$$\begin {align} 
F^{\ast}=\frac{ESS / df_{ESS}}{RSS / df_{RSS}}=\frac{ESS /(k-1)}{RSS /(n-k)}=\frac{MSS_{ESS}}{MSS_{\mathrm{RSS}}} \sim \mathrm{F}(k-1, n-k)
\end {align}$$`

---
## k变量回归模型的F检验

k变量回归模型下，F样本统计量也可以用判定系数
`\(R^2\)`表达为：

`$$\begin {align} 
F &amp;=\frac{(n-k) ESS}{(k-1) RSS} \\ 
&amp;=\frac{n-k}{k-1} \cdot \frac{ESS}{TSS-ESS} \\
&amp;=\frac{n-k}{k-1} \cdot \frac{ESS / TSS}{1-(ESS / TSS)} \\ &amp;=\frac{n-k}{k-1} \cdot \frac{R^{2}}{1-R^{2}} \\ 
&amp;=\frac{R^{2} /(k-1)}{\left(1-R^{2}\right) /(n-k)} 
\end {align}$$`

---
## k变量回归模型的F检验

k变量回归模型下，方差分析表（ANOVA）理论上可以写成：


<div id="htmlwidget-60f91e137e9029e0dcc9" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-60f91e137e9029e0dcc9">{"x":{"filter":"none","data":[["1","2","3"],["回归平方和","残差平方和","总平方和"],["ESS","RSS","TSS"],["\\( R^2\\sum{y_i^2} \\)","\\( (1-R^2)\\sum{y_i^2} \\)","\\( \\sum{y_i^2}\\)"],["k-1","n-3","n-1"],["\\(MSS_{ESS}\\)","\\(MSS_{RSS}\\)","\\(MSS_{TSS}\\)"],["\\(  R^2\\sum{y_i^2}/(k-1) \\)","\\( \\frac{(1-R^2)\\sum{y_i^2}}{n-3} \\)","\\(TSS/df_{TSS}=\\frac{\\sum{y_i^2}}{n-1}\\)"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>变异来源<\/th>\n      <th>平方和符号SS<\/th>\n      <th>平方和计算公式<\/th>\n      <th>自由度df<\/th>\n      <th>均方和符号MSS<\/th>\n      <th>均方和计算公式<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":4,"dom":"tip","order":[],"autoWidth":false,"orderClasses":false,"columnDefs":[{"orderable":false,"targets":0}],"lengthMenu":[4,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>

---
## k变量回归模型的F检验（案例）



研究关注儿童死亡率（`CM`，千分数）与人均GNP（`PGNP`，1980年的人均GNP）和妇女识字率（`FLR`，百分数）的关系，并构建如下PRM：

`$$\begin{equation} \begin{alignedat}{999} &amp;CM=&amp;&amp; + \beta_{1} &amp;&amp; + \beta_{2} PGNP&amp;&amp; + \beta_{3} FLR&amp;&amp;+u_i\\ \end{alignedat} \end{equation}$$`

可以计算得到如下方差分析表（AVOVA）：

<div id="htmlwidget-5f12fed978b664550899" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-5f12fed978b664550899">{"x":{"filter":"none","caption":"<caption>儿童死亡率案例的ANOVA分析表<\/caption>","data":[["1","2","3"],["回归平方和ESS","残差平方和RSS","总平方和TSS"],[257362.373050769,106315.626949231,363678],[2,61,63],[128681.186525384,1742.87913031527,5772.66666666667]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>source<\/th>\n      <th>SS<\/th>\n      <th>df<\/th>\n      <th>MSS<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":3,"dom":"tip","columnDefs":[{"className":"dt-right","targets":[2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[3,10,25,50,100],"rowCallback":"function(row, data) {\nDTWidget.formatRound(this, row, data, 2, 2, 3, ',', '.');\nDTWidget.formatRound(this, row, data, 4, 2, 3, ',', '.');\n}"}},"evals":["options.rowCallback"],"jsHooks":[]}</script>

---
## k变量回归模型的F检验（案例）

因此可以计算得到样本F统计量值（
`\(F^{\ast}\)`）为：

`$$\begin {align}
F^{\ast} = \frac{ESS / df_{ESS}}{RSS / df_{RSS}}
=\frac{MSS_{ESS}}{MSS_{RSS}}
=\frac{128681.1865}{1742.8791}=73.8325
\end {align}$$`

给定显著性水平
`\(\alpha=0.05\)`下，查出F分布的**理论值**
`\(F_{1-\alpha}(1,n-2)=F_{0.95}\)`(2,61)=3.1478

得到显著性检验的判断结论。因为
`\(F^{\ast}=\)` 73.8325 .red[**大于**] `\(F_{1-\alpha}(1,n-2)=F_{0.95}\)`(2,61)=3.1478，所以模型整体显著性的F检验结果**显著**。

换言之，在显著性水平
`\(\alpha=0.05\)`下，应**显著**地拒绝原假设
`\(H_0\)`，接受备择假设
`\(H_1\)`，认为斜率参数
`\(\beta_2=\beta_3 \neq 0\)`。

---
class: inverse, center, middle
# 受约束的最小二乘法的检验

---
## 线性等式约束条件

**线性等式约束条件**：根据已有的经济理论，某一回归模型中的系数需满足一些线性等式约束条件。

柯布道格拉斯生产函数(the Cobb-Douglas production function):

`$$\begin {align} 
Y_{i}=\beta_{1} X_{2 i}^{\beta_{2}} X_{3 i}^{\beta_{3}} e^{u_{i}}
\end {align}$$`

其中，
`\(Y_i\)`表示产出；
`\(X_{2i}\)`表示劳动投入；
`\(X_{3i}\)`表示资本投入。

可以将指数模型转换成如下线性模型：

`$$\begin {align} 
\ln Y_{i} &amp;=\ln \beta_{1}+\beta_{2} \ln X_{2 i}+\beta_{3} \ln X_{3 i}+u_{i} \\ 
&amp;=\beta_{0}+\beta_{2} \ln X_{2 i}+\beta_{3} \ln X_{3 i}+u_{i} &amp;&amp; \leftarrow \left[ \beta_{0}=\ln \beta_{1} \right]
 \end {align}$$`
 

假设所描述的生产是规模报酬不变，由经济理论可得如下的**线性等式约束条件**：

`$$\begin {align}
\beta_{2}+\beta_{3}=1
\end {align}$$`

---
## 线性等式约束的t检验法

**步骤1**：先做无约束的或**无限制的回归**（unrestricted or unconstrained  regression）

`$$\begin{equation} \begin{alignedat}{999} &amp;log(Y)=&amp;&amp; + \beta_{1} &amp;&amp; + \beta_{2} log(X2)&amp;&amp; + \beta_{3} log(X3)&amp;&amp;+e_i\\ \end{alignedat} \end{equation}$$`

**步骤2**：构建T统计量：

`$$\begin {align} 
T=\frac{\left(\hat{\beta}_{2}+\hat{\beta}_{3}\right)-\left(\beta_{2}+\beta_{3}\right)}{S_{\left(\hat{\beta}_{2}+\hat{\beta}_{3}\right)}} \sim \mathrm{t}(n-3)
\end {align}$$`

---
## 线性等式约束的t检验法

其中：

`$$\begin {align} 
S^2_{\left(\hat{\beta}_{2}+\hat{\beta}_{3}\right)} &amp;= S^2_{\hat{\beta}_{2}}+S^2_{\hat{\beta}_{3}}+2 S^2_{\hat{\beta}_{2}\hat{\beta}_{3}}
\end {align}$$`

`$$\begin {align} 
S_{\hat{\beta}_{2}}^{2} 
&amp;  =\frac{\hat{\sigma}^{2}}{\sum x_{2 i}^{2}\left(1-r_{23}^{2}\right)} &amp;&amp; \leftarrow \left[ r_{23}^{2}=\frac{\left(\sum x_{2 i} x_{3 i}\right)^{2}}{\sum x_{2 i}^{2} \sum x_{3 i}^{2}} \right] 
\end {align}$$`

`$$\begin {align} 
S_{\hat{\beta}_{3}}^{2} 
&amp; =\frac{\hat{\sigma}^{2}}{\sum x_{3 i}^{2}\left(1-r_{23}^{2}\right)} &amp;&amp; \leftarrow \left[ r_{23}^{2}=\frac{\left(\sum x_{2 i} x_{3 i}\right)^{2}}{\sum x_{2 i}^{2} \sum x_{3 i}^{2}} \right] 
\end {align}$$`

`$$\begin {align} 
S^2_{\hat{\beta}_{2} \hat{\beta}_{3}} &amp; =\frac{-r_{23} \hat{\sigma}^{2}}{\left(1-r_{23}^{2}\right) \sqrt{\sum x_{2 i}^{2}} \sqrt{\sum x_{3 i}^{2}}} &amp;&amp; \leftarrow \left[ r_{23}^{2}=\frac{\left(\sum x_{2 i} x_{3 i}\right)^{2}}{\sum x_{2 i}^{2} \sum x_{3 i}^{2}} \right] 
\end {align}$$`

---
## 线性等式约束的t检验法

提出理论假设：

`$$H_0: \beta_{2}+\beta_{3}=1; H_1: \beta_{2}+\beta_{3} \neq 1$$`

在原假设
`\(H_0\)`下，可以计算得到如下样本t统计量：

`$$\begin {align} 
t^{\ast}=\frac{\left(\hat{\beta}_{2}+\hat{\beta}_{3}\right)-1}{S_{\left(\hat{\beta}_{2}+\hat{\beta}_{3}\right)}} 
\end {align}$$`

给定显著性水平
`\(\alpha=0.05\)`下，查出统计量的**理论分布值**。
`\(t_{1-\alpha/2}(n-3)\)`。

得到显著性检验的判断结论。

- 若
`\(|t^{\ast}| &gt; t_{1-\alpha/2}(n-2)\)`，则
`\(\beta_i\)`的t检验结果**显著**。换言之，在显著性水平
`\(\alpha=0.05\)`下，应**显著**地拒绝原假设
`\(H_0\)`，接受备择假设
`\(H_1\)`，认为
`\(\beta_{2}+\beta_{3} \neq 1\)`，也即**规模报酬可变**。
    
- 若
`\(|t^{\ast}_{\hat{\beta}_i}| &lt; t_{1-\alpha/2}(n-2)\)`，则
`\(\beta_i\)`的t检验结果**不显著**。换言之，在显著性水平
`\(\alpha=0.05\)`下，不能**显著**地拒绝原假设
`\(H_0\)`，只能暂时接受原假设
`\(H_0\)`，认为回归参数
`\(\beta_{2}+\beta_{3} = 1\)`，也即**规模报酬不变**。


---
## 线性等式约束的F检验

**无约束模型**（Unrestricted model）：
`$$\begin {align} 
\ln Y_{i}&amp;=\beta_{0}+\beta_{2} \ln X_{2 i}+\beta_{3} \ln X_{3 i}+u_{i} &amp;&amp; \leftarrow \left[ \beta_{0}=\ln \beta_{1} \right]
 \end {align}$$`

在线性等式约束条件下：
`$$\begin {align}
\beta_{2} =1- \beta_{3}
\end {align}$$`

可以将原模型变换为如下的**受约束模型**（Restricted model）：

`$$\begin {align}
\ln Y_{i} &amp;=\beta_{0}+\left(1-\beta_{3}\right) \ln X_{2 i}+\beta_{3} \ln X_{3 i}+u_{i} \\ 
\ln Y_{i} &amp;=\beta_{0}+\ln X_{2 i}+\beta_{3}\left(\ln X_{3 i}-\ln X_{2 i}\right)+u_{i} \\
\left(\ln Y_{i}-\ln X_{2 i}\right) &amp; =\beta_{0}+\beta_{3}\left(\ln X_{3 i}-\ln X_{2 i}\right)+u_{i} \\
\ln \left(Y_{i} / X_{2 i}\right) &amp;= \beta_{0}+\beta_{3} \ln \left(X_{3 i} / X_{2 i}\right)+u_{i}
\end {align}$$`

---
## 线性等式约束的F检验

给出原假设
`\(H_0: \beta_2 + \beta_3 =1\)`下，可以得到如下样本F统计量：

`$$\begin {align}
F^{*}&amp;=\frac{\left(RSS_{R}-RSS_{UR}\right) / m}{RSS_{UR} /(n-k)}
=\frac{\left(\sum e_{R}^{2}-\sum e_{U \mathrm{R}}^{2}\right) / m}{\sum e_{U \mathrm{R}}^{2} /(n-k)} \sim \mathrm{F}(\mathrm{m}, \mathrm{n}-\mathrm{k})\\
F^{*}&amp;=\frac{\left(R_{UR}^{2}-R_{R}^{2}\right) / m}{\left(1-R_{UR}^{2}\right) /(n-k)}
\end {align}$$`


其中：
- 
`\(RSS_UR\)`表示**无约束回归模型**的RSS；

- 
`\(RSS_R\)`表示**受约束回归模型**的RSS；

- 
`\(R_{UR}^{2}\)`表示**无约束回归模型**的判定系数；

- 
`\(R_{R}^{2}\)`表示**受约束回归模型**的判定系数；

- 
`\(m\)`表示线性约束条件的个数；
`\(n\)`表示样本数；
`\(k\)`表示无约束回归模型中回归系数个数（包括截距）；


---
## 线性等式约束的F检验

给定显著性水平
`\(\alpha=0.05\)`下，查出统计量的**理论分布值**。
`\(F_{1-\alpha}(m,n-k)\)`

得到显著性检验的判断结论。

- 若
`\(F^{\ast} &gt; F_{1-\alpha}(m,n-k)\)`，则**显著**地拒绝原假设
`\(H_0\)`，接受备择假设
`\(H_1\)`，认为**规模报酬可变**。

- 若
`\(F^{\ast} &lt; F_{1-\alpha}(m,n-k)\)`，则不能**显著**地拒绝原假设
`\(H_0\)`，暂时接受原假设
`\(H_0\)`，认为**规模报酬不变**。

---
## 线性等式约束的F检验（案例：数据）



<div id="htmlwidget-febaf735e8e0c7a322ca" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-febaf735e8e0c7a322ca">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51"],["Alabama","Alaska","Arizona","Arkansas","California","Colorado","Connecticut","Delaware","District of Columbia","Florida","Georgia","Hawaii","Idaho","Illinois","Indiana","Iowa","Kansas","Kentucky","Louisiana","Maine","Maryland","Massachusetts","Michigan","Minnesota","Mississippi","Missouri","Montana","Nebraska","Nevada","New Hampshire","New Jersey","New Mexico","New York","North Carolina","North Dakota","Ohio","Oklahoma","Oregon","Pennsylvania","Rhode Island","South Carolina","South Dakota","Tennessee","Texas","Utah","Vermont","Virginia","Washington","West Virginia","Wisconsin","Wyoming"],[38372840,1805427,23736129,26981983,217546032,19462751,28972772,14313157,159921,47289846,63015125,1809052,10511786,105324866,90120459,39079550,22826760,38686340,69910555,7856947,21352966,46044292,92335528,48304274,17207903,47340157,2644567,14650080,7290360,9188322,51298516,20401410,87756129,101268432,3556025,124986166,20451196,34808109,104858322,6541356,37668126,4988905,62828100,172960157,15702637,5418786,49166991,46164427,9185967,66964978,2979475],[424471,19895,206893,304055,1809756,180366,224267,54455,2029,471211,659379,17528,75414,963156,835083,336159,246144,384484,216149,82021,174855,355701,943298,456553,267806,439427,24167,163637,59737,96106,407076,43079,727177,820013,34723,1174540,201284,257820,944998,68987,400317,56524,582241,1120382,150030,48134,425346,313279,89639,694628,15221],[2689076,57997,2308272,1376235,13554116,1790751,1210229,421064,7188,2761281,3540475,146371,848220,5870409,5832503,1795976,1595118,2503693,4726625,415131,1729116,2706065,5294356,2833525,1212281,2404122,334008,627806,522335,507488,3295056,404749,4260353,4086558,184700,6301421,1327353,1456683,5896392,297618,2500071,311251,4126465,11588283,762671,276293,2731669,1945860,685587,3902823,361536],[90.4015586459381,90.7477758230711,114.726592973179,88.7404680074329,120.207382652689,107.906983577836,129.188743774162,262.843760903498,78.8176441596846,100.358111334413,95.5673823400503,103.209265175719,139.387726416846,109.353901133357,107.917966238087,116.253171862125,92.7374219968799,100.618855401005,323.436865310503,95.7918947586594,122.118132166652,129.446619492214,97.8858515548639,105.80211716931,64.2551063082978,107.731561783869,109.428849257252,89.5279185025392,122.040946147279,95.6061224065095,126.017048413564,473.581327328861,120.680561953967,123.496129939403,102.411225988538,106.412864610826,101.603684346495,135.009343728182,110.961422140576,94.8201255308971,94.0957441227827,88.2617118392187,107.907378559737,154.376058344386,104.663314003866,112.577097270121,115.592931401729,147.358830307809,102.477348029318,96.4040867917792,195.74765127127],[6.33512301193721,2.9151545614476,11.1568395257452,4.52626991827137,7.48947150886639,9.92842886131533,5.39637574854972,7.73232944633183,3.54263183834401,5.85996719091872,5.36940818558068,8.35069602921041,11.2475137242422,6.09497215404358,6.9843392812451,5.34263845382691,6.48042609204368,6.51182623984353,21.867438664995,5.06127699003914,9.88885648108433,7.60769578944113,5.6126017440936,6.20634406082098,4.5267133671389,5.4710384204885,13.8208300575164,3.83657730219938,8.74391080904632,5.28050277818242,8.09444919376234,9.39550593096404,5.85875653382876,4.98352830991704,5.31924084900498,5.36501183442028,6.59442876731385,5.65,6.23958145943166,4.31411715250699,6.24522815668583,5.50652820041044,7.08721130940624,10.3431534958612,5.08345664200493,5.7400797772884,6.42222802142256,6.21126854975916,7.64831156081616,5.61858001692992,23.7524472767886]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>state<\/th>\n      <th>Y<\/th>\n      <th>X2<\/th>\n      <th>X3<\/th>\n      <th>Y.X2<\/th>\n      <th>X3.X2<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"dom":"tip","columnDefs":[{"className":"dt-right","targets":[2,3,4,5,6]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100],"rowCallback":"function(row, data) {\nDTWidget.formatRound(this, row, data, 5, 4, 3, ',', '.');\nDTWidget.formatRound(this, row, data, 6, 4, 3, ',', '.');\n}"}},"evals":["options.rowCallback"],"jsHooks":[]}</script>

---
## 线性等式约束的F检验（案例：回归1）

**无约束模型**回归结果如下：

`$$\begin{equation} \begin{alignedat}{999} &amp;log(Y)=&amp;&amp; + \beta_{1} &amp;&amp; + \beta_{2} log(X2)&amp;&amp; + \beta_{3} log(X3)&amp;&amp;+u_i\\ \end{alignedat} \end{equation}$$`

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{log(Y)}=&amp;&amp;+3.89&amp;&amp;+0.47log(X2)&amp;&amp;+0.52log(X3)\\ &amp;\text{(t)}&amp;&amp;(9.8115)&amp;&amp;(4.7342)&amp;&amp;(5.3803)\\&amp;\text{(se)}&amp;&amp;(0.3962)&amp;&amp;(0.0989)&amp;&amp;(0.0969)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.9642;&amp;&amp; \bar{R^2}=0.9627\\&amp; &amp;&amp; F^{\ast}=645.93;&amp;&amp; p=0.0000 \end{alignedat} \end{equation}$$`

其中：

- 
`\(RSS_{UR}=\)` 3.4155

- 
`\(R^2_{UR}=\)` 0.9642

---
## 线性等式约束的F检验（案例：回归2）

**受约束模型**回归结果如下：

`$$\begin{equation} \begin{alignedat}{999} &amp;log(Y.X2)=&amp;&amp; + \beta_{1} &amp;&amp; + \beta_{2} log(X3.X2)&amp;&amp;+u_i\\ \end{alignedat} \end{equation}$$`

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{log(Y.X2)}=&amp;&amp;+3.76&amp;&amp;+0.52log(X3.X2)\\ &amp;\text{(t)}&amp;&amp;(20.2637)&amp;&amp;(5.4665)\\&amp;\text{(se)}&amp;&amp;(0.1854)&amp;&amp;(0.0958)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.3788;&amp;&amp; \bar{R^2}=0.3661\\&amp; &amp;&amp; F^{\ast}=29.88;&amp;&amp; p=0.0000 \end{alignedat} \end{equation}$$`

其中：

- 
`\(RSS_R=\)` 3.4256

- 
`\(R^2_R=\)` 0.3788

---
## 线性等式约束的F检验（案例：F统计量）

.pull-left[
利用RSS计算样本F统计量：

`$$\begin{align}
F^{*}&amp;=\frac{\left(RSS_{R}-RSS_{UR}\right) / m}{RSS_{UR} /(n-k)}\\
&amp;=\frac{\left(3.4256-3.4155\right) /1}{3.4155/(51-3)} \\
&amp;=0.1414
\end{align}$$`
]


.pull-right[
利用
`\(R^2\)`计算样本F统计量：

`$$\begin{align}
F^{*}&amp;=\frac{\left(R_{UR}^{2}-R_{R}^{2}\right) / m}{\left(1-R_{UR}^{2}\right) /(n-k)}\\
&amp;=\frac{\left(0.9642-0.3788\right) /1}{ (1-0.9642) /(51-3)} \\
&amp;=784.2919
\end{align}$$`

]

给定显著性水平
`\(\alpha=0.05\)`下，查出F分布的**理论值**
`\(F_{1-\alpha}(m,n-k)=F_{0.95}\)`(1,48)=4.0427

因为
`\(F^{\ast}=\)` 0.1414 .red[**小于**] 
`\(F_{1-\alpha}(m,n-k)=F_{0.95}\)` (1,48)=4.0427，所以，认为
`\(\beta_2+\beta_3 = 1\)`，也即**规模报酬不变**。

---
## 检验回归模型的结构或稳定性: 邹至庄检验



&lt;div class="figure" style="text-align: center"&gt;
<div id="htmlwidget-f312a545ad0ffe4bea4e" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-f312a545ad0ffe4bea4e">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26"],[1970,1971,1972,1973,1974,1975,1976,1977,1978,1979,1980,1981,1982,1983,1984,1985,1986,1987,1988,1989,1990,1991,1992,1993,1994,1995],[61,68.6,63.6,89.6,97.6,104.4,96.4,92.5,112.6,130.1,161.8,199.1,205.5,167,235.7,206.2,196.5,168.4,189.1,187.8,208.7,246.4,272.6,214.4,189.4,249.3],[727.1,790.2,855.3,965,1054.2,1159.2,1273,1401.4,1580.1,1769.5,1973.3,2200.2,2347.3,2522.4,2810,3002,3187.6,3363.1,3640.8,3894.5,4166.8,4343.7,4613.7,4790.2,5021.7,5320.8],["spl1","spl1","spl1","spl1","spl1","spl1","spl1","spl1","spl1","spl1","spl1","spl1","spl2","spl2","spl2","spl2","spl2","spl2","spl2","spl2","spl2","spl2","spl2","spl2","spl2","spl2"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Year<\/th>\n      <th>Saving<\/th>\n      <th>Income<\/th>\n      <th>sample<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"dom":"tip","columnDefs":[{"className":"dt-right","targets":[1,2,3]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
&lt;p class="caption"&gt;1970-1995年间美国储蓄、可支配收入数据（n=26）&lt;/p&gt;
&lt;/div&gt;

---
## 检验回归模型的结构或稳定性: 邹至庄检验

按时间分段绘制散点图如下：

&lt;img src="06-multiple-reg-algebra-slide_files/figure-html/unnamed-chunk-63-1.png" style="display: block; margin: auto;" /&gt;

其中：spl1表示1970-1981年；spl2表示1982-1995年。

---
## 检验回归模型的结构或稳定性: 邹至庄检验

根据散点图的情况，我们可以构建如下三个模型：

`$$\begin {align} 
1970-1981 : &amp; Y_{t}=\lambda_{1}+\lambda_{2} X_{t}+u_{1 t}&amp;&amp; {n_{1}=12} \\ 
1982-1995 : &amp; Y_{t}=\gamma_{1}+\gamma_{2} X_{t}+u_{2 t} &amp;&amp; {n_{2}=14} \\ 
1970-1995 : &amp; Y_{t}=\alpha_{1}+\alpha_{2} X_{t}+u_{t} &amp;&amp; n=\left(n_{1}+n_{2}\right)=26
\end {align}$$`


---
## 检验回归模型的结构或稳定性: 邹至庄检验

.pull-left[
样本段spl1（1970-1981年）**回归1**：

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{Saving}=&amp;&amp;+1.02&amp;&amp;+0.08Income\\ &amp;\text{(t)}&amp;&amp;(0.0873)&amp;&amp;(9.6016)\\&amp;\text{(se)}&amp;&amp;(11.6377)&amp;&amp;(0.0084)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.9021;&amp;&amp; \bar{R^2}=0.8924\\&amp; &amp;&amp; F^{\ast}=92.19;&amp;&amp; p=0.0000 \end{alignedat} \end{equation}$$`
]

.pull-right[
样本段spl2（1982-1995年）**回归2**：

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{Saving}=&amp;&amp;+153.49&amp;&amp;+0.01Income\\ &amp;\text{(t)}&amp;&amp;(4.6923)&amp;&amp;(1.7708)\\&amp;\text{(se)}&amp;&amp;(32.7123)&amp;&amp;(0.0084)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.2072;&amp;&amp; \bar{R^2}=0.1411\\&amp; &amp;&amp; F^{\ast}=3.14;&amp;&amp; p=0.1020 \end{alignedat} \end{equation}$$`
]

全部样本（1970-1995年）**回归3**：

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{Saving}=&amp;&amp;+62.42&amp;&amp;+0.04Income\\ &amp;\text{(t)}&amp;&amp;(4.8918)&amp;&amp;(8.8938)\\&amp;\text{(se)}&amp;&amp;(12.7607)&amp;&amp;(0.0042)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.7672;&amp;&amp; \bar{R^2}=0.7575\\&amp; &amp;&amp; F^{\ast}=79.10;&amp;&amp; p=0.0000 \end{alignedat} \end{equation}$$`

---
## 检验回归模型的结构或稳定性: 邹至庄检验

**邹至庄检验**的原理和过程如下：

**步骤1**：估计在全部样本下的**约束方程**（方程3），得到**约束残差平方和**（记为
`\(RSS_R\)`，此处也记为
`\(RSS_3\)`）。在全部样本下（1970-1995）的模型，如果参数是稳定的，也即可以认为约束了如下两个条件：

`$$\gamma_1=\lambda_1; \quad \gamma_2=\lambda_2$$`

**步骤2**：估计分段样本（spl1=1970-1981）下的子方程1，得到其残差平方和
`\(RSS_1\)`，其自由度为
`\(df_{RSS_1}=n_1-k\)`

**步骤3**：估计分段样本（spl2=1982-1995）下的子方程2，得到其残差平方和
`\(RSS_2\)`，其自由度为
`\(df_{RSS_2}=n_2-k\)`

---
## 检验回归模型的结构或稳定性: 邹至庄检验


**步骤4**：计算得到**无约束残差平方和**（
`\(RSS_{UR}=RSS_1 +RSS_2\)`），其自由度为
`\(df_{RSS_{UR}}=n_1 +n_2 -2k\)`

**步骤5**：如果没有结构性变动（
`\(H_0\)`），则构造得到如下样本F统计量：

`$$\begin {align} 
F^{\ast}=\frac{\left(\mathrm{RSS}_{\mathrm{R}}-\mathrm{RSS}_{\mathrm{UR}}\right) / k}{\left(\mathrm{RSS}_{\mathrm{UR}}\right) /\left(n_{1}+n_{2}-2 k\right)} \sim F_{\left[k,\left(n_{1}+n_{2}-2 k\right)\right]}
\end {align}$$`

**步骤6**：得到显著性检验的判断结论。

- 若
`\(F^{\ast} &gt; F_{1-\alpha}(k,n_1+n_2-2k)\)`，则**显著**地拒绝原假设
`\(H_0\)`，接受备择假设
`\(H_1\)`，认为**存在结构变动**（也即参数不稳定）。

- 若
`\(F^{\ast} &lt; F_{1-\alpha}(k,n_1+n_2-2k)\)`，则不能**显著**地拒绝原假设
`\(H_0\)`，暂时接受原假设
`\(H_0\)`，认为**不存在结构变动**（也即参数稳定）。

---
## 检验回归模型的结构或稳定性: 邹至庄检验

在本案例中：

- **约束残差平方和**（记为
`\(RSS_R=\)` 23248.2982）

- **无约束残差平方和**（
`\(RSS_{UR}=RSS_1 +RSS_2=\)` 1785.0321+10005=11790.2528），其自由度为
`\(df_{RSS_{UR}}=n_1 +n_2 -2k=\)` 12+14-2*2=22

`$$\begin{align}
F^{*}&amp;=\frac{\left(RSS_{R}-RSS_{UR}\right) / k}{RSS_{UR} /(n_1+n_2-2k)}\\
&amp;=\frac{\left(23248.2982-11790.2528\right) /2}{11790.2528/(12+14-2*2)} \\
&amp;=10.6901
\end{align}$$`

- 因为
`\(F^{\ast}=\)` 10.6901 .red[**大于**]查表值
`\(F_{1-\alpha}(k,n_1+n_2-2k)=F_{0.95}\)`(2,12+14-2\*2)=3.4434，所以显著拒绝
`\(H_0\)`，接受备择假设
`\(H_1\)`，认为**存在结构性变动**，也即**参数不稳定**。


---
## 检验回归模型的结构或稳定性: 邹至庄检验

牢记关于邹至庄检验的一些警告：

- 必须满足该检验背后的假定。

- 邹至庄检验只是告诉我们子样本模型之间是否有差别，并没有告诉我们差别是来自截距、斜率还是二者都有。

- 邹至庄检验假定我们知道结构转折点。

---
background-image: url("pic/thank-you-gif-funny-little-yellow.gif")
class: inverse,center
# 本章结束
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
