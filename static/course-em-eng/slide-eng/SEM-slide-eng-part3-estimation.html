<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>SEM-slide-eng-part3-estimation.knit</title>
    <meta charset="utf-8" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/duke-blue.css" rel="stylesheet" />
    <link href="libs/remark-css/hygge-duke.css" rel="stylesheet" />
    <link href="libs/tachyons/tachyons.min.css" rel="stylesheet" />
    <link href="libs/panelset/panelset.css" rel="stylesheet" />
    <script src="libs/panelset/panelset.js"></script>
    <script src="libs/htmlwidgets/htmlwidgets.js"></script>
    <link href="libs/datatables-css/datatables-crosstalk.css" rel="stylesheet" />
    <script src="libs/datatables-binding/datatables.js"></script>
    <script src="libs/jquery/jquery-3.6.0.min.js"></script>
    <link href="libs/dt-core/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="libs/dt-core/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="libs/dt-core/js/jquery.dataTables.min.js"></script>
    <link href="libs/crosstalk/css/crosstalk.min.css" rel="stylesheet" />
    <script src="libs/crosstalk/js/crosstalk.min.js"></script>
    <link rel="stylesheet" href="../mycss/my-theme.css" type="text/css" />
    <link rel="stylesheet" href="../mycss/my-font-eng.css" type="text/css" />
    <link rel="stylesheet" href="../mycss/my-custom-for-video-roomy.css" type="text/css" />
    <link rel="stylesheet" href="../mycss/text-box.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">

background-image: url("../pic/slide-front-page.jpg")
class: center,middle
count: false

# Advanced Econometrics III

## (高级计量经济学III 全英文)

&lt;!---    chakra: libs/remark-latest.min.js ---&gt;

### Hu Huaping (胡华平 )

### NWAFU (西北农林科技大学)


### School of Economics and Management (经济管理学院)

### huhuaping01 at hotmail.com

### 2023-04-07







<div>
<style type="text/css">.xaringan-extra-logo {
width: 110px;
height: 70px;
z-index: 0;
background-image: url(../pic/logo/nwafu-logo-circle-wb.png);
background-size: contain;
background-repeat: no-repeat;
position: absolute;
top:0.2em;left:1em;
}
</style>
<script>(function () {
  let tries = 0
  function addLogo () {
    if (typeof slideshow === 'undefined') {
      tries += 1
      if (tries < 10) {
        setTimeout(addLogo, 100)
      }
    } else {
      document.querySelectorAll('.remark-slide-content:not(.title-slide):not(.inverse):not(.hide_logo)')
        .forEach(function (slide) {
          const logo = document.createElement('div')
          logo.classList = 'xaringan-extra-logo'
          logo.href = null
          slide.appendChild(logo)
        })
    }
  }
  document.addEventListener('DOMContentLoaded', addLogo)
})()</script>
</div>

---
count: false
class: center, middle, duke-orange,hide_logo

# Part 2：Simultaneous Equation Models (SEM)

.large[

Chapter 17. Endogeneity and Instrumental Variables

Chapter 18. Why Should We Concern SEM ?

Chapter 19. What is the Identification Problem ?

.red[Chapter 20. How to Estimate SEM ?]

]


---
layout: false
class: center, middle, duke-softblue,hide_logo
name: chpt20

## Chapter 20. How to Estimate SEM ?

[20.1 Approaches to Estimation](#approaches)

[20.2 General least squares (OLS)](#LS)

[20.3 Indirect least squares (ILS)](#ILS)

[20.4 Two-stage least square method (2SLS)](#TSLS)

[20.5 Truffle case](#truffle)

[20.6 Cod case](#cod)



---
layout: false
class: center, middle, duke-softblue,hide_logo
name: approaches

## 20.1 Approaches to Estimation

---
layout: true
  
&lt;div class="my-header-h2"&gt;&lt;/div&gt;
&lt;div class="watermark1"&gt;&lt;/div&gt;
&lt;div class="watermark2"&gt;&lt;/div&gt;
&lt;div class="watermark3"&gt;&lt;/div&gt;

&lt;div class="my-footer"&gt;&lt;span&gt;huhuaping@   &lt;a href="#chpt20"&gt; Chapter 20. How to Estimate SEM ? &lt;/a&gt; &amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;
&lt;a href="#approaches"&gt; 20.1 Approaches to Estimation &lt;/a&gt; &lt;/span&gt;&lt;/div&gt; 

---

### Approaches to Estimation



In order to estimate the structural SEM, two approaches can be adopted:

- **Single equation method**, also known as **limited information methods**.

&gt; estimate each equation in SEM one by one, considering only the constraints in that equation

- **System method** , also known as **full information method**

&gt;estimate all the equations in the model simultaneously, taking into account all the constraints in the SEM

???
为了估计结构方程，可采取两种方法：

- 单方程法，又称有限息法(limited information methods) 。

    - 我们逐个估计(联立)方程组中的每一个方程，仅考虑对该方程的约束(如对某些变量的排除)而不考虑对其他方程的约束

- 方程组法(或系统法)，又称完全信息法 (full information methods) 

    - 我们同时估计模型中的全部方程，适当考虑了因某些变量被排除而对方程组造成的全部约束

---

### Approaches to Estimation

Instrumental variables are often used to estimate simultaneous equation problems, mainly including three IV techniques for **System method** :

- **Three-stage least squares** (**3SLS**)：Applicable in a few cases

- **Generalized  moment method**( **GMM**)：It is commonly used for dynamic model problems

- **Full information maximum likelihood**( **FIML**)：It has much theoretical value and it brings no advantage over 3SLS, but is much more complicated to compute.

???
工具变量往往被用于估计联立方程问题，主要又包括三类方法：

---

### Approaches to Estimation

Consider the following SEM:

`$$\begin{cases}
  \begin{alignedat}{9}
&amp;  Y_{t1} &amp;-\gamma_{21}Y_{t2}&amp;-\gamma_{31}Y_{t3} &amp; &amp;-\beta_{01}&amp;-\beta_{11}X_{t1} &amp;  &amp; &amp;= &amp;u_{t1} \\
&amp; &amp; Y_{t2} &amp;-\gamma_{32} Y_{3t} &amp; &amp; -\beta_{02}&amp;-\beta_{12}X_{1t} &amp;- \beta_{22}X_{2t} &amp; &amp;= &amp;u_{t2}\\
&amp;-\gamma_{13}Y_{t1} &amp;  &amp;+ Y_{t3} &amp; &amp; -\beta_{03}&amp;-\beta_{13}X_{1t} &amp;-\beta_{23}X_{2t} &amp; &amp;= &amp;u_{t3} \\
&amp;-\gamma_{14}Y_{t1}&amp;-\gamma_{24}Y_{t2} &amp;  &amp;+Y_{t4}   &amp;-\beta_{04} &amp; &amp; &amp;-\beta_{34}X_{t3} &amp;= &amp;u_{t4} 
  \end{alignedat}
\end{cases}$$`

- If you focus only on estimating the third equation, we can use the **single equation method** , which the variables
`\(Y_2, Y_4, X_3\)` were excluded from the estimation.

- If you want to estimate all four equations **simultaneously**, you should use the **system method**, and it will take into account all the constraints on multiple equations in the system.

???
- 如果仅仅关注于估计第三个方程，采用**单方程法**将只考虑此方程，也即仅注意变量
`\(Y_2,Y_4,X_3\)`
被排除在此方程之外。

- 如果希望**同时**估计全部四个方程，采用**方程组法**将会对方程组中多个方程的全部约束都考虑进来。

---

### Approaches to Estimation

In order to use all information  of SEM, it is most desirable to apply **system method**, such as **full information maximum likelihood** (FIML).

In practice, however, **systems method** are not commonly used for the following main reasons:

1. The computational burden is too great.

2. Systematic methods such as FIML often bring highly nonlinearity on parameters  , which are difficult to determine and caculate.

3. If there is one or more **specification error** in SEM (eg. an incorrect functional form or missing variables), the error will be passed to the remaining equations. As a result, the system method becomes very sensitive to the specification errors.

???
为了保持联立方程模型的品质，最理想的应是使用**方程组法**，比如**完全信息极大似然法** (full information maximum likelihood, FIML) 。

然而，实际上**方程组法**并不常用，主要原因包括：

1. 计算上的负担太大。

2. 像FIML这样的系统方法常常导致参数的高度非线性解，以致难以确定。

3. 如果方程组中的一个或多个方程有**设定误差**(比如说，一个错误的函数形式或漏掉有关变量)，则误差将传递至其余方程。其结果是，方程组法变得对设定误差非常敏感。

---
layout: false
class: center, middle, duke-softblue,hide_logo
name: LS

## 20.2 Least squares  approach (LS)

---
layout: true
  
&lt;div class="my-header-h2"&gt;&lt;/div&gt;
&lt;div class="watermark1"&gt;&lt;/div&gt;
&lt;div class="watermark2"&gt;&lt;/div&gt;
&lt;div class="watermark3"&gt;&lt;/div&gt;

&lt;div class="my-footer"&gt;&lt;span&gt;huhuaping@   &lt;a href="#chpt20"&gt; Chapter 20. How to Estimate SEM ? &lt;/a&gt; &amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp; 
&lt;a href="#LS"&gt; 20.2 Least squares  approach (LS) &lt;/a&gt; &lt;/span&gt;&lt;/div&gt; 

---

### OLS Approarch with recursive model

**Recursive model** : also known as the **triangle model**  or **causality  model**.

&gt;The simultaneous disturbance terms in different equations are unrelated, and each equation exhibits a one-way causal dependence.

Consider the following structural SEM:

`$$\begin{cases}
  \begin{alignat}{6}
  Y_{t1} =  &amp; &amp; &amp; &amp; +\beta_{01}&amp; + \beta_{11}X_{t1} &amp; + \beta_{21}X_{t2}  &amp; &amp; +u_{t1} \\
  Y_{t2} =  &amp; + \gamma_{12}Y_{1t} &amp; &amp; &amp;+\beta_{02} &amp; + \beta_{12}X_{t1} &amp; + \beta_{22}X_{t2} &amp; &amp; + u_{t2}\\
  Y_{t3} =  &amp; + \gamma_{13}Y_{t1}&amp; + \gamma_{23}Y_{t2}&amp; &amp;+\beta_{03} &amp; + \beta_{13}X_{t1} &amp; + \beta_{23}X_{t2} &amp; &amp; + u_{t3} \\
  \end{alignat}
\end{cases}$$`

???
递归模型(recursive model)：也称为三角形模型(triangular model)或因果性(causalmodel)模型。

不同方程中的同期干扰项是不相关的，每个方程都展现一种单向的因果依赖关系。

考虑下面的联立方程模型：



---

### OLS Approarch with recursive model

`$$\begin{cases}
  \begin{alignat}{6}
  Y_{t1} =  &amp; &amp; &amp; &amp; +\beta_{01}&amp; + \beta_{11}X_{t1} &amp; + \beta_{21}X_{t2}  &amp; &amp; +u_{t1} \\
  Y_{t2} =  &amp; + \gamma_{12}Y_{1t} &amp; &amp; &amp;+\beta_{02} &amp; + \beta_{12}X_{t1} &amp; + \beta_{22}X_{t2} &amp; &amp; + u_{t2}\\
  Y_{t3} =  &amp; + \gamma_{13}Y_{t1}&amp; + \gamma_{23}Y_{t2}&amp; &amp;+\beta_{03} &amp; + \beta_{13}X_{t1} &amp; + \beta_{23}X_{t2} &amp; &amp; + u_{t3} \\
  \end{alignat}
\end{cases}$$`

It is easy to find that the contemporaneous disturbance terms in different equations are irrelevant (namely **zero contemporaneous correlation**) :


`$$cov(u_{t1},u_{t2})=cov(u_{t1},u_{t3})=cov(u_{t2},u_{t3})=0$$`

- Since the first equation' right-hand side only contains exogenous variables, and are not correlated with disturbance terms, so this equation satisfies the CLRM and OLS can be applied directly to  it.


-  because 
`\(cov(u_{t1},u_{t2})=0\)`, and 
`\(cov(Y_{t1},u_{t2})=0\)`. Thus OLS can be applied directly to  it.

- because 
`\(cov(u_{t1},u_{t3})=0\)`, and 
`\(cov(Y_{t1},u_{t3})=0\)`. Also 
`\(cov(u_{t1},u_{t3})=0\)`, and 
`\(cov(Y_{t2},u_{t3})=0\)`. Thus OLS can be applied directly to  it.

???
zero contemporaneous correlation
我们很容易发现,不同方程中的同期干扰项是不相关的(或者说是零同期相关)：

对于第一个方程。因为它的右边仅含有外生变量，假定外生变量与干扰项均不相关，所以此方程满足经典OLS解释变量与干扰项不相关的基本假定。因而OLS可直接应用于此方程的估计。

---

### OLS Approarch with recursive model

We can also visualize it graphically:

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="pic/chpt20-recursive-graph.png" alt="SEM in recursive form" width="711" /&gt;
&lt;p class="caption"&gt;SEM in recursive form&lt;/p&gt;
&lt;/div&gt;

---

### OLS Approarch with recursive model

Let's look at the **wage-price model**:


`$$\begin{cases}
  \begin{align}
  P_t &amp;= \beta_0+\beta_1UN_t+\beta_2R_t+\beta_3M_t+u_{t2}  &amp;&amp;\text{(price equation)}\\
  W_t &amp;= \alpha_0+\alpha_1UN_t+\alpha_2P_t+u_{t1}   &amp;&amp;\text{(wage equation)}
  \end{align}
\end{cases}$$`

Where:

- W, the money wage rate;
- UN, unemployment, %;
- P, price rate;
- R, the cost of capital rate;
- M, import price change rate of raw materials.

???
- 价格方程假定当前价格变化率是资本和原料价格变化率、劳动生产率变化率以及前期工资变化率等的函数。

- 工资方程则表示当前工资变化率取决于当前价格变化率和失业率。

    - 货币工资变化率W
    - 失业率UN，%
    - 价格变化率P
    - 资本成本变化率R
    - 进口原材料的价格变化率M

---
layout: false
class: center, middle, duke-softblue,hide_logo
name: ILS

## 20.3 Indirect least squares (ILS)

---
layout: true
  
&lt;div class="my-header-h2"&gt;&lt;/div&gt;
&lt;div class="watermark1"&gt;&lt;/div&gt;
&lt;div class="watermark2"&gt;&lt;/div&gt;
&lt;div class="watermark3"&gt;&lt;/div&gt;

&lt;div class="my-footer"&gt;&lt;span&gt;huhuaping@   &lt;a href="#chpt20"&gt; Chapter 20. How to Estimate SEM ? &lt;/a&gt; &amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp; 
&lt;a href="#ILS"&gt; 20.3 Indirect least squares (ILS) &lt;/a&gt; &lt;/span&gt;&lt;/div&gt;

---

### ILS approach with Just Identification model

For a just or exactly identiﬁed structural equation, the method of obtaining the estimates of the structural coefﬁcients from the OLS estimates of the reduced-form coefﬁcients is known as the method of **Indirect Least Squares** (ILS), and the estimates thus obtained are known as the **indirect least squares estimates**. 

**ILS** involves the following three steps:

- Step 1. We ﬁrst obtain the reduced-form SEM. 

- Step 2. We apply **OLS** to the reduced-form SEM individually. 

- Step 3. We obtain estimates of the original structural coefﬁcients from the estimated reduced-form coefﬁcients obtained in Step 2. 
&gt; If an equation is **exactly identiﬁed**, there is one-to-one mapping between the structural and reduced coefficients.

???

&gt; This operation is permissible since the explanatory variables in these equations are predetermined and hence uncorrelated with the stochastic disturbances. The estimates thus obtained are consistent.

对一个恰好识别的结构方程，从**约简型系数**的OLS估计值获得**结构系数**估计值的方法叫做间接最小二乘法 (method of indirect least squares, ILS)，而如此得到的估计值称**间接最小二乘估计值**。 

间接最小二乘法(ILS方法)包含以下三个步骤:

- step 1：先求约简型方程。从结构方程组解出约简型方程，使得在每个方程的因变量都成为唯一的内生变量，并且仅仅是前定变量(外生或滞后内生)和随机误差项的函数。 

- step 2：对约简型方程逐个应用OLS。因为这些方程中的解释变量是前定的并因而与随机干扰项不相关，所以这种做法是合适的，由此得到的估计值是一致的。

- step 3: 从得到的约简型系数的估计值求原始结构系数的估计值 。若方程恰可识别，则结构与约简型系数之间有一一对应关系，就是说可以从后者导出前者的唯一估计值。

---

### Case demo: US crop supply and demand

The variables in the US crop supply and demand case are illustrated below

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-fb79a11028440402a1aa" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-fb79a11028440402a1aa">{"x":{"filter":"none","vertical":false,"caption":"<caption>variables in the model<\/caption>","data":[["1","2","3"],["Q","P","X"],["Crop yield index","Agricultural products purchasing prices index","Capital personal consumption expenditure"],["(1996=100)","(1990-1992=100)","(In 2007 dollars)"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>vars<\/th>\n      <th>label<\/th>\n      <th>note<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","columnDefs":[{"className":"dt-center","targets":"_all"},{"visible":false,"targets":0},{"orderable":false,"targets":0}],"pageLength":3,"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[3,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>

---

### Case demo: data set

The data for US crop supply and demand case show here:

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-76076b961853444f734b" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-76076b961853444f734b">{"x":{"filter":"none","vertical":false,"caption":"<caption>sample data (n=30)<\/caption>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30"],["1975 ","1976 ","1977 ","1978 ","1979 ","1980 ","1981 ","1982 ","1983 ","1984 ","1985 ","1986 ","1987 ","1988 ","1989 ","1990 ","1991 ","1992 ","1993 ","1994 ","1995 ","1996 ","1997 ","1998 ","1999  ","2000 ","2001 ","2002","2003","2004 "],[66,67,71,73,78,75,81,82,71,81,85,82,84,80,86,90,90,96,91,101,96,100,104,105,108,108,108,107,108,112],[88,87,83,89,98,107,111,98,108,111,98,87,86,104,109,103,101,101,102,105,112,127,115,107,97,96,99,105,111,117],[4789,5282,5804,6417,7073,7716,8439,8945,9775,10589,11406,12048,12766,13685,14546,15349,15722,16485,17204,18004,18665,19490,20323,21291,22491,23862,24722,25501,26463,27937]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>year<\/th>\n      <th>Q<\/th>\n      <th>P<\/th>\n      <th>X<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"tip","columnDefs":[{"className":"dt-center","targets":"_all"},{"visible":false,"targets":0},{"orderable":false,"targets":0}],"pageLength":7,"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[7,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>

---

### Case demo: structural SEM

So we can construct the following structural SEM:

`$$\begin{cases}
  \begin{align}
  Q &amp;= \alpha_0+\alpha_1P_t+\alpha_2X_t+u_{t1}   &amp;(\alpha_1&lt;0,\alpha_2&gt;0)  &amp;&amp;\text{(demand function)}\\
  Q &amp;= \beta_0+\beta_1P_t+u_{t2}  &amp;(\beta_1&gt;0) &amp;&amp;\text{(supply function)}
  \end{align}
\end{cases}$$`

&gt;where：
- `\(Q=\)`Crop yield index; 
- `\(P=\)`Agricultural products purchasing prices index; 
- `\(X=\)`Capital personal consumption expenditure.

---

### Case demo: reduced SEM

Thus we can obtain the reduced SEM:

`$$\begin{cases}
  \begin{align}
  P_t &amp;= \pi_{11}+ \pi_{21}X_t+w_t &amp;&amp;\text{(eq1)}\\
  Q_t &amp;= \pi_{12}+\pi_{22}X_t+v_t &amp;&amp;\text{(eq2)} \\
  \end{align}
\end{cases}$$`

and the relationship between structural and reduced coefficients is:

.pull-left[

`$$\begin{cases}
  \begin{align}
  \pi_{11} &amp;= \frac{\beta_0-\alpha_0}{\alpha_1-\beta_1} \\
  \pi_{21} &amp;= - \frac{\alpha_2}{\alpha_1-\beta_1}\\
  w_t &amp;= \frac{u_{2t}-u_{t1}}{\alpha_1-\beta_1}  \\
  \end{align}
\end{cases}$$`

]

.pull-right[

`$$\begin{cases}
  \begin{align}
  \pi_{12} &amp;= \frac{\alpha_1\beta_0-\alpha_0\beta_1}{\alpha_1-\beta_1}  \\
  \pi_{22} &amp;= - \frac{\alpha_2\beta_1}{\alpha_1-\beta_1}  \\
  v_t &amp;= \frac{\alpha_1u_{t2}-\beta_1u_{1t}}{\alpha_1-\beta_1} 
  \end{align}
\end{cases}$$`

]

---

### Case demo: reduced coefficients

For the above reduced SEM, we can use OLS method to obtain the estimated coefficients:

`$$\begin{cases}
  \begin{align}
  \widehat{\pi}_{21} &amp;=  \frac{\sum{p_t x_t}}{\sum{x^2_t}} &amp;&amp;\text{(slope of the reduced price  eq)} \\
  \widehat{\pi}_{11} &amp;= \overline{P} - \widehat{\pi}_1 \cdot \overline{X} &amp;&amp;\text{(intercept of the  reduced price eq)} \\
  \widehat{\pi}_{22} &amp;= \frac{\sum{q_t x_t}}{\sum{x^2_t}} &amp;&amp;\text{(slope of the reduced quantaty  eq)} \\
  \widehat{\pi}_{12} &amp;= \overline{Q} - \widehat{\pi}_3 \cdot \overline{X} &amp;&amp;\text{(intercept of the reduced quantaty  eq)} 
  \end{align}
\end{cases}$$`

---

### Case demo: structural coefficients

Because we already know that **the supply equation** in the structural SEM is **Just identification** (please review the order and rank conditions) , hence the structural coefficients of the supply equation can be  calculated uniquely with the reduced coefficients.

`$$\begin{cases}
  \begin{align}
  \beta_0 &amp;= \pi_{12}+ \beta_1 \pi_{11} \\
  \beta_1 &amp;= \frac{\pi_{22}}{\pi_{21}} \\
  \end{align}
\end{cases}$$`

which is:

`$$\begin{cases}
  \begin{align}
  \hat{\beta_0} &amp;= \widehat{\pi}_{12}+ \hat{\beta_1} \widehat{\pi}_{11} \\
  \hat{\beta_1} &amp;= \frac{\widehat{\pi}_{22}}{\widehat{\pi}_{21}} \\
  \end{align}
\end{cases}$$`

???

因为我们已经知道（请复习阶条件和秩条件）**供给方程**是**恰好可识别的**，因此供给方程的结构系数是可以由简约系数唯一地估计得到：

---

### Case demo: OLS estimates for reduced equation

Next, we carry out OLS regression for the reduced equation.

`$$\begin{cases}   
  \begin{align}
  P_t &amp;= \pi_{11}+ \pi_{21}X_t+w_t &amp;&amp;\text{(reduced eq1)}\\
  Q_t &amp;= \pi_{12}+\pi_{22}X_t+v_t &amp;&amp;\text{(reduced eq2)} \\
  \end{align}
\end{cases}$$`



.pull-left[

The regression result of the reduced price  equation is:

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{P}=&amp;&amp;+90.96&amp;&amp;+0.00X\\ &amp;\text{(t)}&amp;&amp;(22.4499)&amp;&amp;(3.0060)\\&amp;\text{(se)}&amp;&amp;(4.0517)&amp;&amp;(0.0002)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.2440;&amp;&amp; \bar{R^2}=0.2170\\&amp; &amp;&amp; F^{\ast}=9.04;&amp;&amp; p=0.0055 \end{alignedat} \end{equation}$$`

]

.pull-right[

The regression result of the reduced quantity  equation is:

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{Q}=&amp;&amp;+59.76&amp;&amp;+0.00X\\ &amp;\text{(t)}&amp;&amp;(38.3080)&amp;&amp;(20.9273)\\&amp;\text{(se)}&amp;&amp;(1.5600)&amp;&amp;(0.0001)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.9399;&amp;&amp; \bar{R^2}=0.9378\\&amp; &amp;&amp; F^{\ast}=437.95;&amp;&amp; p=0.0000 \end{alignedat} \end{equation}$$`
]

---
exclude: true

### Rscript: calculate values



---

### Case demo: obtain structural coefficients

we can obtain the **reduced coefficients**:

.pull-left[
- `\(\widehat{\pi}_{21}=\)`
0.00074

- `\(\widehat{\pi}_{11}=\)`
90.96007

]

.pull-right[
- `\(\widehat{\pi}_{22}=\)`
0.00197

- `\(\widehat{\pi}_{12}=\)`
59.76183
]

Because **supply equation** in structural SEM is **Just identification**, so the structural coefficients of **supply equation** can be calculated by using the estimated reduced coefficients.



`\(\hat{\beta_1} = \frac{\widehat{\pi}_{22}}{\widehat{\pi}_{12}}\)` = 
0.00197 / 
0.00074 = 
2.68052

`\(\hat{\beta_0} = \widehat{\pi}_{12}+ \hat{\beta_1} \widehat{\pi}_{11}\)` = 
59.76183 - 
2.68052 `\(\cdot\)` 
90.96007 = 
-184.05874


Therefore, the ILS estimators of **supply equation** parameters are:


`\(\hat{Q_t}=\)`
-184.05874 +
2.68052
`\(P_t\)`


---

### Case demo: result comparison

As comparison, we will show a **"biased"** estimation method, which  use  OLS directly for both quantity and price equation.  


.pull-left[

- Estimation of the **supply equation** based on the ILS approach:

`\(\hat{Q_t}=\)`
-184.05874 +
2.68052
`\(P_t\)`

]

.pull_right[

- Estimation of the **supply equation** based on the **biased** OLS approach:

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{Q}=&amp;&amp;+20.89&amp;&amp;+0.67P\\ &amp;\text{(t)}&amp;&amp;(0.9067)&amp;&amp;(2.9940)\\&amp;\text{(se)}&amp;&amp;(23.0396)&amp;&amp;(0.2246)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.2425;&amp;&amp; \bar{R^2}=0.2154\\&amp; &amp;&amp; F^{\ast}=8.96;&amp;&amp; p=0.0057 \end{alignedat} \end{equation}$$`

]


---
layout: false
class: center, middle, duke-softblue,hide_logo
name: TSLS

## 20.4 Two-stage least square method (2SLS)

---
layout: true
  
&lt;div class="my-header-h2"&gt;&lt;/div&gt;
&lt;div class="watermark1"&gt;&lt;/div&gt;
&lt;div class="watermark2"&gt;&lt;/div&gt;
&lt;div class="watermark3"&gt;&lt;/div&gt;

&lt;div class="my-footer"&gt;&lt;span&gt;huhuaping@   &lt;a href="#chpt20"&gt; Chapter 20. How to Estimate SEM ? &lt;/a&gt; &amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp; 
&lt;a href="#TSLS"&gt; 20.4 Two-stage least square method (2SLS) &lt;/a&gt; &lt;/span&gt;&lt;/div&gt;

---

### Overidentification: structural SEM

Consider the following structural SEM:

`$$\begin{cases}
  \begin{alignat}{6}
  Y_{t1} = &amp; &amp;+ \gamma_{21}Y_{2t} &amp; &amp; +\beta_{01}  &amp; + \beta_{11}X_{t1} &amp; + \beta_{21}X_{t2}  &amp;  +u_{t1} &amp; \text{   (income eq)} \\
  Y_{t2} =  &amp; + \gamma_{12}Y_{t1} &amp; &amp;  &amp;    +\beta_{02} &amp; &amp; &amp; + u_{t2} &amp; \text{   (monetary supply eq)}
  \end{alignat}
\end{cases}$$`

where: 
`\(Y_1=\)`Income;
`\(Y_2=\)`Monetary stock;
`\(X_1=\)`Government expenditure;
`\(X_2=\)`Government spending on goods and services

Using **order condition rules** and **rank condition rules** (Review), we can know:

- The **Income equation** is **underidentification**
- if you don't change the model specification, then god can't help you! 

- The **monetary supply equation** is **overidentification** 
it's easy to prove that if we apply the ILS approach we will obtain two estimates on
`\(\gamma_{21}\)`. Hence it is impossible to determin the exact value.

???
运用**阶条件识别规则**和**秩条件识别规则**（复习），可以知道：

- **收入方程**是**不可识别的**

- 如果不改变模型设定，那“神也帮不了你”！
    
- **货币供给方程**是**过度识别的**

- 容易证明，如果采用ILS估计方法，$\gamma_{21}$有两个ILS估计值。所以也没办法估计得到！

---

### Overidentification: Instrument variables

Looking for **Instrument variables approach** to crack the **overidentification** problems:

- In practice, people might want to use OLS to estimate the monetary supply equation, but it will get the biased estimators, because there exist correlationship between 
`\(Y_1\)` and
`\(u_2\)`.

&gt; **Instrument Variable**: An agent variable which is highly correlated with 
`\(Y_1\)` but have no relationship with 
`\(u_2\)`.


- if we can find an **instrument variable**, then we can apply  OLS approach directly to estimate the structural monetary supply eqution.

But how does one obtain such an instrumental variable? 

One answer is provided by the **two-stageleast squares** (2SLS), developed independently by Henri Theil and Robert Basmann.

???
由瑟尔和巴斯曼 (Robert Basmann)各自独立发现的两阶段最小二乘 (two-stage least squares, 2SLS)成为寻找合适**工具变量**的重要方途径和方法。


---

### Overidentification: stage 1 of 2SLS

**2SLS method** involves two successive applications of OLS. The process is as follows:


**Stage 1**. To get rid of the likely correlation between 
`\(Y_1\)` and 
`\(u_2\)`,apply regresssion 
`\(Y_1\)` on all the predetermined variables in the whole system, not just that equation.

`$$\begin{align}
Y_{t1} &amp;= \widehat{\pi}_{01} + \widehat{\pi}_{11} X_{t1} +  \widehat{\pi}_{21} X_{t2} + \hat{v}_{t1} \\
       &amp;= \hat{Y_{t1} } + \hat{v}_{t1} \\
\hat{Y_{t1} }&amp;= \widehat{\pi}_{01} + \widehat{\pi}_{11} X_{t1} +  \widehat{\pi}_{21} X_{t2}
\end{align}$$`

Indicates that the random 
`\(Y_1\)` is composed of two parts:

- a linear combination of the nonstochastic  `\(X\)`
- random component 
`\(\hat{u}_t\)`

&gt;according to OLS theory, 
`\(\hat {Y}_{t1}\)` is not related to 
`\(\hat{v}_{t1}\)` (Why?).



???
**stage 1: **为摆脱
`\(Y_1\)`
和
`\(u_2\)`
之间可能的相关性，先求
`\(Y_1\)`
对整个方程组(不仅仅是所考虑的方程中)全部**前定变量**的回归。也即：

表明随机的
`\(Y_1\)`
是由两部分构成：

- 随机X的一个线性组合而成的
`\(\hat{Y}_{t1}\)`
- 随机成分
`\(\hat{u}_t\)`
- 按照OLS理论，
`\(\hat{Y}_{t1}\)`
与
`\(\hat{v}_{t1}\)`
是不相关的（Why？提问）。

---

### Overidentification: stage 2 of 2SLS

**stage 2**. Now retransform the **overidentification** supply equation as follow:

`$$\begin{align}
Y_{t2} &amp; = \beta_{02}  + \gamma_{12} Y_{t1} + u_{t2}  \\
       &amp; = \beta_{02}  + \gamma_{12} (\hat{Y}_{t1}+\hat{v}_{t1}) + u_{t2} \\
       &amp; = \beta_{02}  + \gamma_{12} \hat{Y}_{t1}+(\gamma_{12} \hat{v}_{t1} + u_{t2} ) \\
       &amp; = \beta_{02}  + \gamma_{12} \hat{Y}_{t1}+ u_{t2}^{\ast}
\end{align}$$`

We can prove that:

- the variable
`\(Y_{t1}\)` may be relative with the disturbance term
`\(u_{t2}\)`, which will invalid the OLS approach.

- Meanwhile, 
`\(\hat{Y_{1t}}\)`is uncorrelated with 
`\(u_{t2}^{\ast}\)` asymptotically, that is, in the large sample (or more accurately, as the sample size increases indeﬁnitely). 

&gt; As a result, OLS can be applied to monetary Eq, which will give consistent estimates of the parameters of the monetary supply function.

---

### 2SLS approach: Features

Note the following features of 2SLS:

- It can be applied to an individual equation in the system without directly taking into account any other equation(s) in the system. Hence, for solving econometric models involving a large number of equations, 2SLS offers an economical method. 

- Unlike ILS, which provides multiple estimates of parameters in the overidentiﬁed equations, 2SLS provides only one estimate per parameter.

- It is easy to apply because all one needs to know is the total number of exogenous or pre-determined variables in the system without knowing any other variables in the system.

- Although specially designed to handle overidentiﬁed equations, the method can also be applied to exactly identiﬁed equations. But then ILS and 2SLS will give identical estimates. (Why?)


???

两阶段最小二乘法(2SLS方法)的特点：

- 它可以应用于方程组中的某个方程而无需考虑方程组中的其他方程。因此，在求解涉及大量方程的计量经济模型时，2SLS提供了一个经济适用的方法。由于这一原因，此法在实际中被广泛应用。

- 相对于ILS为过度识别的方程提供参数的多个估计值，而2SLS对每个参数只提供一个估计值。

- 它只需知道方程组中一共有多少个外生或前定变量，而无需知道方程组中的任何其他变量，故易于应用。


---

### 2SLS approach: Features

Note the following features of 2SLS (continue):

- If the 
`\(R^2\)` values in the reduced-form regressions (that is, Stage 1 regressions) are very high, say, in excess of 0.8, the classical OLS estimates and 2SLS estimates will be very close. 

&gt; But this result should not be surprising because if the 
`\(R^2\)` value in the first stage is very high, it means that the estimated values of the endogenous variables are very close to their actual values.

&gt; And hence the latter are less likely to be correlated with the stochastic disturbances in the original structural SEM. (Why?)


???
.large[
两阶段最小二乘法(2SLS方法)的特点(续)：

- 此法虽然专为过度识别的方程而设计，但同样适用于恰好识别的方程。但这时ILS和2SLS将给出相同的估计。(为什么?)

- 如果约简型回归（即阶段1的回归）的F值很高，比如说高于0.8。则经典OLS估计和 2SLS估计将相差无几。

- 在ILS方法的回归报告中，我们没有给出所估系数的**标准误**，但我们能对 2SLS估计值给出这些**标准误**。
]

---

### 2SLS approach: Features

Note the following features of 2SLS (continue):

- Notice that in reporting the ILS regression we did not state the **standard errors** of the estimated coefﬁcients . But we can do this for the 2SLS estimates because the structural coefﬁcients are directly estimated from the second-stage (OLS) regressions. 
&gt; The estimated standard errors in the second-stage regressions need to be modiﬁed because the error term 
`\(u^{\ast}_t\)` is, in fact, equal to  
`\(u_{2t}+β_{21}\hat{u}_t\)`. 

&gt; Hence, the variance of 
`\(u^{\ast}_t\)` is not exactly equal to the variance of the original 
`\(u_{2t}\)`.

---

### 2SLS approach: Features

Note the following features of 2SLS (continue):

- Remarks from `Henri Theil`:

&gt; 
- The statistical justification of the 2SLS is of the large-sample type.

&gt; 
- When the equation system contains lagged endogenous variables, the consistency and large-sample normality of the 2SLS coefﬁcient estimators require an additional condition.

&gt; 
- Take cautions when lagged endogenous variables are not really predetermined. 



---

### Standard error correction: why

In the regression report of ILS method, we do not give the **standard error** of the estimated coefficient, but we can give these **standard error** for the estimator of 2SLS.

- Remind
`\(u^{\ast}_{t2}=u_{t2}+\gamma_{12}\hat{v}_{t1}\)`

- It will imply 
`\(u^{\ast}_{t2} \neq u_{t2}\)`
, and then we need to calculate the "correct" standard error for the purpose of inference.

&gt; For the specific method of error correction, please refer to appendix 20a.2 of the textbook (Damodar Gujarati).

- In the following cases illurtration, we will show the 2SLS estimates **without error correction** and the 2SLS estimates **with error correction** respectively.


???
在ILS方法的回归报告中，我们没有给出所估系数的**标准误**，但我们能对 2SLS估计值给出这些**标准误**。

- 需要注意的是：
`\(u^{\ast}_{t2}=u_{t2}+\gamma_{12}\hat{v}_{t1}\)`

- 这意味着
`\(u^{\ast}_{t2} \neq u_{t2}\)`
，因此需要进行**误差校正**

- 误差矫正的具体办法，可以参考教材附录20A.2

- 下面的案例展示中，我们将会分别展示**没有误差校正**的2SLS估计和**经过误差矫正**的2SLS估计。

---

### Standard error correction: focus stage 2

The process for error correction show as below.

- **stage 2:** The regression form of the supply equation is

`$$\begin{align}
Y_{t2} &amp; = \beta_{02}  + \gamma_{12} Y_{1t} + u_{2t}  \\
       &amp; = \beta_{02}  + \gamma_{12} (\hat{Y_{1t}}+\hat{v}_{t1}) + u_{2t} \\
       &amp; = \beta_{02}  + \gamma_{12} \hat{Y_{1t}}+(\gamma_{12} \hat{v}_{t1} + u_{t2} ) \\
       &amp; = \beta_{02}  + \gamma_{12} \hat{Y_{1t}}+ u_{t2}^{\ast}
\end{align}$$`

&gt; Where:

&gt; `\(u^{\ast}_{t2}=u_{t2}+\gamma_{12}\hat{v}_{t1}\)`

---

### Standard error correction: focus stage 2

- **stage 2:** the estimation for the parameter `\(\gamma_{12}\)` is `\(\hat{\gamma}_{12}\)`, and its standard error  `\(s.e_{\hat{\gamma}_{12}}\)` can be calculated as below.

`$$\begin{align}
Y_{t2} &amp; = \beta_{02}  + \gamma_{12} \hat{Y_{1t}}+ u_{t2}^{\ast}
\end{align}$$`

`$$\begin{align}
s.e_{\hat{\gamma}_{21}} &amp; = \frac{\hat{\sigma}^2_{u^{\ast}_{t2}}}{\sum{\hat{y}^2_{t1}}}\\
\hat{\sigma}^2_{u^{\ast}_{t2}} &amp; =\frac{ \sum{\left ( u^{\ast}_{t2} \right )^2} }{n-2} = \frac{ \sum{\left (Y_{t2}-\hat{\beta}_{02} -\hat{\gamma}_{12}\hat{Y}_{1t} \right )^2} }{n-2}
\end{align}$$`

---

### Standard error correction: results

- In fact, we know
`\(u^{\ast}_{t2} \neq u_{t2}\)`
, which means
`\(\hat{\sigma}_{u^{\ast}_{t2}} \neq \hat{\sigma}_{u_{t2}}\)`. 

- Thus we can obtain
`\(\hat{\sigma}_{u_{t2}}\)`.


`$$\begin{align}
\hat{u}_{t2} &amp;= Y_{t2} - \hat{\beta}_{02} - \hat{\gamma}_{12}Y_{t1} \\
\hat{\sigma}^2_{u_{2t}} &amp; =\frac{ \sum{\left ( u_{2t} \right )^2} }{n-2} = \frac{ \sum{\left (Y_{t2}-\hat{\beta}_{02} -\hat{\gamma}_{12}Y_{1t} \right )^2} }{n-2}
\end{align}$$`

---

### Standard error correction: for coefficients

Therefore, in order to correct the standard error of the coefficients estimated by **stage 2** regression, it is necessary to multiply the standard error of each coefficient by the following **error correction factor**.


`$$\begin{align}
\eta &amp;= \frac{ \hat{\sigma}^2_{u_{t2}} } {\hat{\sigma}^2_{u^{\ast}_{t2}} } 
\end{align}$$`

`$$\begin{align}
s.e^{\ast}_{\hat{\gamma}_{12}} &amp; = s.e_{\hat{\gamma}_{12}} \cdot \eta = s.e_{\hat{\gamma}_{12}} \cdot \frac{ \hat{\sigma}^2_{u_{t2}} } {\hat{\sigma}^2_{u^{\ast}_{t2}} } \\
s.e^{\ast}_{\hat{\beta}_{02}} &amp; = s.e_{\hat{\beta}_{02}} \cdot \eta = s.e_{\hat{\beta}_{20}} \cdot \frac{ \hat{\sigma}^2_{u_{t2}} } {\hat{\sigma}^2_{u^{\ast}_{t2}} } 
\end{align}$$`

???

- **误差矫正因子**：因此校正**stage 2** 回归所估计的系数的标准误，需要对每一个系数的标准误乘以如下的**误差矫正因子**

---
class: inverse, middle, center

## Case study and application for 2SLS approach

---

### variable description


<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-bb4a802daa83ed9b9941" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-bb4a802daa83ed9b9941">{"x":{"filter":"none","vertical":false,"caption":"<caption>Variables description<\/caption>","data":[["1","2","3","4","5","6","7"],["Y1","Y2","X1","X2","Y1.l1","Y2.l1","X3"],["GDP:  gross domestic product","M2:money supply","GDPI: Total private domestic investment ","FEDEXP: Federal expenditure ","GDP_t-1: The gross domestic product of the previous period","M2_t-1: The money supply in the previous period","TB6: 6 month Treasury bond interest rate "],["($1 billion in 2000)","($1 billion)","($1 billion in 2000)","($1 billion)","($1 billion in 2000)","($1 billion)","(%)"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>vars<\/th>\n      <th>label<\/th>\n      <th>note<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","columnDefs":[{"className":"dt-center","targets":"_all"},{"visible":false,"targets":0},{"orderable":false,"targets":0}],"pageLength":7,"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[7,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>

---

### data set




<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-a3bc5c9c79894e18db31" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-a3bc5c9c79894e18db31">{"x":{"filter":"none","vertical":false,"caption":"<caption>Sample data ( n=36)<\/caption>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36"],["1970 ","1971 ","1972 ","1973 ","1974 ","1975 ","1976 ","1977 ","1978 ","1979 ","1980 ","1981 ","1982 ","1983 ","1984 ","1985 ","1986 ","1987 ","1988 ","1989 ","1990 ","1991 ","1992 ","1993 ","1994 ","1995 ","1996 ","1997 ","1998 ","1999  ","2000 ","2001 ","2002","2003","2004 ","2005 "],[3771.9,3898.6,4105,4341.5,4319.6,4311.2,4540.9,4750.5,5015,5173.4,5161.7,5291.7,5189.3,5423.8,5813.6,6053.7,6263.6,6475.1,6742.7,6981.4,7112.5,7100.5,7336.6,7532.7,7835.5,8031.7,8328.9,8703.5,9066.9,9470.3,9817,9890.7,10048.8,10301,10703.5,11048.6],[626.5,710.3,802.3,855.5,902.1,1016.2,1152,1270.3,1366,1473.7,1599.8,1755.4,1910.3,2126.5,2310,2495.7,2732.4,2831.4,2994.5,3158.5,3278.6,3379.1,3432.5,3484,3497.5,3640.4,3815.1,4031.6,4379,4641.1,4920.9,5430.3,5774.1,6062,6411.7,6669.4],[427.1,475.7,532.1,594.4,550.6,453.1,544.7,627,702.6,725,645.3,704.9,606,662.5,857.7,849.7,843.9,870,890.5,926.2,895.1,822.2,889,968.3,1099.6,1134,1234.3,1387.7,1524.1,1642.6,1735.5,1598.4,1557.1,1613.1,1770.6,1866.3],[201.1,220,244.4,261.7,293.3,346.2,374.3,407.5,450,497.5,585.7,672.7,748.5,815.4,877.1,948.2,1006,1041.6,1092.7,1167.5,1253.5,1315,1444.6,1496,1533.1,1603.5,1665.8,1708.9,1734.9,1787.6,1864.4,1969.5,2101.1,2252.1,2383,2555.9],[null,3771.9,3898.6,4105,4341.5,4319.6,4311.2,4540.9,4750.5,5015,5173.4,5161.7,5291.7,5189.3,5423.8,5813.6,6053.7,6263.6,6475.1,6742.7,6981.4,7112.5,7100.5,7336.6,7532.7,7835.5,8031.7,8328.9,8703.5,9066.9,9470.3,9817,9890.7,10048.8,10301,10703.5],[null,626.5,710.3,802.3,855.5,902.1,1016.2,1152,1270.3,1366,1473.7,1599.8,1755.4,1910.3,2126.5,2310,2495.7,2732.4,2831.4,2994.5,3158.5,3278.6,3379.1,3432.5,3484,3497.5,3640.4,3815.1,4031.6,4379,4641.1,4920.9,5430.3,5774.1,6062,6411.7]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>year<\/th>\n      <th>Y1<\/th>\n      <th>Y2<\/th>\n      <th>X1<\/th>\n      <th>X2<\/th>\n      <th>Y1.l1<\/th>\n      <th>Y2.l1<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"tip","columnDefs":[{"className":"dt-center","targets":"_all"},{"visible":false,"targets":0},{"orderable":false,"targets":0}],"pageLength":8,"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[8,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>


---

##  Modeling scenario 1

Only the money supply equation is overidentifiable

---

### Structural SEM and identification problems

Therefore, we can construct the following structural SEM:

`$$\begin{cases}
  \begin{alignat}{6}
  Y_{t1} = \beta_{01} &amp; &amp;+ \gamma_{21}Y_{t2} &amp; &amp; + \beta_{11}X_{t1} &amp; + \beta_{21}X_{t2}  &amp; &amp; +u_{t1} &amp;&amp; \text{   (income eq)} \\
  Y_{t2} = \beta_{02} &amp; + \gamma_{12}Y_{1t} &amp; &amp;  &amp;  &amp;  &amp; &amp; + u_{t2} &amp;&amp; \text{   (money supply eq)}
  \end{alignat}
\end{cases}$$`

Where:

- `\(Y_1=GDP\)` (gross domestic product GDP);

- `\(Y_2=M2\)` (money supply);

- `\(X_1=GDPI\)` (Private domestic investment);

- `\(X_2=FEDEXP\)` (Federal expenditure)


---

### 2SLS approach 1: without error correction



`$$\begin{cases}
  \begin{alignat}{6}
  Y_{t1} &amp;&amp;= \beta_{01} &amp;&amp; &amp;&amp;+ \gamma_{21}Y_{t2} &amp;&amp; + \beta_{11}X_{t1} &amp;&amp; + \beta_{21}X_{t2}  &amp;&amp; +u_{t1} &amp;&amp; \text{   (income eq)} \\
  Y_{t2} &amp;&amp;= \beta_{02} &amp;&amp; + \gamma_{12}Y_{1t} &amp;&amp;  &amp;&amp; &amp;&amp; &amp;&amp; + u_{t2} &amp;&amp; \text{   (money supply eq)}
  \end{alignat}
\end{cases}$$`

**stage 1: ** Estimate the regression of 
`\(Y_1\)` to all **predetermined variables** in the structural SEM (not only in the equation under consideration), and obtain 
`\(\hat{Y}_{t1}; \hat {n} _ {t1}\)`. 

.pull-left[
That is:

`$$\begin{align}
Y_{1t} &amp;= \widehat{\pi_0} + \widehat{\pi_1} X_{1t} +  \widehat{\pi_2} X_{2t} + \hat{v}_{t1} \\
       &amp;= \hat{Y_{1t} } + \hat{v}_{t1}
\end{align}$$`

]

.pull-right[

Regression results of **stage 1**:



`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{Y1}=&amp;&amp;+2689.85&amp;&amp;+1.87X1&amp;&amp;+2.03X2\\ &amp;\text{(t)}&amp;&amp;(39.5639)&amp;&amp;(10.8938)&amp;&amp;(18.9295)\\&amp;\text{(se)}&amp;&amp;(67.9874)&amp;&amp;(0.1717)&amp;&amp;(0.1075)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.9964;&amp;&amp; \bar{R^2}=0.9962\\&amp; &amp;&amp; F^{\ast}=4534.36;&amp;&amp; p=0.0000 \end{alignedat} \end{equation}$$`

]


???
**stage 1: **先求$Y_1$对整个方程组(不仅仅是所考虑的方程中)全部**前定变量**的回归，并分别得到$\hat{Y }_{t1} ;\hat{v}_{t1}$。也即：


---

### 2SLS approach 1: without error correction

At the same time, we can obtain 
`\(\hat{Y }_{t1} ;\hat{v}_{t1}\)`:

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-653e7780bb5e81e37984" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-653e7780bb5e81e37984">{"x":{"filter":"none","vertical":false,"caption":"<caption>New variable Yt1.hat and vt1.hat after regression of stage 1 <\/caption>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36"],["1970 ","1971 ","1972 ","1973 ","1974 ","1975 ","1976 ","1977 ","1978 ","1979 ","1980 ","1981 ","1982 ","1983 ","1984 ","1985 ","1986 ","1987 ","1988 ","1989 ","1990 ","1991 ","1992 ","1993 ","1994 ","1995 ","1996 ","1997 ","1998 ","1999  ","2000 ","2001 ","2002","2003","2004 ","2005 "],[3771.9,3898.6,4105,4341.5,4319.6,4311.2,4540.9,4750.5,5015,5173.4,5161.7,5291.7,5189.3,5423.8,5813.6,6053.7,6263.6,6475.1,6742.7,6981.4,7112.5,7100.5,7336.6,7532.7,7835.5,8031.7,8328.9,8703.5,9066.9,9470.3,9817,9890.7,10048.8,10301,10703.5,11048.6],[626.5,710.3,802.3,855.5,902.1,1016.2,1152,1270.3,1366,1473.7,1599.8,1755.4,1910.3,2126.5,2310,2495.7,2732.4,2831.4,2994.5,3158.5,3278.6,3379.1,3432.5,3484,3497.5,3640.4,3815.1,4031.6,4379,4641.1,4920.9,5430.3,5774.1,6062,6411.7,6669.4],[427.1,475.7,532.1,594.4,550.6,453.1,544.7,627,702.6,725,645.3,704.9,606,662.5,857.7,849.7,843.9,870,890.5,926.2,895.1,822.2,889,968.3,1099.6,1134,1234.3,1387.7,1524.1,1642.6,1735.5,1598.4,1557.1,1613.1,1770.6,1866.3],[201.1,220,244.4,261.7,293.3,346.2,374.3,407.5,450,497.5,585.7,672.7,748.5,815.4,877.1,948.2,1006,1041.6,1092.7,1167.5,1253.5,1315,1444.6,1496,1533.1,1603.5,1665.8,1708.9,1734.9,1787.6,1864.4,1969.5,2101.1,2252.1,2383,2555.9],[null,3771.9,3898.6,4105,4341.5,4319.6,4311.2,4540.9,4750.5,5015,5173.4,5161.7,5291.7,5189.3,5423.8,5813.6,6053.7,6263.6,6475.1,6742.7,6981.4,7112.5,7100.5,7336.6,7532.7,7835.5,8031.7,8328.9,8703.5,9066.9,9470.3,9817,9890.7,10048.8,10301,10703.5],[null,626.5,710.3,802.3,855.5,902.1,1016.2,1152,1270.3,1366,1473.7,1599.8,1755.4,1910.3,2126.5,2310,2495.7,2732.4,2831.4,2994.5,3158.5,3278.6,3379.1,3432.5,3484,3497.5,3640.4,3815.1,4031.6,4379,4641.1,4920.9,5430.3,5774.1,6062,6411.7],[3897.6136,4026.9427,4182.0464,4333.7391,4316.1193,4241.4135,4469.867,4691.3048,4919.1332,5057.6509,5088.0423,5376.4787,5345.7411,5587.4906,6078.0259,6207.7069,6314.4452,6435.6733,6577.9617,6796.8872,6913.6834,6902.474,7291.0365,7543.8892,7864.8892,8072.4327,8386.7288,8761.261,9069.2169,9398.0169,9727.973,9685.4085,9875.8963,10287.7978,10848.6108,11379.3017],[-125.7136,-128.3427,-77.0464,7.7609,3.4807,69.7865,71.033,59.1952,95.8668,115.7491,73.6577,-84.7787,-156.4411,-163.6906,-264.4259,-154.0069,-50.8452,39.4267,164.7383,184.5128,198.8166,198.026,45.5635,-11.1892,-29.3892,-40.7327,-57.8288,-57.761,-2.3169,72.2831,89.027,205.2915,172.9037,13.2022,-145.1108,-330.7017]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>year<\/th>\n      <th>Y1<\/th>\n      <th>Y2<\/th>\n      <th>X1<\/th>\n      <th>X2<\/th>\n      <th>Y1.l1<\/th>\n      <th>Y2.l1<\/th>\n      <th>Y1.hat<\/th>\n      <th>v1.hat<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"tip","columnDefs":[{"className":"dt-center","targets":"_all"},{"visible":false,"targets":0},{"orderable":false,"targets":0}],"pageLength":6,"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[6,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>

---

### 2SLS approach 1: without error correction

`$$\begin{cases}
  \begin{alignat}{6}
  Y_{t1} &amp;&amp;= \beta_{01} &amp;&amp; &amp;&amp;+ \gamma_{21}Y_{t2} &amp;&amp; + \beta_{11}X_{t1} &amp;&amp; + \beta_{21}X_{t2}  &amp;&amp; +u_{t1} &amp;&amp; \text{   (income eq)} \\
  Y_{t2} &amp;&amp;= \beta_{02} &amp;&amp; + \gamma_{12}Y_{1t} &amp;&amp;  &amp;&amp; &amp;&amp; &amp;&amp; + u_{t2} &amp;&amp; \text{   (money supply eq)}
  \end{alignat}
\end{cases}$$`

**stage 2:** Now transform the **overidentification** supply equation as follows:

`$$\begin{align}
Y_{t2} &amp; = \beta_{02}  + \gamma_{12} \hat{Y}_{1t}+ u_{t2}^{\ast}
\end{align}$$`

&gt;Using the new variables in **stage 1** results, and apply OLS estimation to obtain:


`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{Y2}=&amp;&amp;-2440.20&amp;&amp;+0.79Y1.hat\\ &amp;\text{(t)}&amp;&amp;(-19.1578)&amp;&amp;(44.5241)\\&amp;\text{(se)}&amp;&amp;(127.3738)&amp;&amp;(0.0178)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.9831;&amp;&amp; \bar{R^2}=0.9826\\&amp; &amp;&amp; F^{\ast}=1982.40;&amp;&amp; p=0.0000 \end{alignedat} \end{equation}$$`


---

### Comparison 1: OLS approach with biased estimation

As comparison, we give a **"biased"** estimation with OLS method directly to the money supply equation, and obtain following result:

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{Y2}=&amp;&amp;-2430.34&amp;&amp;+0.79Y1\\ &amp;\text{(t)}&amp;&amp;(-19.1042)&amp;&amp;(44.5059)\\&amp;\text{(se)}&amp;&amp;(127.2148)&amp;&amp;(0.0178)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.9831;&amp;&amp; \bar{R^2}=0.9826\\&amp; &amp;&amp; F^{\ast}=1980.77;&amp;&amp; p=0.0000 \end{alignedat} \end{equation}$$`

???
作为对比，我们给出一个**"有偏误"**的估计方法，也即直接对数量$Y2$对$Y1$采用OLS方法，将得到如下结果：



---

### Comparison 1: OLS approach with biased estimation

The R raw report for the biased regression show as:


```

Call:
lm(formula = models_money$mod.ols, data = us_money_new)

Residuals:
   Min     1Q Median     3Q    Max 
-418.3 -151.6   40.2  143.5  380.8 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -2.43e+03   1.27e+02   -19.1   &lt;2e-16 ***
Y1           7.90e-01   1.78e-02    44.5   &lt;2e-16 ***
---
Signif. codes:  
0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 229 on 34 degrees of freedom
Multiple R-squared:  0.983,	Adjusted R-squared:  0.983 
F-statistic: 1.98e+03 on 1 and 34 DF,  p-value: &lt;2e-16
```

---

## Modeling scenario 2

both income equation and money supply equation are over-identifiable


---

### Improved structural SEM and identification problems

Different from the former structural SEM, we can construct the improved one:

`$$\begin{cases}
  \begin{alignat}{6}
  Y_{t1} = \beta_{01} &amp; &amp;+ \gamma_{12}Y_{t2} &amp; &amp; + \beta_{11}X_{t1} &amp; + \beta_{21}X_{t2} &amp; &amp; &amp; +u_{t1} &amp; \text{   (income eq)} \\
  Y_{t2} = \beta_{02} &amp; + \gamma_{12}Y_{1t} &amp; &amp;  &amp;  &amp; &amp;+ \beta_{12}Y_{1,t-1}  &amp;+ \beta_{22}Y_{2,t-1} &amp; + u_{t2} &amp; \text{   (money supply eq)}
  \end{alignat}
\end{cases}$$`

Next, we judge the identification problem according to **order condition rules 2** :

- The number of predetermineed variables in the structural SEM is 
`\(K=5\)`.
- The first equation: the number of predetermined variables is
`\(k=3\)`, and
`\((K-k)=2\)`. Also the number of endogenous variables is
`\(m=2\)`, and
`\((m-1)=1\)`. We will see 
`\((K-k)&gt;(m-1)\)`. So the first equation is **overidentification**.
- The second equation: the number of predetermined variables is 
`\(k=3\)`, and
`\((K-k)=2\)`; Also the number of endogenous variables is 
`\(m=2\)`, and 
`\((m-1)=1\)`. We will see 
`\((K-k)&gt;(m-1)\)`. Thus it is also **overidentification**.

???

- Conclusion: both the income equation and the money supply equation are **overidentifiable**.

---

### 2SLS approach 2: without error correction



Now, we will use two-stage least squares (2SLS) to get **consistent  estimates** for both **income equation** and **money supply equation**.


**Stage 1**: 

- Estimate the regression of 
`\(Y_1\)` to all **predetermined variables** in the structural SEM (not only in the equation under consideration), and obtain 
`\(\hat{Y}_{t1} ;\hat{v}^{\ast}_{t1}\)`. 

- .red[Meanwhile], estimate the regression of 
`\(Y_2\)` to all **predetermined variables** in the structural SEM (not only in the equation under consideration), and obtain 
`\(\hat{Y}_{t2} ;\hat{v}^{\ast}_{t2}\)`：

`$$\begin{align}
Y_{t1} &amp;= \widehat{\pi}_{01} + \widehat{\pi}_{11} X_{t1} +  \widehat{\pi}_{21} X_{t2} +  \widehat{\pi}_{31} Y_{t-1,1} +  \widehat{\pi}_{41} Y_{t-1,2}+ \hat{v}_{t1} \\
       &amp;= \hat{Y}_{1t} +\hat{v}_{t1} \\
Y_{t2} &amp;= \widehat{\pi}_{02} + \widehat{\pi}_{12} X_{t1} +  \widehat{\pi}_{22} X_{t2} +  \widehat{\pi}_{32} Y_{t-1,1} +  \widehat{\pi}_{42} Y_{t-1,2}+ \hat{v}_{t2} \\
       &amp;= \hat{Y}_{t2} +\hat{v}_{t2} 
\end{align}$$`

---

### 2SLS approach 2: without error correction

- OLS regression results of **new income equation** at **stage 1**:

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{Y1}=&amp;&amp;+1098.90&amp;&amp;+0.98X1&amp;&amp;+0.77X2&amp;&amp;+0.59Y1.l1&amp;&amp;-0.01Y2.l1\\ &amp;\text{(t)}&amp;&amp;(5.9222)&amp;&amp;(7.4954)&amp;&amp;(4.1895)&amp;&amp;(8.8729)&amp;&amp;(-0.1024)\\&amp;\text{(se)}&amp;&amp;(185.5566)&amp;&amp;(0.1308)&amp;&amp;(0.1831)&amp;&amp;(0.0667)&amp;&amp;(0.0721)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.9990;&amp;&amp; \bar{R^2}=0.9989\\&amp; &amp;&amp; F^{\ast}=7857.58;&amp;&amp; p=0.0000 \end{alignedat} \end{equation}$$`

---

### 2SLS approach 2: without error correction

- OLS regression results of **new money supply equation** at **stage 1**:

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{Y2}=&amp;&amp;-207.14&amp;&amp;+0.20X1&amp;&amp;-0.35X2&amp;&amp;+0.06Y1.l1&amp;&amp;+1.06Y2.l1\\ &amp;\text{(t)}&amp;&amp;(-1.1202)&amp;&amp;(1.5298)&amp;&amp;(-1.9455)&amp;&amp;(0.9352)&amp;&amp;(14.7779)\\&amp;\text{(se)}&amp;&amp;(184.9121)&amp;&amp;(0.1303)&amp;&amp;(0.1824)&amp;&amp;(0.0665)&amp;&amp;(0.0718)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.9985;&amp;&amp; \bar{R^2}=0.9983\\&amp; &amp;&amp; F^{\ast}=5050.57;&amp;&amp; p=0.0000 \end{alignedat} \end{equation}$$`

---

### 2SLS approach 2: without error correction

Hence, we can obtain new variables from the two former regressions results respectively:
`\(\hat{Y}_{t1} ;\hat{v}_{t1}\)`, and
`\(\hat{Y}_{t2} ;\hat{v}_{t2}\)`.

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-983125fb79801a3ae5c2" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-983125fb79801a3ae5c2">{"x":{"filter":"none","vertical":false,"caption":"<caption>New variables from regression of stage 1<\/caption>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36"],[3771.9,3898.6,4105,4341.5,4319.6,4311.2,4540.9,4750.5,5015,5173.4,5161.7,5291.7,5189.3,5423.8,5813.6,6053.7,6263.6,6475.1,6742.7,6981.4,7112.5,7100.5,7336.6,7532.7,7835.5,8031.7,8328.9,8703.5,9066.9,9470.3,9817,9890.7,10048.8,10301,10703.5,11048.6],[null,3771.9,3898.6,4105,4341.5,4319.6,4311.2,4540.9,4750.5,5015,5173.4,5161.7,5291.7,5189.3,5423.8,5813.6,6053.7,6263.6,6475.1,6742.7,6981.4,7112.5,7100.5,7336.6,7532.7,7835.5,8031.7,8328.9,8703.5,9066.9,9470.3,9817,9890.7,10048.8,10301,10703.5],[null,3963.16221869858,4111.57768515084,4307.47247766228,4428.44578929569,4360.13019724065,4465.65151104022,4706.82054171374,4936.77948285524,5151.10621835138,5233.64066667267,5350.92313637302,5387.95457278017,5432.85464188149,5808.79666392269,6084.98378291147,6264.45271747674,6439.90312423001,6623.71519014263,6873.35406319449,7048.98138643086,7101.44509267014,7258.46679484753,7515.05137834654,7787.96482502016,8054.90588062043,8316.14347279548,8674.28762062313,9048.1848874992,9417.41369997324,9804.35062660564,9953.83037210483,10054.1619236847,10315.9539535962,10717.9655811806,11180.1678224072],[null,-64.5622186985847,-6.57768515083779,34.0275223377157,-108.845789295686,-48.9301972406478,75.2484889597812,43.6794582862606,78.2205171447622,22.2937816486204,-71.9406666726673,-59.2231363730194,-198.654572780171,-9.05464188148986,4.80333607731182,-31.283782911466,-0.85271747673761,35.1968757699915,118.984809857367,108.045936805509,63.5186135691421,-0.945092670141772,78.133205152469,17.6486216534632,47.5351749798449,-23.2058806204262,12.7565272045159,29.2123793768659,18.7151125008005,52.8863000267624,12.6493733943621,-63.1303721048319,-5.36192368471812,-14.9539535962474,-14.465581180628,-131.567822407243],[626.5,710.3,802.3,855.5,902.1,1016.2,1152,1270.3,1366,1473.7,1599.8,1755.4,1910.3,2126.5,2310,2495.7,2732.4,2831.4,2994.5,3158.5,3278.6,3379.1,3432.5,3484,3497.5,3640.4,3815.1,4031.6,4379,4641.1,4920.9,5430.3,5774.1,6062,6411.7,6669.4],[null,626.5,710.3,802.3,855.5,902.1,1016.2,1152,1270.3,1366,1473.7,1599.8,1755.4,1910.3,2126.5,2310,2495.7,2732.4,2831.4,2994.5,3158.5,3278.6,3379.1,3432.5,3484,3497.5,3640.4,3815.1,4031.6,4379,4641.1,4920.9,5430.3,5774.1,6062,6411.7],[null,709.457616666095,808.900075055048,925.702961862726,976.954305239303,986.8583813217,1115.77254277551,1278.87469212458,1417.50934887674,1523.18268842586,1600.19772622861,1714.36502045826,1841.04472126788,1986.66384756197,2247.82434948008,2440.07917012719,2630.51598424703,2887.46242677249,2991.6861628997,3162.07830524493,3314.33588042833,3413.64979201753,3486.93431582749,3555.88808187473,3635.77808162732,3650.82230965648,3812.64025282157,4031.90549670109,4303.0468398627,4699.43221839384,4994.08078620441,5248.09808963875,5738.60827762642,6071.05390603444,6377.36949878321,6731.42584586597],[null,0.84238333390528,-6.6000750550477,-70.202961862726,-74.854305239303,29.3416186783003,36.2274572244865,-8.57469212458065,-51.5093488767377,-49.4826884258629,-0.39772622861023,41.0349795417435,69.2552787321182,139.836152438026,62.1756505199233,55.6208298728086,101.88401575297,-56.0624267724932,2.8138371002993,-3.57830524492592,-35.735880428334,-34.5497920175316,-54.4343158274884,-71.8880818747347,-138.27808162732,-10.4223096564801,2.45974717842692,-0.305496701088675,75.9531601373015,-58.3322183938402,-73.1807862044147,182.201910361249,35.4917223735841,-9.05390603444351,34.3305012167902,-62.0258458659686]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Y1<\/th>\n      <th>Y1.l1<\/th>\n      <th>Y1.hat<\/th>\n      <th>v1.hat<\/th>\n      <th>Y2<\/th>\n      <th>Y2.l1<\/th>\n      <th>Y2.hat<\/th>\n      <th>v2.hat<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"tip","columnDefs":[{"targets":4,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 4, 3, \",\", \".\", null);\n  }"},{"targets":8,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 4, 3, \",\", \".\", null);\n  }"},{"targets":1,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 1, 3, \",\", \".\", null);\n  }"},{"targets":2,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 1, 3, \",\", \".\", null);\n  }"},{"targets":3,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 1, 3, \",\", \".\", null);\n  }"},{"targets":5,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 1, 3, \",\", \".\", null);\n  }"},{"targets":6,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 1, 3, \",\", \".\", null);\n  }"},{"targets":7,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 1, 3, \",\", \".\", null);\n  }"},{"className":"dt-center","targets":"_all"},{"visible":false,"targets":0},{"orderable":false,"targets":0}],"pageLength":6,"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[6,10,25,50,100]}},"evals":["options.columnDefs.0.render","options.columnDefs.1.render","options.columnDefs.2.render","options.columnDefs.3.render","options.columnDefs.4.render","options.columnDefs.5.render","options.columnDefs.6.render","options.columnDefs.7.render"],"jsHooks":[]}</script>

---

### 2SLS approach 2: without error correction

**Stage 2:** 

- The re-transformed new income equation and the money supply equation are:

`$$\begin{align}
Y_{t1} &amp;= \beta_{01}  + \gamma_{21} \hat{Y}_{t2}  + \beta_{11}X_{t1}  + \beta_{21}X_{t2} +u^{\ast}_{t1}  \\
Y_{t2} &amp;= \beta_{20}  + \gamma_{12} \hat{Y}_{1t} + \beta_{12}Y_{t-1,1}  + \beta_{22}Y_{t-1,2}  + u^{\ast}_{t2} 
\end{align}$$`

- And then, we can conduct these new equations by using the former variables frome stage 1.

---

### 2SLS approach 2: without error correction

- OLS estimation results of **new** income equation in **stage 2**:

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{Y1}=&amp;&amp;+2723.68&amp;&amp;+0.22Y2.hat&amp;&amp;+1.71X1&amp;&amp;+1.57X2\\ &amp;\text{(t)}&amp;&amp;(40.3310)&amp;&amp;(1.8961)&amp;&amp;(9.2748)&amp;&amp;(5.9811)\\&amp;\text{(se)}&amp;&amp;(67.5331)&amp;&amp;(0.1156)&amp;&amp;(0.1848)&amp;&amp;(0.2623)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.9966;&amp;&amp; \bar{R^2}=0.9963\\&amp; &amp;&amp; F^{\ast}=3073.97;&amp;&amp; p=0.0000 \end{alignedat} \end{equation}$$`

---

### 2SLS approach 2: without error correction

- OLS estimation results of the **new** money supply equation in **stage 2**:

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{Y2}=&amp;&amp;-228.13&amp;&amp;+0.11Y1.hat&amp;&amp;-0.03Y1.l1&amp;&amp;+0.93Y2.l1\\ &amp;\text{(t)}&amp;&amp;(-1.4843)&amp;&amp;(0.7685)&amp;&amp;(-0.1691)&amp;&amp;(15.0961)\\&amp;\text{(se)}&amp;&amp;(153.6925)&amp;&amp;(0.1431)&amp;&amp;(0.1481)&amp;&amp;(0.0618)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.9981;&amp;&amp; \bar{R^2}=0.9979\\&amp; &amp;&amp; F^{\ast}=5461.60;&amp;&amp; p=0.0000 \end{alignedat} \end{equation}$$`

---

### 2SLS approach 2: without error correction

- The R raw report of OLS estimation for the  new income equation in **stage 2**:

.scroll-box-18[


```

Call:
lm(formula = models_money2$mod2.stage2.1, data = us_money_new2)

Residuals:
   Min     1Q Median     3Q    Max 
-360.4  -66.8   35.7   81.2  186.2 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 2723.681     67.533   40.33  &lt; 2e-16 ***
Y2.hat         0.219      0.116    1.90    0.067 .  
X1             1.714      0.185    9.27  1.9e-10 ***
X2             1.569      0.262    5.98  1.3e-06 ***
---
Signif. codes:  
0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 130 on 31 degrees of freedom
  (因为不存在，1个观察量被删除了)
Multiple R-squared:  0.997,	Adjusted R-squared:  0.996 
F-statistic: 3.07e+03 on 3 and 31 DF,  p-value: &lt;2e-16
```

]

---

### 2SLS approach 2: without error correction

- The R raw report of OLS estimation for the  new money supply equation in **stage 2**:

.scroll-box-18[


```

Call:
lm(formula = models_money2$mod2.stage2.2, data = us_money_new2)

Residuals:
    Min      1Q  Median      3Q     Max 
-192.58  -42.96    7.05   42.93  218.68 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -228.1320   153.6925   -1.48     0.15    
Y1.hat         0.1100     0.1431    0.77     0.45    
Y1.l1         -0.0250     0.1481   -0.17     0.87    
Y2.l1          0.9330     0.0618   15.10  7.8e-16 ***
---
Signif. codes:  
0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 78 on 31 degrees of freedom
  (因为不存在，1个观察量被删除了)
Multiple R-squared:  0.998,	Adjusted R-squared:  0.998 
F-statistic: 5.46e+03 on 3 and 31 DF,  p-value: &lt;2e-16
```

]

---

### 2SLS approach 2: with error correction

By using R `systemfit` package, we can apply the two-stage least square method with **"error correction"**, and the report summarized as follows:




<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-ab91bfa334aa697ff2ef" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-ab91bfa334aa697ff2ef">{"x":{"filter":"none","vertical":false,"caption":"<caption>Result of 2SLS with error correction<\/caption>","data":[["1","2","3","4","5","6","7","8"],["eq1","eq1","eq1","eq1","eq2","eq2","eq2","eq2"],["(Intercept)","Y2","X1","X2","(Intercept)","Y1","Y1.l1","Y2.l1"],[2723.68094389355,0.219243322396451,1.71421562765313,1.56903879525853,-228.132038697227,0.109968179861762,-0.0250416176584451,0.932956220564694],[69.1017290433198,0.118316604725378,0.189118852526913,0.268426771265983,157.94546242023,0.147050396020319,0.152227171258453,0.0635111321118053],[39.4155252205929,1.85302242999054,9.06422392452482,5.84531411624282,-1.4443722231808,0.747826478798241,-0.164501629054968,14.6896487205158],[0,0.0734196596058307,3.17168957764125e-10,1.90684580059219e-06,0.15866639996072,0.460200592912428,0.870404215458877,1.77635683940025e-15]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>eq<\/th>\n      <th>vars<\/th>\n      <th>Estimate<\/th>\n      <th>Std. Error<\/th>\n      <th>t value<\/th>\n      <th>Pr(&gt;|t|)<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","columnDefs":[{"targets":3,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"targets":4,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 4, 3, \",\", \".\", null);\n  }"},{"targets":5,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 4, 3, \",\", \".\", null);\n  }"},{"targets":6,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 4, 3, \",\", \".\", null);\n  }"},{"className":"dt-center","targets":"_all"},{"visible":false,"targets":0},{"orderable":false,"targets":0}],"pageLength":10,"order":[],"autoWidth":false,"orderClasses":false}},"evals":["options.columnDefs.0.render","options.columnDefs.1.render","options.columnDefs.2.render","options.columnDefs.3.render"],"jsHooks":[]}</script>



---

### 2SLS approach 2: with error correction

By using R `systemfit` package, we can apply the two-stage least square method with **"error correction"**, and the detail report show as follows:

.scroll-box-16[


```

systemfit results 
method: 2SLS 

        N DF    SSR  detRCov OLS-R2 McElroy-R2
system 70 62 749260 1.07e+08  0.997      0.998

     N DF    SSR   MSE  RMSE    R2 Adj R2
eq1 35 31 549669 17731 133.2 0.996  0.996
eq2 35 31 199592  6438  80.2 0.998  0.998

The covariance matrix of the residuals
      eq1   eq2
eq1 17731 -2604
eq2 -2604  6438

The correlations of the residuals
       eq1    eq2
eq1  1.000 -0.244
eq2 -0.244  1.000


2SLS estimates for 'eq1' (equation 1)
Model Formula: Y1 ~ Y2 + X1 + X2
Instruments: ~X1 + X2 + Y1.l1 + Y2.l1

            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 2723.681     69.102   39.42  &lt; 2e-16 ***
Y2             0.219      0.118    1.85    0.073 .  
X1             1.714      0.189    9.06  3.2e-10 ***
X2             1.569      0.268    5.85  1.9e-06 ***
---
Signif. codes:  
0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 133.159 on 31 degrees of freedom
Number of observations: 35 Degrees of Freedom: 31 
SSR: 549668.549 MSE: 17731.244 Root MSE: 133.159 
Multiple R-Squared: 0.996 Adjusted R-Squared: 0.996 


2SLS estimates for 'eq2' (equation 2)
Model Formula: Y2 ~ Y1 + Y1.l1 + Y2.l1
Instruments: ~X1 + X2 + Y1.l1 + Y2.l1

             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -228.1320   157.9455   -1.44     0.16    
Y1             0.1100     0.1471    0.75     0.46    
Y1.l1         -0.0250     0.1522   -0.16     0.87    
Y2.l1          0.9330     0.0635   14.69  1.8e-15 ***
---
Signif. codes:  
0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 80.24 on 31 degrees of freedom
Number of observations: 35 Degrees of Freedom: 31 
SSR: 199591.775 MSE: 6438.444 Root MSE: 80.24 
Multiple R-Squared: 0.998 Adjusted R-Squared: 0.998 
```

]


---

### Comparison 2: OLS approach with biased estimation

- **"biased"** OLS estimation results of the income equation:

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{Y1}=&amp;&amp;+2706.39&amp;&amp;+0.17Y2&amp;&amp;+1.75X1&amp;&amp;+1.68X2\\ &amp;\text{(t)}&amp;&amp;(40.0265)&amp;&amp;(1.5062)&amp;&amp;(9.3862)&amp;&amp;(6.6008)\\&amp;\text{(se)}&amp;&amp;(67.6150)&amp;&amp;(0.1115)&amp;&amp;(0.1864)&amp;&amp;(0.2552)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.9966;&amp;&amp; \bar{R^2}=0.9963\\&amp; &amp;&amp; F^{\ast}=3139.86;&amp;&amp; p=0.0000 \end{alignedat} \end{equation}$$`

- **"biased"** OLS estimates of the money supply equation:

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{Y2}=&amp;&amp;-206.53&amp;&amp;-0.02Y1&amp;&amp;+0.10Y1.l1&amp;&amp;+0.94Y2.l1\\ &amp;\text{(t)}&amp;&amp;(-1.3373)&amp;&amp;(-0.1377)&amp;&amp;(0.7870)&amp;&amp;(15.1363)\\&amp;\text{(se)}&amp;&amp;(154.4428)&amp;&amp;(0.1178)&amp;&amp;(0.1252)&amp;&amp;(0.0622)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.9981;&amp;&amp; \bar{R^2}=0.9979\\&amp; &amp;&amp; F^{\ast}=5362.58;&amp;&amp; p=0.0000 \end{alignedat} \end{equation}$$`

---
layout: false
class: center, middle, duke-softblue,hide_logo
name: truffle

## 20.5 Truffle supply and demand

---
layout: true
  
&lt;div class="my-header-h2"&gt;&lt;/div&gt;
&lt;div class="watermark1"&gt;&lt;/div&gt;
&lt;div class="watermark2"&gt;&lt;/div&gt;
&lt;div class="watermark3"&gt;&lt;/div&gt;

&lt;div class="my-footer"&gt;&lt;span&gt;huhuaping@   &lt;a href="#chpt20"&gt; Chapter 20. How to Estimate SEM ? &lt;/a&gt; &amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp; 
&lt;a href="#truffle"&gt; 20.5 Truffle supply and demand &lt;/a&gt; &lt;/span&gt;&lt;/div&gt; 


---

### Case of Truffle supply and demand

.pull-left[

&lt;img src="../pic/Truffle-pig.jpg" width="367" style="display: block; margin: auto;" /&gt;

&lt;img src="../pic/Truffle-pig2.jpg" width="367" style="display: block; margin: auto;" /&gt;
]

.pull-right[
&lt;img src="../pic/Truffle-pig4.jpg" width="342" style="display: block; margin: auto;" /&gt;
]

---

### Variables description



<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-0744a331589ddd547d75" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-0744a331589ddd547d75">{"x":{"filter":"none","vertical":false,"caption":"<caption>variables description<\/caption>","data":[["1","2","3","4","5"],["P","Q","PS","DI","PF"],["market price of trufﬂes","market quantity of trufﬂes","market price of substitute","disposable income","rental price of trufﬂe-pigs"],["dollar/ounce","ounce","dollar/ounce","dollar/person, monthly","dollar/hour"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>vars<\/th>\n      <th>label<\/th>\n      <th>measure<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","columnDefs":[{"className":"dt-center","targets":"_all"},{"visible":false,"targets":0},{"orderable":false,"targets":0}],"pageLength":6,"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[6,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>

???

case source: Hill, R. C., W. E. Griffiths and G. C. Lim. Principles of Econometrics 4th Edition  [M], Wiley, 2011. chpt 11

refferenc: [PoE with R](https://bookdown.org/ccolonescu/RPoE4/simultaneous-equations-models.html)


---

### Data set

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-53c020ffc702a7b5d83c" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-53c020ffc702a7b5d83c">{"x":{"filter":"none","vertical":false,"caption":"<caption>Case data set (n=30)<\/caption>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30"],[29.64,40.23,34.71,41.43,53.37,38.52,54.33,40.56,67.35,49.65,58.17,66.87,49.95,64.95,52.68,61.2,80.55,89.94,70.77,57.33,46.23,77.43,83.01,70.71,66.75,76.8,83.7,81,88.44,105.45],[19.89,13.04,19.61,17.13,22.55,6.37,15.02,10.22,23.64,16.12,24.55,18.92,11.94,18.93,12.6,20.49,22.94,21.08,16.68,17.61,16.62,20.99,24.53,19.67,23.29,16.64,20.81,14.95,26.27,20.65],[19.97,18.04,22.36,20.87,19.79,15.98,17.94,17.09,22.72,15.74,24.64,23.7,15.93,23.34,15.21,26.04,22.95,27.1,23.65,20.06,26.38,24.28,26.64,22.65,19.68,23.82,28.98,18.52,28.16,28.43],[2.103,2.043,1.87,1.525,2.709,2.489,2.294,2.196,3.885,3.169,2.623,3.007,3.367,3.29,3.746,3.518,4.381,4.121,3.82,4.398,3.764,4.524,4.815,3.67,4.392,4.603,4.632,4.894,5.125,4.836],[10.52,19.67,13.74,17.95,13.71,24.95,24.17,23.61,19.52,20.03,15.38,22.98,25.76,25.17,25.82,19.31,26.02,29.65,27.45,18,18.87,24.58,25.25,24.24,22.63,27.35,27.8,30.34,24.12,34.01]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>P<\/th>\n      <th>Q<\/th>\n      <th>PS<\/th>\n      <th>DI<\/th>\n      <th>PF<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"tip","columnDefs":[{"className":"dt-center","targets":"_all"},{"visible":false,"targets":0},{"orderable":false,"targets":0}],"pageLength":8,"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[8,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>

---

### Scatter

The scatter plot on truffle quantity Q and truffle market price P is given below:

&lt;img src="SEM-slide-eng-part3-estimation_files/figure-html/unnamed-chunk-8-1.png" style="display: block; margin: auto;" /&gt;

---

### The structural SEM

Given the structural SEM:

`$$\begin{cases}
  \begin{align}
  Q_i &amp;= \alpha_0+\alpha_1P_i+\alpha_2PS_i+\alpha_3DI_i+u_{i1}  &amp;&amp;\text{(demand function)}\\
  Q_i &amp;= \beta_0+\beta_1P_i+\beta_2PF_i+u_{i2}    &amp;&amp;\text{(supply function)}
  \end{align}
\end{cases}$$`

---
class: page-font-20

### The reduced SEM

We can get the reduced SEM:

`$$\begin{cases}
  \begin{align}
  P_i &amp;= \pi_{01}+ \pi_{11}PS_i+\pi_{21}DI_i+\pi_{31}PF_i+v_{t1}\\
  Q_i &amp;= \pi_{02}+\pi_{12}PS_t+\pi_{22}DI_i+\pi_{32}PF_i+v_{t2}
  \end{align}
\end{cases}$$`

Also we obtain the relationship between structural and reduced coefficients:

.smaller[

.pull-left[

`$$\begin{cases}
  \begin{align}
  &amp; \pi_{01} = \frac{\beta_0-\alpha_0}{\alpha_1-\beta_1}  \\
  &amp; \pi_{11} = - \frac{\alpha_2}{\alpha_1-\beta_1}  \\
  &amp; \pi_{21} = - \frac{\alpha_3}{\alpha_1-\beta_1}  \\
  &amp; \pi_{31} = \frac{\beta_2}{\alpha_1-\beta_1}  \\
  &amp; v_{t1} = \frac{u_{2t}-u_{1t}}{\alpha_1-\beta_1} &amp;&amp;
  \end{align}
\end{cases}$$`

]

.pull-right[

`$$\begin{cases}
  \begin{align}
  &amp; \pi_{02} = - \frac{\alpha_1\beta_0-\alpha_0\beta_1}{\alpha_1-\beta_1} \\
  &amp; \pi_{12} = - \frac{\alpha_2\beta_1}{\alpha_1-\beta_1}  \\
  &amp; \pi_{22} = - \frac{\alpha_3\beta_1}{\alpha_1-\beta_1}  \\
  &amp; \pi_{32} =   \frac{\alpha_1\beta_2}{\alpha_1-\beta_1}  \\
  &amp; v_{t2} = \frac{\alpha_1u_{2t}-\beta_1u_{1t}}{\alpha_1-\beta_1} 
  \end{align}
\end{cases}$$`
]

]

---
exclude: true

### Rscript: simple OLS estimate









---
### Simple OLS solution: results

We can  apply OLS method directly. Of course estimation results will be biased.

- tidy results of **bias** OLS estimation  for the demand equation:

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{Q}=&amp;&amp;+1.09&amp;&amp;+0.02P&amp;&amp;+0.71PS&amp;&amp;+0.08DI\\ &amp;\text{(t)}&amp;&amp;(0.2940)&amp;&amp;(0.3032)&amp;&amp;(3.3129)&amp;&amp;(0.0642)\\&amp;\text{(se)}&amp;&amp;(3.7116)&amp;&amp;(0.0768)&amp;&amp;(0.2143)&amp;&amp;(1.1909)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.4957;&amp;&amp; \bar{R^2}=0.4375\\&amp; &amp;&amp; F^{\ast}=8.52;&amp;&amp; p=0.0004 \end{alignedat} \end{equation}$$`

- tidy results of **bias** OLS estimation for the supply equation:

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{Q}=&amp;&amp;+20.03&amp;&amp;+0.34P&amp;&amp;-1.00PF\\ &amp;\text{(t)}&amp;&amp;(16.3938)&amp;&amp;(15.5436)&amp;&amp;(-13.1028)\\&amp;\text{(se)}&amp;&amp;(1.2220)&amp;&amp;(0.0217)&amp;&amp;(0.0764)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.9019;&amp;&amp; \bar{R^2}=0.8946\\&amp; &amp;&amp; F^{\ast}=124.08;&amp;&amp; p=0.0000 \end{alignedat} \end{equation}$$`


---
### Simple OLS solution: R code (`lm`)


```r
# set equation systems
eq.D &lt;- Q~P+PS+DI
eq.S &lt;- Q~P+PF

# fit using direct `OLS` method
ols.D &lt;- lm(formula = eq.D, data = truffles)
ols.S &lt;- lm(formula = eq.S, data = truffles)
# report
smry.olsD &lt;- summary(ols.D)
smry.olsS &lt;- summary(ols.S)
```


---
### Simple OLS solution: R report (`lm`)



.pull-left[

.scroll-box-18[


```

Call:
lm(formula = eq.D, data = truffles)

Residuals:
   Min     1Q Median     3Q    Max 
-7.155 -1.936 -0.374  2.396  6.335 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)   
(Intercept)   1.0910     3.7116    0.29   0.7711   
P             0.0233     0.0768    0.30   0.7642   
PS            0.7100     0.2143    3.31   0.0027 **
DI            0.0764     1.1909    0.06   0.9493   
---
Signif. codes:  
0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 3.5 on 26 degrees of freedom
Multiple R-squared:  0.496,	Adjusted R-squared:  0.438 
F-statistic: 8.52 on 3 and 26 DF,  p-value: 0.000416
```

]

]




.pull-right[

.scroll-box-18[


```

Call:
lm(formula = eq.S, data = truffles)

Residuals:
   Min     1Q Median     3Q    Max 
-3.783 -0.853  0.227  0.758  3.347 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  20.0328     1.2220    16.4  1.5e-15 ***
P             0.3380     0.0217    15.5  5.4e-15 ***
PF           -1.0009     0.0764   -13.1  3.2e-13 ***
---
Signif. codes:  
0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.5 on 27 degrees of freedom
Multiple R-squared:  0.902,	Adjusted R-squared:  0.895 
F-statistic:  124 on 2 and 27 DF,  p-value: 2.45e-14
```

]

]

---
### Simple OLS solution: R code (`symtemfit`)



---
### Simple OLS solution: R report (`symtemfit`)

.scroll-box-18[


```

systemfit results 
method: OLS 

        N DF SSR detRCov OLS-R2 McElroy-R2
system 60 53 372    23.6  0.699      0.809

     N DF   SSR   MSE RMSE    R2 Adj R2
eq1 30 26 311.2 11.97 3.46 0.496  0.438
eq2 30 27  60.6  2.24 1.50 0.902  0.895

The covariance matrix of the residuals
      eq1  eq2
eq1 11.97 1.81
eq2  1.81 2.24

The correlations of the residuals
      eq1   eq2
eq1 1.000 0.349
eq2 0.349 1.000


OLS estimates for 'eq1' (equation 1)
Model Formula: Q ~ P + PS + DI

            Estimate Std. Error t value Pr(&gt;|t|)   
(Intercept)   1.0910     3.7116    0.29   0.7711   
P             0.0233     0.0768    0.30   0.7642   
PS            0.7100     0.2143    3.31   0.0027 **
DI            0.0764     1.1909    0.06   0.9493   
---
Signif. codes:  
0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 3.46 on 26 degrees of freedom
Number of observations: 30 Degrees of Freedom: 26 
SSR: 311.21 MSE: 11.97 Root MSE: 3.46 
Multiple R-Squared: 0.496 Adjusted R-Squared: 0.438 


OLS estimates for 'eq2' (equation 2)
Model Formula: Q ~ P + PF

            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  20.0328     1.2220    16.4  1.3e-15 ***
P             0.3380     0.0217    15.5  5.3e-15 ***
PF           -1.0009     0.0764   -13.1  3.2e-13 ***
---
Signif. codes:  
0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.498 on 27 degrees of freedom
Number of observations: 30 Degrees of Freedom: 27 
SSR: 60.555 MSE: 2.243 Root MSE: 1.498 
Multiple R-Squared: 0.902 Adjusted R-Squared: 0.895 
```

]

---
exclude: true

### Rscript: IV 2SLS estimate



---
### IV-2SLS Solution: results




<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-af0a197dee0407bf9649" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-af0a197dee0407bf9649">{"x":{"filter":"none","vertical":false,"caption":"<caption>IV 2SLS result(using `systemfit::systemfit()`<\/caption>","data":[["1","2","3","4","5","6","7"],["eq1","eq1","eq1","eq1","eq2","eq2","eq2"],["(Intercept)","P","PS","DI","(Intercept)","P","PF"],[-4.27947061497233,-0.374459060942076,1.29603324237432,5.01397707849119,20.0328021518429,0.337981567223284,-1.00090937478858],[5.54388441531859,0.164751696005395,0.35519318191257,2.28355585791892,1.22311480030668,0.0249195580539933,0.0825279436522352],[-0.771926377676184,-2.27286923304155,3.64881227560651,2.19568838708443,16.3785134043181,13.5629037437573,-12.1281269167001],[0.447117984640339,0.0315350456407235,0.00116008232650699,0.0372352383660512,1.55431223447522e-15,1.4344081478157e-13,1.94555482835312e-12]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>eq<\/th>\n      <th>vars<\/th>\n      <th>Estimate<\/th>\n      <th>Std. Error<\/th>\n      <th>t value<\/th>\n      <th>Pr(&gt;|t|)<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","columnDefs":[{"targets":3,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 4, 3, \",\", \".\", null);\n  }"},{"targets":4,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 4, 3, \",\", \".\", null);\n  }"},{"targets":5,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 4, 3, \",\", \".\", null);\n  }"},{"targets":6,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 4, 3, \",\", \".\", null);\n  }"},{"className":"dt-center","targets":"_all"},{"visible":false,"targets":0},{"orderable":false,"targets":0}],"pageLength":10,"order":[],"autoWidth":false,"orderClasses":false}},"evals":["options.columnDefs.0.render","options.columnDefs.1.render","options.columnDefs.2.render","options.columnDefs.3.render"],"jsHooks":[]}</script>



---
### IV-2SLS Solution:  R code (`symtemfit`)

.scroll-box-18[


```r
# load pkg
require(systemfit)
# set equation systems
eq.D &lt;- Q~P+PS+DI
eq.S &lt;- Q~P+PF
eq.sys &lt;- list(eq.D, eq.S)
# set instruments
instr &lt;- ~PS+DI+PF
# system fit using `2SLS` method
system.iv &lt;-systemfit(
  formula = eq.sys, inst = instr,
  method="2SLS", 
  data=truffles)
# report
smry.iv &lt;- summary(system.iv)
```

]

---
### IV-2SLS Solution:  R report (`symtemfit`)

.scroll-box-18[


```

systemfit results 
method: 2SLS 

        N DF SSR detRCov OLS-R2 McElroy-R2
system 60 53 692    49.8  0.439      0.807

     N DF   SSR   MSE RMSE     R2 Adj R2
eq1 30 26 631.9 24.30 4.93 -0.024 -0.142
eq2 30 27  60.6  2.24 1.50  0.902  0.895

The covariance matrix of the residuals
      eq1  eq2
eq1 24.30 2.17
eq2  2.17 2.24

The correlations of the residuals
      eq1   eq2
eq1 1.000 0.294
eq2 0.294 1.000


2SLS estimates for 'eq1' (equation 1)
Model Formula: Q ~ P + PS + DI
Instruments: ~PS + DI + PF

            Estimate Std. Error t value Pr(&gt;|t|)   
(Intercept)   -4.279      5.544   -0.77   0.4471   
P             -0.374      0.165   -2.27   0.0315 * 
PS             1.296      0.355    3.65   0.0012 **
DI             5.014      2.284    2.20   0.0372 * 
---
Signif. codes:  
0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 4.93 on 26 degrees of freedom
Number of observations: 30 Degrees of Freedom: 26 
SSR: 631.917 MSE: 24.305 Root MSE: 4.93 
Multiple R-Squared: -0.024 Adjusted R-Squared: -0.142 


2SLS estimates for 'eq2' (equation 2)
Model Formula: Q ~ P + PF
Instruments: ~PS + DI + PF

            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  20.0328     1.2231    16.4  1.6e-15 ***
P             0.3380     0.0249    13.6  1.4e-13 ***
PF           -1.0009     0.0825   -12.1  1.9e-12 ***
---
Signif. codes:  
0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.498 on 27 degrees of freedom
Number of observations: 30 Degrees of Freedom: 27 
SSR: 60.555 MSE: 2.243 Root MSE: 1.498 
Multiple R-Squared: 0.902 Adjusted R-Squared: 0.895 
```

]


---

### IV-2SLS Solution: results of the reduced SEM



The OLS regression results of **reduced price equation**:

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{P}=&amp;&amp;-32.51&amp;&amp;+1.71PS&amp;&amp;+7.60DI&amp;&amp;+1.35PF\\ &amp;\text{(t)}&amp;&amp;(-4.0721)&amp;&amp;(4.8682)&amp;&amp;(4.4089)&amp;&amp;(4.5356)\\&amp;\text{(se)}&amp;&amp;(7.9842)&amp;&amp;(0.3509)&amp;&amp;(1.7243)&amp;&amp;(0.2985)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.8887;&amp;&amp; \bar{R^2}=0.8758\\&amp; &amp;&amp; F^{\ast}=69.19;&amp;&amp; p=0.0000 \end{alignedat} \end{equation}$$`

The OLS regression results of **reduced quantity equation**:

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{Q}=&amp;&amp;+7.90&amp;&amp;+0.66PS&amp;&amp;+2.17DI&amp;&amp;-0.51PF\\ &amp;\text{(t)}&amp;&amp;(2.4342)&amp;&amp;(4.6051)&amp;&amp;(3.0938)&amp;&amp;(-4.1809)\\&amp;\text{(se)}&amp;&amp;(3.2434)&amp;&amp;(0.1425)&amp;&amp;(0.7005)&amp;&amp;(0.1213)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.6974;&amp;&amp; \bar{R^2}=0.6625\\&amp; &amp;&amp; F^{\ast}=19.97;&amp;&amp; p=0.0000 \end{alignedat} \end{equation}$$`



---
class: page-font-20

### Comparison: the biased OLS estimation

We can  apply OLS method directly. Of course estimation results will be biased.

- tidy results of **bias** OLS estimation  for the demand equation:

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{Q}=&amp;&amp;+1.09&amp;&amp;+0.02P&amp;&amp;+0.71PS&amp;&amp;+0.08DI\\ &amp;\text{(t)}&amp;&amp;(0.2940)&amp;&amp;(0.3032)&amp;&amp;(3.3129)&amp;&amp;(0.0642)\\&amp;\text{(se)}&amp;&amp;(3.7116)&amp;&amp;(0.0768)&amp;&amp;(0.2143)&amp;&amp;(1.1909)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.4957;&amp;&amp; \bar{R^2}=0.4375\\&amp; &amp;&amp; F^{\ast}=8.52;&amp;&amp; p=0.0004 \end{alignedat} \end{equation}$$`

- tidy results of **bias** OLS estimation for the supply equation:

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{Q}=&amp;&amp;+20.03&amp;&amp;+0.34P&amp;&amp;-1.00PF\\ &amp;\text{(t)}&amp;&amp;(16.3938)&amp;&amp;(15.5436)&amp;&amp;(-13.1028)\\&amp;\text{(se)}&amp;&amp;(1.2220)&amp;&amp;(0.0217)&amp;&amp;(0.0764)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.9019;&amp;&amp; \bar{R^2}=0.8946\\&amp; &amp;&amp; F^{\ast}=124.08;&amp;&amp; p=0.0000 \end{alignedat} \end{equation}$$`




---
layout: false
class: center, middle, duke-softblue,hide_logo
name: cod

## 20.6 Cod supply and demand

---
layout: true
  
&lt;div class="my-header-h2"&gt;&lt;/div&gt;
&lt;div class="watermark1"&gt;&lt;/div&gt;
&lt;div class="watermark2"&gt;&lt;/div&gt;
&lt;div class="watermark3"&gt;&lt;/div&gt;

&lt;div class="my-footer"&gt;&lt;span&gt;huhuaping@   &lt;a href="#chpt20"&gt; Chapter 20. How to Estimate SEM ? &lt;/a&gt; &amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp; 
&lt;a href="#cod"&gt; 20.6 Cod supply and demand &lt;/a&gt; &lt;/span&gt;&lt;/div&gt; 


---
class: center, inverse

### Cod supply and demand

.pull-left[

&lt;img src="../pic/whiting-fishing.jpg" width="345" style="display: block; margin: auto;" /&gt;

&lt;img src="../pic/whiting-fishing2.jpg" width="345" style="display: block; margin: auto;" /&gt;
]

.pull-right[
&lt;img src="../pic/whiting-fishing4.jpg" width="259" style="display: block; margin: auto;" /&gt;
]

---

### Variables description

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-3520d54288b63ff7d54c" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-3520d54288b63ff7d54c">{"x":{"filter":"none","vertical":false,"caption":"<caption>Variables description of the cod case<\/caption>","data":[["1","2","3","4","5","6","7"],["lprice","lquan","mon","tue","wen","thu","stormy"],["the logarithmic market price of cod","the logarithmic quantity of cod","monday","tuesday","wensday","thursday","Stormy"],["continuous variable","continuous variable","dummy variable 0/1","dummy variable 0/1","dummy variable 0/1","dummy variable 0/1","dummy variable 0/1"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>vars<\/th>\n      <th>label<\/th>\n      <th>note<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"tip","columnDefs":[{"className":"dt-center","targets":"_all"},{"visible":false,"targets":0},{"orderable":false,"targets":0}],"pageLength":8,"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[8,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>

.footer-note[.tiny[
source：Hill, R. C., W. E. Griffiths and G. C. Lim. Principles of Econometrics 4th Edition  [M], Wiley, 2011. chpt 11。reference：[PoE with R](https://bookdown.org/ccolonescu/RPoE4/simultaneous-equations-models.html)
]
]

---

### Sample data set

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-76e5726a07479fee17ef" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-76e5726a07479fee17ef">{"x":{"filter":"none","vertical":false,"caption":"<caption>Data set of cod case(obs. n=111)<\/caption>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111"],["1991-12-02","1991-12-03","1991-12-04","1991-12-05","1991-12-06","1991-12-09","1991-12-10","1991-12-11","1991-12-12","1991-12-13","1991-12-16","1991-12-17","1991-12-18","1991-12-19","1991-12-20","1991-12-23","1991-12-24","1991-12-26","1991-12-27","1991-12-30","1991-12-31","1992-01-02","1992-01-03","1992-01-06","1992-01-07","1992-01-08","1992-01-09","1992-01-10","1992-01-13","1992-01-14","1992-01-15","1992-01-16","1992-01-17","1992-01-20","1992-01-21","1992-01-22","1992-01-23","1992-01-24","1992-01-27","1992-01-28","1992-01-29","1992-01-30","1992-01-31","1992-02-03","1992-02-04","1992-02-05","1992-02-06","1992-02-07","1992-02-10","1992-02-11","1992-02-12","1992-02-13","1992-02-14","1992-02-18","1992-02-19","1992-02-20","1992-02-21","1992-02-24","1992-02-25","1992-02-26","1992-02-27","1992-02-28","1992-03-02","1992-03-03","1992-03-04","1992-03-05","1992-03-06","1992-03-09","1992-03-10","1992-03-11","1992-03-12","1992-03-13","1992-03-16","1992-03-17","1992-03-18","1992-03-19","1992-03-20","1992-03-23","1992-03-24","1992-03-25","1992-03-26","1992-03-27","1992-03-30","1992-03-31","1992-04-01","1992-04-02","1992-04-03","1992-04-06","1992-04-07","1992-04-08","1992-04-09","1992-04-10","1992-04-13","1992-04-14","1992-04-15","1992-04-16","1992-04-17","1992-04-21","1992-04-22","1992-04-23","1992-04-24","1992-04-27","1992-04-28","1992-04-29","1992-04-30","1992-05-01","1992-05-04","1992-05-05","1992-05-06","1992-05-07","1992-05-08"],[-0.4307829,0,0.0723207,0.247139,0.6643268,-0.2065143,-0.1158318,-0.2598674,-0.1171254,-0.3420761,-0.1255632,0.027399,-0.0712275,0.1230601,0.2130932,-0.3172045,-0.1088388,0.2231435,0.2464593,-0.075431,0.2055992,0.2188098,0.307025,0.399592,0.4969802,0.3968258,0.2830518,0.2263384,-0.0723207,-0.1545295,0.2363888,0.1718503,0.1541506,0.0350913,0.218131,-0.0624355,-0.4418328,-0.7699343,-0.7391911,-0.7230001,-0.5184302,-0.5533853,-0.5590724,-0.4238143,-0.7731899,-0.2040953,0.3841877,0.3479887,0.3229889,0.4345259,0.2000211,-0.0071685,-0.4744579,-0.7711087,-1.094774,-0.8602012,-0.597837,-0.567984,-0.7711087,-0.2724146,0.1849223,0.20676,0.074108,-0.0071685,-0.2548923,-0.2364898,-0.4848501,-0.8119307,-0.4780358,-0.2301122,-0.2887938,-0.3409266,-0.4812668,-0.5817336,-0.0370413,0.0746435,-0.5268259,-0.1123292,-0.2376716,-0.4243931,-0.4828126,-0.1923718,0.1823216,0.2876821,-0.1873341,-0.4404448,-0.567984,-0.3873608,-0.5108256,-0.6149098,-0.3876929,-0.3716677,-0.3101549,-0.3502024,-0.2231435,-0.3119048,-0.2258646,-0.2842691,-0.0971638,-0.1419181,-0.5364382,-0.4596867,-0.4866114,-0.7603559,-0.8931236,-1.107745,-0.7985078,-0.0870114,0.1849223,0.2231435,0.5611184],[8058.003,2224.001,4231.001,5749.998,2551.001,10952,7485,9008.996,4055,9992.003,5180.002,5030,7083,9762.996,5999.002,12196,3463.999,814.9999,6626.999,14260.01,4014.999,4109.001,7221.997,11344,3370.001,3470,13607.01,5260,11930,5590,2269.999,4690,1283,579.9999,1500.001,4410.001,9783.996,11140,4288.999,5548.001,3445,6067.998,4525,8249.997,1860.001,1279.999,4855,7939.001,6274.992,2680,5389.999,8399.999,13708,17555,3493.998,5869.997,8390,4339.999,2100.001,2575,2849.999,6189.998,5615,6610,8054.999,10135,5263.001,21619.99,9625,3349.999,10315,3030.001,15460,9589.999,1704.999,5510,7346.999,2585,3745.001,2940,12040,2235.001,2220.001,1112.001,4880.001,11310,14455,7907.001,1464.999,12280,6249.998,5350.002,5755.007,1609.999,490.0003,9774.996,6499.999,10520,3999.999,6230.003,15550.01,5180.002,3509.999,5785.002,8950.003,8219.997,5490,1289.999,1574.999,6400,4140],[8.994421,7.707063,8.350194,8.656955,7.844241,9.301277,8.920656,9.105979,8.307706,9.20954,8.552561,8.523175,8.865453,9.186355,8.699348,9.408863,8.150179,6.703188,8.798907,9.565214,8.297792,8.320935,8.884887,9.336444,8.122668,8.15191,9.51834,8.567886,9.386811,8.628735,7.727535,8.453188,7.156956,6.363028,7.313221,8.39163,9.188503,9.318297,8.363809,8.621193,8.144679,8.710784,8.417373,9.017968,7.528332,7.154615,8.487764,8.979543,8.744328,7.893572,8.5923,9.035987,9.525735,9.773094,8.158802,8.677609,9.034796,8.375629,7.649693,7.853605,7.955074,8.73069,8.633197,8.796339,8.994048,9.22375,8.568457,9.981374,9.172119,8.116715,9.241354,8.016318,9.646011,9.168476,7.44132,8.61432,8.902047,7.857481,8.228177,7.986165,9.395989,7.711997,7.705263,7.013916,8.492901,9.333443,9.578795,8.975504,7.28961,9.415728,8.740336,8.584852,8.657825,7.383989,6.194406,9.187583,8.779557,9.261033,8.294049,8.737132,9.651816,8.552561,8.163371,8.663024,9.099409,9.014325,8.610683,7.162397,7.36201,8.764053,8.328451],[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0],[0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0],[0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0],[0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0],[1,1,0,1,1,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,0,0,0,0,1,1,1,1,0,1,1,1,0,0,0,0,0,0,0,0,0,1,1,0,1,0,0,0,0,0,0,1,1,0,0,0,0,1,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>date<\/th>\n      <th>lprice<\/th>\n      <th>quan<\/th>\n      <th>lquan<\/th>\n      <th>mon<\/th>\n      <th>tue<\/th>\n      <th>wed<\/th>\n      <th>thu<\/th>\n      <th>stormy<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"tip","columnDefs":[{"targets":3,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 0, 3, \",\", \".\", null);\n  }"},{"targets":2,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"targets":4,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"className":"dt-center","targets":"_all"},{"visible":false,"targets":0},{"orderable":false,"targets":0}],"pageLength":7,"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[7,10,25,50,100]}},"evals":["options.columnDefs.0.render","options.columnDefs.1.render","options.columnDefs.2.render"],"jsHooks":[]}</script>

---

### Scatter

&lt;img src="SEM-slide-eng-part3-estimation_files/figure-html/unnamed-chunk-25-1.png" style="display: block; margin: auto;" /&gt;

---

### The structural and reduced SEM

Given the structural SEM:

`$$\begin{cases}
  \begin{align}
  lquan_t &amp;= \alpha_0+\alpha_1lprice_t+\alpha_2mon_t+\alpha_3tue_t+\alpha_4wen_t+\alpha_5thu_t+u_{1t}  &amp;&amp;\text{(demand eq)}\\
  lquan_t &amp;= \beta_0+\beta_1lprice_t+\beta_3stormy_t+u_{2t}    &amp;&amp;\text{(supply eq)}
  \end{align}
\end{cases}$$`

We can obtain the reduced SEM:

`$$\begin{cases}
  \begin{align}
  lquan_t &amp;= \pi_0 + \pi_1mon_t+\pi_2tue_t+\pi_3wen_t+\pi_4thu_t
          +\pi_5stormy_t+v_t &amp;&amp;\text{(reduced eq1)}\\
  lprice_t &amp;= \pi_0 + \pi_1mon_t+\pi_2tue_t+\pi_3wen_t+\pi_4thu_t
          +\pi_5stormy_t+v_t &amp;&amp;\text{(reduced eq2)}\\
  \end{align}
\end{cases}$$`

???
display

---

### OLS regression results of the reduced SEM



The regression results of reduced **quantity** equation show as follows:

`$$\begin{alignedat}{999}
&amp;\widehat{lquan}=&amp;&amp;+8.81&amp;&amp;+0.10mon&amp;&amp;-0.48tue&amp;&amp;-0.55wed&amp;&amp;+0.05thu&amp;&amp;-0.39stormy\\
&amp;\text{(t)}&amp;&amp;(59.9225)&amp;&amp;(0.4891)&amp;&amp;(-2.4097)&amp;&amp;(-2.6875)&amp;&amp;(0.2671)&amp;&amp;(-2.6979)\\
&amp;\text{(se)}&amp;&amp;(0.1470)&amp;&amp;(0.2065)&amp;&amp;(0.2011)&amp;&amp;(0.2058)&amp;&amp;(0.2010)&amp;&amp;(0.1437)\\
&amp;\text{(fitness)}&amp;&amp; n=111;&amp;&amp; R^2=0.1934;&amp;&amp; \bar{R^2}=0.1550\\
&amp; &amp;&amp; F^{\ast}=5.03;&amp;&amp; p=0.0004\\
\end{alignedat}$$`

The regression results of reduced **price** equation show as follows:

`$$\begin{alignedat}{999}
&amp;\widehat{lprice}=&amp;&amp;-0.27&amp;&amp;-0.11mon&amp;&amp;-0.04tue&amp;&amp;-0.01wed&amp;&amp;+0.05thu&amp;&amp;+0.35stormy\\
&amp;\text{(t)}&amp;&amp;(-3.5569)&amp;&amp;(-1.0525)&amp;&amp;(-0.3937)&amp;&amp;(-0.1106)&amp;&amp;(0.4753)&amp;&amp;(4.6387)\\
&amp;\text{(se)}&amp;&amp;(0.0764)&amp;&amp;(0.1073)&amp;&amp;(0.1045)&amp;&amp;(0.1069)&amp;&amp;(0.1045)&amp;&amp;(0.0747)\\
&amp;\text{(fitness)}&amp;&amp; n=111;&amp;&amp; R^2=0.1789;&amp;&amp; \bar{R^2}=0.1398\\
&amp; &amp;&amp; F^{\ast}=4.58;&amp;&amp; p=0.0008
\end{alignedat}$$`

???
why

---

### Two-stage least squares (2SLS) regression results

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-5b21f2fe1fc1dbfe3f79" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-5b21f2fe1fc1dbfe3f79">{"x":{"filter":"none","vertical":false,"caption":"<caption>Results of 2SLS with error corrrection<\/caption>","data":[["1","2","3","4","5","6","7","8","9"],["eq1","eq1","eq1","eq1","eq1","eq1","eq2","eq2","eq2"],["(Intercept)","lprice","mon","tue","wed","thu","(Intercept)","lprice","stormy"],[8.5059112890502,-1.11941694703997,-0.0254021646376243,-0.530769384683624,-0.56635107482246,0.109267314500112,8.62835440243637,0.0010593145839648,-0.363246058871382],[0.166166893894006,0.428645030869011,0.214774153720313,0.208000076745794,0.212754855116754,0.208786577906619,0.388970231453113,1.30954696779856,0.464912480042289],[51.1889648396264,-2.61152437663987,-0.118273843465839,-2.55177494637321,-2.66198895678157,0.523344534862691,22.18255718491,0.000808916831555558,-0.781321376527343],[0,0.0103334470784988,0.906076649619626,0.0121574239875613,0.00898948735794836,0.601837263643839,0,0.999356070103824,0.436322895676659]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>eq<\/th>\n      <th>vars<\/th>\n      <th>Estimate<\/th>\n      <th>Std. Error<\/th>\n      <th>t value<\/th>\n      <th>Pr(&gt;|t|)<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","columnDefs":[{"targets":3,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 4, 3, \",\", \".\", null);\n  }"},{"targets":4,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 4, 3, \",\", \".\", null);\n  }"},{"targets":5,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 4, 3, \",\", \".\", null);\n  }"},{"targets":6,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 4, 3, \",\", \".\", null);\n  }"},{"className":"dt-center","targets":"_all"},{"visible":false,"targets":0},{"orderable":false,"targets":0}],"pageLength":10,"order":[],"autoWidth":false,"orderClasses":false}},"evals":["options.columnDefs.0.render","options.columnDefs.1.render","options.columnDefs.2.render","options.columnDefs.3.render"],"jsHooks":[]}</script>

---
### Two-stage least squares (2SLS) regression results

.scroll-box-20[


```

systemfit results 
method: 2SLS 

         N  DF SSR detRCov OLS-R2 McElroy-R2
system 222 213 110   0.107  0.094     -0.598

      N  DF  SSR   MSE  RMSE    R2 Adj R2
eq1 111 105 52.1 0.496 0.704 0.139  0.098
eq2 111 108 57.5 0.533 0.730 0.049  0.032

The covariance matrix of the residuals
      eq1   eq2
eq1 0.496 0.396
eq2 0.396 0.533

The correlations of the residuals
      eq1   eq2
eq1 1.000 0.771
eq2 0.771 1.000


2SLS estimates for 'eq1' (equation 1)
Model Formula: lquan ~ lprice + mon + tue + wed + thu
Instruments: ~mon + tue + wed + thu + stormy

            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   8.5059     0.1662   51.19   &lt;2e-16 ***
lprice       -1.1194     0.4286   -2.61    0.010 *  
mon          -0.0254     0.2148   -0.12    0.906    
tue          -0.5308     0.2080   -2.55    0.012 *  
wed          -0.5664     0.2128   -2.66    0.009 ** 
thu           0.1093     0.2088    0.52    0.602    
---
Signif. codes:  
0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.704 on 105 degrees of freedom
Number of observations: 111 Degrees of Freedom: 105 
SSR: 52.09 MSE: 0.496 Root MSE: 0.704 
Multiple R-Squared: 0.139 Adjusted R-Squared: 0.098 


2SLS estimates for 'eq2' (equation 2)
Model Formula: lquan ~ lprice + stormy
Instruments: ~mon + tue + wed + thu + stormy

            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  8.62835    0.38897   22.18   &lt;2e-16 ***
lprice       0.00106    1.30955    0.00     1.00    
stormy      -0.36325    0.46491   -0.78     0.44    
---
Signif. codes:  
0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.73 on 108 degrees of freedom
Number of observations: 111 Degrees of Freedom: 108 
SSR: 57.522 MSE: 0.533 Root MSE: 0.73 
Multiple R-Squared: 0.049 Adjusted R-Squared: 0.032 
```

]

---


### Comparison: the biased OLS estimation

- tidy results of **bias** OLS estimation  for the demand equation:

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{lquan}=&amp;&amp;+8.61&amp;&amp;-0.56lprice&amp;&amp;+0.01mon&amp;&amp;-0.52tue&amp;&amp;-0.56wed&amp;&amp;+0.08thu\\ &amp;\text{(t)}&amp;&amp;(60.1698)&amp;&amp;(-3.3443)&amp;&amp;(0.0706)&amp;&amp;(-2.6114)&amp;&amp;(-2.7450)&amp;&amp;(0.4126)\\&amp;\text{(se)}&amp;&amp;(0.1430)&amp;&amp;(0.1682)&amp;&amp;(0.2026)&amp;&amp;(0.1977)&amp;&amp;(0.2023)&amp;&amp;(0.1978)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.2205;&amp;&amp; \bar{R^2}=0.1834\\&amp; &amp;&amp; F^{\ast}=5.94;&amp;&amp; p=0.0001 \end{alignedat} \end{equation}$$`

- tidy results of **bias** OLS estimation  for the supply equation:

`$$\begin{equation} \begin{alignedat}{999} &amp;\widehat{lquan}=&amp;&amp;+8.50&amp;&amp;-0.44lprice&amp;&amp;-0.22stormy\\ &amp;\text{(t)}&amp;&amp;(86.6914)&amp;&amp;(-2.2560)&amp;&amp;(-1.3253)\\&amp;\text{(se)}&amp;&amp;(0.0981)&amp;&amp;(0.1942)&amp;&amp;(0.1630)\\&amp;\text{(fitness)}&amp;&amp; R^2=0.0923;&amp;&amp; \bar{R^2}=0.0755\\&amp; &amp;&amp; F^{\ast}=5.49;&amp;&amp; p=0.0053 \end{alignedat} \end{equation}$$`

---

### Comparison: the biased OLS estimation

- raw R summry of **bias** OLS estimation for the demand equation:

.scroll-box-18[


```

Call:
lm(formula = fish.D, data = fultonfish)

Residuals:
    Min      1Q  Median      3Q     Max 
-2.2384 -0.3674  0.0883  0.4230  1.2487 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   8.6069     0.1430   60.17   &lt;2e-16 ***
lprice       -0.5625     0.1682   -3.34   0.0011 ** 
mon           0.0143     0.2026    0.07   0.9438    
tue          -0.5162     0.1977   -2.61   0.0103 *  
wed          -0.5554     0.2023   -2.75   0.0071 ** 
thu           0.0816     0.1978    0.41   0.6807    
---
Signif. codes:  
0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.67 on 105 degrees of freedom
Multiple R-squared:  0.22,	Adjusted R-squared:  0.183 
F-statistic: 5.94 on 5 and 105 DF,  p-value: 7.08e-05
```

]

---

### Comparison: the biased OLS estimation

- raw R summry of **bias** OLS estimation for the supply equation:


```

Call:
lm(formula = fish.S, data = fultonfish)

Residuals:
    Min      1Q  Median      3Q     Max 
-2.4042 -0.3754  0.0734  0.5197  1.2267 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   8.5009     0.0981   86.69   &lt;2e-16 ***
lprice       -0.4381     0.1942   -2.26    0.026 *  
stormy       -0.2160     0.1630   -1.33    0.188    
---
Signif. codes:  
0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.71 on 108 degrees of freedom
Multiple R-squared:  0.0923,	Adjusted R-squared:  0.0755 
F-statistic: 5.49 on 2 and 108 DF,  p-value: 0.00534
```

---
layout:false
background-image: url("../pic/thank-you-gif-funny-little-yellow.gif")
class: inverse,center
# End of this chapter!

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
