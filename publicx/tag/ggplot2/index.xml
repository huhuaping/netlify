<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>ggplot2 | Academic</title>
    <link>https://huhuaping.netlify.app/tag/ggplot2/</link>
      <atom:link href="https://huhuaping.netlify.app/tag/ggplot2/index.xml" rel="self" type="application/rss+xml" />
    <description>ggplot2</description>
    <generator>Wowchemy (https://wowchemy.com)</generator><language>en-us</language><copyright>huhuaping@2019</copyright><lastBuildDate>Sat, 07 Mar 2020 00:00:00 +0000</lastBuildDate>
    <image>
      <url>https://huhuaping.netlify.app/media/icon_hua2ec155b4296a9c9791d015323e16eb5_11927_512x512_fill_lanczos_center_2.png</url>
      <title>ggplot2</title>
      <link>https://huhuaping.netlify.app/tag/ggplot2/</link>
    </image>
    
    <item>
      <title>ggplot2绘图细节及美化技巧</title>
      <link>https://huhuaping.netlify.app/2020/03/07/ggplot2-refined-adjustment-skills/</link>
      <pubDate>Sat, 07 Mar 2020 00:00:00 +0000</pubDate>
      <guid>https://huhuaping.netlify.app/2020/03/07/ggplot2-refined-adjustment-skills/</guid>
      <description>

&lt;div id=&#34;TOC&#34;&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;#调整轴题与轴标签之间的间距&#34;&gt;调整轴题与轴标签之间的间距&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#geom_text如何控制字体大小&#34;&gt;geom_text()如何控制字体大小&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#如何给geom_hline添加图例&#34;&gt;如何给geom_hline()添加图例&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#保持读取csv编码正确&#34;&gt;保持读取csv编码正确&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#facet_grid-实现多种图形并存&#34;&gt;facet_grid() 实现多种图形并存&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;

&lt;div id=&#34;调整轴题与轴标签之间的间距&#34; class=&#34;section level1&#34;&gt;
&lt;h1&gt;调整轴题与轴标签之间的间距&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://stackoverflow.com/questions/14487188/increase-distance-between-text-and-title-on-the-y-axis&#34;&gt;Increase distance between text and title on the y-axis&lt;/a&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;ggplot(mpg, aes(cty, hwy)) + geom_point()+
  theme(axis.title.y = element_text(margin = margin(t = 0, r = 20, b = 0, l = 0)))&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;geom_text如何控制字体大小&#34; class=&#34;section level1&#34;&gt;
&lt;h1&gt;geom_text()如何控制字体大小&lt;/h1&gt;
&lt;p&gt;首先，geom_text()的size是按mm计量的。所以并不是跟font size一样的计量规则。所以不要混同二者的度量尺度。（参看&lt;a href=&#34;https://github.com/tidyverse/ggplot2/issues/1828&#34;&gt;The size in geom_text is not a font size&lt;/a&gt;）&lt;/p&gt;
&lt;p&gt;其次，ggplot中字体控制的关系如下。简言之：geom_text()是单独控制字体的！！（参看：&lt;a href=&#34;https://stackoverflow.com/questions/25061822/ggplot-geom-text-font-size-control&#34;&gt;ggplot geom_text font size control&lt;/a&gt;）&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;p &amp;lt;- p + theme(axis.text = element_text(size = 15)) # changes axis labels

p &amp;lt;- p + theme(axis.title = element_text(size = 25)) # change axis titles

p &amp;lt;- p + theme(text = element_text(size = 10)) # this will change all text size 
                                                             # (except geom_text)&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;div id=&#34;如何给geom_hline添加图例&#34; class=&#34;section level1&#34;&gt;
&lt;h1&gt;如何给geom_hline()添加图例&lt;/h1&gt;
&lt;p&gt;给geom_hline&lt;a href=&#34;https://stackoverflow.com/questions/39119917/how-to-add-a-legend-to-hline&#34;&gt;添加图例&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;保持读取csv编码正确&#34; class=&#34;section level1&#34;&gt;
&lt;h1&gt;保持读取csv编码正确&lt;/h1&gt;
&lt;p&gt;&lt;a href=&#34;https://stackoverflow.com/questions/46996501/readrread-csv-issue-chinese-character-becomes-messy-codes&#34;&gt;编码正确&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div id=&#34;facet_grid-实现多种图形并存&#34; class=&#34;section level1&#34;&gt;
&lt;h1&gt;facet_grid() 实现多种图形并存&lt;/h1&gt;
&lt;p&gt;facet_grid()可以同时绘制多个子图，但是默认情况下每个子图都是同一种类型，如都是line，或都是point。&lt;/p&gt;
&lt;p&gt;下面是多个子图不同类型的实现思路&lt;a href=&#34;#fn1&#34; class=&#34;footnote-ref&#34; id=&#34;fnref1&#34;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/a&gt; &lt;a href=&#34;#fn2&#34; class=&#34;footnote-ref&#34; id=&#34;fnref2&#34;&gt;&lt;sup&gt;2&lt;/sup&gt;&lt;/a&gt;：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;保持数据为long format data格式&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;设定一个factor作为子图分类。 factor levels 将决定子图的个数。&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;绘制空白图p1。含有factor levels个数的子图，data为全数据集。&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;通过subset()函数选定数据子集，并分别叠加绘制在p1上,直至所有空白子图都绘制完成。子图的geom_xxx()可以各不相同。&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;一个样本案例可以参照：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;# for column select
got_vars &amp;lt;- c(&amp;quot;bigtractor&amp;quot;,&amp;quot;bigtractor1&amp;quot;, &amp;quot;smalltractor&amp;quot;, &amp;quot;smalltractor1&amp;quot;, &amp;quot;match_big&amp;quot;, &amp;quot;match_small&amp;quot;)

# gather for facet
smry_tractor &amp;lt;- smry %&amp;gt;%
  filter(region_pro == &amp;quot;旱区&amp;quot;) %&amp;gt;%
  select(one_of(c(&amp;quot;year&amp;quot;, &amp;quot;region_pro&amp;quot;, got_vars))) %&amp;gt;%
  gather(key=&amp;quot;variables&amp;quot;, value=&amp;quot;value&amp;quot;, bigtractor:match_small) %&amp;gt;%
  mutate(mark = as.factor(if_else(str_detect(variables, &amp;quot;bigtractor.?&amp;quot;), 
                        &amp;quot;bigtractor&amp;quot;,
                        if_else(str_detect(variables, &amp;quot;^smalltractor&amp;quot;),
                                &amp;quot;smalltractor&amp;quot;,
                                if_else(str_detect(variables, &amp;quot;^match&amp;quot;),
                                        &amp;quot;match&amp;quot;,
                                        &amp;quot;NA&amp;quot;))))) %&amp;gt;%
  mutate(mark= fct_relevel(mark,&amp;quot;bigtractor&amp;quot;, &amp;quot;smalltractor&amp;quot;, &amp;quot;mathch&amp;quot;))

# list for facet labels                       
list_chn &amp;lt;- c(bigtractor=&amp;quot;中大型及配套(万台)&amp;quot;,
              smalltractor=&amp;quot;小型及配套(万台)&amp;quot;, 
              match=&amp;quot;配套比(%)&amp;quot;)

# base plot
p0 &amp;lt;-  ggplot(smry_tractor, aes(factor(year), value)) +
  facet_grid(mark~., 
              scales = &amp;quot;free&amp;quot;,
              labeller = labeller(mark = list_chn)) +
  labs(x =&amp;quot;年份&amp;quot;, y=&amp;quot;&amp;quot;) +
  theme(axis.title.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0)),
        strip.text.y = element_text(size = 8)) # tune facet label font size

# raw 1 plot 
list_big &amp;lt;- c(&amp;quot;bigtractor&amp;quot;, &amp;quot;bigtractor1&amp;quot;) # for subset
list_text &amp;lt;- c(&amp;quot;中大型&amp;quot;, &amp;quot;中大型配套&amp;quot;, &amp;quot;小型&amp;quot;, &amp;quot;小型配套&amp;quot;) # for legend text
p1 &amp;lt;-  p0 +
   geom_bar( subset(smry_tractor, variables %in% list_big),
             mapping = aes(fill = variables),
             stat = &amp;quot;identity&amp;quot;, position = &amp;quot;stack&amp;quot;) +
  geom_text( subset(smry_tractor, variables %in% list_big),
             mapping = aes(label = round(value,0)),
             position = position_stack(vjust = 0.7), size =3) +
  scale_fill_discrete(name = &amp;quot;&amp;quot;, labels = list_text)

# raw 2 plot 
list_small &amp;lt;- c(&amp;quot;smalltractor&amp;quot;, &amp;quot;smalltractor1&amp;quot;) # for subset
p2 &amp;lt;- p1 +
  geom_bar( subset(smry_tractor, variables %in% list_small),
            mapping = aes(fill = variables),
            stat = &amp;quot;identity&amp;quot;, position = &amp;quot;stack&amp;quot;) +
  geom_text( subset(smry_tractor, variables %in% list_small),
             mapping = aes(label = round(value,0)),
             position = position_stack(vjust = 0.7), size =3) +
  scale_fill_discrete(name = &amp;quot;&amp;quot;, labels = list_text)

# raw 3 plot  
list_match &amp;lt;- c(&amp;quot;match_big&amp;quot;, &amp;quot;match_small&amp;quot;) # for subset
list_text &amp;lt;- c(&amp;quot;中大型&amp;quot;, &amp;quot;小型&amp;quot;)  # for legend text
p3 &amp;lt;- p2 +
   geom_line( subset(smry_tractor, variables %in% list_match),
              mapping = aes(linetype = variables, group = variables)) +
   geom_point( subset(smry_tractor, variables %in% list_match),
               mapping = aes(color = variables, group = variables)) +
   geom_text_repel( subset(smry_tractor, variables %in% list_match),
                    mapping = aes(label = formatC(value,1, format = &amp;quot;f&amp;quot;)), 
                    direction =&amp;quot;both&amp;quot;, size =3) +
  scale_linetype_discrete(name = &amp;quot;&amp;quot;, labels = list_text) +
  scale_color_discrete(name = &amp;quot;&amp;quot;, labels = list_text) +
  guides(fill = guide_legend(order = 1))  # tune legend order
 
 p3&lt;/code&gt;&lt;/pre&gt;
&lt;div class=&#34;figure&#34;&gt;&lt;span id=&#34;fig:unnamed-chunk-1&#34;&gt;&lt;/span&gt;
&lt;img src=&#34;pic/facet-multiple-geom.png&#34; alt=&#34;include_graphics函数方法插入图片&#34; width=&#34;826&#34; /&gt;
&lt;p class=&#34;caption&#34;&gt;
Figure 1: include_graphics函数方法插入图片
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;footnotes&#34;&gt;
&lt;hr /&gt;
&lt;ol&gt;
&lt;li id=&#34;fn1&#34;&gt;&lt;p&gt;&lt;a href=&#34;https://learnr.wordpress.com/2009/05/18/ggplot2-three-variable-time-series-panel-chart/&#34;&gt;ggplot2: Three Variable Time Series Panel Chart&lt;/a&gt;&lt;a href=&#34;#fnref1&#34; class=&#34;footnote-back&#34;&gt;↩︎&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li id=&#34;fn2&#34;&gt;&lt;p&gt;&lt;a href=&#34;https://statbandit.wordpress.com/2011/07/29/a-ggplot-trick-to-plot-different-plot-types-in-facets/&#34;&gt;A GGPLOT TRICK TO PLOT DIFFERENT PLOT TYPES IN FACETS&lt;/a&gt;&lt;a href=&#34;#fnref2&#34; class=&#34;footnote-back&#34;&gt;↩︎&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>Latex pdf和html输出下ggplot绘图中文字体显示问题</title>
      <link>https://huhuaping.netlify.app/2019/07/04/chinese-character-in-graph-consistence-with-both-latex-and-html/</link>
      <pubDate>Thu, 04 Jul 2019 00:00:00 +0000</pubDate>
      <guid>https://huhuaping.netlify.app/2019/07/04/chinese-character-in-graph-consistence-with-both-latex-and-html/</guid>
      <description>


&lt;p&gt;中文字体问题总是会在时不时出来捣乱。今天就碰到了ggplot2绘图时，latex pdf输出和html网页输出显示不一致的问题（类似的 &lt;a href=&#34;https://community.rstudio.com/t/chinese-characters-in-ggplot-on-macos/4429&#34;&gt;问题报告&lt;/a&gt;）。&lt;/p&gt;
&lt;div id=&#34;section&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;问题描述&lt;/h2&gt;
&lt;p&gt;google神搜一遍，大家普遍把问题指向：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;操作系统OS问题。Linux/Mac OS普遍采用UTF-8编码格式，而Windows系统则坚持GBK编码格式。因此，如果Rstudio里Rmarkdown文件用UTF-8编码，自然就会导致Windowns粉出现悲催的混乱事件。Windowns系统下还可能存在本地字体库不全的问题。&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;中文字体库问题。除了系统阵营的锅，中文字体本身也会给编码世界带来混乱。其实不单是中文字体，CJK字体库就是专门为了解救中文-日文-韩文字体等东亚语言字体问题的。另外就是，字体库有“真体”（TrueType Collection 字体文件 (.ttc)）等字体版本。因此，latex包&lt;code&gt;\usepackage{xeCJK}&lt;/code&gt;渲染时，可能会提示错误（&lt;a href=&#34;https://github.com/CTeX-org/ctex-kit/issues/316&#34;&gt;类似报告1&lt;/a&gt;；&lt;a href=&#34;https://blog.csdn.net/RobertChenGuangzhi/article/details/48979285&#34;&gt;报告2&lt;/a&gt;）&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;engine或dev问题。第三个锅就是软件的问题了。其一，bookdown下默认的Latex引擎&lt;code&gt;pdflatex&lt;/code&gt;对&lt;strong&gt;Unicode characters&lt;/strong&gt;支持不好，需要改用&lt;code&gt;xelatex&lt;/code&gt;引擎（&lt;a href=&#34;https://github.com/yihui/tinytex/issues/35&#34;&gt;yihuixie留爪&lt;/a&gt;）。其二，绘图装置dev也有小九九&lt;a href=&#34;https://github.com/rstudio/rmarkdown/issues/213&#34;&gt;类似报告&lt;/a&gt;。最关键的是绘图装置可以自己根据需要设定，包括：dev=‘cairo_pdf’；dev=‘pdf’；dev=‘svg’（见&lt;a href=&#34;https://github.com/rstudio/rmarkdown/issues/111&#34;&gt;友情提示&lt;/a&gt;）。&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div id=&#34;section-1&#34; class=&#34;section level2&#34;&gt;
&lt;h2&gt;解决办法&lt;/h2&gt;
&lt;ol style=&#34;list-style-type: decimal&#34;&gt;
&lt;li&gt;&lt;p&gt;（windowns系统）安装缺少的字体库。大概就先去看看“c:/windows/fonts”目录吧！。也可以在R中用package如 &lt;code&gt;&#34;showtext&#34;&lt;/code&gt;来安装。——不说这个了，都是泪。&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;latex中设定header.tex的包调用。最重要的&lt;code&gt;\usepackage{xeCJK}&lt;/code&gt;，大抵如下：&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code&gt;\usepackage{xeCJK}
%\setCJKmainfont{SimSun}
\setCJKmainfont{宋体}  % 字体可以更换
\setCJKmonofont{simsun.ttc} % for \textsf
\setmainfont{宋体} % 設定英文字型
\setromanfont{Georgia} % 字型
\setmonofont{Courier New}&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;3&#34; style=&#34;list-style-type: decimal&#34;&gt;
&lt;li&gt;Rmarkdown中设定engine和dev。这个地方倒是有一个逻辑性的问题我之前一直没有弄清楚。engine设好后（如前，最好用&lt;code&gt;xelatex&lt;/code&gt;引擎），不同输出形式（pdf、html）对绘图转置dev需求是不一样的，因此需要考虑latex_engine和dev所处的&lt;strong&gt;环境&lt;/strong&gt;。这个&lt;strong&gt;环境&lt;/strong&gt;不一样，控制的范围自然就不同，但大概有三个级别：a. yaml区域的全局性&lt;code&gt;- output&lt;/code&gt;环境； b. R代码块的文档级设置；c.特定R代码块的设置。&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code&gt;环境1：yaml区域的全局性设置
output: 
  bookdown::pdf_document2:
    latex_engine: xelatex
    dev: cairo_pdf
    &lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;环境2：R代码块的文档级设置
{r global_options,echo=FALSE, message=FALSE}
knitr::opts_chunk$set(fig.align=&amp;#39;center&amp;#39;, dev=&amp;quot;cairo_pdf&amp;quot;,
                      echo=FALSE, fig.pos = &amp;#39;H&amp;#39;) #
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;环境3：特定绘图R代码块环境
{r common-get-sum,echo=FALSE, dev=&amp;quot;cairo_pdf&amp;quot;, message=FALSE,error=FALSE,warning=F, fig.width=10,fig.height=7,fig.cap=&amp;quot;学生累计获得通识课程学分情况&amp;quot;}

ggplot() +
  theme(text=element_text(family=&amp;quot;Batang&amp;quot;, size=12))&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;总结起来，最后的问题解决就是：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;更改pdf&lt;strong&gt;全局性环境&lt;/strong&gt;的引擎为latex_engine: xelatex。&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;更改pdf&lt;strong&gt;全局性环境&lt;/strong&gt;里绘图装置为：dev: cairo_pdf。设好后就不要画蛇添足再在环境2或环境3中做额外配置了。因为控制范围是不一样的！html输出默认绘图转置为dev: cairo_pdf&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;因为字体库问题，还得在绘图R代码块里指定一个能够显示的字体。如&lt;code&gt;theme(text=element_text(family=&#34;Batang&#34;, size=12))&lt;/code&gt;。&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;最后，html和pdf显示都一致啦！！&lt;/p&gt;
&lt;/div&gt;
</description>
    </item>
    
  </channel>
</rss>
