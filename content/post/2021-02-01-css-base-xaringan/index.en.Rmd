---
title: CSS突击：xaringan美化
author: huhuaping
date: '2021-02-01'
slug: css-base-xaringan
categories:
  - R
tags:
  - Xaringan
  - CSS
subtitle: ''
summary: ''
authors: [胡华平]
lastmod: '2021-02-01T09:23:57+08:00'
featured: no
image:
  caption: ''
  focal_point: ''
  preview_only: no
projects: []
output:
  blogdown::html_page:
    toc: true
    number_sections: true
---

# CSS基础

## CSS selector

| 类型                                                                                                        | 含义         | 子类                           | 语法  | 示例             |
|-------------------------------------------------------------------------------------------------------------|--------------|--------------------------------|-------|------------------|
| Simple selector                                                                                             |              | ID                             | \#    | \#para1 { }      |
|                                                                                                             |              | class/name                     | .     | .center{ }       |
|                                                                                                             |              | Attribute selector             | [ ]   |                  |
|                                                                                                             |              | Universal Selector             | \*    | \* { }           |
|                                                                                                             |              | Grouping Selector              | ,     | h1, h2, p { }    |
| Combinator selector                                                                                         | relationship | Descendant                     | space | div p { }        |
|                                                                                                             |              | Child                          | \>    | div \> p { }     |
|                                                                                                             |              | Adjacent sibling               | \+    | div + p { }      |
|                                                                                                             |              | General sibling                | \~    | div \~ p { }     |
| [Pseudo -class selector](https://www.w3schools.com/css/css_pseudo_classes.asp "All CSS Pseudo Classes")     | state        | Mouse over/ visited link/focus | :     | a:link {}        |
| [Pseudo -element selector](https://www.w3schools.com/css/css_pseudo_elements.asp "All CSS Pseudo Elements") | part         | First letter/ line/ element    | ::    | ::first-line { } |
|                                                                                                             |              | Insert content before or after | ::    | p::after { }     |

: CSS selector

## CSS layout

-   布局：margin；border；padding

-   位置：position: static/relative/fixed/absolute/sticky

-   定位：top/right/bottom/left

# Xaringan的本质

Xaringan背后是基于remark.js的。remark.js后台基本工作流程，就是采用JavaScript语言把markdown文档，**映射**到html上，并形成独特的slide幻灯片样式。因此，还是很有必要了解一下remark.js的说明文档（见[Wiki页面](https://github.com/gnab/remark/wiki)）。那么Xaringan包又起到了什么作用呢？根据yihui的说法：它扩展支持了Rmarkdown语法以及R代码的直接运行！

Xaringan本质上是以html形态呈现，并使用css样式进行style视觉美化。Xaringan的技术讨论和细节见其[wiki页面](https://github.com/yihui/xaringan/wiki)。

归结起来这是对slide工具的一种选择，而且是选择了"未来感"的html呈现形态！那么CSS知识这是绕不过去的学习壁垒。html和css的学习至少也是需要在"三姑学院"（[W3school](https://www.w3schools.com/css/default.asp)）的汪洋里过水"捞一遍"（通读一遍）。

# Xaringan的CSS美化

## 头衬和底衬（header and footer） {#layout-html}

调整header和footer视觉效果，主要是从某个slide开始里设定`layout: true`，并按html语法设置header和footer样式。其完整的语法如下：

``` {.html}
<!---slide area with layout--->
---
layout: true

<div class="my-header-h2"></div>

<div class="watermark1"></div>

<div class="watermark2"></div>

<div class="watermark3"></div>

<div class="my-footer"><span>huhuaping@  &emsp;&emsp; <a href="#chapter01"> 第01章 导论</a>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
<a href="#sec-process">1.3 计量经济学分析过程</a> </span></div> 
---
```

具体样式细节包括：

-   heading文本居中设定。需要注意叠放层级参数`z-index`的设置。

``` {.css}
.remark-slide-content h2, h3,h4,h5{
  position: relative;
  top: 0px;
  margin: 15px 0px 50px;
  width: 99%;
  text-shadow: 0px 0px;
  text-align: center;
  z-index: 5;
}
```

-   header背景色和渐变方式。

``` {.css}
div.my-header-h2 {
    background-color: #FFFFFF;
    background: -webkit-gradient(linear, left top, right top, color-stop(0%,#f77a00), color-stop(0%,#f77a00), color-stop(10%,red), color-stop(74%,#fbd0ac), color-stop(83%,#fbd0ac), color-stop(100%,#fddfc8));
    position: fixed;
    top: 0px;
    left: 0px;
    height: 86.92913px;
    width: 100%;
}
```

-   footer导航样式。

``` {.css}
div.my-footer {
    background-color: #272822;
    position: absolute;
    bottom: 0px;
    left: 0px;
    height: 20px;
    width: 100%;
}

div.my-footer span {
    font-size: 10pt;
    color: #F7F8FA;
    position: absolute;
    left: 15px;
    bottom: 2px;
}
```

-   footer的导航链接功能。先在css里设定链接文本的颜色，然后在slide里设定`layout: true`（见前面完整[语句块](#layout-html)），并按html语法设定链接定位`#a-specify-id`。

``` {.css}
/* link text color*/
div.my-footer a {
  color: white;
  background-color: transparent;
  text-decoration: none;
}
```

## 个性水印图片（watermark）

水印图片的个性化设定。首先需要设定css，然后在slide里设定`layout: true`（见前面完整[语句块](#layout-html)），并按html语法依次设定三个水印图片，其中之一如`<div class="watermark1"></div>`。

``` {.css}
/* water remark image */

.watermark1::after {
  content: "";
  display: block;
  width: 30%;
  height: 20%;
  position: absolute;
  top: 150px;
  left: 100px;
  background-image: url("vlog-nwsuaf.jpg");
  background-size: 80%;
  background-position: 0px 20px;
  background-repeat: no-repeat;
  opacity: 0.04;  
  /* Rotate div */
 -ms-transform: rotate(-45deg); /* IE 9 */
 -moz-transform: rotate(-45deg); /* firefox */
 -webkit-transform: rotate(-45deg); /* Chrome, Safari, Opera */
 transform: rotate(-45deg);
}
```

## 各类窗框（notes box）

在多个写作场景下（如`xaringan`、`blogdown`、`rmarkdown`），可能会用到各类提示窗框（notes box）。可以利用css设定获得个性化的提示窗框效果，具体可参看desirée de leon的博文[^1]。


```{r, echo=FALSE}
knitr::include_graphics("/pic/div-tip-annotate.png", error = FALSE)
```

基本要点：

- 背后要用到html的`div`语块

- 可以借用R包`bookdown`的`blocks`代码块，进行快捷应用。


第一步：css文件（`/my-css/notes-tips.css`）设定如下：

```{css}
/* -----------div tips------------- */

div.puzzle, div.fyi, div.demo, div.notes {
    padding: 0.5em;
    margin: 0.5em 0;
    padding-left: 100px;
    background-size: 70px;
    background-repeat: no-repeat;
    background-position: 15px center;
    min-height: 100px;
    color: #1f5386;
    background-color: #bed3ec;
    border: solid 5px #dfedff;
}

div.notes {
  background-image: url("notes-light-bulb-ff5500.png");
}

```

> 注意：需要自己手动下载背景图片，免费的图片icon下载网站有：

>- [aiconica.net](https://aiconica.net/)。
- [fontawesome.com](https://fontawesome.com/)。正文里还可使用R函数`fontawesome::fa('slideshare')`。例如slide图标`r fontawesome::fa('slideshare', fill= "blue")`

第二步：在`.Rmd`文件的`yaml`区域引用上面的css文件路径。

```
css: 
  - ../mycss/notes-tips.css
```


第三步：在`.Rmd`文件下进行写作，并引用对应的css样式：

``````
` ``{block, type='notes', echo=T}

待完成：找到新数据，绘制一张条形图，但其不适合制作柱状图。

` ``
``````




# 下一步需要处理的CSS问题

-   解决字体灵活选用问题。工作量理论上不是很大，主要是受到中文字体适用性和加载速度等的限制。目前暂时还不想去碰它，大众字体就大众字体，先忍一忍。具体看yihui的相关思考和说明。如[思源宋体](https://yihui.org/cn/2017/04/source-han-serif/) ；[楷体](https://yihui.org/cn/2017/02/kaiti/#fnref:-1)。

-   提前准备好各类丰富slide功能的css实现方法。具体明确的一些炫酷功能,相关css样板可以参看：a)Remark.js推荐的三个[Remark templates](https://github.com/gnab/remark/wiki/HTML-CSS-JS-samples)；尤其推荐Story模板[Remark-Apron](https://story.xaprb.com/slides/adirondack/#5)。另外，有空还要好好看看`xaringanthemer`[R包](https://github.com/gadenbuie/xaringanthemer)。

-   页面紧凑度和宽松度灵活调整。例如`remark-slide-content.roomy`。

-   图文混排技巧。

-   正文符号列表的前导符设定问题。

# 最后的若干思考和感受

这次对Xaringan 又一次发起冲锋，直接缘由是《计量经济学》双一流课程团队的视频录制。团队里其他人都不用R和Rmarkdown，更不要提Xaringan slide了。大家仍旧还是基于PowerPoint准备和制作授课幻灯片，有的老师甚至操作系统还是win7，office套件还是2010版！所以只能我事先用powerpoint设定好ppt模板，大家各自拿去制作自己的授课ppt（其实大部分团队老师甚至连ppt母版也不会用）。考虑到我自己的实际需求，我是希望能同时兼顾自己使用xaringan 和团队其他老师使用ppt的一致性------当然是不能奢求最后两者视觉效果的完全一样！目前在Xaringan上的设定调整，基本上达到了ppt模板类似效果的80%左右。

事实上，Xaringan和ppt二者效果一致性的达成，并不是最大的挑战。基本上基于html的Xaringan slide，可以使用css技巧实现ppt里的几乎所有功能。而况Xaringan还有很多ppt无法实现的"现代的"以及"未来的"诸多功能！真正的挑战在于团队协作，尤其是对于非常技术守旧的团队（并不指技术之外的其他方面）。到此，我的基本态度就是：最低限度地在技术方面与其他人协作，重点是把协作任务下自己事情做完、基本ok即可！

当然，这里面也还有一个在协作冲突中推动自己不断学习进步的问题。显然，如果没有这次的协作录制课程，我肯定还是会一如往常地坚持"最小化学习"策略：也即如无实际所需，绝不去茫然学习所谓的各种知识技能。这一次，我充分认识到了CSS对于Xaringan甚至对于Html的重要性，并且看到了一些文档协作、协作和输出的"未来"趋势和走向！


[^1]:[MAKING PRETTY NOTE BOXES: A div tip for all occasions](https://desiree.rbind.io/post/2019/making-tip-boxes-with-bookdown-and-rmarkdown/)