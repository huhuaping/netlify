---
title: R函数踩坑
author: huhuaping
date: '2021-02-23'
slug: variaty-of-r-function
categories:
  - R
tags:
  - R beginer
subtitle: 'variaty of R function'
summary: '日常碰到的常用的统计分析场景，但是容易有坑的R函数操作。'
authors: [胡华平]
lastmod: '2021-02-23T11:45:07+08:00'
featured: no
math: yes
image:
  caption: ''
  focal_point: ''
  preview_only: no
projects: []
output:
  blogdown::html_page:
    toc: true
    number_sections: true
---

# 分析场景与R包

## 统计制表 vs janitor::tabyl

tabyls: a tidy, fully-featured approach to counting things. [see link](https://cran.r-project.org/web/packages/janitor/vignettes/tabyls.html)

- **优点**：

    - 方便统计频次和频率
    
    - 方便添加行合计
    
    - 方便调整数据格式（百分数等）
    
    - 可以结合`knitr::kable()`输出


- **不足**：

    - `janitor::tabyl()`仅适合处理**原始数据**，并且是`data.frame`或`vector`。


# 分析场景与R函数

## 数据类型读取

- 读取spss文件。为了避免出现编码错误（中文等多字节问题），建议使用`foreign::read.spss()`函数，而不宜使用`haven::read_sav()`函数

```{r, eval=FALSE, echo=T}
df_computer<- haven::read_sav("../data/case-3.6-computer-sales.sav",encoding = "UTF-8", .name_repair = "unique")

knitr::kable(df_computer)
```

```{r, eval=FALSE, echo=T}
df_computer<- foreign::read.spss("../data/case-3.6-computer-sales.sav", to.data.frame=TRUE)
knitr::kable(df_computer)
```


## 生成重复数据rep()

**分析场景**：生成指定的重复数据，要求指定被重复的`vector("char vec")`，以及指定各自重复的次数`vector("times vec")`。

- **踩坑函数1**：直接`rep()`。

```{r, echo=T, message=FALSE, comment= ""}
require(magrittr)
brand<- c("果汁","矿泉水","绿茶","其他","碳酸饮料")
reps <- c(6L, 10L,11L, 8L,15L)

rep(brand, reps)

```

- **踩坑函数2**：`mapply()` + `rep()`。这个要复杂一点。

```{r, comment=""}
drink <- mapply(FUN = rep, x=brand, times = reps) %>%
  unlist()

names(drink) <-NULL

drink
```


